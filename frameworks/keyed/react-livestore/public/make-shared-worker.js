var CW=Object.defineProperty;var NT=Ce=>{throw TypeError(Ce)};var RW=(Ce,l,R)=>l in Ce?CW(Ce,l,{enumerable:!0,configurable:!0,writable:!0,value:R}):Ce[l]=R;var a=(Ce,l,R)=>RW(Ce,typeof l!="symbol"?l+"":l,R),xT=(Ce,l,R)=>l.has(Ce)||NT("Cannot "+R);var wn=(Ce,l,R)=>(xT(Ce,l,"read from private field"),R?R.call(Ce):l.get(Ce)),xg=(Ce,l,R)=>l.has(Ce)?NT("Cannot add the same private member more than once"):l instanceof WeakSet?l.add(Ce):l.set(Ce,R),Dg=(Ce,l,R,Lr)=>(xT(Ce,l,"write to private field"),Lr?Lr.call(Ce,R):l.set(Ce,R),R);(function(){"use strict";var Jc,d$,m$,g$,p$,y$,S$,b$,_$,w$,E$,k$,v$,$$,T$,O$,I$,C$,R$,F$,P$,M$,A$,N$,x$,D$,L$,K$,U$,q$,j$,z$,B$,W$,H$,V$,J$,G$,Q$,Y$,X$,Z$,eT,tT,nT,rT,sT,oT,iT,cT,aT,uT,lT,fT,hT,dT,mT,gT,pT,yT,ST,bT,_T,wT,ET,kT,vT,$T,TT,OT,IT,Bt,CT,RT,FT,PT,MT,AT,Wt;const Ce=e=>typeof e=="function",l=function(e,t){if(typeof e=="function")return function(){return e(arguments)?t.apply(this,arguments):n=>t(n,...arguments)};switch(e){case 0:case 1:throw new RangeError(`Invalid arity ${e}`);case 2:return function(n,r){return arguments.length>=2?t(n,r):function(s){return t(s,n)}};case 3:return function(n,r,s){return arguments.length>=3?t(n,r,s):function(o){return t(o,n,r)}};case 4:return function(n,r,s,o){return arguments.length>=4?t(n,r,s,o):function(i){return t(i,n,r,s)}};case 5:return function(n,r,s,o,i){return arguments.length>=5?t(n,r,s,o,i):function(c){return t(c,n,r,s,o)}};default:return function(){if(arguments.length>=e)return t.apply(this,arguments);const n=arguments;return function(r){return t(r,...n)}}}},R=e=>e,Lr=e=>()=>e,Lg=Lr(!0),Ps=Lr(!1),Kg=Lr(void 0),of=Kg,LT=e=>{throw new Error("Called `absurd` function which should be uncallable")};function h(e,t,n,r,s,o,i,c,u){switch(arguments.length){case 1:return e;case 2:return t(e);case 3:return n(t(e));case 4:return r(n(t(e)));case 5:return s(r(n(t(e))));case 6:return o(s(r(n(t(e)))));case 7:return i(o(s(r(n(t(e))))));case 8:return c(i(o(s(r(n(t(e)))))));case 9:return u(c(i(o(s(r(n(t(e))))))));default:{let f=arguments[0];for(let d=1;d<arguments.length;d++)f=arguments[d](f);return f}}}const Kr=e=>(t,n)=>t===n||e(t,n),KT=(e,t)=>e===t,UT=KT,Ug=l(2,(e,t)=>Kr((n,r)=>e(t(n),t(r)))),qT=Ug(UT,e=>e.getTime()),jT=e=>Kr((t,n)=>{if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(!e(t[r],n[r]))return!1;return!0}),zT=e=>l(2,(t,n)=>e(t,r=>({[n]:r}))),BT=(e,t)=>l(3,(n,r,s)=>t(n,o=>e(s(o),i=>Object.assign({},o,{[r]:i}))));let WT="3.7.2";const Gc=()=>WT,cf=Symbol.for(`effect/GlobalValue/globalStoreId/${Gc()}`);cf in globalThis||(globalThis[cf]=new Map);const af=globalThis[cf],Q=(e,t)=>(af.has(e)||af.set(e,t()),af.get(e)),HT=e=>e instanceof Set,Tt=e=>typeof e=="string",En=e=>typeof e=="number",Ur=e=>typeof e=="boolean",Qc=e=>typeof e=="bigint",Yc=e=>typeof e=="symbol",Ms=Ce,VT=e=>e===void 0,JT=e=>!1,qg=e=>typeof e=="object"&&e!==null,Dn=e=>qg(e)||Ms(e),N=l(2,(e,t)=>Dn(e)&&t in e),uf=l(2,(e,t)=>N(e,"_tag")&&e._tag===t),As=e=>e==null,GT=e=>e!=null,QT=e=>e instanceof Uint8Array,jg=e=>e instanceof Date,zg=e=>N(e,Symbol.iterator),lf=e=>qg(e)&&!Array.isArray(e),Bg=e=>N(e,"then")&&Ms(e.then),Xc=e=>`BUG: ${e} - please report an issue at https://github.com/Effect-TS/effect/issues`;let YT=class DT{constructor(t){a(this,"self");a(this,"called",!1);this.self=t}next(t){return this.called?{value:t,done:!0}:(this.called=!0,{value:this.self,done:!1})}return(t){return{value:t,done:!0}}throw(t){throw t}[Symbol.iterator](){return new DT(this.self)}};const XT=335903614,ZT=4150755663,eO=1481765933,tO=1284865837,nO=9007199254740992,rO=134217728;class sO{constructor(t,n,r,s){a(this,"_state");return As(n)&&As(t)?(n=Math.random()*4294967295>>>0,t=0):As(n)&&(n=t,t=0),As(s)&&As(r)?(s=this._state?this._state[3]:ZT,r=this._state?this._state[2]:XT):As(s)&&(s=r,r=0),this._state=new Int32Array([0,0,r>>>0,((s||0)|1)>>>0]),this._next(),Wg(this._state,this._state[0],this._state[1],t>>>0,n>>>0),this._next(),this}getState(){return[this._state[0],this._state[1],this._state[2],this._state[3]]}setState(t){this._state[0]=t[0],this._state[1]=t[1],this._state[2]=t[2],this._state[3]=t[3]|1}integer(t){if(!t)return this._next();if(t=t>>>0,!(t&t-1))return this._next()&t-1;let n=0;const r=(-t>>>0)%t>>>0;for(n=this._next();n<r;n=this._next());return n%t}number(){const t=(this._next()&67108863)*1,n=(this._next()&134217727)*1;return(t*rO+n)/nO}_next(){const t=this._state[0]>>>0,n=this._state[1]>>>0;oO(this._state,t,n,eO,tO),Wg(this._state,this._state[0],this._state[1],this._state[2],this._state[3]);let r=t>>>18,s=(n>>>18|t<<14)>>>0;r=(r^t)>>>0,s=(s^n)>>>0;const o=(s>>>27|r<<5)>>>0,i=t>>>27,c=(-i>>>0&31)>>>0;return(o>>>i|o<<c)>>>0}}function oO(e,t,n,r,s){let o=(n>>>16)*(s&65535)>>>0,i=(n&65535)*(s>>>16)>>>0,c=(n&65535)*(s&65535)>>>0,u=(n>>>16)*(s>>>16)+((i>>>16)+(o>>>16))>>>0;i=i<<16>>>0,c=c+i>>>0,c>>>0<i>>>0&&(u=u+1>>>0),o=o<<16>>>0,c=c+o>>>0,c>>>0<o>>>0&&(u=u+1>>>0),u=u+Math.imul(n,r)>>>0,u=u+Math.imul(t,s)>>>0,e[0]=u,e[1]=c}function Wg(e,t,n,r,s){let o=t+r>>>0;const i=n+s>>>0;i>>>0<n>>>0&&(o=o+1|0),e[0]=o,e[1]=i}const ff=Symbol.for("effect/Utils/YieldWrap");class Zc{constructor(t){xg(this,Jc);Dg(this,Jc,t)}[ff](){return wn(this,Jc)}}Jc=new WeakMap;function iO(e){if(typeof e=="object"&&e!==null&&ff in e)return e[ff]();throw new Error(Xc("yieldWrapGet"))}const Ht=Q("effect/Utils/isStructuralRegion",()=>({enabled:!1,tester:void 0})),ut=(e=>{const t={[e](n){return n()}};return function(n){return t[e](n)}})("effect_internal_function"),hf=Q(Symbol.for("effect/Hash/randomHashCache"),()=>new WeakMap),G=Symbol.for("effect/Hash"),F=e=>{if(Ht.enabled===!0)return 0;switch(typeof e){case"number":return mf(e);case"bigint":return qe(e.toString(10));case"boolean":return qe(String(e));case"symbol":return qe(String(e));case"string":return qe(e);case"undefined":return qe("undefined");case"function":case"object":return e===null?qe("null"):e instanceof Date?F(e.toISOString()):cO(e)?e[G]():df(e);default:throw new Error(`BUG: unhandled typeof ${typeof e} - please report an issue at https://github.com/Effect-TS/effect/issues`)}},df=e=>(hf.has(e)||hf.set(e,mf(Math.floor(Math.random()*Number.MAX_SAFE_INTEGER))),hf.get(e)),ee=e=>t=>t*53^e,ea=e=>e&3221225471|e>>>1&1073741824,cO=e=>N(e,G),mf=e=>{if(e!==e||e===1/0)return 0;let t=e|0;for(t!==e&&(t^=e*4294967295);e>4294967295;)t^=e/=4294967295;return ea(t)},qe=e=>{let t=5381,n=e.length;for(;n;)t=t*33^e.charCodeAt(--n);return ea(t)},aO=(e,t)=>{let n=12289;for(let r=0;r<t.length;r++)n^=h(qe(t[r]),ee(F(e[t[r]])));return ea(n)},Hg=e=>aO(e,Object.keys(e)),Xo=e=>{let t=6151;for(let n=0;n<e.length;n++)t=h(t,ee(F(e[n])));return ea(t)},Pe=function(){if(arguments.length===1){const n=arguments[0];return function(r){return Object.defineProperty(n,G,{value(){return r},enumerable:!1}),r}}const e=arguments[0],t=arguments[1];return Object.defineProperty(e,G,{value(){return t},enumerable:!1}),t},B=Symbol.for("effect/Equal");function L(){return arguments.length===1?e=>ta(e,arguments[0]):ta(arguments[0],arguments[1])}function ta(e,t){if(e===t)return!0;const n=typeof e;if(n!==typeof t)return!1;if(n==="object"||n==="function"){if(e!==null&&t!==null){if(na(e)&&na(t))return F(e)===F(t)&&e[B](t)?!0:Ht.enabled&&Ht.tester?Ht.tester(e,t):!1;if(e instanceof Date&&t instanceof Date)return e.toISOString()===t.toISOString()}if(Ht.enabled){if(Array.isArray(e)&&Array.isArray(t))return e.length===t.length&&e.every((r,s)=>ta(r,t[s]));if(Object.getPrototypeOf(e)===Object.prototype&&Object.getPrototypeOf(e)===Object.prototype){const r=Object.keys(e),s=Object.keys(t);if(r.length===s.length){for(const o of r)if(!(o in t&&ta(e[o],t[o])))return Ht.tester?Ht.tester(e,t):!1;return!0}}return Ht.tester?Ht.tester(e,t):!1}}return Ht.enabled&&Ht.tester?Ht.tester(e,t):!1}const na=e=>N(e,B),gf=()=>L,ge=Symbol.for("nodejs.util.inspect.custom"),Re=e=>N(e,"toJSON")&&Ms(e.toJSON)&&e.toJSON.length===0?e.toJSON():Array.isArray(e)?e.map(Re):e,je=e=>JSON.stringify(e,null,2),ra=(e,t=2)=>{try{return typeof e=="object"?uO(e,t):String(e)}catch{return String(e)}},uO=(e,t)=>{let n=[];const r=JSON.stringify(e,(s,o)=>typeof o=="object"&&o!==null?n.includes(o)?void 0:n.push(o)&&o:o,t);return n=void 0,r},I=(e,t)=>{switch(t.length){case 0:return e;case 1:return t[0](e);case 2:return t[1](t[0](e));case 3:return t[2](t[1](t[0](e)));case 4:return t[3](t[2](t[1](t[0](e))));case 5:return t[4](t[3](t[2](t[1](t[0](e)))));case 6:return t[5](t[4](t[3](t[2](t[1](t[0](e))))));case 7:return t[6](t[5](t[4](t[3](t[2](t[1](t[0](e)))))));case 8:return t[7](t[6](t[5](t[4](t[3](t[2](t[1](t[0](e))))))));case 9:return t[8](t[7](t[6](t[5](t[4](t[3](t[2](t[1](t[0](e)))))))));default:{let n=e;for(let r=0,s=t.length;r<s;r++)n=t[r](n);return n}}},Zo="Async",pf="Commit",lt="Failure",sa="OnFailure",oa="OnSuccess",ia="OnSuccessAndFailure",ft="Success",Vg="Sync",lO="Tag",Ns="UpdateRuntimeFlags",ca="While",Jg="WithRuntime",aa="Yield",yf="RevertFlags",Gg=Symbol.for("effect/Effect"),fO=Symbol.for("effect/Stream"),hO=Symbol.for("effect/Sink"),dO=Symbol.for("effect/Channel"),xs={_R:e=>e,_E:e=>e,_A:e=>e,_V:Gc()},mO={_A:e=>e,_In:e=>e,_L:e=>e,_E:e=>e,_R:e=>e},gO={_Env:e=>e,_InErr:e=>e,_InElem:e=>e,_InDone:e=>e,_OutErr:e=>e,_OutElem:e=>e,_OutDone:e=>e},ua={[Gg]:xs,[fO]:xs,[hO]:mO,[dO]:gO,[B](e){return this===e},[G](){return Pe(this,df(this))},[Symbol.iterator](){return new YT(new Zc(this))},pipe(){return I(this,arguments)}},Sf={[G](){return Pe(this,Hg(this))},[B](e){const t=Object.keys(this),n=Object.keys(e);if(t.length!==n.length)return!1;for(const r of t)if(!(r in e&&L(this[r],e[r])))return!1;return!0}},pO={...{...ua,_op:pf},...Sf},Qg=Symbol.for("effect/Option"),Yg={...ua,[Qg]:{_A:e=>e},[ge](){return this.toJSON()},toString(){return je(this.toJSON())}},yO=Object.assign(Object.create(Yg),{_tag:"Some",_op:"Some",[B](e){return Xg(e)&&ep(e)&&L(this.value,e.value)},[G](){return Pe(this,ee(F(this._tag))(F(this.value)))},toJSON(){return{_id:"Option",_tag:this._tag,value:Re(this.value)}}}),SO=F("None"),bO=Object.assign(Object.create(Yg),{_tag:"None",_op:"None",[B](e){return Xg(e)&&Zg(e)},[G](){return SO},toJSON(){return{_id:"Option",_tag:this._tag}}}),Xg=e=>N(e,Qg),Zg=e=>e._tag==="None",ep=e=>e._tag==="Some",bf=Object.create(bO),_f=e=>{const t=Object.create(yO);return t.value=e,t},tp=Symbol.for("effect/Either"),np={...ua,[tp]:{_R:e=>e},[ge](){return this.toJSON()},toString(){return je(this.toJSON())}},_O=Object.assign(Object.create(np),{_tag:"Right",_op:"Right",[B](e){return rp(e)&&op(e)&&L(this.right,e.right)},[G](){return ee(F(this._tag))(F(this.right))},toJSON(){return{_id:"Either",_tag:this._tag,right:Re(this.right)}}}),wO=Object.assign(Object.create(np),{_tag:"Left",_op:"Left",[B](e){return rp(e)&&sp(e)&&L(this.left,e.left)},[G](){return ee(F(this._tag))(F(this.left))},toJSON(){return{_id:"Either",_tag:this._tag,left:Re(this.left)}}}),rp=e=>N(e,tp),sp=e=>e._tag==="Left",op=e=>e._tag==="Right",EO=e=>{const t=Object.create(wO);return t.left=e,t},re=e=>{const t=Object.create(_O);return t.right=e,t},z=EO,kO=e=>{if(Ms(e))try{return re(e())}catch(t){return z(t)}else try{return re(e.try())}catch(t){return z(e.catch(t))}},st=sp,Ln=op,ip=l(2,(e,t)=>st(e)?z(t(e.left)):re(e.right)),gt=l(2,(e,{onLeft:t,onRight:n})=>st(e)?t(e.left):n(e.right)),vO=gt({onLeft:R,onRight:R}),$O=l(2,(e,t)=>{if(Ln(e))return e.right;throw t(e.left)}),cp=e=>e.length>0,ap=e=>(t,n)=>t===n?0:e(t,n),TO=ap((e,t)=>e<t?-1:1),la=l(2,(e,t)=>ap((n,r)=>e(t(n),t(r)))),OO=e=>l(2,(t,n)=>e(t,n)===1),$=()=>bf,T=_f,pe=Zg,q=ep,ze=l(2,(e,{onNone:t,onSome:n})=>pe(e)?t():n(e.value)),we=l(2,(e,t)=>pe(e)?t():e.value),fa=l(2,(e,t)=>pe(e)?t():e),IO=l(2,(e,t)=>pe(e)?T(t()):e),ei=e=>e==null?$():T(e),Kn=we(Kg),CO=e=>(...t)=>{try{return T(e(...t))}catch{return $()}},up=l(2,(e,t)=>{if(q(e))return e.value;throw t()})(()=>new Error("getOrThrow called on a None")),Ds=l(2,(e,t)=>pe(e)?$():T(t(e.value))),ti=l(2,(e,t)=>pe(e)?$():t(e.value)),lp=l(2,(e,t)=>pe(e)?$():t(e.value)),RO=l(2,(e,t)=>lp(e,n=>t(n)?_f(n):bf)),FO=(e=>l(2,(t,n)=>pe(t)?!1:e(t.value,n)))(gf()),PO=(...e)=>e,MO=e=>{const n=e[Symbol.iterator]().next();return n.done?$():T(n.value)},fp=e=>{const n=e[Symbol.iterator]().next();if(n.done)throw new Error("unsafeHead: empty iterable");return n.value},AO=l(2,(e,t)=>{let n=0;for(const r of e){const s=t(r,n);if(Ur(s)){if(s)return T(r)}else if(q(s))return s;n++}return $()}),NO={[Symbol.iterator](){return xO}},xO={next(){return{done:!0,value:void 0}}},DO=()=>NO,LO=l(2,(e,t)=>({[Symbol.iterator](){const n=e[Symbol.iterator]();let r=0;return{next(){let s=n.next();for(;!s.done;){if(t(s.value,r++))return{done:!1,value:s.value};s=n.next()}return{done:!0,value:void 0}}}}})),wf=()=>({}),Ef=l(2,(e,t)=>{const n={...e};for(const r of ha(e))n[r]=t(e[r],r);return n}),KO=l(2,(e,t)=>{const n=wf();for(const r of ha(e))t(e[r],r)&&(n[r]=e[r]);return n}),UO=l(2,(e,t)=>{const n=wf(),r=wf();for(const s of ha(e))t(e[s],s)?r[s]=e[s]:n[s]=e[s];return[n,r]}),ha=e=>Object.keys(e),qO=l(2,(e,t)=>{for(const n of ha(e))if(t(e[n],n))return!0;return!1}),da=e=>new Array(e),jO=(e,t)=>{const n=Math.max(1,Math.floor(e)),r=new Array(n);for(let s=0;s<n;s++)r[s]=t(s);return r},he=e=>Array.isArray(e)?e:Array.from(e),kf=e=>Array.isArray(e)?e:[e],zO=l(2,(e,{onEmpty:t,onNonEmpty:n})=>ye(e)?n(e):t()),BO=l(2,(e,{onEmpty:t,onNonEmpty:n})=>ye(e)?n(Ot(e),qr(e)):t()),ma=l(2,(e,t)=>[t,...e]),WO=l(2,(e,t)=>[...e,t]),hp=l(2,(e,t)=>he(e).concat(he(t))),vf=Array.isArray,HO=e=>e.length===0,ga=cp,ye=cp,dp=(e,t)=>e<0||e>=t.length,VO=(e,t)=>Math.floor(Math.min(Math.max(0,e),t.length)),JO=l(2,(e,t)=>{const n=Math.floor(t);return dp(n,e)?$():T(e[n])}),mp=l(2,(e,t)=>{const n=Math.floor(t);if(dp(n,e))throw new Error(`Index ${n} out of bounds`);return e[n]}),ni=JO(0),Ot=mp(0),GO=e=>ye(e)?T(gp(e)):$(),gp=e=>e[e.length-1],qr=e=>e.slice(1),QO=(e,t)=>{let n=0;for(const r of e){if(!t(r,n))break;n++}return n},YO=l(2,(e,t)=>bp(e,QO(e,t))),XO=l(2,(e,t)=>{const n=he(e);return n.slice(VO(t,n),n.length)}),ZO=AO,pp=e=>Array.from(e).reverse(),jr=l(2,(e,t)=>{const n=Array.from(e);return n.sort(t),n}),yp=l(2,(e,t)=>eI(e,t,PO)),eI=l(3,(e,t,n)=>{const r=he(e),s=he(t);if(ye(r)&&ye(s)){const o=[n(Ot(r),Ot(s))],i=Math.min(r.length,s.length);for(let c=1;c<i;c++)o[c]=n(r[c],s[c]);return o}return[]}),tI=e=>l(2,(t,n)=>{for(const r of t)if(e(n,r))return!0;return!1}),Sp=gf(),bp=l(2,(e,t)=>{const n=Array.from(e),r=Math.floor(t);return ye(n)?r>=1?nI(n,r):[[],n]:[n,[]]}),nI=l(2,(e,t)=>{const n=Math.max(1,Math.floor(t));return n>=e.length?[ri(e),[]]:[ma(e.slice(1,n),Ot(e)),e.slice(n)]}),ri=e=>e.slice(),rI=l(3,(e,t,n)=>{const r=he(e),s=he(t);return ye(r)?ye(s)?Ep(n)(hp(r,s)):r:s}),pa=l(2,(e,t)=>rI(e,t,Sp)),sI=(e=>{const t=tI(e);return l(2,(n,r)=>he(n).filter(s=>t(r,s)))})(Sp),cr=()=>[],tn=e=>[e],Un=l(2,(e,t)=>e.map(t)),ya=l(2,(e,t)=>{if(HO(e))return[];const n=[];for(let r=0;r<e.length;r++){const s=t(e[r],r);for(let o=0;o<s.length;o++)n.push(s[o])}return n}),oI=ya(R),_p=l(2,(e,t)=>{const n=he(e),r=[];for(let s=0;s<n.length;s++){const o=t(n[s],s);q(o)&&r.push(o.value)}return r}),iI=l(2,(e,t)=>{const n=he(e),r=[];for(let s=0;s<n.length;s++)t(n[s],s)&&r.push(n[s]);return r}),$f=l(3,(e,t,n)=>he(e).reduce((r,s,o)=>n(r,s,o),t)),wp=(e,t)=>{const n=[];let r=e,s;for(;q(s=t(r));){const[o,i]=s.value;n.push(o),r=i}return n},si=jT,Ep=l(2,(e,t)=>{const n=he(e);if(ye(n)){const r=[Ot(n)],s=qr(n);for(const o of s)r.every(i=>!t(o,i))&&r.push(o);return r}return[]}),cI=e=>Ep(e,gf()),zr=l(2,(e,t)=>he(e).join(t)),kp=Symbol.for("effect/Context/Tag"),vp={...ua,_tag:"Tag",_op:"Tag",[Symbol.for("effect/STM")]:xs,[kp]:{_Service:e=>e,_Identifier:e=>e},toString(){return je(this.toJSON())},toJSON(){return{_id:"Tag",key:this.key,stack:this.stack}},[ge](){return this.toJSON()},of(e){return e},context(e){return Op(this,e)}},aI=e=>{const t=Error.stackTraceLimit;Error.stackTraceLimit=2;const n=new Error;Error.stackTraceLimit=t;const r=Object.create(vp);return Object.defineProperty(r,"stack",{get(){return n.stack}}),r.key=e,r},uI=e=>()=>{const t=Error.stackTraceLimit;Error.stackTraceLimit=2;const n=new Error;Error.stackTraceLimit=t;function r(){}return Object.setPrototypeOf(r,vp),r.key=e,Object.defineProperty(r,"stack",{get(){return n.stack}}),r},$p=Symbol.for("effect/Context"),lI={[$p]:{_Services:e=>e},[B](e){if(Tp(e)&&this.unsafeMap.size===e.unsafeMap.size){for(const t of this.unsafeMap.keys())if(!e.unsafeMap.has(t)||!L(this.unsafeMap.get(t),e.unsafeMap.get(t)))return!1;return!0}return!1},[G](){return Pe(this,mf(this.unsafeMap.size))},pipe(){return I(this,arguments)},toString(){return je(this.toJSON())},toJSON(){return{_id:"Context",services:Array.from(this.unsafeMap).map(Re)}},[ge](){return this.toJSON()}},Ls=e=>{const t=Object.create(lI);return t.unsafeMap=e,t},fI=e=>{const t=new Error(`Service not found${e.key?`: ${String(e.key)}`:""}`);if(e.stack){const n=e.stack.split(`
`);if(n.length>2){const r=n[2].match(/at (.*)/);r&&(t.message=t.message+` (defined at ${r[1]})`)}}if(t.stack){const n=t.stack.split(`
`);n.splice(1,3),t.stack=n.join(`
`)}return t},Tp=e=>N(e,$p),hI=e=>N(e,kp),dI=Ls(new Map),mI=()=>dI,Op=(e,t)=>Ls(new Map([[e.key,t]])),gI=l(3,(e,t,n)=>{const r=new Map(e.unsafeMap);return r.set(t.key,n),Ls(r)}),Ip=l(2,(e,t)=>{if(!e.unsafeMap.has(t.key))throw fI(t);return e.unsafeMap.get(t.key)}),pI=Ip,yI=l(2,(e,t)=>e.unsafeMap.has(t.key)?_f(e.unsafeMap.get(t.key)):bf),SI=l(2,(e,t)=>{const n=new Map(e.unsafeMap);for(const[r,s]of t.unsafeMap)n.set(r,s);return Ls(n)}),Vt=aI,bI=Tp,Sa=hI,qn=mI,oi=Op,Ks=gI,Mt=pI,_I=Ip,ar=yI,Br=SI,wI=uI,Cp=Symbol.for("effect/Chunk");function EI(e,t,n,r,s){for(let o=t;o<Math.min(e.length,t+s);o++)n[r+o-t]=e[o];return n}const Rp=[],kI=(e=>Kr((t,n)=>t.length===n.length&&At(t).every((r,s)=>e(r,ur(n,s)))))(L),vI={[Cp]:{_A:e=>e},toString(){return je(this.toJSON())},toJSON(){return{_id:"Chunk",values:At(this).map(Re)}},[ge](){return this.toJSON()},[B](e){return Tf(e)&&kI(this,e)},[G](){return Pe(this,Xo(At(this)))},[Symbol.iterator](){switch(this.backing._tag){case"IArray":return this.backing.array[Symbol.iterator]();case"IEmpty":return Rp[Symbol.iterator]();default:return At(this)[Symbol.iterator]()}},pipe(){return I(this,arguments)}},Fe=e=>{const t=Object.create(vI);switch(t.backing=e,e._tag){case"IEmpty":{t.length=0,t.depth=0,t.left=t,t.right=t;break}case"IConcat":{t.length=e.left.length+e.right.length,t.depth=1+Math.max(e.left.depth,e.right.depth),t.left=e.left,t.right=e.right;break}case"IArray":{t.length=e.array.length,t.depth=0,t.left=nn,t.right=nn;break}case"ISingleton":{t.length=1,t.depth=0,t.left=nn,t.right=nn;break}case"ISlice":{t.length=e.length,t.depth=e.chunk.depth+1,t.left=nn,t.right=nn;break}}return t},Tf=e=>N(e,Cp),nn=Fe({_tag:"IEmpty"}),Me=()=>nn,Of=(...e)=>e.length===1?Ae(e[0]):TI(e),Ae=e=>Fe({_tag:"ISingleton",a:e}),ii=e=>Tf(e)?e:Fe({_tag:"IArray",array:he(e)}),If=(e,t,n)=>{switch(e.backing._tag){case"IArray":{EI(e.backing.array,0,t,n,e.length);break}case"IConcat":{If(e.left,t,n),If(e.right,t,n+e.left.length);break}case"ISingleton":{t[n]=e.backing.a;break}case"ISlice":{let r=0,s=n;for(;r<e.length;)t[s]=ur(e,r),r+=1,s+=1;break}}},At=e=>{switch(e.backing._tag){case"IEmpty":return Rp;case"IArray":return e.backing.array;default:{const t=new Array(e.length);return If(e,t,0),e.backing={_tag:"IArray",array:t},e.left=nn,e.right=nn,e.depth=0,t}}},jn=e=>{switch(e.backing._tag){case"IEmpty":case"ISingleton":return e;case"IArray":return Fe({_tag:"IArray",array:pp(e.backing.array)});case"IConcat":return Fe({_tag:"IConcat",left:jn(e.backing.right),right:jn(e.backing.left)});case"ISlice":return Jt(pp(At(e)))}},$I=l(2,(e,t)=>t<0||t>=e.length?$():T(ur(e,t))),Jt=e=>Fe({_tag:"IArray",array:e}),TI=e=>Jt(e),ur=l(2,(e,t)=>{switch(e.backing._tag){case"IEmpty":throw new Error("Index out of bounds");case"ISingleton":{if(t!==0)throw new Error("Index out of bounds");return e.backing.a}case"IArray":{if(t>=e.length||t<0)throw new Error("Index out of bounds");return e.backing.array[t]}case"IConcat":return t<e.left.length?ur(e.left,t):ur(e.right,t-e.left.length);case"ISlice":return ur(e.backing.chunk,t+e.backing.offset)}}),ci=l(2,(e,t)=>Be(e,Ae(t))),ot=l(2,(e,t)=>Be(Ae(t),e)),ba=l(2,(e,t)=>{if(t<=0)return nn;if(t>=e.length)return e;switch(e.backing._tag){case"ISlice":return Fe({_tag:"ISlice",chunk:e.backing.chunk,length:t,offset:e.backing.offset});case"IConcat":return t>e.left.length?Fe({_tag:"IConcat",left:e.left,right:ba(e.right,t-e.left.length)}):ba(e.left,t);default:return Fe({_tag:"ISlice",chunk:e,offset:0,length:t})}}),_a=l(2,(e,t)=>{if(t<=0)return e;if(t>=e.length)return nn;switch(e.backing._tag){case"ISlice":return Fe({_tag:"ISlice",chunk:e.backing.chunk,offset:e.backing.offset+t,length:e.backing.length-t});case"IConcat":return t>e.left.length?_a(e.right,t-e.left.length):Fe({_tag:"IConcat",left:_a(e.left,t),right:e.right});default:return Fe({_tag:"ISlice",chunk:e,offset:t,length:e.length-t})}}),Be=l(2,(e,t)=>{if(e.backing._tag==="IEmpty")return t;if(t.backing._tag==="IEmpty")return e;const n=t.depth-e.depth;if(Math.abs(n)<=1)return Fe({_tag:"IConcat",left:e,right:t});if(n<-1)if(e.left.depth>=e.right.depth){const r=Be(e.right,t);return Fe({_tag:"IConcat",left:e.left,right:r})}else{const r=Be(e.right.right,t);if(r.depth===e.depth-3){const s=Fe({_tag:"IConcat",left:e.right.left,right:r});return Fe({_tag:"IConcat",left:e.left,right:s})}else{const s=Fe({_tag:"IConcat",left:e.left,right:e.right.left});return Fe({_tag:"IConcat",left:s,right:r})}}else if(t.right.depth>=t.left.depth){const r=Be(e,t.left);return Fe({_tag:"IConcat",left:r,right:t.right})}else{const r=Be(e,t.left.left);if(r.depth===t.depth-3){const s=Fe({_tag:"IConcat",left:r,right:t.left.right});return Fe({_tag:"IConcat",left:s,right:t.right})}else{const s=Fe({_tag:"IConcat",left:t.left.right,right:t.right});return Fe({_tag:"IConcat",left:r,right:s})}}}),OI=l(2,(e,t)=>Jt(_p(e,t))),wa=l(2,(e,t)=>Jt(iI(e,t))),Ea=e=>e.length===0,zn=e=>e.length>0,Cf=$I(0),Rf=e=>ur(e,0),kn=Rf,Fp=l(2,(e,t)=>e.backing._tag==="ISingleton"?Ae(t(e.backing.a,0)):Jt(h(At(e),Un((n,r)=>t(n,r))))),II=l(2,(e,t)=>[ba(e,t),_a(e,t)]),CI=l(2,(e,t)=>{let n=0;for(const r of At(e)){if(t(r))break;n++}return II(e,n)}),Bn=e=>_a(e,1),RI=$f,Ff=Symbol.for("effect/Duration"),Us=BigInt(0),Pf=BigInt(24),qs=BigInt(60),ka=BigInt(1e3),Mf=BigInt(1e6),Af=BigInt(1e9),Pp=/^(-?\d+(?:\.\d+)?)\s+(nanos?|micros?|millis?|seconds?|minutes?|hours?|days?|weeks?)$/,rn=e=>{if(Ap(e))return e;if(En(e))return ai(e);if(Qc(e))return Nf(e);if(Array.isArray(e)){if(e.length===2&&En(e[0])&&En(e[1]))return Nf(BigInt(e[0])*Af+BigInt(e[1]))}else if(Tt(e)){Pp.lastIndex=0;const t=Pp.exec(e);if(t){const[n,r,s]=t,o=Number(r);switch(s){case"nano":case"nanos":return Nf(BigInt(r));case"micro":case"micros":return AI(BigInt(r));case"milli":case"millis":return ai(o);case"second":case"seconds":return Np(o);case"minute":case"minutes":return NI(o);case"hour":case"hours":return xI(o);case"day":case"days":return DI(o);case"week":case"weeks":return LI(o)}}}throw new Error("Invalid DurationInput")},Mp={_tag:"Millis",millis:0},FI={_tag:"Infinity"},PI={[Ff]:Ff,[G](){return Pe(this,Hg(this.value))},[B](e){return Ap(e)&&BI(this,e)},toString(){return`Duration(${xp(this)})`},toJSON(){switch(this.value._tag){case"Millis":return{_id:"Duration",_tag:"Millis",millis:this.value.millis};case"Nanos":return{_id:"Duration",_tag:"Nanos",hrtime:UI(this)};case"Infinity":return{_id:"Duration",_tag:"Infinity"}}},[ge](){return this.toJSON()},pipe(){return I(this,arguments)}},sn=e=>{const t=Object.create(PI);return En(e)?isNaN(e)||e<=0?t.value=Mp:Number.isFinite(e)?Number.isInteger(e)?t.value={_tag:"Millis",millis:e}:t.value={_tag:"Nanos",nanos:BigInt(Math.round(e*1e6))}:t.value=FI:e<=Us?t.value=Mp:t.value={_tag:"Nanos",nanos:e},t},Ap=e=>N(e,Ff),MI=sn(0),Nf=e=>sn(e),AI=e=>sn(e*ka),ai=e=>sn(e),Np=e=>sn(e*1e3),NI=e=>sn(e*6e4),xI=e=>sn(e*36e5),DI=e=>sn(e*864e5),LI=e=>sn(e*6048e5),ui=e=>{const t=rn(e);switch(t.value._tag){case"Infinity":return 1/0;case"Nanos":return Number(t.value.nanos)/1e6;case"Millis":return t.value.millis}},KI=e=>{const t=rn(e);switch(t.value._tag){case"Infinity":throw new Error("Cannot convert infinite duration to nanos");case"Nanos":return t.value.nanos;case"Millis":return BigInt(Math.round(t.value.millis*1e6))}},UI=e=>{const t=rn(e);switch(t.value._tag){case"Infinity":return[1/0,0];case"Nanos":return[Number(t.value.nanos/Af),Number(t.value.nanos%Af)];case"Millis":return[Math.floor(t.value.millis/1e3),Math.round(t.value.millis%1e3*1e6)]}},xf=l(3,(e,t,n)=>{const r=rn(e),s=rn(t);if(r.value._tag==="Infinity"||s.value._tag==="Infinity")return n.onMillis(ui(r),ui(s));if(r.value._tag==="Nanos"||s.value._tag==="Nanos"){const o=r.value._tag==="Nanos"?r.value.nanos:BigInt(Math.round(r.value.millis*1e6)),i=s.value._tag==="Nanos"?s.value.nanos:BigInt(Math.round(s.value.millis*1e6));return n.onNanos(o,i)}return n.onMillis(r.value.millis,s.value.millis)}),qI=(e,t)=>xf(e,t,{onMillis:(n,r)=>n===r,onNanos:(n,r)=>n===r}),jI=l(2,(e,t)=>xf(e,t,{onMillis:(n,r)=>sn(n+r),onNanos:(n,r)=>sn(n+r)})),zI=l(2,(e,t)=>xf(e,t,{onMillis:(n,r)=>n>=r,onNanos:(n,r)=>n>=r})),BI=l(2,(e,t)=>qI(rn(e),rn(t))),xp=e=>{const t=rn(e),n=[];if(t.value._tag==="Infinity")return"Infinity";const r=KI(t);r%Mf&&n.push(`${r%Mf}ns`);const s=r/Mf;s%ka!==Us&&n.push(`${s%ka}ms`);const o=s/ka;o%qs!==Us&&n.push(`${o%qs}s`);const i=o/qs;i%qs!==Us&&n.push(`${i%qs}m`);const c=i/qs;c%Pf!==Us&&n.push(`${c%Pf}h`);const u=c/Pf;return u!==Us&&n.push(`${u}d`),n.reverse().join(" ")},Wr=5,Df=Math.pow(2,Wr),WI=Df-1,HI=Df/2,VI=Df/4;function JI(e){return e-=e>>1&1431655765,e=(e&858993459)+(e>>2&858993459),e=e+(e>>4)&252645135,e+=e>>8,e+=e>>16,e&127}function js(e,t){return t>>>e&WI}function zs(e){return 1<<e}function Dp(e,t){return JI(e&t-1)}const GI=(e,t)=>({value:e,previous:t});function Bs(e,t,n,r){let s=r;if(!e){const o=r.length;s=new Array(o);for(let i=0;i<o;++i)s[i]=r[i]}return s[t]=n,s}function Lp(e,t,n){const r=n.length-1;let s=0,o=0,i=n;if(e)s=o=t;else for(i=new Array(r);s<t;)i[o++]=n[s++];for(++s;s<=r;)i[o++]=n[s++];return e&&(i.length=r),i}function QI(e,t,n,r){const s=r.length;if(e){let u=s;for(;u>=t;)r[u--]=r[u];return r[t]=n,r}let o=0,i=0;const c=new Array(s+1);for(;o<t;)c[i++]=r[o++];for(c[t]=n;o<s;)c[++i]=r[o++];return c}class lr{constructor(){a(this,"_tag","EmptyNode")}modify(t,n,r,s,o,i){const c=r($());return pe(c)?new lr:(++i.value,new Hr(t,s,o,c))}}function on(e){return uf(e,"EmptyNode")}function YI(e){return on(e)||e._tag==="LeafNode"||e._tag==="CollisionNode"}function va(e,t){return on(e)?!1:t===e.edit}class Hr{constructor(t,n,r,s){a(this,"edit");a(this,"hash");a(this,"key");a(this,"value");a(this,"_tag","LeafNode");this.edit=t,this.hash=n,this.key=r,this.value=s}modify(t,n,r,s,o,i){if(L(o,this.key)){const u=r(this.value);return u===this.value?this:pe(u)?(--i.value,new lr):va(this,t)?(this.value=u,this):new Hr(t,s,o,u)}const c=r($());return pe(c)?this:(++i.value,Kp(t,n,this.hash,this,s,new Hr(t,s,o,c)))}}class Lf{constructor(t,n,r){a(this,"edit");a(this,"hash");a(this,"children");a(this,"_tag","CollisionNode");this.edit=t,this.hash=n,this.children=r}modify(t,n,r,s,o,i){if(s===this.hash){const u=va(this,t),f=this.updateCollisionList(u,t,this.hash,this.children,r,o,i);return f===this.children?this:f.length>1?new Lf(t,this.hash,f):f[0]}const c=r($());return pe(c)?this:(++i.value,Kp(t,n,this.hash,this,s,new Hr(t,s,o,c)))}updateCollisionList(t,n,r,s,o,i,c){const u=s.length;for(let d=0;d<u;++d){const m=s[d];if("key"in m&&L(i,m.key)){const p=m.value,g=o(p);return g===p?s:pe(g)?(--c.value,Lp(t,d,s)):Bs(t,d,new Hr(n,r,i,g),s)}}const f=o($());return pe(f)?s:(++c.value,Bs(t,u,new Hr(n,r,i,f),s))}}class Ws{constructor(t,n,r){a(this,"edit");a(this,"mask");a(this,"children");a(this,"_tag","IndexedNode");this.edit=t,this.mask=n,this.children=r}modify(t,n,r,s,o,i){const c=this.mask,u=this.children,f=js(n,s),d=zs(f),m=Dp(c,d),p=c&d,g=va(this,t);if(!p){const E=new lr().modify(t,n+Wr,r,s,o,i);return E?u.length>=HI?ZI(t,f,E,c,u):new Ws(t,c|d,QI(g,m,E,u)):this}const b=u[m],S=b.modify(t,n+Wr,r,s,o,i);if(b===S)return this;let _=c,y;if(on(S)){if(_&=~d,!_)return new lr;if(u.length<=2&&YI(u[m^1]))return u[m^1];y=Lp(g,m,u)}else y=Bs(g,m,S,u);return g?(this.mask=_,this.children=y,this):new Ws(t,_,y)}}class Kf{constructor(t,n,r){a(this,"edit");a(this,"size");a(this,"children");a(this,"_tag","ArrayNode");this.edit=t,this.size=n,this.children=r}modify(t,n,r,s,o,i){let c=this.size;const u=this.children,f=js(n,s),d=u[f],m=(d||new lr).modify(t,n+Wr,r,s,o,i);if(d===m)return this;const p=va(this,t);let g;if(on(d)&&!on(m))++c,g=Bs(p,f,m,u);else if(!on(d)&&on(m)){if(--c,c<=VI)return XI(t,c,f,u);g=Bs(p,f,new lr,u)}else g=Bs(p,f,m,u);return p?(this.size=c,this.children=g,this):new Kf(t,c,g)}}function XI(e,t,n,r){const s=new Array(t-1);let o=0,i=0;for(let c=0,u=r.length;c<u;++c)if(c!==n){const f=r[c];f&&!on(f)&&(s[o++]=f,i|=1<<c)}return new Ws(e,i,s)}function ZI(e,t,n,r,s){const o=[];let i=r,c=0;for(let u=0;i;++u)i&1&&(o[u]=s[c++]),i>>>=1;return o[t]=n,new Kf(e,c+1,o)}function e0(e,t,n,r,s,o){if(n===s)return new Lf(e,n,[o,r]);const i=js(t,n),c=js(t,s);if(i===c)return u=>new Ws(e,zs(i)|zs(c),[u]);{const u=i<c?[r,o]:[o,r];return new Ws(e,zs(i)|zs(c),u)}}function Kp(e,t,n,r,s,o){let i,c=t;for(;;){const u=e0(e,c,n,r,s,o);if(typeof u=="function")i=GI(u,i),c=c+Wr;else{let f=u;for(;i!=null;)f=i.value(f),i=i.previous;return f}}}const Up="effect/HashMap",Uf=Symbol.for(Up),t0={[Uf]:Uf,[Symbol.iterator](){return new $a(this,(e,t)=>[e,t])},[G](){let e=F(Up);for(const t of this)e^=h(F(t[0]),ee(F(t[1])));return Pe(this,e)},[B](e){if(s0(e)){if(e._size!==this._size)return!1;for(const t of this){const n=h(e,jf(t[0],F(t[0])));if(pe(n))return!1;if(!L(t[1],n.value))return!1}return!0}return!1},toString(){return je(this.toJSON())},toJSON(){return{_id:"HashMap",values:Array.from(this).map(Re)}},[ge](){return this.toJSON()},pipe(){return I(this,arguments)}},qf=(e,t,n,r)=>{const s=Object.create(t0);return s._editable=e,s._edit=t,s._root=n,s._size=r,s};class $a{constructor(t,n){a(this,"map");a(this,"f");a(this,"v");this.map=t,this.f=n,this.v=qp(this.map._root,this.f,void 0)}next(){if(pe(this.v))return{done:!0,value:void 0};const t=this.v.value;return this.v=Ta(t.cont),{done:!1,value:t.value}}[Symbol.iterator](){return new $a(this.map,this.f)}}const Ta=e=>e?jp(e[0],e[1],e[2],e[3],e[4]):$(),qp=(e,t,n=void 0)=>{switch(e._tag){case"LeafNode":return q(e.value)?T({value:t(e.key,e.value.value),cont:n}):Ta(n);case"CollisionNode":case"ArrayNode":case"IndexedNode":{const r=e.children;return jp(r.length,r,0,t,n)}default:return Ta(n)}},jp=(e,t,n,r,s)=>{for(;n<e;){const o=t[n++];if(o&&!on(o))return qp(o,r,[e,t,n,r,s])}return Ta(s)},n0=qf(!1,0,new lr,0),Oa=()=>n0,r0=e=>{const t=Bp(Oa());for(const n of e)li(t,n[0],n[1]);return u0(t)},s0=e=>N(e,Uf),o0=e=>e&&on(e._root),i0=l(2,(e,t)=>jf(e,t,F(t))),jf=l(3,(e,t,n)=>{let r=e._root,s=0;for(;;)switch(r._tag){case"LeafNode":return L(t,r.key)?r.value:$();case"CollisionNode":{if(n===r.hash){const o=r.children;for(let i=0,c=o.length;i<c;++i){const u=o[i];if("key"in u&&L(t,u.key))return u.value}}return $()}case"IndexedNode":{const o=js(s,n),i=zs(o);if(r.mask&i){r=r.children[Dp(r.mask,i)],s+=Wr;break}return $()}case"ArrayNode":{if(r=r.children[js(s,n)],r){s+=Wr;break}return $()}default:return $()}}),c0=l(2,(e,t)=>q(jf(e,t,F(t)))),li=l(3,(e,t,n)=>zf(e,t,()=>T(n))),a0=l(3,(e,t,n)=>e._editable?(e._root=t,e._size=n,e):t===e._root?e:qf(e._editable,e._edit,t,n)),zp=e=>new $a(e,t=>t),Ia=e=>e._size,Bp=e=>qf(!0,e._edit+1,e._root,e._size),u0=e=>(e._editable=!1,e),zf=l(3,(e,t,n)=>l0(e,t,F(t),n)),l0=l(4,(e,t,n,r)=>{const s={value:e._size},o=e._root.modify(e._editable?e._edit:NaN,0,r,n,t,s);return h(e,a0(o,s.value))}),Wp=l(2,(e,t)=>zf(e,t,$)),f0=l(2,(e,t)=>Ca(e,Oa(),(n,r,s)=>li(n,s,t(r,s)))),Hp=l(2,(e,t)=>Ca(e,void 0,(n,r,s)=>t(r,s))),Ca=l(3,(e,t,n)=>{const r=e._root;if(r._tag==="LeafNode")return q(r.value)?n(t,r.value.value,r.key):t;if(r._tag==="EmptyNode")return t;const s=[r.children];let o;for(;o=s.pop();)for(let i=0,c=o.length;i<c;){const u=o[i++];u&&!on(u)&&(u._tag==="LeafNode"?q(u.value)&&(t=n(t,u.value.value,u.key)):s.push(u.children))}return t}),Vp="effect/HashSet",Bf=Symbol.for(Vp),h0={[Bf]:Bf,[Symbol.iterator](){return zp(this._keyMap)},[G](){return Pe(this,ee(F(this._keyMap))(F(Vp)))},[B](e){return d0(e)?Ia(this._keyMap)===Ia(e._keyMap)&&L(this._keyMap,e._keyMap):!1},toString(){return je(this.toJSON())},toJSON(){return{_id:"HashSet",values:Array.from(this).map(Re)}},[ge](){return this.toJSON()},pipe(){return I(this,arguments)}},Ra=e=>{const t=Object.create(h0);return t._keyMap=e,t},d0=e=>N(e,Bf),m0=Ra(Oa()),Fa=()=>m0,g0=e=>{const t=Wf(Fa());for(const n of e)fi(t,n);return Hf(t)},p0=(...e)=>{const t=Wf(Fa());for(const n of e)fi(t,n);return Hf(t)},y0=l(2,(e,t)=>c0(e._keyMap,t)),S0=e=>Ia(e._keyMap),Wf=e=>Ra(Bp(e._keyMap)),Hf=e=>(e._keyMap._editable=!1,e),Jp=l(2,(e,t)=>{const n=Wf(e);return t(n),Hf(n)}),fi=l(2,(e,t)=>e._keyMap._editable?(li(t,!0)(e._keyMap),e):Ra(li(t,!0)(e._keyMap))),Gp=l(2,(e,t)=>e._keyMap._editable?(Wp(t)(e._keyMap),e):Ra(Wp(t)(e._keyMap))),b0=l(2,(e,t)=>Jp(e,n=>{for(const r of t)Gp(n,r)})),_0=l(2,(e,t)=>Jp(Fa(),n=>{w0(e,r=>fi(n,r));for(const r of t)fi(n,r)})),w0=l(2,(e,t)=>Hp(e._keyMap,(n,r)=>t(r))),E0=l(3,(e,t,n)=>Ca(e._keyMap,t,(r,s,o)=>n(r,o))),Vr=Fa,k0=g0,Vf=p0,Qp=y0,Yp=S0,Hs=fi,Jf=Gp,Xp=b0,hi=_0,Pa=E0,Zp=Symbol.for("effect/MutableRef"),v0={[Zp]:Zp,toString(){return je(this.toJSON())},toJSON(){return{_id:"MutableRef",current:Re(this.current)}},[ge](){return this.toJSON()},pipe(){return I(this,arguments)}},Jr=e=>{const t=Object.create(v0);return t.current=e,t},$0=l(3,(e,t,n)=>L(t,e.current)?(e.current=n,!0):!1),te=e=>e.current,Gr=l(2,(e,t)=>(e.current=t,e)),Ma="effect/FiberId",Qr=Symbol.for(Ma),Vs="None",Gf="Runtime",Qf="Composite",T0=qe(`${Ma}-${Vs}`);let O0=class{constructor(){a(this,d$,Qr);a(this,"_tag",Vs);a(this,"id",-1);a(this,"startTimeMillis",-1)}[(d$=Qr,G)](){return T0}[B](t){return Xf(t)&&t._tag===Vs}toString(){return je(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag}}[ge](){return this.toJSON()}};class Yf{constructor(t,n){a(this,"id");a(this,"startTimeMillis");a(this,m$,Qr);a(this,"_tag",Gf);this.id=t,this.startTimeMillis=n}[(m$=Qr,G)](){return Pe(this,qe(`${Ma}-${this._tag}-${this.id}-${this.startTimeMillis}`))}[B](t){return Xf(t)&&t._tag===Gf&&this.id===t.id&&this.startTimeMillis===t.startTimeMillis}toString(){return je(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag,id:this.id,startTimeMillis:this.startTimeMillis}}[ge](){return this.toJSON()}}let ey=class{constructor(t,n){a(this,"left");a(this,"right");a(this,g$,Qr);a(this,"_tag",Qf);a(this,"_hash");this.left=t,this.right=n}[(g$=Qr,G)](){return h(qe(`${Ma}-${this._tag}`),ee(F(this.left)),ee(F(this.right)),Pe(this))}[B](t){return Xf(t)&&t._tag===Qf&&L(this.left,t.left)&&L(this.right,t.right)}toString(){return je(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag,left:Re(this.left),right:Re(this.right)}}[ge](){return this.toJSON()}};const I0=new O0,C0=(e,t)=>new Yf(e,t),R0=(e,t)=>new ey(e,t),Xf=e=>N(e,Qr),F0=l(2,(e,t)=>e._tag===Vs?t:t._tag===Vs?e:new ey(e,t)),Aa=e=>{switch(e._tag){case Vs:return Vr();case Gf:return Vf(e.id);case Qf:return h(Aa(e.left),hi(Aa(e.right)))}},ty=Q(Symbol.for("effect/Fiber/Id/_fiberCounter"),()=>Jr(0)),P0=(e,t)=>new Yf(e,t),Na=e=>Array.from(Aa(e)).map(n=>`#${n}`).join(","),M0=()=>{const e=te(ty);return h(ty,Gr(e+1)),new Yf(e,Date.now())},fr=I0,A0=C0,N0=R0,Zf=F0,x0=Aa,D0=P0,L0=Na,ny=M0,xa=Oa,K0=r0,U0=o0,ry=i0,Da=li,sy=zp,eh=Ia,q0=zf,oy=f0,j0=Hp,iy=Ca,di=Symbol.for("effect/List"),th=e=>he(e),z0=(e=>Ug(si(e),th))(L),B0={[di]:di,_tag:"Cons",toString(){return je(this.toJSON())},toJSON(){return{_id:"List",_tag:"Cons",values:th(this).map(Re)}},[ge](){return this.toJSON()},[B](e){return ay(e)&&this._tag===e._tag&&z0(this,e)},[G](){return Pe(this,Xo(th(this)))},[Symbol.iterator](){let e=!1,t=this;return{next(){if(e)return this.return();if(t._tag==="Nil")return e=!0,this.return();const n=t.head;return t=t.tail,{done:e,value:n}},return(n){return e||(e=!0),{done:!0,value:n}}}},pipe(){return I(this,arguments)}},La=(e,t)=>{const n=Object.create(B0);return n.head=e,n.tail=t,n},W0=qe("Nil"),H0={[di]:di,_tag:"Nil",toString(){return je(this.toJSON())},toJSON(){return{_id:"List",_tag:"Nil"}},[ge](){return this.toJSON()},[G](){return W0},[B](e){return ay(e)&&this._tag===e._tag},[Symbol.iterator](){return{next(){return{done:!0,value:void 0}}}},pipe(){return I(this,arguments)}},cy=Object.create(H0),ay=e=>N(e,di),Wn=e=>e._tag==="Nil",Ka=e=>e._tag==="Cons",V0=()=>cy,Yr=(e,t)=>La(e,t),Js=V0,nh=e=>La(e,cy),J0=l(2,(e,t)=>Q0(t,e)),G0=l(2,(e,t)=>Yr(t,e)),Q0=l(2,(e,t)=>{if(Wn(e))return t;if(Wn(t))return e;{const n=La(t.head,e);let r=n,s=t.tail;for(;!Wn(s);){const o=La(s.head,e);r.tail=o,r=o,s=s.tail}return n}}),Y0=l(3,(e,t,n)=>{let r=t,s=e;for(;!Wn(s);)r=n(r,s.head),s=s.tail;return r}),X0=e=>{let t=Js(),n=e;for(;!Wn(n);)t=G0(t,n.head),n=n.tail;return t},rh=function(){function e(t){t&&Object.assign(this,t)}return e.prototype=Sf,e}(),Z0=Symbol.for("effect/DifferContextPatch");function uy(e){return e}const mi={...rh.prototype,[Z0]:{_Value:uy,_Patch:uy}},eC=Object.create(Object.assign(Object.create(mi),{_tag:"Empty"})),ly=()=>eC,tC=Object.assign(Object.create(mi),{_tag:"AndThen"}),nC=(e,t)=>{const n=Object.create(tC);return n.first=e,n.second=t,n},rC=Object.assign(Object.create(mi),{_tag:"AddService"}),sC=(e,t)=>{const n=Object.create(rC);return n.key=e,n.service=t,n},oC=Object.assign(Object.create(mi),{_tag:"RemoveService"}),iC=e=>{const t=Object.create(oC);return t.key=e,t},cC=Object.assign(Object.create(mi),{_tag:"UpdateService"}),aC=(e,t)=>{const n=Object.create(cC);return n.key=e,n.update=t,n},uC=(e,t)=>{const n=new Map(e.unsafeMap);let r=ly();for(const[s,o]of t.unsafeMap.entries())if(n.has(s)){const i=n.get(s);n.delete(s),L(i,o)||(r=Ua(aC(s,()=>o))(r))}else n.delete(s),r=Ua(sC(s,o))(r);for(const[s]of n.entries())r=Ua(iC(s))(r);return r},Ua=l(2,(e,t)=>nC(e,t)),lC=l(2,(e,t)=>{if(e._tag==="Empty")return t;let n=!1,r=Ae(e);const s=new Map(t.unsafeMap);for(;zn(r);){const i=kn(r),c=Bn(r);switch(i._tag){case"Empty":{r=c;break}case"AddService":{s.set(i.key,i.service),r=c;break}case"AndThen":{r=ot(ot(c,i.second),i.first);break}case"RemoveService":{s.delete(i.key),r=c;break}case"UpdateService":{s.set(i.key,i.update(s.get(i.key))),n=!0,r=c;break}}}if(!n)return Ls(s);const o=new Map;for(const[i]of t.unsafeMap)s.has(i)&&(o.set(i,s.get(i)),s.delete(i));for(const[i,c]of s)o.set(i,c);return Ls(o)}),fC=Symbol.for("effect/DifferHashSetPatch");function sh(e){return e}const qa={...rh.prototype,[fC]:{_Value:sh,_Key:sh,_Patch:sh}},hC=Object.create(Object.assign(Object.create(qa),{_tag:"Empty"})),fy=()=>hC,dC=Object.assign(Object.create(qa),{_tag:"AndThen"}),mC=(e,t)=>{const n=Object.create(dC);return n.first=e,n.second=t,n},gC=Object.assign(Object.create(qa),{_tag:"Add"}),pC=e=>{const t=Object.create(gC);return t.value=e,t},yC=Object.assign(Object.create(qa),{_tag:"Remove"}),SC=e=>{const t=Object.create(yC);return t.value=e,t},bC=(e,t)=>{const[n,r]=Pa([e,fy()],([s,o],i)=>Qp(i)(s)?[Jf(i)(s),o]:[s,oh(pC(i))(o)])(t);return Pa(r,(s,o)=>oh(SC(o))(s))(n)},oh=l(2,(e,t)=>mC(e,t)),_C=l(2,(e,t)=>{if(e._tag==="Empty")return t;let n=t,r=Ae(e);for(;zn(r);){const s=kn(r),o=Bn(r);switch(s._tag){case"Empty":{r=o;break}case"AndThen":{r=ot(s.first)(ot(s.second)(o));break}case"Add":{n=Hs(s.value)(n),r=o;break}case"Remove":n=Jf(s.value)(n),r=o}}return n}),wC=Symbol.for("effect/DifferReadonlyArrayPatch");function hy(e){return e}const gi={...rh.prototype,[wC]:{_Value:hy,_Patch:hy}},EC=Object.create(Object.assign(Object.create(gi),{_tag:"Empty"})),dy=()=>EC,kC=Object.assign(Object.create(gi),{_tag:"AndThen"}),vC=(e,t)=>{const n=Object.create(kC);return n.first=e,n.second=t,n},$C=Object.assign(Object.create(gi),{_tag:"Append"}),TC=e=>{const t=Object.create($C);return t.values=e,t},OC=Object.assign(Object.create(gi),{_tag:"Slice"}),IC=(e,t)=>{const n=Object.create(OC);return n.from=e,n.until=t,n},CC=Object.assign(Object.create(gi),{_tag:"Update"}),RC=(e,t)=>{const n=Object.create(CC);return n.index=e,n.patch=t,n},FC=e=>{let t=0,n=dy();for(;t<e.oldValue.length&&t<e.newValue.length;){const r=e.oldValue[t],s=e.newValue[t],o=e.differ.diff(r,s);L(o,e.differ.empty)||(n=ja(n,RC(t,o))),t=t+1}return t<e.oldValue.length&&(n=ja(n,IC(0,t))),t<e.newValue.length&&(n=ja(n,TC(XO(t)(e.newValue)))),n},ja=l(2,(e,t)=>vC(e,t)),PC=l(3,(e,t,n)=>{if(e._tag==="Empty")return t;let r=t.slice(),s=tn(e);for(;ga(s);){const o=Ot(s),i=qr(s);switch(o._tag){case"Empty":{s=i;break}case"AndThen":{i.unshift(o.first,o.second),s=i;break}case"Append":{for(const c of o.values)r.push(c);s=i;break}case"Slice":{r=r.slice(o.from,o.until),s=i;break}case"Update":{r[o.index]=n.patch(o.patch,r[o.index]),s=i;break}}}return r}),MC={[Symbol.for("effect/Differ")]:{_P:R,_V:R}},Gs=e=>{const t=Object.create(MC);return t.empty=e.empty,t.diff=e.diff,t.combine=e.combine,t.patch=e.patch,t},AC=()=>Gs({empty:ly(),combine:(e,t)=>Ua(t)(e),diff:(e,t)=>uC(e,t),patch:(e,t)=>lC(t)(e)}),NC=()=>Gs({empty:fy(),combine:(e,t)=>oh(t)(e),diff:(e,t)=>bC(e,t),patch:(e,t)=>_C(t)(e)}),xC=e=>Gs({empty:dy(),combine:(t,n)=>ja(t,n),diff:(t,n)=>FC({oldValue:t,newValue:n,differ:e}),patch:(t,n)=>PC(t,n,e)}),my=()=>DC((e,t)=>t),DC=e=>Gs({empty:R,combine:(t,n)=>t===R?n:n===R?t:r=>n(t(r)),diff:(t,n)=>L(t,n)?R:Lr(n),patch:(t,n)=>e(n,t(n))}),pi=255,gy=8,ih=e=>e&pi,ch=e=>e>>gy&pi,yi=(e,t)=>(e&pi)+((t&e&pi)<<gy),LC=yi(0,0),KC=e=>yi(e,e),UC=e=>yi(e,0),qC=l(2,(e,t)=>yi(ih(e)&~t,ch(e))),jC=l(2,(e,t)=>e|t),zC=e=>~e>>>0&pi,BC=0,Qs=1,WC=2,py=4,ah=16,yy=32,HC=e=>za(e,yy),VC=l(2,(e,t)=>e|t),hr=e=>Sy(e)&&!GC(e),Sy=e=>za(e,Qs),za=l(2,(e,t)=>(e&t)!==0),by=(...e)=>e.reduce((t,n)=>t|n,0),JC=by(BC),_y=e=>za(e,py),GC=e=>za(e,ah),Xr=l(2,(e,t)=>yi(e^t,t)),Ys=l(2,(e,t)=>e&(zC(ih(t))|ch(t))|ih(t)&ch(t)),wy=Gs({empty:LC,diff:(e,t)=>Xr(e,t),combine:(e,t)=>jC(t)(e),patch:(e,t)=>Ys(t,e)}),QC=KC,Ey=UC,ky=qC,vy=(e,t)=>({_tag:"Par",left:e,right:t}),Ba=(e,t)=>({_tag:"Seq",left:e,right:t}),YC=e=>{let t=nh(e),n=Js();for(;;){const[r,s]=Y0(t,[$y(),Js()],([o,i],c)=>{const[u,f]=XC(c);return[rR(o,u),J0(i,f)]});if(n=ZC(n,r),Wn(s))return X0(n);t=s}throw new Error("BUG: BlockedRequests.flatten - please report an issue at https://github.com/Effect-TS/effect/issues")},XC=e=>{let t=e,n=$y(),r=Js(),s=Js();for(;;)switch(t._tag){case"Empty":{if(Wn(r))return[n,s];t=r.head,r=r.tail;break}case"Par":{r=Yr(t.right,r),t=t.left;break}case"Seq":{const o=t.left,i=t.right;switch(o._tag){case"Empty":{t=i;break}case"Par":{const c=o.left,u=o.right;t=vy(Ba(c,i),Ba(u,i));break}case"Seq":{const c=o.left,u=o.right;t=Ba(c,Ba(u,i));break}case"Single":{t=o,s=Yr(i,s);break}}break}case"Single":{if(n=nR(n,t),Wn(r))return[n,s];t=r.head,r=r.tail;break}}throw new Error("BUG: BlockedRequests.step - please report an issue at https://github.com/Effect-TS/effect/issues")},ZC=(e,t)=>{if(Wn(e))return nh(lh(t));if(sR(t))return e;const n=lR(e.head),r=oR(t);return n.length===1&&r.length===1&&L(n[0],r[0])?Yr(uR(e.head,lh(t)),e.tail):Yr(lh(t),e)},eR=Symbol.for("effect/RequestBlock/RequestBlockParallel"),tR={_R:e=>e};p$=eR;class uh{constructor(t){a(this,"map");a(this,p$,tR);this.map=t}}const $y=()=>new uh(xa()),nR=(e,t)=>new uh(q0(e.map,t.dataSource,n=>IO(Ds(n,ci(t.blockedRequest)),()=>Ae(t.blockedRequest)))),rR=(e,t)=>new uh(iy(e.map,t.map,(n,r,s)=>Da(n,s,ze(ry(n,s),{onNone:()=>r,onSome:o=>Be(r,o)})))),sR=e=>U0(e.map),oR=e=>Array.from(sy(e.map)),lh=e=>aR(oy(e.map,t=>Ae(t))),iR=Symbol.for("effect/RequestBlock/RequestBlockSequential"),cR={_R:e=>e};y$=iR;class Ty{constructor(t){a(this,"map");a(this,y$,cR);this.map=t}}const aR=e=>new Ty(e),uR=(e,t)=>new Ty(iy(t.map,e.map,(n,r,s)=>Da(n,s,ze(ry(n,s),{onNone:()=>Me(),onSome:o=>Be(o,r)})))),lR=e=>Array.from(sy(e.map)),fR=e=>Array.from(e.map),Xs="Die",Zs="Empty",eo="Fail",to="Interrupt",no="Parallel",ro="Sequential",Oy="effect/Cause",Iy=Symbol.for(Oy),hR={_E:e=>e},so={[Iy]:hR,[G](){return h(F(Oy),ee(F(kR(this))),Pe(this))},[B](e){return fh(e)&&ER(this,e)},pipe(){return I(this,arguments)},toJSON(){switch(this._tag){case"Empty":return{_id:"Cause",_tag:this._tag};case"Die":return{_id:"Cause",_tag:this._tag,defect:Re(this.defect)};case"Interrupt":return{_id:"Cause",_tag:this._tag,fiberId:this.fiberId.toJSON()};case"Fail":return{_id:"Cause",_tag:this._tag,failure:Re(this.error)};case"Sequential":case"Parallel":return{_id:"Cause",_tag:this._tag,left:Re(this.left),right:Re(this.right)}}},toString(){return Zr(this)},[ge](){return this.toJSON()}},Hn=(()=>{const e=Object.create(so);return e._tag=Zs,e})(),dr=e=>{const t=Object.create(so);return t._tag=eo,t.error=e,t},pt=e=>{const t=Object.create(so);return t._tag=Xs,t.defect=e,t},Gt=e=>{const t=Object.create(so);return t._tag=to,t.fiberId=e,t},cn=(e,t)=>{const n=Object.create(so);return n._tag=no,n.left=e,n.right=t,n},Qe=(e,t)=>{const n=Object.create(so);return n._tag=ro,n.left=e,n.right=t,n},fh=e=>N(e,Iy),hh=e=>e._tag===Xs,Wa=e=>e._tag===Zs?!0:oo(e,!0,(t,n)=>{switch(n._tag){case Zs:return T(t);case Xs:case eo:case to:return T(!1);default:return $()}}),Cy=e=>q(yR(e)),Ha=e=>Ga(void 0,$R)(e),dR=e=>jn(oo(e,Me(),(t,n)=>n._tag===eo?T(h(t,ot(n.error))):$())),Ry=e=>jn(oo(e,Me(),(t,n)=>n._tag===Xs?T(h(t,ot(n.defect))):$())),mR=e=>oo(e,Vr(),(t,n)=>n._tag===to?T(h(t,Hs(n.fiberId))):$()),gR=e=>Ja(e,t=>t._tag===eo?T(t.error):$()),Va=e=>{const t=gR(e);switch(t._tag){case"None":return re(e);case"Some":return z(t.value)}},pR=e=>Si(e,{onEmpty:T(Hn),onFail:t=>h(t,Ds(dr)),onDie:t=>T(pt(t)),onInterrupt:t=>T(Gt(t)),onSequential:(t,n)=>q(t)&&q(n)?T(Qe(t.value,n.value)):pe(t)&&q(n)?T(n.value):q(t)&&pe(n)?T(t.value):$(),onParallel:(t,n)=>q(t)&&q(n)?T(cn(t.value,n.value)):pe(t)&&q(n)?T(n.value):q(t)&&pe(n)?T(t.value):$()}),yR=e=>Ja(e,t=>t._tag===to?T(t.fiberId):$()),SR=e=>Si(e,{onEmpty:$(),onFail:t=>T(pt(t)),onDie:t=>T(pt(t)),onInterrupt:()=>$(),onSequential:(t,n)=>q(t)&&q(n)?T(Qe(t.value,n.value)):q(t)&&pe(n)?T(t.value):pe(t)&&q(n)?T(n.value):$(),onParallel:(t,n)=>q(t)&&q(n)?T(cn(t.value,n.value)):q(t)&&pe(n)?T(t.value):pe(t)&&q(n)?T(n.value):$()}),Fy=e=>Si(e,{onEmpty:Hn,onFail:()=>Hn,onDie:t=>pt(t),onInterrupt:t=>Gt(t),onSequential:Qe,onParallel:cn}),bR=e=>Si(e,{onEmpty:Hn,onFail:t=>pt(t),onDie:t=>pt(t),onInterrupt:t=>Gt(t),onSequential:(t,n)=>Qe(t,n),onParallel:(t,n)=>cn(t,n)}),_R=l(2,(e,t)=>wR(e,n=>dr(t(n)))),wR=l(2,(e,t)=>Si(e,{onEmpty:Hn,onFail:n=>t(n),onDie:n=>pt(n),onInterrupt:n=>Gt(n),onSequential:(n,r)=>Qe(n,r),onParallel:(n,r)=>cn(n,r)})),ER=(e,t)=>{let n=Ae(e),r=Ae(t);for(;zn(n)&&zn(r);){const[s,o]=h(kn(n),oo([Vr(),Me()],([u,f],d)=>{const[m,p]=dh(d);return T([h(u,hi(m)),h(f,Be(p))])})),[i,c]=h(kn(r),oo([Vr(),Me()],([u,f],d)=>{const[m,p]=dh(d);return T([h(u,hi(m)),h(f,Be(p))])}));if(!L(s,i))return!1;n=o,r=c}return!0},kR=e=>vR(Ae(e),Me()),vR=(e,t)=>{for(;;){const[n,r]=h(e,$f([Vr(),Me()],([o,i],c)=>{const[u,f]=dh(c);return[h(o,hi(u)),h(i,Be(f))]})),s=Yp(n)>0?h(t,ot(n)):t;if(Ea(r))return jn(s);e=r,t=s}throw new Error(Xc("Cause.flattenCauseLoop"))},Ja=l(2,(e,t)=>{const n=[e];for(;n.length>0;){const r=n.pop(),s=t(r);switch(s._tag){case"None":{switch(r._tag){case ro:case no:{n.push(r.right),n.push(r.left);break}}break}case"Some":return s}}return $()}),dh=e=>{let t=e;const n=[];let r=Vr(),s=Me();for(;t!==void 0;)switch(t._tag){case Zs:{if(n.length===0)return[r,s];t=n.pop();break}case eo:{if(r=Hs(r,Of(t._tag,t.error)),n.length===0)return[r,s];t=n.pop();break}case Xs:{if(r=Hs(r,Of(t._tag,t.defect)),n.length===0)return[r,s];t=n.pop();break}case to:{if(r=Hs(r,Of(t._tag,t.fiberId)),n.length===0)return[r,s];t=n.pop();break}case ro:{switch(t.left._tag){case Zs:{t=t.right;break}case ro:{t=Qe(t.left.left,Qe(t.left.right,t.right));break}case no:{t=cn(Qe(t.left.left,t.right),Qe(t.left.right,t.right));break}default:{s=ot(s,t.right),t=t.left;break}}break}case no:{n.push(t.right),t=t.left;break}}throw new Error(Xc("Cause.evaluateCauseLoop"))},$R={emptyCase:Lg,failCase:Ps,dieCase:Ps,interruptCase:Lg,sequentialCase:(e,t,n)=>t&&n,parallelCase:(e,t,n)=>t&&n},Py="SequentialCase",My="ParallelCase",Si=l(2,(e,{onDie:t,onEmpty:n,onFail:r,onInterrupt:s,onParallel:o,onSequential:i})=>Ga(e,void 0,{emptyCase:()=>n,failCase:(c,u)=>r(u),dieCase:(c,u)=>t(u),interruptCase:(c,u)=>s(u),sequentialCase:(c,u,f)=>i(u,f),parallelCase:(c,u,f)=>o(u,f)})),oo=l(3,(e,t,n)=>{let r=t,s=e;const o=[];for(;s!==void 0;){const i=n(r,s);switch(r=q(i)?i.value:r,s._tag){case ro:{o.push(s.right),s=s.left;break}case no:{o.push(s.right),s=s.left;break}default:{s=void 0;break}}s===void 0&&o.length>0&&(s=o.pop())}return r}),Ga=l(3,(e,t,n)=>{const r=[e],s=[];for(;r.length>0;){const i=r.pop();switch(i._tag){case Zs:{s.push(re(n.emptyCase(t)));break}case eo:{s.push(re(n.failCase(t,i.error)));break}case Xs:{s.push(re(n.dieCase(t,i.defect)));break}case to:{s.push(re(n.interruptCase(t,i.fiberId)));break}case ro:{r.push(i.right),r.push(i.left),s.push(z({_tag:Py}));break}case no:{r.push(i.right),r.push(i.left),s.push(z({_tag:My}));break}}}const o=[];for(;s.length>0;){const i=s.pop();switch(i._tag){case"Left":{switch(i.left._tag){case Py:{const c=o.pop(),u=o.pop(),f=n.sequentialCase(t,c,u);o.push(f);break}case My:{const c=o.pop(),u=o.pop(),f=n.parallelCase(t,c,u);o.push(f);break}}break}case"Right":{o.push(i.right);break}}}if(o.length===0)throw new Error("BUG: Cause.reduceWithContext - please report an issue at https://github.com/Effect-TS/effect/issues");return o.pop()}),Zr=(e,t)=>Ha(e)?"All fibers interrupted without errors.":xy(e).map(function(n){return(t==null?void 0:t.renderErrorCause)!==!0||n.cause===void 0?n.stack:`${n.stack} {
${Ay(n.cause,"  ")}
}`}).join(`
`),Ay=(e,t)=>{const n=e.stack.split(`
`);let r=`${t}[cause]: ${n[0]}`;for(let s=1,o=n.length;s<o;s++)r+=`
${t}${n[s]}`;return e.cause&&(r+=` {
${Ay(e.cause,`${t}  `)}
${t}}`),r};class Qa extends globalThis.Error{constructor(n){const r=typeof n=="object"&&n!==null,s=Error.stackTraceLimit;Error.stackTraceLimit=1;super(TR(n),r&&"cause"in n&&typeof n.cause<"u"?{cause:new Qa(n.cause)}:void 0);a(this,"span");this.message===""&&(this.message="An error has occurred"),Error.stackTraceLimit=s,this.name=n instanceof Error?n.name:"Error",r&&(Ny in n&&(this.span=n[Ny]),Object.keys(n).forEach(o=>{o in this||(this[o]=n[o])})),this.stack=IR(`${this.name}: ${this.message}`,n instanceof Error&&n.stack?n.stack:"",this.span)}}const TR=e=>{if(typeof e=="string")return e;if(typeof e=="object"&&e!==null&&e instanceof Error)return e.message;try{if(N(e,"toString")&&Ms(e.toString)&&e.toString!==Object.prototype.toString&&e.toString!==globalThis.Array.prototype.toString)return e.toString()}catch{}return JSON.stringify(e)},OR=/\((.*)\)/,Ya=Q("effect/Tracer/spanToTrace",()=>new WeakMap),IR=(e,t,n)=>{const r=[e],s=t.startsWith(e)?t.slice(e.length).split(`
`):t.split(`
`);for(let o=1;o<s.length&&!s[o].includes("Generator.next");o++){if(s[o].includes("effect_internal_function")){r.pop();break}r.push(s[o].replace(/at .*effect_instruction_i.*\((.*)\)/,"at $1").replace(/EffectPrimitive\.\w+/,"<anonymous>"))}if(n){let o=n,i=0;for(;o&&o._tag==="Span"&&i<10;){const c=Ya.get(o);if(typeof c=="function"){const u=c();if(typeof u=="string"){const f=u.match(OR),d=f?f[1]:u.replace(/^at /,"");r.push(`    at ${o.name} (${d})`)}else r.push(`    at ${o.name}`)}else r.push(`    at ${o.name}`);o=Kn(o.parent),i++}}return r.join(`
`)},Ny=Symbol.for("effect/SpanAnnotation"),xy=e=>Ga(e,void 0,{emptyCase:()=>[],dieCase:(t,n)=>[new Qa(n)],failCase:(t,n)=>[new Qa(n)],interruptCase:()=>[],parallelCase:(t,n,r)=>[...n,...r],sequentialCase:(t,n,r)=>[...n,...r]}),bi="Pending",Xa="Done",Dy=Symbol.for("effect/Deferred"),CR={_E:e=>e,_A:e=>e},RR=e=>({_tag:bi,joiners:e}),Ly=e=>({_tag:Xa,effect:e});class _i{constructor(t){a(this,"self");a(this,"called",!1);this.self=t}next(t){return this.called?{value:t,done:!0}:(this.called=!0,{value:this.self,done:!1})}return(t){return{value:t,done:!0}}throw(t){throw t}[Symbol.iterator](){return new _i(this.self)}}const Ky=Symbol.for("effect/Tracer"),FR=e=>({[Ky]:Ky,...e}),Za=Vt("effect/Tracer"),io=Vt("effect/ParentSpan"),Uy=function(){const e="abcdef0123456789",t=e.length;return function(n){let r="";for(let s=0;s<n;s++)r+=e.charAt(Math.floor(Math.random()*t));return r}}();class PR{constructor(t,n,r,s,o,i){a(this,"name");a(this,"parent");a(this,"context");a(this,"links");a(this,"startTime");a(this,"kind");a(this,"_tag","Span");a(this,"spanId");a(this,"traceId","native");a(this,"sampled",!0);a(this,"status");a(this,"attributes");a(this,"events",[]);this.name=t,this.parent=n,this.context=r,this.links=s,this.startTime=o,this.kind=i,this.status={_tag:"Started",startTime:o},this.attributes=new Map,this.traceId=n._tag==="Some"?n.value.traceId:Uy(32),this.spanId=Uy(16)}end(t,n){this.status={_tag:"Ended",endTime:t,exit:n,startTime:this.status.startTime}}attribute(t,n){this.attributes.set(t,n)}event(t,n,r){this.events.push([t,n,r??{}])}}const MR=FR({span:(e,t,n,r,s,o)=>new PR(e,t,n,r,s,o),context:e=>e()}),qy=e=>{if((e==null?void 0:e.captureStackTrace)===!1)return e;if((e==null?void 0:e.captureStackTrace)!==void 0&&typeof e.captureStackTrace!="boolean")return e;const t=Error.stackTraceLimit;Error.stackTraceLimit=3;const n=new Error;Error.stackTraceLimit=t;let r=!1;return{...e,captureStackTrace:()=>{if(r!==!1)return r;if(n.stack!==void 0){const s=n.stack.split(`
`);if(s[3]!==void 0)return r=s[3].trim(),r}}}},mh=Symbol.for("effect/EffectError"),AR=e=>N(e,mh),NR=e=>({[mh]:mh,_tag:"EffectError",cause:e}),jy=(e,t)=>{const n=new Ze("Blocked");return n.effect_instruction_i0=e,n.effect_instruction_i1=t,n},xR=e=>{const t=new Ze("RunBlocked");return t.effect_instruction_i0=e,t},eu=Symbol.for("effect/Effect");class DR{constructor(t,n){a(this,"patch");a(this,"op");a(this,"_op",yf);this.patch=t,this.op=n}}class Ze{constructor(t){a(this,"_op");a(this,"effect_instruction_i0");a(this,"effect_instruction_i1");a(this,"effect_instruction_i2");a(this,"trace");a(this,S$,xs);this._op=t}[(S$=eu,B)](t){return this===t}[G](){return Pe(this,df(this))}pipe(){return I(this,arguments)}toJSON(){return{_id:"Effect",_op:this._op,effect_instruction_i0:Re(this.effect_instruction_i0),effect_instruction_i1:Re(this.effect_instruction_i1),effect_instruction_i2:Re(this.effect_instruction_i2)}}toString(){return je(this.toJSON())}[ge](){return this.toJSON()}[Symbol.iterator](){return new _i(new Zc(this))}}class zy{constructor(t){a(this,"_op");a(this,"effect_instruction_i0");a(this,"effect_instruction_i1");a(this,"effect_instruction_i2");a(this,"trace");a(this,b$,xs);this._op=t,this._tag=t}[(b$=eu,B)](t){return hu(t)&&t._op==="Failure"&&L(this.effect_instruction_i0,t.effect_instruction_i0)}[G](){return h(qe(this._tag),ee(F(this.effect_instruction_i0)),Pe(this))}get cause(){return this.effect_instruction_i0}pipe(){return I(this,arguments)}toJSON(){return{_id:"Exit",_tag:this._op,cause:this.cause.toJSON()}}toString(){return je(this.toJSON())}[ge](){return this.toJSON()}[Symbol.iterator](){return new _i(new Zc(this))}}class By{constructor(t){a(this,"_op");a(this,"effect_instruction_i0");a(this,"effect_instruction_i1");a(this,"effect_instruction_i2");a(this,"trace");a(this,_$,xs);this._op=t,this._tag=t}[(_$=eu,B)](t){return hu(t)&&t._op==="Success"&&L(this.effect_instruction_i0,t.effect_instruction_i0)}[G](){return h(qe(this._tag),ee(F(this.effect_instruction_i0)),Pe(this))}get value(){return this.effect_instruction_i0}pipe(){return I(this,arguments)}toJSON(){return{_id:"Exit",_tag:this._op,value:Re(this.value)}}toString(){return je(this.toJSON())}[ge](){return this.toJSON()}[Symbol.iterator](){return new _i(new Zc(this))}}const vn=e=>N(e,eu),se=e=>{const t=new Ze(Jg);return t.effect_instruction_i0=e,t},tu=l(3,(e,t,n)=>xt(r=>w(e,s=>w(an(P(()=>r(t(s)))),o=>P(()=>n(s,o)).pipe(ht({onFailure:i=>{switch(o._tag){case lt:return fe(cn(o.effect_instruction_i0,i));case ft:return fe(i)}},onSuccess:()=>o})))))),We=l(2,(e,t)=>w(e,()=>v(t))),Nt=e=>We(e,void 0),Wy=function(){const e=new Ze(pf);switch(arguments.length){case 2:{e.effect_instruction_i0=arguments[0],e.commit=arguments[1];break}case 3:{e.effect_instruction_i0=arguments[0],e.effect_instruction_i1=arguments[1],e.commit=arguments[2];break}case 4:{e.effect_instruction_i0=arguments[0],e.effect_instruction_i1=arguments[1],e.effect_instruction_i2=arguments[2],e.commit=arguments[3];break}default:throw new Error(Xc("you're not supposed to end up here"))}return e},LR=(e,t=fr)=>{const n=new Ze(Zo);let r;return n.effect_instruction_i0=s=>{r=e(s)},n.effect_instruction_i1=t,r!==void 0?fo(n,s=>r):n},Qt=(e,t=fr)=>Wy(e,function(){let n,r;function s(u){n?n(u):r===void 0&&(r=u)}const o=new Ze(Zo);o.effect_instruction_i0=u=>{n=u,r&&u(r)},o.effect_instruction_i1=t;let i,c;return this.effect_instruction_i0.length!==1?(c=new AbortController,i=ut(()=>this.effect_instruction_i0(s,c.signal))):i=ut(()=>this.effect_instruction_i0(s)),i||c?fo(o,u=>(c&&c.abort(),i??W)):o}),wi=l(2,(e,t)=>{const n=new Ze(sa);return n.effect_instruction_i0=e,n.effect_instruction_i1=t,n}),co=l(2,(e,t)=>$n(e,{onFailure:t,onSuccess:v})),Hy=l(3,(e,t,n)=>wi(e,r=>{const s=Va(r);switch(s._tag){case"Left":return t(s.left)?n(s.left):fe(r);case"Right":return fe(s.right)}})),nu=Symbol.for("effect/SpanAnnotation"),Vy=Symbol.for("effect/OriginalAnnotation"),Jy=(e,t)=>q(t)?new Proxy(e,{has(n,r){return r===nu||r===Vy||r in n},get(n,r){return r===nu?t.value:r===Vy?e:n[r]}}):e,Ei=e=>Dn(e)&&!(nu in e)?se(t=>fe(pt(Jy(e,ES(t))))):fe(pt(e)),Gy=e=>Qy(()=>pt(new mF(e))),ao=e=>$n(e,{onFailure:t=>v(z(t)),onSuccess:t=>v(re(t))}),an=e=>Yy(e,{onFailure:ue,onSuccess:et}),Ee=e=>Dn(e)&&!(nu in e)?se(t=>fe(dr(Jy(e,ES(t))))):fe(dr(e)),ru=e=>w(k(e),Ee),fe=e=>{const t=new zy(lt);return t.effect_instruction_i0=e,t},Qy=e=>w(k(e),fe),ki=se(e=>v(e.id())),uo=e=>se(t=>e(t.id())),w=l(2,(e,t)=>{const n=new Ze(oa);return n.effect_instruction_i0=e,n.effect_instruction_i1=t,n}),KR=l(2,(e,t)=>w(e,n=>{const r=typeof t=="function"?t(n):t;return vn(r)?r:Bg(r)?Qt(s=>{r.then(o=>s(v(o)),o=>s(Ee(new vh(o))))}):v(r)})),UR=e=>{const t=new Ze("OnStep");return t.effect_instruction_i0=e,t},lo=e=>w(e,R),Yy=l(2,(e,t)=>ht(e,{onFailure:n=>v(t.onFailure(n)),onSuccess:n=>v(t.onSuccess(n))})),ht=l(2,(e,t)=>{const n=new Ze(ia);return n.effect_instruction_i0=e,n.effect_instruction_i1=t.onFailure,n.effect_instruction_i2=t.onSuccess,n}),$n=l(2,(e,t)=>ht(e,{onFailure:n=>{if(Ry(n).length>0)return fe(bR(n));const s=dR(n);return s.length>0?t.onFailure(Rf(s)):fe(n)},onSuccess:t.onSuccess})),Vn=l(2,(e,t)=>P(()=>{const n=he(e),r=da(n.length);let s=0;return We(Sh({while:()=>s<n.length,body:()=>t(n[s],s),step:o=>{r[s++]=o}}),r)})),vi=l(2,(e,t)=>P(()=>{const n=he(e);let r=0;return Sh({while:()=>r<n.length,body:()=>t(n[r],r),step:()=>{r++}})})),He=w(ki,e=>gh(e)),gh=e=>fe(Gt(e)),su=e=>{const t=new Ze(Ns);return t.effect_instruction_i0=QC(Qs),t.effect_instruction_i1=()=>e,t},Xy=l(2,(e,t)=>xt(n=>w(an(n(e)),r=>bS(t,r)))),A=l(2,(e,t)=>w(e,n=>k(()=>t(n)))),ph=l(2,(e,t)=>$n(e,{onFailure:n=>ru(()=>t.onFailure(n)),onSuccess:n=>k(()=>t.onSuccess(n))})),ou=l(2,(e,t)=>ht(e,{onFailure:n=>{const r=Va(n);switch(r._tag){case"Left":return ru(()=>t(r.left));case"Right":return fe(r.right)}},onSuccess:v})),qR=l(2,(e,t)=>Jn(e,n=>SS(n)?W:t(n.effect_instruction_i0))),Jn=l(2,(e,t)=>xt(n=>ht(n(e),{onFailure:r=>{const s=ue(r);return ht(t(s),{onFailure:o=>ue(Qe(r,o)),onSuccess:()=>s})},onSuccess:r=>{const s=et(r);return ae(t(s),s)}}))),fo=l(2,(e,t)=>Jn(e,mu({onFailure:n=>Ha(n)?Nt(t(mR(n))):W,onSuccess:()=>W}))),jR=l(2,(e,t)=>WR(e,t,v)),yh=e=>zR(e,R),zR=l(2,(e,t)=>$n(e,{onFailure:n=>Ei(t(n)),onSuccess:v})),v=e=>{const t=new By(ft);return t.effect_instruction_i0=e,t},P=e=>w(k(e),R),k=e=>{const t=new Ze(Vg);return t.effect_instruction_i0=e,t},Tn=l(e=>e.length===3||e.length===2&&!(Dn(e[1])&&"onlyEffect"in e[1]),(e,t)=>w(e,n=>{const r=typeof t=="function"?t(n):t;return vn(r)?We(r,n):Bg(r)?Qt(s=>{r.then(o=>s(v(n)),o=>s(Ee(new vh(o))))}):v(n)})),BR=e=>se(t=>{const n=t.getFiberRef(wh),r=h(n,we(()=>t.scope()));return e(ho(wh,T(r)))}),WR=l(3,(e,t,n)=>ht(e,{onFailure:r=>Ry(r).length>0?fe(up(SR(r))):t(),onSuccess:n})),mr=e=>{const t=new Ze(Ns);return t.effect_instruction_i0=Ey(Qs),t.effect_instruction_i1=()=>e,t},xt=e=>Wy(e,function(){const t=new Ze(Ns);return t.effect_instruction_i0=Ey(Qs),t.effect_instruction_i1=n=>Sy(n)?ut(()=>this.effect_instruction_i0(su)):ut(()=>this.effect_instruction_i0(mr)),t}),W=v(void 0),HR=e=>{const t=new Ze(Ns);return t.effect_instruction_i0=e,t.effect_instruction_i1=void 0,t},iu=l(2,(e,t)=>w(t,n=>n?h(e,A(T)):v($()))),Sh=e=>{const t=new Ze(ca);return t.effect_instruction_i0=e.while,t.effect_instruction_i1=e.body,t.effect_instruction_i2=e.step,t},VR=l(2,(e,t)=>{const n=new Ze(Ns);return n.effect_instruction_i0=t,n.effect_instruction_i1=()=>e,n}),$i=e=>{const t=new Ze(aa);return typeof(e==null?void 0:e.priority)<"u"?aF(t,e.priority):t},Zy=l(2,(e,t)=>w(e,n=>A(t,r=>[n,r]))),es=l(2,(e,t)=>w(e,n=>We(t,n))),ae=l(2,(e,t)=>w(e,()=>t)),eS=l(3,(e,t,n)=>w(e,r=>A(t,s=>n(r,s)))),JR=Qt(()=>{const e=setInterval(()=>{},2147483647);return k(()=>clearInterval(e))}),Ti=e=>w(ki,t=>h(e,Gn(t))),Gn=l(2,(e,t)=>w(e.interruptAsFork(t),()=>e.await)),GR={_tag:"All",syslog:0,label:"ALL",ordinal:Number.MIN_SAFE_INTEGER,pipe(){return I(this,arguments)}},QR={_tag:"Fatal",syslog:2,label:"FATAL",ordinal:5e4,pipe(){return I(this,arguments)}},YR={_tag:"Error",syslog:3,label:"ERROR",ordinal:4e4,pipe(){return I(this,arguments)}},XR={_tag:"Warning",syslog:4,label:"WARN",ordinal:3e4,pipe(){return I(this,arguments)}},tS={_tag:"Info",syslog:6,label:"INFO",ordinal:2e4,pipe(){return I(this,arguments)}},nS={_tag:"Debug",syslog:7,label:"DEBUG",ordinal:1e4,pipe(){return I(this,arguments)}},ZR={_tag:"Trace",syslog:7,label:"TRACE",ordinal:0,pipe(){return I(this,arguments)}},eF={_tag:"None",syslog:7,label:"OFF",ordinal:Number.MAX_SAFE_INTEGER,pipe(){return I(this,arguments)}},tF=Symbol.for("effect/FiberRef"),nF={_A:e=>e},Oi=e=>rS(e,t=>[t,t]),ts=l(2,(e,t)=>w(Oi(e),t)),cu=l(2,(e,t)=>rS(e,()=>[void 0,t])),rS=l(2,(e,t)=>se(n=>{const[r,s]=t(n.getFiberRef(e));return n.setFiberRef(e,s),v(r)})),ho=l(3,(e,t,n)=>tu(es(Oi(t),cu(t,n)),()=>e,r=>cu(t,r))),sS=l(3,(e,t,n)=>ts(t,r=>ho(e,t,n(r)))),it=(e,t)=>mo(e,{differ:my(),fork:(t==null?void 0:t.fork)??R,join:t==null?void 0:t.join}),rF=e=>{const t=NC();return mo(e,{differ:t,fork:t.empty})},sF=e=>{const t=xC(my());return mo(e,{differ:t,fork:t.empty})},oS=e=>{const t=AC();return mo(e,{differ:t,fork:t.empty})},mo=(e,t)=>({[tF]:nF,initial:e,diff:(n,r)=>t.differ.diff(n,r),combine:(n,r)=>t.differ.combine(n,r),patch:n=>r=>t.differ.patch(n,r),fork:t.fork,join:t.join??((n,r)=>r),pipe(){return I(this,arguments)}}),oF=e=>mo(e,{differ:wy,fork:wy.empty}),Dt=Q(Symbol.for("effect/FiberRef/currentContext"),()=>oS(qn())),Ii=Q(Symbol.for("effect/FiberRef/currentSchedulingPriority"),()=>it(0)),iS=Q(Symbol.for("effect/FiberRef/currentMaxOpsBeforeYield"),()=>it(2048)),cS=Q(Symbol.for("effect/FiberRef/currentLogAnnotation"),()=>it(xa())),iF=Q(Symbol.for("effect/FiberRef/currentLogLevel"),()=>it(tS)),cF=Q(Symbol.for("effect/FiberRef/currentLogSpan"),()=>it(Js())),aF=l(2,(e,t)=>ho(e,Ii,t)),uF=Q(Symbol.for("effect/FiberRef/currentConcurrency"),()=>it("unbounded")),lF=Q(Symbol.for("effect/FiberRef/currentRequestBatching"),()=>it(!0)),bh=Q(Symbol.for("effect/FiberRef/currentUnhandledErrorLogLevel"),()=>it(T(nS))),_h=Q(Symbol.for("effect/FiberRef/currentMetricLabels"),()=>sF(cr())),wh=Q(Symbol.for("effect/FiberRef/currentForkScopeOverride"),()=>it($(),{fork:()=>$(),join:(e,t)=>e})),au=Q(Symbol.for("effect/FiberRef/currentInterruptedCause"),()=>it(Hn,{fork:()=>Hn,join:(e,t)=>e})),fF=Q(Symbol.for("effect/FiberRef/currentTracerEnabled"),()=>it(!0)),aS=Q(Symbol.for("effect/FiberRef/currentTracerTiming"),()=>it(!0)),hF=Q(Symbol.for("effect/FiberRef/currentTracerSpanAnnotations"),()=>it(xa())),dF=Q(Symbol.for("effect/FiberRef/currentTracerSpanLinks"),()=>it(Me())),uS=Symbol.for("effect/Scope"),lS=Symbol.for("effect/CloseableScope"),fS=(e,t)=>e.addFinalizer(()=>Nt(t)),Eh=(e,t)=>e.addFinalizer(t),uu=(e,t)=>e.close(t),lu=(e,t)=>e.fork(t),kh=function(){class e extends globalThis.Error{commit(){return Ee(this)}toJSON(){return{...this}}[ge](){return this.toString!==globalThis.Error.prototype.toString?this.stack?`${this.toString()}
${this.stack.split(`
`).slice(1).join(`
`)}`:this.toString():"Bun"in globalThis?Zr(dr(this),{renderErrorCause:!0}):this}}return Object.assign(e.prototype,pO),e}(),fu=(e,t)=>{class n extends kh{constructor(){super(...arguments);a(this,"_tag",t)}}return Object.assign(n.prototype,e),n.prototype.name=t,n},hS=Symbol.for("effect/Cause/errors/RuntimeException"),mF=fu({[hS]:hS},"RuntimeException"),gF=Symbol.for("effect/Cause/errors/InterruptedException"),pF=e=>N(e,gF),dS=Symbol.for("effect/Cause/errors/IllegalArgument"),yF=fu({[dS]:dS},"IllegalArgumentException"),mS=Symbol.for("effect/Cause/errors/NoSuchElement"),Ci=fu({[mS]:mS},"NoSuchElementException"),gS=Symbol.for("effect/Cause/errors/Timeout"),SF=fu({[gS]:gS},"TimeoutException"),bF=e=>new SF(`Operation timed out before the specified duration of '${xp(e)}' elapsed`),pS=Symbol.for("effect/Cause/errors/UnknownException"),vh=function(){class e extends kh{constructor(r,s){super(s??"An unknown error occurred",{cause:r});a(this,"cause");a(this,"_tag","UnknownException");a(this,"error");this.cause=r,this.error=r}}return Object.assign(e.prototype,{[pS]:pS,name:"UnknownException"}),e}(),hu=e=>vn(e)&&"_tag"in e&&(e._tag==="Success"||e._tag==="Failure"),yS=e=>e._tag==="Failure",SS=e=>e._tag==="Success",_F=l(2,(e,t)=>{switch(e._tag){case lt:return ue(e.effect_instruction_i0);case ft:return et(t)}}),$h=e=>_F(e,void 0),ns=(e,t)=>vF(e,t!=null&&t.parallel?cn:Qe),wF=e=>ue(pt(e)),Th=e=>ue(dr(e)),ue=e=>{const t=new zy(lt);return t.effect_instruction_i0=e,t},Oh=e=>ue(Gt(e)),du=l(2,(e,t)=>{switch(e._tag){case lt:return ue(e.effect_instruction_i0);case ft:return et(t(e.effect_instruction_i0))}}),mu=l(2,(e,{onFailure:t,onSuccess:n})=>{switch(e._tag){case lt:return t(e.effect_instruction_i0);case ft:return n(e.effect_instruction_i0)}}),Ih=l(2,(e,{onFailure:t,onSuccess:n})=>{switch(e._tag){case lt:return t(e.effect_instruction_i0);case ft:return n(e.effect_instruction_i0)}}),et=e=>{const t=new By(ft);return t.effect_instruction_i0=e,t},Yt=et(void 0),EF=l(2,(e,t)=>Ch(e,t,{onSuccess:(n,r)=>[n,r],onFailure:Qe})),kF=l(2,(e,t)=>Ch(e,t,{onSuccess:(n,r)=>r,onFailure:Qe})),Ch=l(3,(e,t,{onFailure:n,onSuccess:r})=>{switch(e._tag){case lt:switch(t._tag){case ft:return ue(e.effect_instruction_i0);case lt:return ue(n(e.effect_instruction_i0,t.effect_instruction_i0))}case ft:switch(t._tag){case ft:return et(r(e.effect_instruction_i0,t.effect_instruction_i0));case lt:return ue(t.effect_instruction_i0)}}}),vF=(e,t)=>{const n=ii(e);return zn(n)?h(Bn(n),$f(h(kn(n),du(Ae)),(r,s)=>h(r,Ch(s,{onSuccess:(o,i)=>h(o,ot(i)),onFailure:t}))),du(jn),du(r=>At(r)),T):$()},Ri=e=>({[Dy]:CR,state:Jr(RR([])),blockingOn:e,pipe(){return I(this,arguments)}}),Fi=()=>w(ki,e=>$F(e)),$F=e=>k(()=>Ri(e)),Qn=e=>Qt(t=>{const n=te(e.state);switch(n._tag){case Xa:return t(n.effect);case bi:return n.joiners.push(t),RF(e,t)}},e.blockingOn),TF=l(2,(e,t)=>Xy(t,e)),go=l(2,(e,t)=>k(()=>{const n=te(e.state);switch(n._tag){case Xa:return!1;case bi:{Gr(e.state,Ly(t));for(let r=0,s=n.joiners.length;r<s;r++)n.joiners[r](t);return!0}}})),bS=l(2,(e,t)=>go(e,t)),OF=l(2,(e,t)=>go(e,Ee(t))),_S=l(2,(e,t)=>go(e,fe(t))),IF=e=>w(ki,t=>go(e,gh(t))),Rh=l(2,(e,t)=>go(e,gh(t))),CF=e=>k(()=>te(e.state)._tag===Xa),Pi=l(2,(e,t)=>go(e,v(t))),Mi=(e,t)=>{const n=te(e.state);if(n._tag===bi){Gr(e.state,Ly(t));for(let r=0,s=n.joiners.length;r<s;r++)n.joiners[r](t)}},RF=(e,t)=>k(()=>{const n=te(e.state);if(n._tag===bi){const r=n.joiners.indexOf(t);r>=0&&n.joiners.splice(r,1)}}),FF=Oi(Dt),Ai=()=>FF,po=e=>w(Ai(),e),Fh=l(2,(e,t)=>ho(Dt,t)(e)),Ph=l(2,(e,t)=>sS(Dt,n=>Br(n,t))(e)),wS=l(2,(e,t)=>po(n=>Fh(e,t(n)))),ES=e=>{const t=e.getFiberRef(Dt).unsafeMap.get(io.key);return t!==void 0&&t._tag==="Span"?T(t):$()},PF={_tag:"Span",spanId:"noop",traceId:"noop",name:"noop",sampled:!1,parent:$(),context:qn(),status:{_tag:"Ended",startTime:BigInt(0),endTime:BigInt(0),exit:Yt},attributes:new Map,links:[],kind:"internal",attribute(){},event(){},end(){}},MF=e=>{const t=Object.create(PF);return t.name=e,t},gr=Dy,Ke=Fi,Se=Qn,AF=TF,NF=bS,kS=OF,Ni=_S,vS=IF,Mh=CF,yt=Pi,xi=Mi,xF=hu,Ah=yS,Nh=SS,DF=ns,xh=wF,gu=Th,Ye=ue,LF=Oh,KF=du,un=mu,It=et,pr=Yt,$S=EF,Di=kF,TS=Symbol.for("effect/MutableHashMap"),UF={[TS]:TS,[Symbol.iterator](){return new Dh(this)},toString(){return je(this.toJSON())},toJSON(){return{_id:"MutableHashMap",values:Array.from(this).map(Re)}},[ge](){return this.toJSON()},pipe(){return I(this,arguments)}};class Dh{constructor(t){a(this,"self");a(this,"referentialIterator");a(this,"bucketIterator");this.self=t,this.referentialIterator=t.referential[Symbol.iterator]()}next(){if(this.bucketIterator!==void 0)return this.bucketIterator.next();const t=this.referentialIterator.next();return t.done?(this.bucketIterator=new qF(this.self.buckets.values()),this.next()):t}[Symbol.iterator](){return new Dh(this.self)}}class qF{constructor(t){a(this,"backing");a(this,"currentBucket");this.backing=t}next(){if(this.currentBucket===void 0){const n=this.backing.next();if(n.done)return n;this.currentBucket=n.value[Symbol.iterator]()}const t=this.currentBucket.next();return t.done?(this.currentBucket=void 0,this.next()):t}}const jF=()=>{const e=Object.create(UF);return e.referential=new Map,e.buckets=new Map,e.bucketsSize=0,e},rs=l(2,(e,t)=>{if(na(t)===!1)return e.referential.has(t)?T(e.referential.get(t)):$();const n=t[G](),r=e.buckets.get(n);return r===void 0?$():zF(e,r,t)}),zF=(e,t,n,r=!1)=>{for(let s=0,o=t.length;s<o;s++)if(n[B](t[s][0])){const i=t[s][1];return r&&(t.splice(s,1),e.bucketsSize--),T(i)}return $()},Li=l(2,(e,t)=>q(rs(e,t))),Ki=l(3,(e,t,n)=>{if(na(t)===!1)return e.referential.set(t,n),e;const r=t[G](),s=e.buckets.get(r);return s===void 0?(e.buckets.set(r,[[t,n]]),e.bucketsSize++,e):(BF(e,s,t),s.push([t,n]),e.bucketsSize++,e)}),BF=(e,t,n)=>{for(let r=0,s=t.length;r<s;r++)if(n[B](t[r][0])){t.splice(r,1),e.bucketsSize--;return}},OS=Symbol.for("effect/MutableList"),WF={[OS]:OS,[Symbol.iterator](){let e=!1,t=this.head;return{next(){if(e)return this.return();if(t==null)return e=!0,this.return();const n=t.value;return t=t.next,{done:e,value:n}},return(n){return e||(e=!0),{done:!0,value:n}}}},toString(){return je(this.toJSON())},toJSON(){return{_id:"MutableList",values:Array.from(this).map(Re)}},[ge](){return this.toJSON()},pipe(){return I(this,arguments)}},HF=e=>({value:e,removed:!1,prev:void 0,next:void 0}),VF=()=>{const e=Object.create(WF);return e.head=void 0,e.tail=void 0,e._length=0,e},IS=e=>Lh(e)===0,Lh=e=>e._length,JF=l(2,(e,t)=>{const n=HF(t);return e.head===void 0&&(e.head=n),e.tail===void 0||(e.tail.next=n,n.prev=e.tail),e.tail=n,e._length+=1,e}),GF=e=>{const t=e.head;if(t!==void 0)return QF(e,t),t.value},QF=(e,t)=>{t.removed||(t.removed=!0,t.prev!==void 0&&t.next!==void 0?(t.prev.next=t.next,t.next.prev=t.prev):t.prev!==void 0?(e.tail=t.prev,t.prev.next=void 0):t.next!==void 0?(e.head=t.next,t.next.prev=void 0):(e.tail=void 0,e.head=void 0),e._length>0&&(e._length-=1))},CS=Symbol.for("effect/MutableQueue"),Ne=Symbol.for("effect/mutable/MutableQueue/Empty"),YF={[CS]:CS,[Symbol.iterator](){return Array.from(this.queue)[Symbol.iterator]()},toString(){return je(this.toJSON())},toJSON(){return{_id:"MutableQueue",values:Array.from(this).map(Re)}},[ge](){return this.toJSON()},pipe(){return I(this,arguments)}},RS=e=>{const t=Object.create(YF);return t.queue=VF(),t.capacity=e,t},Kh=e=>RS(e),pu=()=>RS(void 0),Uh=e=>Lh(e.queue),ss=e=>IS(e.queue),XF=e=>e.capacity===void 0?1/0:e.capacity,yo=l(2,(e,t)=>{const n=Lh(e.queue);return e.capacity!==void 0&&n===e.capacity?!1:(JF(t)(e.queue),!0)}),qh=l(2,(e,t)=>{const n=t[Symbol.iterator]();let r,s=Me(),o=!0;for(;o&&(r=n.next())&&!r.done;)o=yo(r.value)(e);for(;r!=null&&!r.done;)s=ot(r.value)(s),r=n.next();return jn(s)}),Yn=l(2,(e,t)=>IS(e.queue)?t:GF(e.queue)),yu=l(2,(e,t)=>{let n=Me(),r=0;for(;r<t;){const s=Yn(Ne)(e);if(s===Ne)break;n=ot(s)(n),r+=1}return jn(n)}),FS=Symbol.for("effect/Clock"),So=Vt("effect/Clock"),ZF=2**31-1,PS={unsafeSchedule(e,t){const n=ui(t);if(n>ZF)return Ps;let r=!1;const s=setTimeout(()=>{r=!0,e()},n);return()=>(clearTimeout(s),!r)}},MS=function(){const e=BigInt(1e6);if(typeof performance>"u")return()=>BigInt(Date.now())*e;if(typeof performance.timeOrigin=="number"&&performance.timeOrigin===0)return()=>BigInt(Math.round(performance.now()*1e6));const t=BigInt(Date.now())*e-BigInt(Math.round(performance.now()*1e6));return()=>t+BigInt(Math.round(performance.now()*1e6))}(),e1=function(){const e=typeof process=="object"&&"hrtime"in process&&typeof process.hrtime.bigint=="function"?process.hrtime:void 0;if(!e)return MS;const t=MS()-e.bigint();return()=>t+e.bigint()}();w$=FS;class t1{constructor(){a(this,w$,FS);a(this,"currentTimeMillis",k(()=>this.unsafeCurrentTimeMillis()));a(this,"currentTimeNanos",k(()=>this.unsafeCurrentTimeNanos()))}unsafeCurrentTimeMillis(){return Date.now()}unsafeCurrentTimeNanos(){return e1()}scheduler(){return v(PS)}sleep(t){return Qt(n=>{const r=PS.unsafeSchedule(()=>n(W),t);return Nt(k(r))})}}const n1=()=>new t1,yr=TO,jh=e=>e.replace(/[/\\^$*+?.()|[\]{}]/g,"\\$&"),AS="And",NS="Or",xS="InvalidData",DS="MissingData",LS="SourceUnavailable",KS="Unsupported",US=Symbol.for("effect/ConfigError"),bo={_tag:"ConfigError",[US]:US},qS=(e,t)=>{const n=Object.create(bo);return n._op=AS,n.left=e,n.right=t,Object.defineProperty(n,"toString",{enumerable:!1,value(){return`${this.left} and ${this.right}`}}),n},jS=(e,t)=>{const n=Object.create(bo);return n._op=NS,n.left=e,n.right=t,Object.defineProperty(n,"toString",{enumerable:!1,value(){return`${this.left} or ${this.right}`}}),n},r1=(e,t,n={pathDelim:"."})=>{const r=Object.create(bo);return r._op=xS,r.path=e,r.message=t,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Invalid data at ${h(this.path,zr(n.pathDelim))}: "${this.message}")`}}),r},os=(e,t,n={pathDelim:"."})=>{const r=Object.create(bo);return r._op=DS,r.path=e,r.message=t,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Missing data at ${h(this.path,zr(n.pathDelim))}: "${this.message}")`}}),r},s1=(e,t,n,r={pathDelim:"."})=>{const s=Object.create(bo);return s._op=LS,s.path=e,s.message=t,s.cause=n,Object.defineProperty(s,"toString",{enumerable:!1,value(){return`(Source unavailable at ${h(this.path,zr(r.pathDelim))}: "${this.message}")`}}),s},o1=(e,t,n={pathDelim:"."})=>{const r=Object.create(bo);return r._op=KS,r.path=e,r.message=t,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Unsupported operation at ${h(this.path,zr(n.pathDelim))}: "${this.message}")`}}),r},is=l(2,(e,t)=>{switch(e._op){case AS:return qS(is(e.left,t),is(e.right,t));case NS:return jS(is(e.left,t),is(e.right,t));case xS:return r1([...t,...e.path],e.message);case DS:return os([...t,...e.path],e.message);case LS:return s1([...t,...e.path],e.message,e.cause);case KS:return o1([...t,...e.path],e.message)}}),i1={_tag:"Empty"},zh=l(2,(e,t)=>{let n=nh(t),r=e;for(;Ka(n);){const s=n.head;switch(s._tag){case"Empty":{n=n.tail;break}case"AndThen":{n=Yr(s.first,Yr(s.second,n.tail));break}case"MapName":{r=Un(r,s.f),n=n.tail;break}case"Nested":{r=ma(r,s.name),n=n.tail;break}case"Unnested":{if(h(ni(r),FO(s.name)))r=qr(r),n=n.tail;else return z(os(r,`Expected ${s.name} to be in path in ConfigProvider#unnested`));break}}}return re(r)}),c1="Constant",a1="Fail",u1="Fallback",l1="Described",f1="Lazy",h1="MapOrFail",d1="Nested",m1="Primitive",g1="Sequence",p1="HashMap",y1="ZipWith";var zS={};const Su=(e,t)=>[...e,...t],BS=Symbol.for("effect/ConfigProvider"),S1=Vt("effect/ConfigProvider"),WS=Symbol.for("effect/ConfigProviderFlat"),b1=e=>({[BS]:BS,pipe(){return I(this,arguments)},...e}),_1=e=>({[WS]:WS,patch:e.patch,load:(t,n,r=!0)=>e.load(t,n,r),enumerateChildren:e.enumerateChildren}),w1=e=>b1({load:t=>w(Xt(e,cr(),t,!1),n=>ze(ni(n),{onNone:()=>Ee(os(cr(),`Expected a single value having structure: ${t}`)),onSome:v})),flattened:e}),E1=e=>{const{pathDelim:t,seqDelim:n}=Object.assign({},{pathDelim:"_",seqDelim:","},e),r=u=>h(u,zr(t)),s=u=>u.split(t),o=()=>typeof process<"u"&&"env"in process&&typeof zS=="object"?zS:{};return w1(_1({load:(u,f,d=!0)=>{const m=r(u),p=o(),g=m in p?T(p[m]):$();return h(g,ou(()=>os(u,`Expected ${m} to exist in the process context`)),w(b=>O1(b,u,f,n,d)))},enumerateChildren:u=>k(()=>{const f=o(),p=Object.keys(f).map(g=>s(g.toUpperCase())).filter(g=>{for(let b=0;b<u.length;b++){const S=h(u,mp(b)),_=g[b];if(_===void 0||S!==_)return!1}return!0}).flatMap(g=>g.slice(u.length,u.length+1));return k0(p)}),patch:i1}))},k1=(e,t,n,r)=>{const s=wp(n.length,u=>u>=r.length?$():T([e(u),u+1])),o=wp(r.length,u=>u>=n.length?$():T([t(u),u+1])),i=Su(n,s),c=Su(r,o);return[i,c]},v1=(e,t)=>{let n=t;if(n._tag==="Nested"){const r=e.slice();for(;n._tag==="Nested";)r.push(n.name),n=n.config;return r}return e},Xt=(e,t,n,r)=>{const s=n;switch(s._tag){case c1:return v(tn(s.value));case l1:return P(()=>Xt(e,t,s.config,r));case a1:return Ee(os(t,s.message));case u1:return h(P(()=>Xt(e,t,s.first,r)),co(o=>s.condition(o)?h(Xt(e,t,s.second,r),co(i=>Ee(jS(o,i)))):Ee(o)));case f1:return P(()=>Xt(e,t,s.config(),r));case h1:return P(()=>h(Xt(e,t,s.original,r),w(Vn(o=>h(s.mapOrFail(o),ou(is(v1(t,s.original))))))));case d1:return P(()=>Xt(e,Su(t,tn(s.name)),s.config,r));case m1:return h(zh(t,e.patch),w(o=>h(e.load(o,s,r),w(i=>{if(i.length===0){const c=h(GO(o),we(()=>"<n/a>"));return Ee(os([],`Expected ${s.description} with name ${c}`))}return v(i)}))));case g1:return h(zh(t,e.patch),w(o=>h(e.enumerateChildren(o),w(C1),w(i=>i.length===0?P(()=>A(Xt(e,t,s.config,!0),tn)):h(Vn(i,c=>Xt(e,WO(t,`[${c}]`),s.config,!0)),A(c=>{const u=oI(c);return u.length===0?tn(cr()):tn(u)}))))));case p1:return P(()=>h(zh(t,e.patch),w(o=>h(e.enumerateChildren(o),w(i=>h(i,Vn(c=>Xt(e,Su(o,tn(c)),s.valueConfig,r)),A(c=>c.length===0?tn(xa()):h(I1(c),Un(u=>K0(yp(he(i),u)))))))))));case y1:return P(()=>h(Xt(e,t,s.left,r),ao,w(o=>h(Xt(e,t,s.right,r),ao,w(i=>{if(st(o)&&st(i))return Ee(qS(o.left,i.left));if(st(o)&&Ln(i))return Ee(o.left);if(Ln(o)&&st(i))return Ee(i.left);if(Ln(o)&&Ln(i)){const c=h(t,zr(".")),u=$1(t,c),[f,d]=k1(u,u,h(o.right,Un(re)),h(i.right,Un(re)));return h(f,yp(d),Vn(([m,p])=>h(Zy(m,p),A(([g,b])=>s.zip(g,b)))))}throw new Error("BUG: ConfigProvider.fromFlatLoop - please report an issue at https://github.com/Effect-TS/effect/issues")})))))}},$1=(e,t)=>n=>z(os(e,`The element at index ${n} in a sequence at path "${t}" was missing`)),T1=(e,t)=>e.split(new RegExp(`\\s*${jh(t)}\\s*`)),O1=(e,t,n,r,s)=>s?h(T1(e,r),Vn(o=>n.parse(o.trim())),ou(is(t))):h(n.parse(e),ph({onFailure:is(t),onSuccess:tn})),I1=e=>Object.keys(e[0]).map(t=>e.map(n=>n[t])),C1=e=>h(Vn(e,F1),ph({onFailure:()=>cr(),onSuccess:jr(yr)}),ao,A(vO)),R1=/^(\[(\d+)\])$/,F1=e=>{const t=e.match(R1);if(t!==null){const n=t[2];return h(n!==void 0&&n.length>0?T(n):$(),ti(P1))}return $()},P1=e=>{const t=Number.parseInt(e);return Number.isNaN(t)?$():T(t)},HS=Symbol.for("effect/Console"),bu=Vt("effect/Console"),M1={[HS]:HS,assert(e,...t){return k(()=>{console.assert(e,...t)})},clear:k(()=>{console.clear()}),count(e){return k(()=>{console.count(e)})},countReset(e){return k(()=>{console.countReset(e)})},debug(...e){return k(()=>{console.debug(...e)})},dir(e,t){return k(()=>{console.dir(e,t)})},dirxml(...e){return k(()=>{console.dirxml(...e)})},error(...e){return k(()=>{console.error(...e)})},group(e){return e!=null&&e.collapsed?k(()=>console.groupCollapsed(e==null?void 0:e.label)):k(()=>console.group(e==null?void 0:e.label))},groupEnd:k(()=>{console.groupEnd()}),info(...e){return k(()=>{console.info(...e)})},log(...e){return k(()=>{console.log(...e)})},table(e,t){return k(()=>{console.table(e,t)})},time(e){return k(()=>console.time(e))},timeEnd(e){return k(()=>console.timeEnd(e))},timeLog(e,...t){return k(()=>{console.timeLog(e,...t)})},trace(...e){return k(()=>{console.trace(...e)})},warn(...e){return k(()=>{console.warn(...e)})},unsafe:console},VS=Symbol.for("effect/Random"),A1=Vt("effect/Random");E$=VS;class N1{constructor(t){a(this,"seed");a(this,E$,VS);a(this,"PRNG");this.seed=t,this.PRNG=new sO(t)}get next(){return k(()=>this.PRNG.number())}get nextBoolean(){return A(this.next,t=>t>.5)}get nextInt(){return k(()=>this.PRNG.integer(Number.MAX_SAFE_INTEGER))}nextRange(t,n){return A(this.next,r=>(n-t)*r+t)}nextIntBetween(t,n){return k(()=>this.PRNG.integer(n-t)+t)}shuffle(t){return x1(t,n=>this.nextIntBetween(0,n))}}const x1=(e,t)=>P(()=>h(k(()=>Array.from(e)),w(n=>{const r=[];for(let s=n.length;s>=2;s=s-1)r.push(s);return h(r,vi(s=>h(t(s),A(o=>D1(n,s-1,o)))),We(ii(n)))}))),D1=(e,t,n)=>{const r=e[t];return e[t]=e[n],e[n]=r,e},L1=h(qn(),Ks(So,n1()),Ks(bu,M1),Ks(A1,(e=>new N1(F(e)))(Math.random())),Ks(S1,E1()),Ks(Za,MR)),On=Q(Symbol.for("effect/DefaultServices/currentServices"),()=>oS(L1)),K1=e=>{const t=rn(e);return Bh(n=>n.sleep(t))},Bh=e=>ts(On,t=>e(Mt(t,So))),U1=Bh(e=>e.currentTimeMillis),JS=K1,q1=U1,j1=So;function z1(e){return new Sr(e)}function B1(){return z1(new Map)}const GS=Symbol.for("effect/FiberRefs");k$=GS;class Sr{constructor(t){a(this,"locals");a(this,k$,GS);this.locals=t}pipe(){return I(this,arguments)}}const W1=(e,t,n,r=!1)=>{const s=e;let o=t,i=n,c=r,u;for(;u===void 0;)if(ye(o)&&ye(i)){const f=Ot(o)[0],d=qr(o),m=Ot(i)[0],p=Ot(i)[1],g=qr(i);f.startTimeMillis<m.startTimeMillis?(i=g,c=!0):f.startTimeMillis>m.startTimeMillis?o=d:f.id<m.id?(i=g,c=!0):f.id>m.id?o=d:u=[p,c]}else u=[s.initial,!0];return u},H1=l(3,(e,t,n)=>{const r=new Map(e.locals);return n.locals.forEach((s,o)=>{const i=s[0][1];if(!s[0][0][B](t)){if(!r.has(o)){if(L(i,o.initial))return;r.set(o,[[t,o.join(o.initial,i)]]);return}const c=r.get(o),[u,f]=W1(o,c,s);if(f){const d=o.diff(u,i),m=c[0][1],p=o.join(m,o.patch(d)(m));if(!L(m,p)){let g;const b=c[0][0];b[B](t)?g=[[b,p],...c.slice(1)]:g=[[t,p],...c],r.set(o,g)}}}}),new Sr(r)}),V1=l(2,(e,t)=>{const n=new Map;return QS(e,n,t),new Sr(n)}),QS=(e,t,n)=>{e.locals.forEach((r,s)=>{const o=r[0][1],i=s.patch(s.fork)(o);L(o,i)?t.set(s,r):t.set(s,[[n,i],...r])})},YS=l(2,(e,t)=>{const n=new Map(e.locals);return n.delete(t),new Sr(n)}),_u=l(2,(e,t)=>e.locals.has(t)?T(Ot(e.locals.get(t))[1]):$()),Wh=l(2,(e,t)=>h(_u(e,t),we(()=>t.initial))),Hh=l(2,(e,{fiberId:t,fiberRef:n,value:r})=>{if(e.locals.size===0)return new Sr(new Map([[n,[[t,r]]]]));const s=new Map(e.locals);return Vh(s,t,n,r),new Sr(s)}),Vh=(e,t,n,r)=>{const s=e.get(n)??[];let o;if(ye(s)){const[i,c]=Ot(s);if(i[B](t)){if(L(c,r))return;o=[[t,r],...s.slice(1)]}else o=[[t,r],...s]}else o=[[t,r]];e.set(n,o)},J1=l(2,(e,{entries:t,forkAs:n})=>{if(e.locals.size===0)return new Sr(new Map(t));const r=new Map(e.locals);return n!==void 0&&QS(e,r,n),t.forEach(([s,o])=>{o.length===1?Vh(r,o[0][0],s,o[0][1]):o.forEach(([i,c])=>{Vh(r,i,s,c)})}),new Sr(r)}),XS=_u,Jh=Wh,G1=J1,Q1=B1,Y1=GR,X1=QR,ZS=YR,eb=XR,Z1=tS,Gh=nS,eP=ZR,tP=eF,nP=OO(h(yr,la(e=>e.ordinal))),rP=e=>{switch(e){case"All":return Y1;case"Debug":return Gh;case"Error":return ZS;case"Fatal":return X1;case"Info":return Z1;case"Trace":return eP;case"None":return tP;case"Warning":return eb}},sP=e=>t=>`${t.label.replace(/[\s="]/g,"_")}=${e-t.startTime}ms`,Xn=Symbol.for("effect/Readable"),Qh=Symbol.for("effect/Ref"),Yh={_A:e=>e};$$=Qh,v$=Xn;class oP{constructor(t){a(this,"ref");a(this,$$,Yh);a(this,v$);a(this,"get");this.ref=t,this[Xn]=Xn,this.get=k(()=>te(this.ref))}modify(t){return k(()=>{const n=te(this.ref),[r,s]=t(n);return n!==s&&Gr(s)(this.ref),r})}pipe(){return I(this,arguments)}}const tb=e=>new oP(Jr(e)),wu=e=>k(()=>tb(e)),br=e=>e.get,Ui=l(2,(e,t)=>e.modify(()=>[void 0,t])),nb=l(2,(e,t)=>e.modify(t)),Xh=l(2,(e,t)=>e.modify(n=>[void 0,t(n)])),iP=Qh,qi=wu,cs=br,ji=nb,Eu=Ui,cP=Xh,aP=io,rb="Empty",sb="Add",ob="Remove",ib="Update",cb="AndThen",uP={_tag:rb},ab=(e,t)=>{const n=new Map(e.locals);let r=uP;for(const[s,o]of t.locals.entries()){const i=Ot(o)[1],c=n.get(s);if(c!==void 0){const u=Ot(c)[1];L(u,i)||(r=Zh({_tag:ib,fiberRef:s,patch:s.diff(u,i)})(r))}else r=Zh({_tag:sb,fiberRef:s,value:i})(r);n.delete(s)}for(const[s]of n.entries())r=Zh({_tag:ob,fiberRef:s})(r);return r},Zh=l(2,(e,t)=>({_tag:cb,first:e,second:t})),ub=l(3,(e,t,n)=>{let r=n,s=tn(e);for(;ye(s);){const o=Ot(s),i=qr(s);switch(o._tag){case rb:{s=i;break}case sb:{r=Hh(r,{fiberId:t,fiberRef:o.fiberRef,value:o.value}),s=i;break}case ob:{r=YS(r,o.fiberRef),s=i;break}case ib:{const c=Wh(r,o.fiberRef);r=Hh(r,{fiberId:t,fiberRef:o.fiberRef,value:o.fiberRef.patch(o.patch)(c)}),s=i;break}case cb:{s=ma(o.first)(ma(o.second)(i));break}}}return r}),lb="effect/MetricLabel",ed=Symbol.for(lb);class lP{constructor(t,n){a(this,"key");a(this,"value");a(this,T$,ed);a(this,"_hash");this.key=t,this.value=n,this._hash=qe(lb+this.key+this.value)}[(T$=ed,G)](){return this._hash}[B](t){return hP(t)&&this.key===t.key&&this.value===t.value}pipe(){return I(this,arguments)}}const fP=(e,t)=>new lP(e,t),hP=e=>N(e,ed),dP=l(e=>vn(e[0]),function(){const e=arguments;return sS(e[0],cS,typeof e[1]=="string"?Da(e[1],e[2]):t=>Object.entries(e[1]).reduce((n,[r,s])=>Da(n,r,s),t))}),mP=e=>{let t,n;return typeof e=="function"?t=e:(t=e.try,n=e.catch),k(()=>{try{return t()}catch(r){throw NR(dr(n?n(r):new vh(r)))}})},gP=l(2,(e,t)=>wi(e,n=>{const r=Ja(n,s=>hh(s)?T(s):$());switch(r._tag){case"None":return fe(n);case"Some":return t(r.value.defect)}})),pP=l(2,(e,t)=>ht(e,{onFailure:n=>{const r=t(n);switch(r._tag){case"None":return fe(n);case"Some":return r.value}},onSuccess:v})),yP=l(3,(e,t,n)=>Hy(e,uf(t),n)),fb=l(2,(e,t)=>ae(JS(t),e)),SP=e=>CP(e,EP,ab),bP=BT(A,w),_P=zT(A),hb=l(2,(e,t)=>$n(e,{onFailure:n=>v(t.onFailure(n)),onSuccess:n=>v(t.onSuccess(n))})),td=e=>{const t=w(w(e,()=>$i()),()=>t);return t},wP=function(){let e;return arguments.length===1?e=arguments[0]:e=arguments[1].bind(arguments[0]),P(()=>{const t=e(h),n=ut(()=>t.next()),r=s=>s.done?v(s.value):w(iO(s.value),o=>r(ut(()=>t.next(o))));return r(n)})},EP=se(e=>v(e.getFiberRefs())),kP=e=>hb(e,{onFailure:of,onSuccess:of}),vP=e=>ht(e,{onFailure:t=>db(t,"An error was silently ignored because it is not anticipated to be useful"),onSuccess:()=>W}),nd=e=>(...t)=>{const n=ei(e);let r;for(let s=0,o=t.length;s<o;s++){const i=t[s];fh(i)&&(r!==void 0?r=Qe(r,i):r=i,t=[...t.slice(0,s),...t.slice(s+1)],s--)}return r===void 0&&(r=Hn),se(s=>(s.log(t,r,n),W))},db=nd(Gh),$P=nd(eb),TP=nd(ZS),mb=l(2,(e,t)=>ht(e,{onFailure:n=>Qy(()=>t(n)),onSuccess:v})),OP=e=>A(e,t=>!t),IP=e=>PP((t,n)=>h(e,ub(t,n))),gb=l(3,(e,t,n)=>po(r=>Fh(e,Ks(r,t,n)))),rd=JS,ku=v($()),CP=l(3,(e,t,n)=>w(t,r=>w(e,s=>A(t,o=>[n(r,o),s])))),RP=l(2,(e,t)=>ht(e,{onFailure:n=>{const r=Va(n);switch(r._tag){case"Left":return ae(t(r.left),fe(n));case"Right":return fe(n)}},onSuccess:v})),FP=l(2,(e,t)=>ht(e,{onFailure:n=>ae(t(n),fe(n)),onSuccess:v})),PP=e=>se(t=>(t.setFiberRefs(e(t.id(),t.getFiberRefs())),W)),MP=l(2,(e,t)=>P(()=>t()?A(e,T):v($()))),AP=e=>A(Ai(),ar(e)),NP=w(Ai(),e=>{const t=e.unsafeMap.get(io.key);return t!==void 0&&t._tag==="Span"?v(t):Ee(new Ci)}),pb=BigInt(0),xP=(e,t,n)=>{if(e.getFiberRef(fF)===!1)return MF(t);const s=e.getFiberRef(Dt),o=e.getFiberRef(On),i=Mt(o,Za),c=Mt(o,j1),u=e.getFiberRef(aS),f=e.getFiberRefs(),d=XS(f,hF),m=XS(f,dF),p=n.parent?T(n.parent):n.root?$():ar(s,io),g=m._tag==="Some"?n.links!==void 0?[...At(m.value),...n.links??[]]:At(m.value):n.links??cr(),b=i.span(t,p,n.context??qn(),g,u?c.unsafeCurrentTimeNanos():pb,n.kind??"internal");return typeof n.captureStackTrace=="function"&&Ya.set(b,n.captureStackTrace),d._tag==="Some"&&j0(d.value,(S,_)=>b.attribute(_,S)),n.attributes!==void 0&&Object.entries(n.attributes).forEach(([S,_])=>b.attribute(S,_)),b},DP=(e,t,n,r)=>k(()=>{e.status._tag!=="Ended"&&(yS(t)&&Ya.has(e)&&e.attribute("code.stacktrace",Ya.get(e)()),e.end(r?n.unsafeCurrentTimeNanos():pb,t))}),yb=(e,...t)=>{const n=qy(t.length===1?void 0:t[0]),r=t[t.length-1];return se(s=>{const o=xP(s,e,n),i=s.getFiberRef(aS),c=Mt(s.getFiberRef(On),So);return Jn(r(o),u=>DP(o,u,c,i))})},sd=l(2,(e,t)=>gb(e,io,t)),LP=function(){const e=typeof arguments[0]!="string",t=e?arguments[1]:arguments[0],n=qy(e?arguments[2]:arguments[1]);if(e){const r=arguments[0];return yb(t,n,s=>sd(r,s))}return r=>yb(t,n,s=>sd(r,s))},Sb=Gg,bb="Sequential",_b="Parallel",KP="ParallelN",_o={_tag:bb},UP={_tag:_b},qP=e=>({_tag:KP,parallelism:e}),jP=e=>e._tag===bb,zP=e=>e._tag===_b,zi=_o,od=UP,id=qP,Bi=ab,Wi=ub,vu="effect/FiberStatus",as=Symbol.for(vu),$u="Done",wb="Running",Eb="Suspended",BP=qe(`${vu}-${$u}`);let WP=class{constructor(){a(this,O$,as);a(this,"_tag",$u)}[(O$=as,G)](){return BP}[B](t){return cd(t)&&t._tag===$u}};class HP{constructor(t){a(this,"runtimeFlags");a(this,I$,as);a(this,"_tag",wb);this.runtimeFlags=t}[(I$=as,G)](){return h(F(vu),ee(F(this._tag)),ee(F(this.runtimeFlags)),Pe(this))}[B](t){return cd(t)&&t._tag===wb&&this.runtimeFlags===t.runtimeFlags}}class VP{constructor(t,n){a(this,"runtimeFlags");a(this,"blockingOn");a(this,C$,as);a(this,"_tag",Eb);this.runtimeFlags=t,this.blockingOn=n}[(C$=as,G)](){return h(F(vu),ee(F(this._tag)),ee(F(this.runtimeFlags)),ee(F(this.blockingOn)),Pe(this))}[B](t){return cd(t)&&t._tag===Eb&&this.runtimeFlags===t.runtimeFlags&&L(this.blockingOn,t.blockingOn)}}const JP=new WP,GP=e=>new HP(e),QP=(e,t)=>new VP(e,t),cd=e=>N(e,as),YP=e=>e._tag===$u,XP=JP,kb=GP,ZP=QP,eM=YP,tM=Symbol.for("effect/Micro/runSymbol"),nM=Symbol.for("effect/Micro/Env"),vb=Symbol.for("effect/Micro/EnvRef"),rM={[nM]:{_R:R},pipe(){return I(this,arguments)}},$b=e=>{const t=Object.create(rM);return t.refs=e,t},sM=()=>{const e=new AbortController,t=Object.create(null);return t[Ob.key]=e,t[uM.key]=e.signal,t[fM.key]=new Tb,$b(t)},oM=l(2,(e,t)=>t.key in e.refs?e.refs[t.key]:t.initial),iM=l(3,(e,t,n)=>{const r=Object.assign(Object.create(null),e.refs);return r[t.key]=n,$b(r)}),cM="setImmediate"in globalThis?globalThis.setImmediate:e=>setTimeout(e,0);class Tb{constructor(){a(this,"tasks",[]);a(this,"running",!1);a(this,"afterScheduled",()=>{this.running=!1,this.runTasks()})}scheduleTask(t,n){this.tasks.push(t),this.running||(this.running=!0,cM(this.afterScheduled))}runTasks(){const t=this.tasks;this.tasks=[];for(let n=0,r=t.length;n<r;n++)t[n]()}shouldYield(t){return!1}flush(){for(;this.tasks.length>0;)this.runTasks()}}const aM={[vb]:vb},Tu=(e,t)=>Q(e,()=>{const n=Object.create(aM);return n.key=e,n.initial=t(),n}),Ob=Tu("effect/Micro/currentAbortController",()=>{}),uM=Tu("effect/Micro/currentAbortSignal",()=>{}),lM=Tu("effect/Micro/currentContext",()=>qn()),fM=Tu("effect/Micro/currentScheduler",()=>new Tb);class Ib{constructor(){a(this,"buckets",[])}scheduleTask(t,n){const r=this.buckets.length;let s,o=0;for(;o<r&&this.buckets[o][0]<=n;o++)s=this.buckets[o];s&&s[0]===n?s[1].push(t):o===r?this.buckets.push([n,[t]]):this.buckets.splice(o,0,[n,[t]])}}class hM{constructor(t){a(this,"maxNextTickBeforeTimer");a(this,"running",!1);a(this,"tasks",new Ib);this.maxNextTickBeforeTimer=t}starveInternal(t){const n=this.tasks.buckets;this.tasks.buckets=[];for(const[r,s]of n)for(let o=0;o<s.length;o++)s[o]();this.tasks.buckets.length===0?this.running=!1:this.starve(t)}starve(t=0){t>=this.maxNextTickBeforeTimer?setTimeout(()=>this.starveInternal(0),0):Promise.resolve(void 0).then(()=>this.starveInternal(t+1))}shouldYield(t){return t.currentOpCount>t.getFiberRef(iS)?t.getFiberRef(Ii):!1}scheduleTask(t,n){this.tasks.scheduleTask(t,n),this.running||(this.running=!0,this.starve())}}const Cb=Q(Symbol.for("effect/Scheduler/defaultScheduler"),()=>new hM(2048));class dM{constructor(){a(this,"tasks",new Ib);a(this,"deferred",!1)}scheduleTask(t,n){this.deferred?Cb.scheduleTask(t,n):this.tasks.scheduleTask(t,n)}shouldYield(t){return t.currentOpCount>t.getFiberRef(iS)?t.getFiberRef(Ii):!1}flush(){for(;this.tasks.buckets.length>0;){const t=this.tasks.buckets;this.tasks.buckets=[];for(const[n,r]of t)for(let s=0;s<r.length;s++)r[s]()}this.deferred=!0}}const Hi=Q(Symbol.for("effect/FiberRef/currentScheduler"),()=>it(Cb)),Rb=Q(Symbol.for("effect/FiberRef/currentRequestMap"),()=>it(new Map)),Fb=(e,t,n,r)=>{switch(e){case void 0:return t();case"unbounded":return n();case"inherit":return ts(uF,s=>s==="unbounded"?n():s>1?r(s):t());default:return e>1?r(e):t()}},ad="InterruptSignal",ud="Stateful",ld="Resume",fd="YieldNow",hd=e=>({_tag:ad,cause:e}),Ou=e=>({_tag:ud,onFiber:e}),wo=e=>({_tag:ld,effect:e}),mM=()=>({_tag:fd}),Iu=Symbol.for("effect/FiberScope");R$=Iu;class gM{constructor(){a(this,R$,Iu);a(this,"fiberId",fr);a(this,"roots",new Set)}add(t,n){this.roots.add(n),n.addObserver(()=>{this.roots.delete(n)})}}F$=Iu;class pM{constructor(t,n){a(this,"fiberId");a(this,"parent");a(this,F$,Iu);this.fiberId=t,this.parent=n}add(t,n){this.parent.tell(Ou(r=>{r.addChild(n),n.addObserver(()=>{r.removeChild(n)})}))}}const yM=e=>new pM(e.id(),e),Cu=Q(Symbol.for("effect/FiberScope/Global"),()=>new gM),SM=Symbol.for("effect/Fiber"),bM={_E:e=>e,_A:e=>e},_M=Symbol.for("effect/Fiber"),wM=e=>e.await,EM=e=>e.inheritAll,kM=l(2,(e,t)=>e.interruptAsFork(t)),Ru=e=>es(lo(e.await),e.inheritAll),us="effect/FiberCurrent",vM=Symbol.for("effect/Logger"),$M={_Message:e=>e,_Output:e=>e},Vi=e=>({[vM]:$M,log:e,pipe(){return I(this,arguments)}}),TM=Vi(({annotations:e,cause:t,date:n,fiberId:r,logLevel:s,message:o,spans:i})=>{const c=n.getTime();let f=[`timestamp=${n.toISOString()}`,`level=${s.label}`,`fiber=${Na(r)}`].join(" ");const d=kf(o);for(let m=0;m<d.length;m++){const p=ra(d[m]);p.length>0&&(f=f+" message=",f=dd(p,f))}if(t!=null&&t._tag!=="Empty"&&(f=f+" cause=",f=dd(Zr(t,{renderErrorCause:!0}),f)),Ka(i)){f=f+" ";let m=!0;for(const p of i)m?m=!1:f=f+" ",f=f+h(p,sP(c))}if(eh(e)>0){f=f+" ";let m=!0;for(const[p,g]of e)m?m=!1:f=f+" ",f=f+Mb(p),f=f+"=",f=dd(ra(g),f)}return f}),OM=e=>`"${e.replace(/\\([\s\S])|(")/g,"\\$1$2")}"`,IM=/^[^\s"=]+$/,dd=(e,t)=>t+(e.match(IM)?e:OM(e)),Pb=e=>{switch(typeof e){case"bigint":case"function":case"symbol":return String(e);default:return e}},Mb=e=>e.replace(/[\s="]/g,"_"),Ab=e=>t=>`${Mb(t.label)}=${e-t.startTime}ms`,CM=(e,...t)=>{let n="";for(let r=0;r<t.length;r++)n+=`\x1B[${t[r]}m`;return n+e+"\x1B[0m"},RM=(e,...t)=>e,Zt={bold:"1",red:"31",green:"32",yellow:"33",blue:"34",cyan:"36",white:"37",gray:"90",black:"30",bgBrightRed:"101"},FM={None:[],All:[],Trace:[Zt.gray],Debug:[Zt.blue],Info:[Zt.green],Warning:[Zt.yellow],Error:[Zt.red],Fatal:[Zt.bgBrightRed,Zt.black]},PM={None:"",All:"",Trace:"color:gray",Debug:"color:blue",Info:"color:green",Warning:"color:orange",Error:"color:red",Fatal:"background-color:red;color:white"},MM=e=>`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}.${e.getMilliseconds().toString().padStart(3,"0")}`,Nb=typeof process=="object"&&process!==null&&typeof process.stdout=="object"&&process.stdout!==null,xb=Nb&&process.stdout.isTTY===!0,AM=Nb||"Deno"in globalThis,NM=e=>{const t=(e==null?void 0:e.mode)??"auto",r=(t==="auto"?AM?"tty":"browser":t)==="browser",s=typeof(e==null?void 0:e.colors)=="boolean"?e.colors:xb||r,o=(e==null?void 0:e.formatDate)??MM;return r?DM({colors:s,formatDate:o}):xM({colors:s,formatDate:o,stderr:(e==null?void 0:e.stderr)===!0})},xM=e=>{const t=typeof process=="object"&&"isBun"in process&&process.isBun===!0,n=e.colors&&xb?CM:RM;return Vi(({annotations:r,cause:s,context:o,date:i,fiberId:c,logLevel:u,message:f,spans:d})=>{const m=Jh(o,On),p=Mt(m,bu).unsafe,g=e.stderr===!0?p.error:p.log,b=kf(f);let S=n(`[${e.formatDate(i)}]`,Zt.white)+` ${n(u.label,...FM[u._tag])} (${Na(c)})`;if(Ka(d)){const y=i.getTime(),E=Ab(y);for(const O of d)S+=" "+E(O)}S+=":";let _=0;if(b.length>0){const y=Pb(b[0]);typeof y=="string"&&(S+=" "+n(y,Zt.bold,Zt.cyan),_++)}if(g(S),t||p.group(),Wa(s)||g(Zr(s,{renderErrorCause:!0})),_<b.length)for(;_<b.length;_++)g(b[_]);if(eh(r)>0)for(const[y,E]of r)g(n(`${y}:`,Zt.bold,Zt.white),E);t||p.groupEnd()})},DM=e=>{const t=e.colors?"%c":"";return Vi(({annotations:n,cause:r,context:s,date:o,fiberId:i,logLevel:c,message:u,spans:f})=>{const d=Jh(s,On),m=Mt(d,bu).unsafe,p=kf(u);let g=`${t}[${e.formatDate(o)}]`;const b=[];if(e.colors&&b.push("color:gray"),g+=` ${t}${c.label}${t} (${Na(i)})`,e.colors&&b.push(PM[c._tag],""),Ka(f)){const _=o.getTime(),y=Ab(_);for(const E of f)g+=" "+y(E)}g+=":";let S=0;if(p.length>0){const _=Pb(p[0]);typeof _=="string"&&(g+=` ${t}${_}`,e.colors&&b.push("color:deepskyblue"),S++)}if(m.groupCollapsed(g,...b),Wa(r)||m.error(Zr(r,{renderErrorCause:!0})),S<p.length)for(;S<p.length;S++)m.log(p[S]);if(eh(n)>0)for(const[_,y]of n)e.colors?m.log(`%c${_}:`,"color:gray",y):m.log(`${_}:`,y);m.groupEnd()})},Db="effect/MetricBoundaries",md=Symbol.for(Db);class LM{constructor(t){a(this,"values");a(this,P$,md);a(this,"_hash");this.values=t,this._hash=h(qe(Db),ee(Xo(this.values)))}[(P$=md,G)](){return this._hash}[B](t){return KM(t)&&L(this.values,t.values)}pipe(){return I(this,arguments)}}const KM=e=>N(e,md),UM=e=>{const t=h(e,hp(Ae(Number.POSITIVE_INFINITY)),cI);return new LM(t)},qM=e=>h(jO(e.count-1,t=>e.start*Math.pow(e.factor,t)),Jt,UM),Lb=Symbol.for("effect/MetricKeyType"),Kb="effect/MetricKeyType/Counter",gd=Symbol.for(Kb),jM=Symbol.for("effect/MetricKeyType/Frequency"),zM=Symbol.for("effect/MetricKeyType/Gauge"),Ub="effect/MetricKeyType/Histogram",pd=Symbol.for(Ub),BM=Symbol.for("effect/MetricKeyType/Summary"),qb={_In:e=>e,_Out:e=>e};class WM{constructor(t,n){a(this,"incremental");a(this,"bigint");a(this,A$,qb);a(this,M$,gd);a(this,"_hash");this.incremental=t,this.bigint=n,this._hash=qe(Kb)}[(A$=Lb,M$=gd,G)](){return this._hash}[B](t){return jb(t)}pipe(){return I(this,arguments)}}class HM{constructor(t){a(this,"boundaries");a(this,x$,qb);a(this,N$,pd);a(this,"_hash");this.boundaries=t,this._hash=h(qe(Ub),ee(F(this.boundaries)))}[(x$=Lb,N$=pd,G)](){return this._hash}[B](t){return zb(t)&&L(this.boundaries,t.boundaries)}pipe(){return I(this,arguments)}}const VM=e=>new WM((e==null?void 0:e.incremental)??!1,(e==null?void 0:e.bigint)??!1),JM=e=>new HM(e),jb=e=>N(e,gd),GM=e=>N(e,jM),QM=e=>N(e,zM),zb=e=>N(e,pd),YM=e=>N(e,BM),Bb=Symbol.for("effect/MetricKey"),XM={_Type:e=>e},ZM=si(L);class yd{constructor(t,n,r,s=[]){a(this,"name");a(this,"keyType");a(this,"description");a(this,"tags");a(this,D$,XM);a(this,"_hash");this.name=t,this.keyType=n,this.description=r,this.tags=s,this._hash=h(qe(this.name+this.description),ee(F(this.keyType)),ee(Xo(this.tags)))}[(D$=Bb,G)](){return this._hash}[B](t){return eA(t)&&this.name===t.name&&L(this.keyType,t.keyType)&&L(this.description,t.description)&&ZM(this.tags,t.tags)}pipe(){return I(this,arguments)}}const eA=e=>N(e,Bb),tA=(e,t)=>new yd(e,VM(t),ei(t==null?void 0:t.description)),nA=(e,t,n)=>new yd(e,JM(t),ei(n)),rA=l(2,(e,t)=>t.length===0?e:new yd(e.name,e.keyType,e.description,pa(e.tags,t))),Ji=Symbol.for("effect/MetricState"),Wb="effect/MetricState/Counter",Sd=Symbol.for(Wb),Hb="effect/MetricState/Frequency",bd=Symbol.for(Hb),Vb="effect/MetricState/Gauge",_d=Symbol.for(Vb),Jb="effect/MetricState/Histogram",wd=Symbol.for(Jb),Gb="effect/MetricState/Summary",Ed=Symbol.for(Gb),Gi={_A:e=>e};class sA{constructor(t){a(this,"count");a(this,K$,Gi);a(this,L$,Sd);this.count=t}[(K$=Ji,L$=Sd,G)](){return h(F(Wb),ee(F(this.count)),Pe(this))}[B](t){return gA(t)&&this.count===t.count}pipe(){return I(this,arguments)}}const oA=si(L);class iA{constructor(t){a(this,"occurrences");a(this,q$,Gi);a(this,U$,bd);a(this,"_hash");this.occurrences=t}[(q$=Ji,U$=bd,G)](){return h(qe(Hb),ee(Xo(he(this.occurrences.entries()))),Pe(this))}[B](t){return pA(t)&&oA(he(this.occurrences.entries()),he(t.occurrences.entries()))}pipe(){return I(this,arguments)}}class cA{constructor(t){a(this,"value");a(this,z$,Gi);a(this,j$,_d);this.value=t}[(z$=Ji,j$=_d,G)](){return h(F(Vb),ee(F(this.value)),Pe(this))}[B](t){return yA(t)&&this.value===t.value}pipe(){return I(this,arguments)}}class aA{constructor(t,n,r,s,o){a(this,"buckets");a(this,"count");a(this,"min");a(this,"max");a(this,"sum");a(this,W$,Gi);a(this,B$,wd);this.buckets=t,this.count=n,this.min=r,this.max=s,this.sum=o}[(W$=Ji,B$=wd,G)](){return h(F(Jb),ee(F(this.buckets)),ee(F(this.count)),ee(F(this.min)),ee(F(this.max)),ee(F(this.sum)),Pe(this))}[B](t){return SA(t)&&L(this.buckets,t.buckets)&&this.count===t.count&&this.min===t.min&&this.max===t.max&&this.sum===t.sum}pipe(){return I(this,arguments)}}class uA{constructor(t,n,r,s,o,i){a(this,"error");a(this,"quantiles");a(this,"count");a(this,"min");a(this,"max");a(this,"sum");a(this,V$,Gi);a(this,H$,Ed);this.error=t,this.quantiles=n,this.count=r,this.min=s,this.max=o,this.sum=i}[(V$=Ji,H$=Ed,G)](){return h(F(Gb),ee(F(this.error)),ee(F(this.quantiles)),ee(F(this.count)),ee(F(this.min)),ee(F(this.max)),ee(F(this.sum)),Pe(this))}[B](t){return bA(t)&&this.error===t.error&&L(this.quantiles,t.quantiles)&&this.count===t.count&&this.min===t.min&&this.max===t.max&&this.sum===t.sum}pipe(){return I(this,arguments)}}const lA=e=>new sA(e),fA=e=>new iA(e),hA=e=>new cA(e),dA=e=>new aA(e.buckets,e.count,e.min,e.max,e.sum),mA=e=>new uA(e.error,e.quantiles,e.count,e.min,e.max,e.sum),gA=e=>N(e,Sd),pA=e=>N(e,bd),yA=e=>N(e,_d),SA=e=>N(e,wd),bA=e=>N(e,Ed),_A=Symbol.for("effect/MetricHook"),wA={_In:e=>e,_Out:e=>e},Qi=e=>({[_A]:wA,pipe(){return I(this,arguments)},...e}),Qb=BigInt(0),EA=e=>{let t=e.keyType.bigint?Qb:0;const n=e.keyType.incremental?e.keyType.bigint?s=>s>=Qb:s=>s>=0:s=>!0,r=s=>{n(s)&&(t=t+s)};return Qi({get:()=>lA(t),update:r,modify:r})},kA=e=>{const t=new Map;for(const r of e.keyType.preregisteredWords)t.set(r,0);const n=r=>{const s=t.get(r)??0;t.set(r,s+1)};return Qi({get:()=>fA(t),update:n,modify:n})},vA=(e,t)=>{let n=t;return Qi({get:()=>hA(n),update:r=>{n=r},modify:r=>{n=n+r}})},$A=e=>{const t=e.keyType.boundaries.values,n=t.length,r=new Uint32Array(n+1),s=new Float32Array(n);let o=0,i=0,c=Number.MAX_VALUE,u=Number.MIN_VALUE;h(t,jr(yr),Un((m,p)=>{s[p]=m}));const f=m=>{let p=0,g=n;for(;p!==g;){const b=Math.floor(p+(g-p)/2),S=s[b];m<=S?g=b:p=b,g===p+1&&(m<=s[p]?g=p:p=g)}r[p]=r[p]+1,o=o+1,i=i+m,m<c&&(c=m),m>u&&(u=m)},d=()=>{const m=da(n);let p=0;for(let g=0;g<n;g++){const b=s[g],S=r[g];p=p+S,m[g]=[b,p]}return m};return Qi({get:()=>dA({buckets:d(),count:o,min:c,max:u,sum:i}),update:f,modify:f})},TA=e=>{const{error:t,maxAge:n,maxSize:r,quantiles:s}=e.keyType,o=h(s,jr(yr)),i=da(r);let c=0,u=0,f=0,d=Number.MAX_VALUE,m=Number.MIN_VALUE;const p=b=>{const S=[];let _=0;for(;_!==r-1;){const y=i[_];if(y!=null){const[E,O]=y,U=ai(b-E);zI(U,MI)&&U<=n&&S.push(O)}_=_+1}return OA(t,o,jr(S,yr))},g=(b,S)=>{if(r>0){c=c+1;const _=c%r;i[_]=[S,b]}u=u+1,f=f+b,b<d&&(d=b),b>m&&(m=b)};return Qi({get:()=>mA({error:t,quantiles:p(Date.now()),count:u,min:d,max:m,sum:f}),update:([b,S])=>g(b,S),modify:([b,S])=>g(b,S)})},OA=(e,t,n)=>{const r=n.length;if(!ye(t))return cr();const s=t[0],o=t.slice(1),i=Yb(e,r,$(),0,s,n),c=tn(i);return o.forEach(u=>{c.push(Yb(e,r,i.value,i.consumed,u,i.rest))}),Un(c,u=>[u.quantile,u.value])},Yb=(e,t,n,r,s,o)=>{let i=e,c=t,u=n,f=r,d=s,m=o,p=e,g=t,b=n,S=r,_=s,y=o;for(;;){if(!ye(m))return{quantile:d,value:$(),consumed:f,rest:[]};if(d===1)return{quantile:d,value:T(gp(m)),consumed:f+m.length,rest:[]};const E=YO(m,M=>M<=m[0]),O=d*c,U=i/2*O,J=f+E[0].length,j=Math.abs(J-O);if(J<O-U){p=i,g=c,b=ni(m),S=J,_=d,y=E[1],i=p,c=g,u=b,f=S,d=_,m=y;continue}if(J>O+U)return{quantile:d,value:u,consumed:f,rest:m};switch(u._tag){case"None":{p=i,g=c,b=ni(m),S=J,_=d,y=E[1],i=p,c=g,u=b,f=S,d=_,m=y;continue}case"Some":{const M=Math.abs(O-u.value);if(j<M){p=i,g=c,b=ni(m),S=J,_=d,y=E[1],i=p,c=g,u=b,f=S,d=_,m=y;continue}return{quantile:d,value:T(u.value),consumed:f,rest:m}}}}throw new Error("BUG: MetricHook.resolveQuantiles - please report an issue at https://github.com/Effect-TS/effect/issues")},IA=Symbol.for("effect/MetricPair"),CA={_Type:e=>e},RA=(e,t)=>({[IA]:CA,metricKey:e,metricState:t,pipe(){return I(this,arguments)}}),Xb=Symbol.for("effect/MetricRegistry");J$=Xb;class FA{constructor(){a(this,J$,Xb);a(this,"map",jF())}snapshot(){const t=[];for(const[n,r]of this.map)t.push(RA(n,r.get()));return t}get(t){const n=h(this.map,rs(t),Kn);if(n==null){if(jb(t.keyType))return this.getCounter(t);if(QM(t.keyType))return this.getGauge(t);if(GM(t.keyType))return this.getFrequency(t);if(zb(t.keyType))return this.getHistogram(t);if(YM(t.keyType))return this.getSummary(t);throw new Error("BUG: MetricRegistry.get - unknown MetricKeyType - please report an issue at https://github.com/Effect-TS/effect/issues")}else return n}getCounter(t){let n=h(this.map,rs(t),Kn);if(n==null){const r=EA(t);h(this.map,Li(t))||h(this.map,Ki(t,r)),n=r}return n}getFrequency(t){let n=h(this.map,rs(t),Kn);if(n==null){const r=kA(t);h(this.map,Li(t))||h(this.map,Ki(t,r)),n=r}return n}getGauge(t){let n=h(this.map,rs(t),Kn);if(n==null){const r=vA(t,t.keyType.bigint?BigInt(0):0);h(this.map,Li(t))||h(this.map,Ki(t,r)),n=r}return n}getHistogram(t){let n=h(this.map,rs(t),Kn);if(n==null){const r=$A(t);h(this.map,Li(t))||h(this.map,Ki(t,r)),n=r}return n}getSummary(t){let n=h(this.map,rs(t),Kn);if(n==null){const r=TA(t);h(this.map,Li(t))||h(this.map,Ki(t,r)),n=r}return n}}const PA=()=>new FA,MA=Symbol.for("effect/Metric"),AA={_Type:e=>e,_In:e=>e,_Out:e=>e},Zb=Q(Symbol.for("effect/Metric/globalMetricRegistry"),()=>PA()),e_=function(e,t,n,r){const s=Object.assign(o=>Tn(o,i=>LA(s,i)),{[MA]:AA,keyType:e,unsafeUpdate:t,unsafeValue:n,unsafeModify:r,register(){return this.unsafeValue([]),this},pipe(){return I(this,arguments)}});return s},Fu=(e,t)=>t_(tA(e,t)),t_=e=>{let t;const n=new WeakMap,r=s=>{if(s.length===0)return t!==void 0||(t=Zb.get(e)),t;let o=n.get(s);return o!==void 0||(o=Zb.get(rA(e,s)),n.set(s,o)),o};return e_(e.keyType,(s,o)=>r(o).update(s),s=>r(s).get(),(s,o)=>r(o).modify(s))},NA=(e,t,n)=>t_(nA(e,t,n)),xA=l(3,(e,t,n)=>DA(e,[fP(t,n)])),DA=l(2,(e,t)=>e_(e.keyType,(n,r)=>e.unsafeUpdate(n,pa(t,r)),n=>e.unsafeValue(pa(t,n)),(n,r)=>e.unsafeModify(n,pa(t,r)))),LA=l(2,(e,t)=>ts(_h,n=>k(()=>e.unsafeUpdate(t,n)))),KA=Symbol.for("effect/Request"),UA={_E:e=>e,_A:e=>e},qA={...Sf,[KA]:UA},jA=function(){function e(t){t&&Object.assign(this,t)}return e.prototype=qA,e}(),zA=l(2,(e,t)=>ts(Rb,n=>k(()=>{if(n.has(e)){const r=n.get(e);r.state.completed||(r.state.completed=!0,Mi(r.result,t))}}))),Pu=Symbol.for("effect/Supervisor"),kd={_T:e=>e};G$=Pu;const Mg=class Mg{constructor(t,n){a(this,"underlying");a(this,"value0");a(this,G$,kd);this.underlying=t,this.value0=n}get value(){return this.value0}onStart(t,n,r,s){this.underlying.onStart(t,n,r,s)}onEnd(t,n){this.underlying.onEnd(t,n)}onEffect(t,n){this.underlying.onEffect(t,n)}onSuspend(t){this.underlying.onSuspend(t)}onResume(t){this.underlying.onResume(t)}map(t){return new Mg(this,h(this.value,A(t)))}zip(t){return new Au(this,t)}};let Mu=Mg;Q$=Pu;const Ag=class Ag{constructor(t,n){a(this,"left");a(this,"right");a(this,"_tag","Zip");a(this,Q$,kd);this.left=t,this.right=n}get value(){return Zy(this.left.value,this.right.value)}onStart(t,n,r,s){this.left.onStart(t,n,r,s),this.right.onStart(t,n,r,s)}onEnd(t,n){this.left.onEnd(t,n),this.right.onEnd(t,n)}onEffect(t,n){this.left.onEffect(t,n),this.right.onEffect(t,n)}onSuspend(t){this.left.onSuspend(t),this.right.onSuspend(t)}onResume(t){this.left.onResume(t),this.right.onResume(t)}map(t){return new Mu(this,h(this.value,A(t)))}zip(t){return new Ag(this,t)}};let Au=Ag;const n_=e=>N(e,Pu)&&uf(e,"Zip");Y$=Pu;class BA{constructor(t){a(this,"effect");a(this,Y$,kd);this.effect=t}get value(){return this.effect}onStart(t,n,r,s){}onEnd(t,n){}onEffect(t,n){}onSuspend(t){}onResume(t){}map(t){return new Mu(this,h(this.value,A(t)))}zip(t){return new Au(this,t)}onRun(t,n){return t()}}const WA=e=>new BA(e),Nu=Q("effect/Supervisor/none",()=>WA(W)),HA=Gs,r_="Empty",s_="AddSupervisor",o_="RemoveSupervisor",i_="AndThen",Yi={_tag:r_},xu=(e,t)=>({_tag:i_,first:e,second:t}),VA=(e,t)=>JA(t,Ae(e)),JA=(e,t)=>{let n=e,r=t;for(;zn(r);){const s=kn(r);switch(s._tag){case r_:{r=Bn(r);break}case s_:{n=n.zip(s.supervisor),r=Bn(r);break}case o_:{n=vd(n,s.supervisor),r=Bn(r);break}case i_:{r=ot(s.first)(ot(s.second)(Bn(r)));break}}}return n},vd=(e,t)=>L(e,t)?Nu:n_(e)?vd(e.left,t).zip(vd(e.right,t)):e,Du=e=>L(e,Nu)?Vr():n_(e)?h(Du(e.left),hi(Du(e.right))):Vf(e),GA=HA({empty:Yi,patch:VA,combine:xu,diff:(e,t)=>{if(L(e,t))return Yi;const n=Du(e),r=Du(t),s=h(r,Xp(n),Pa(Yi,(i,c)=>xu(i,{_tag:s_,supervisor:c}))),o=h(n,Xp(r),Pa(Yi,(i,c)=>xu(i,{_tag:o_,supervisor:c})));return xu(s,o)}}),QA=Fu("effect_fiber_started",{incremental:!0}),c_=Fu("effect_fiber_active"),YA=Fu("effect_fiber_successes",{incremental:!0}),XA=Fu("effect_fiber_failures",{incremental:!0}),ZA=xA(NA("effect_fiber_lifetimes",qM({start:.5,factor:2,count:35})),"time_unit","milliseconds"),Xi="Continue",eN="Done",a_="Yield",tN={_E:e=>e,_A:e=>e},Zi=e=>{throw new Error(`BUG: FiberRuntime - ${ra(e)} - please report an issue at https://github.com/Effect-TS/effect/issues`)},_r=Symbol.for("effect/internal/fiberRuntime/YieldedOp"),Zn=Q("effect/internal/fiberRuntime/yieldedOpChannel",()=>({currentOp:null})),Lu={[oa]:(e,t,n)=>ut(()=>t.effect_instruction_i1(n)),OnStep:(e,t,n)=>et(et(n)),[ia]:(e,t,n)=>ut(()=>t.effect_instruction_i2(n)),[yf]:(e,t,n)=>(e.patchRuntimeFlags(e._runtimeFlags,t.patch),hr(e._runtimeFlags)&&e.isInterrupted()?ue(e.getInterruptedCause()):et(n)),[ca]:(e,t,n)=>(ut(()=>t.effect_instruction_i2(n)),ut(()=>t.effect_instruction_i0())?(e.pushStack(t),ut(()=>t.effect_instruction_i1())):W)},nN={[ad]:(e,t,n,r)=>(e.processNewInterruptSignal(r.cause),hr(t)?ue(r.cause):n),[ld]:(e,t,n,r)=>{throw new Error("It is illegal to have multiple concurrent run loops in a single fiber")},[ud]:(e,t,n,r)=>(r.onFiber(e,kb(t)),n),[fd]:(e,t,n,r)=>w($i(),()=>n)},rN=e=>vi(YC(e),t=>er(fR(t),([n,r])=>{const s=new Map,o=[];for(const c of r){o.push(At(c));for(const u of c)s.set(u.request,u)}const i=o.flat();return ho(wN(n.runAll(o),i,()=>i.forEach(c=>{c.listeners.interrupted=!0})),Rb,s)},!1,!1));class u_{constructor(t,n,r){a(this,Z$,bM);a(this,X$,tN);a(this,"_fiberRefs");a(this,"_fiberId");a(this,"_runtimeFlags");a(this,"_queue",new Array);a(this,"_children",null);a(this,"_observers",new Array);a(this,"_running",!1);a(this,"_stack",[]);a(this,"_asyncInterruptor",null);a(this,"_asyncBlockingOn",null);a(this,"_exitValue",null);a(this,"_steps",[]);a(this,"_supervisor");a(this,"_scheduler");a(this,"_tracer");a(this,"currentOpCount",0);a(this,"isYielding",!1);a(this,"run",()=>{this.drainQueueOnCurrentThread()});if(this._runtimeFlags=r,this._fiberId=t,this._fiberRefs=n,this._supervisor=this.getFiberRef(w_),this._scheduler=this.getFiberRef(Hi),_y(r)){const s=this.getFiberRef(_h);QA.unsafeUpdate(1,s),c_.unsafeUpdate(1,s)}this._tracer=Mt(this.getFiberRef(On),Za)}pipe(){return I(this,arguments)}id(){return this._fiberId}resume(t){this.tell(wo(t))}get status(){return this.ask((t,n)=>n)}get runtimeFlags(){return this.ask((t,n)=>eM(n)?t._runtimeFlags:n.runtimeFlags)}scope(){return yM(this)}get children(){return this.ask(t=>Array.from(t.getChildren()))}getChildren(){return this._children===null&&(this._children=new Set),this._children}getInterruptedCause(){return this.getFiberRef(au)}fiberRefs(){return this.ask(t=>t.getFiberRefs())}ask(t){return P(()=>{const n=Ri(this._fiberId);return this.tell(Ou((r,s)=>{Mi(n,k(()=>t(r,s)))})),Qn(n)})}tell(t){this._queue.push(t),this._running||(this._running=!0,this.drainQueueLaterOnExecutor())}get await(){return Qt(t=>{const n=r=>t(v(r));return this.tell(Ou((r,s)=>{r._exitValue!==null?n(this._exitValue):r.addObserver(n)})),k(()=>this.tell(Ou((r,s)=>{r.removeObserver(n)})))},this.id())}get inheritAll(){return se((t,n)=>{const r=t.id(),s=t.getFiberRefs(),o=n.runtimeFlags,i=this.getFiberRefs(),c=H1(s,r,i);t.setFiberRefs(c);const u=t.getFiberRef(__),f=h(Xr(o,u),ky(Qs),ky(ah));return HR(f)})}get poll(){return k(()=>ei(this._exitValue))}unsafePoll(){return this._exitValue}interruptAsFork(t){return k(()=>this.tell(hd(Gt(t))))}unsafeInterruptAsFork(t){this.tell(hd(Gt(t)))}addObserver(t){this._exitValue!==null?t(this._exitValue):this._observers.push(t)}removeObserver(t){this._observers=this._observers.filter(n=>n!==t)}getFiberRefs(){return this.setFiberRef(__,this._runtimeFlags),this._fiberRefs}unsafeDeleteFiberRef(t){this._fiberRefs=YS(this._fiberRefs,t)}getFiberRef(t){return this._fiberRefs.locals.has(t)?this._fiberRefs.locals.get(t)[0][1]:t.initial}setFiberRef(t,n){this._fiberRefs=Hh(this._fiberRefs,{fiberId:this._fiberId,fiberRef:t,value:n}),this.refreshRefCache()}refreshRefCache(){this._tracer=Mt(this.getFiberRef(On),Za),this._supervisor=this.getFiberRef(w_),this._scheduler=this.getFiberRef(Hi)}setFiberRefs(t){this._fiberRefs=t,this.refreshRefCache()}addChild(t){this.getChildren().add(t)}removeChild(t){this.getChildren().delete(t)}drainQueueOnCurrentThread(){let t=!0;for(;t;){let n=Xi;const r=globalThis[us];globalThis[us]=this;try{for(;n===Xi;)n=this._queue.length===0?eN:this.evaluateMessageWhileSuspended(this._queue.splice(0,1)[0])}finally{this._running=!1,globalThis[us]=r}this._queue.length>0&&!this._running?(this._running=!0,n===a_?(this.drainQueueLaterOnExecutor(),t=!1):t=!0):t=!1}}drainQueueLaterOnExecutor(){this._scheduler.scheduleTask(this.run,this.getFiberRef(Ii))}drainQueueWhileRunning(t,n){let r=n;for(;this._queue.length>0;){const s=this._queue.splice(0,1)[0];r=nN[s._tag](this,t,r,s)}return r}isInterrupted(){return!Wa(this.getFiberRef(au))}addInterruptedCause(t){const n=this.getFiberRef(au);this.setFiberRef(au,Qe(n,t))}processNewInterruptSignal(t){this.addInterruptedCause(t),this.sendInterruptSignalToAllChildren()}sendInterruptSignalToAllChildren(){if(this._children===null||this._children.size===0)return!1;let t=!1;for(const n of this._children)n.tell(hd(Gt(this.id()))),t=!0;return t}interruptAllChildren(){if(this.sendInterruptSignalToAllChildren()){const t=this._children.values();this._children=null;let n=!1;return Sh({while:()=>!n,body:()=>{const s=t.next();return s.done?k(()=>{n=!0}):Nt(s.value.await)},step:()=>{}})}return null}reportExitValue(t){if(_y(this._runtimeFlags)){const n=this.getFiberRef(_h),r=this.id().startTimeMillis,s=Date.now();switch(ZA.unsafeUpdate(s-r,n),c_.unsafeUpdate(-1,n),t._tag){case ft:{YA.unsafeUpdate(1,n);break}case lt:{XA.unsafeUpdate(1,n);break}}}if(t._tag==="Failure"){const n=this.getFiberRef(bh);!Ha(t.cause)&&n._tag==="Some"&&this.log("Fiber terminated with an unhandled error",t.cause,n)}}setExitValue(t){this._exitValue=t,this.reportExitValue(t);for(let n=this._observers.length-1;n>=0;n--)this._observers[n](t)}getLoggers(){return this.getFiberRef($d)}log(t,n,r){const s=q(r)?r.value:this.getFiberRef(iF),o=this.getFiberRef(l_);if(nP(o,s))return;const i=this.getFiberRef(cF),c=this.getFiberRef(cS),u=this.getLoggers(),f=this.getFiberRefs();if(Yp(u)>0){const d=Mt(this.getFiberRef(On),So),m=new Date(d.unsafeCurrentTimeMillis());for(const p of u)p.log({fiberId:this.id(),logLevel:s,message:t,cause:n,context:f,spans:i,annotations:c,date:m})}}evaluateMessageWhileSuspended(t){switch(t._tag){case fd:return a_;case ad:return this.processNewInterruptSignal(t.cause),this._asyncInterruptor!==null&&(this._asyncInterruptor(ue(t.cause)),this._asyncInterruptor=null),Xi;case ld:return this._asyncInterruptor=null,this._asyncBlockingOn=null,this.evaluateEffect(t.effect),Xi;case ud:return t.onFiber(this,this._exitValue!==null?XP:ZP(this._runtimeFlags,this._asyncBlockingOn)),Xi;default:return Zi(t)}}evaluateEffect(t){this._supervisor.onResume(this);try{let n=hr(this._runtimeFlags)&&this.isInterrupted()?ue(this.getInterruptedCause()):t;for(;n!==null;){const r=n,s=this.runLoop(r);if(s===_r){const o=Zn.currentOp;Zn.currentOp=null,o._op===aa?HC(this._runtimeFlags)?(this.tell(mM()),this.tell(wo(Yt)),n=null):n=Yt:o._op===Zo&&(n=null)}else{this._runtimeFlags=h(this._runtimeFlags,VC(ah));const o=this.interruptAllChildren();o!==null?n=w(o,()=>s):(this._queue.length===0?this.setExitValue(s):this.tell(wo(s)),n=null)}}}finally{this._supervisor.onSuspend(this)}}start(t){if(this._running)this.tell(wo(t));else{this._running=!0;const n=globalThis[us];globalThis[us]=this;try{this.evaluateEffect(t)}finally{this._running=!1,globalThis[us]=n,this._queue.length>0&&this.drainQueueLaterOnExecutor()}}}startFork(t){this.tell(wo(t))}patchRuntimeFlags(t,n){const r=Ys(t,n);return globalThis[us]=this,this._runtimeFlags=r,r}initiateAsync(t,n){let r=!1;const s=o=>{r||(r=!0,this.tell(wo(o)))};hr(t)&&(this._asyncInterruptor=s);try{n(s)}catch(o){s(fe(pt(o)))}}pushStack(t){this._stack.push(t),t._op==="OnStep"&&this._steps.push({refs:this.getFiberRefs(),flags:this._runtimeFlags})}popStack(){const t=this._stack.pop();if(t)return t._op==="OnStep"&&this._steps.pop(),t}getNextSuccessCont(){let t=this.popStack();for(;t;){if(t._op!==sa)return t;t=this.popStack()}}getNextFailCont(){let t=this.popStack();for(;t;){if(t._op!==oa&&t._op!==ca)return t;t=this.popStack()}}[(Z$=SM,X$=_M,lO)](t){return A(Oi(Dt),n=>_I(n,t))}Left(t){return Ee(t.left)}None(t){return Ee(new Ci)}Right(t){return et(t.right)}Some(t){return et(t.value)}Micro(t){return LR(n=>{const r=sM().pipe(iM(lM,this.getFiberRef(Dt)));let s=n;return t[tM](r,o=>{if(o._tag==="Right")return s(et(o.right));switch(o.left._tag){case"Interrupt":return s(ue(Gt(fr)));case"Fail":return s(Ee(o.left.error));case"Die":return s(Ei(o.left.defect))}}),Qt(o=>{s=i=>{o(W)},oM(r,Ob).abort()})})}[Vg](t){const n=ut(()=>t.effect_instruction_i0()),r=this.getNextSuccessCont();return r!==void 0?(r._op in Lu||Zi(r),Lu[r._op](this,r,n)):(Zn.currentOp=et(n),_r)}[ft](t){const n=t,r=this.getNextSuccessCont();return r!==void 0?(r._op in Lu||Zi(r),Lu[r._op](this,r,n.effect_instruction_i0)):(Zn.currentOp=n,_r)}[lt](t){const n=t.effect_instruction_i0,r=this.getNextFailCont();if(r!==void 0)switch(r._op){case sa:case ia:return hr(this._runtimeFlags)&&this.isInterrupted()?ue(Fy(n)):ut(()=>r.effect_instruction_i1(n));case"OnStep":return hr(this._runtimeFlags)&&this.isInterrupted()?ue(Fy(n)):et(ue(n));case yf:return this.patchRuntimeFlags(this._runtimeFlags,r.patch),hr(this._runtimeFlags)&&this.isInterrupted()?ue(Qe(n,this.getInterruptedCause())):ue(n);default:Zi(r)}else return Zn.currentOp=ue(n),_r}[Jg](t){return ut(()=>t.effect_instruction_i0(this,kb(this._runtimeFlags)))}Blocked(t){const n=this.getFiberRefs(),r=this._runtimeFlags;if(this._steps.length>0){const s=[],o=this._steps[this._steps.length-1];let i=this.popStack();for(;i&&i._op!=="OnStep";)s.push(i),i=this.popStack();this.setFiberRefs(o.refs),this._runtimeFlags=o.flags;const c=Bi(o.refs,n),u=Xr(o.flags,r);return et(jy(t.effect_instruction_i0,se(f=>{for(;s.length>0;)f.pushStack(s.pop());return f.setFiberRefs(Wi(f.id(),f.getFiberRefs())(c)),f._runtimeFlags=Ys(u)(f._runtimeFlags),t.effect_instruction_i1})))}return xt(s=>w(ko(xR(t.effect_instruction_i0)),()=>s(t.effect_instruction_i1)))}RunBlocked(t){return rN(t.effect_instruction_i0)}[Ns](t){const n=t.effect_instruction_i0,r=this._runtimeFlags,s=Ys(r,n);if(hr(s)&&this.isInterrupted())return ue(this.getInterruptedCause());if(this.patchRuntimeFlags(this._runtimeFlags,n),t.effect_instruction_i1){const o=Xr(s,r);return this.pushStack(new DR(o,t)),ut(()=>t.effect_instruction_i1(r))}else return Yt}[oa](t){return this.pushStack(t),t.effect_instruction_i0}OnStep(t){return this.pushStack(t),t.effect_instruction_i0}[sa](t){return this.pushStack(t),t.effect_instruction_i0}[ia](t){return this.pushStack(t),t.effect_instruction_i0}[Zo](t){return this._asyncBlockingOn=t.effect_instruction_i1,this.initiateAsync(this._runtimeFlags,t.effect_instruction_i0),Zn.currentOp=t,_r}[aa](t){return this.isYielding=!1,Zn.currentOp=t,_r}[ca](t){const n=t.effect_instruction_i0,r=t.effect_instruction_i1;return n()?(this.pushStack(t),r()):Yt}[pf](t){return ut(()=>t.commit())}runLoop(t){let n=t;for(this.currentOpCount=0;;){if(this._runtimeFlags&WC&&this._supervisor.onEffect(this,n),this._queue.length>0&&(n=this.drainQueueWhileRunning(this._runtimeFlags,n)),!this.isYielding){this.currentOpCount+=1;const r=this._scheduler.shouldYield(this);if(r!==!1){this.isYielding=!0,this.currentOpCount=0;const s=n;n=w($i({priority:r}),()=>s)}}try{if((!("_op"in n)||!(n._op in this))&&Zi(n),n=this._tracer.context(()=>Gc()!==n[Sb]._V?Gy(`Cannot execute an Effect versioned ${n[Sb]._V} with a Runtime of version ${Gc()}`):this[n._op](n),this),n===_r){const r=Zn.currentOp;return r._op===aa||r._op===Zo?_r:(Zn.currentOp=null,r._op===ft||r._op===lt?r:ue(pt(r)))}}catch(r){AR(r)?n=ue(r.cause):pF(r)?n=ue(Qe(pt(r),Gt(fr))):n=Ei(r)}}}}const l_=Q("effect/FiberRef/currentMinimumLogLevel",()=>it(rP("Info"))),sN=e=>Vi(t=>{const n=Jh(t.context,On);Mt(n,bu).unsafe.log(e.log(t))}),f_=Q(Symbol.for("effect/Logger/defaultLogger"),()=>sN(TM)),oN=Q(Symbol.for("effect/Logger/prettyLogger"),()=>NM()),iN=Q(Symbol.for("effect/Logger/tracerLogger"),()=>Vi(({annotations:e,cause:t,context:n,fiberId:r,logLevel:s,message:o})=>{const i=ti(_u(n,Dt),ar(io)),c=Ds(_u(n,On),f=>Mt(f,So));if(i._tag==="None"||i.value._tag==="ExternalSpan"||c._tag==="None")return;const u=Object.fromEntries(oy(e,ra));u["effect.fiberId"]=L0(r),u["effect.logLevel"]=s.label,t!==null&&t._tag!=="Empty"&&(u["effect.cause"]=Zr(t)),i.value.event(String(o),c.value.unsafeCurrentTimeNanos(),u)})),$d=Q(Symbol.for("effect/FiberRef/currentLoggers"),()=>rF(Vf(f_,iN))),Td=l(e=>vn(e[0]),(e,t)=>mr(Tn(e,n=>h_(r=>t(n,r))))),h_=e=>se(t=>{const n=t.getFiberRefs(),r=t._runtimeFlags;return w(y_,s=>Eh(s,o=>se(i=>{const c=i.getFiberRefs(),u=i._runtimeFlags,f=Bi(c,n),d=Xr(u,r),m=Bi(n,c);return i.setFiberRefs(Wi(f,i.id(),n)),tc(VR(e(o),d),k(()=>{i.setFiberRefs(Wi(m,i.id(),i.getFiberRefs()))}))})))}),cN=e=>{if(Array.isArray(e)||zg(e))return[e,$()];const t=Object.keys(e),n=t.length;return[t.map(r=>e[r]),T(r=>{const s={};for(let o=0;o<n;o++)s[t[o]]=r[o];return s})]},aN=(e,t,n)=>{const r=[];for(const s of e)r.push(ao(s));return w(Eo(r,R,{concurrency:n==null?void 0:n.concurrency,batching:n==null?void 0:n.batching}),s=>{const o=$(),i=s.length,c=new Array(i),u=new Array(i);let f=!1;for(let d=0;d<i;d++){const m=s[d];m._tag==="Left"?(c[d]=T(m.left),f=!0):(u[d]=m.right,c[d]=o)}return f?t._tag==="Some"?Ee(t.value(c)):Ee(c):n!=null&&n.discard?W:t._tag==="Some"?v(t.value(u)):v(u)})},uN=(e,t,n)=>{const r=[];for(const s of e)r.push(ao(s));return n!=null&&n.discard?Eo(r,R,{concurrency:n==null?void 0:n.concurrency,batching:n==null?void 0:n.batching,discard:!0}):A(Eo(r,R,{concurrency:n==null?void 0:n.concurrency,batching:n==null?void 0:n.batching}),s=>t._tag==="Some"?t.value(s):s)},Od=(e,t)=>{const[n,r]=cN(e);return(t==null?void 0:t.mode)==="validate"?aN(n,r,t):(t==null?void 0:t.mode)==="either"?uN(n,r,t):(t==null?void 0:t.discard)!==!0&&r._tag==="Some"?A(Eo(n,R,t),r.value):Eo(n,R,t)},Eo=l(e=>zg(e[0]),(e,t,n)=>se(r=>{const s=(n==null?void 0:n.batching)===!0||(n==null?void 0:n.batching)==="inherit"&&r.getFiberRef(lF);return n!=null&&n.discard?Fb(n.concurrency,()=>vo(zi,n==null?void 0:n.concurrentFinalizers)(o=>s?er(e,(i,c)=>o(t(i,c)),!0,!1,1):vi(e,(i,c)=>o(t(i,c)))),()=>vo(od,n==null?void 0:n.concurrentFinalizers)(o=>er(e,(i,c)=>o(t(i,c)),s,!1)),o=>vo(id(o),n==null?void 0:n.concurrentFinalizers)(i=>er(e,(c,u)=>i(t(c,u)),s,!1,o))):Fb(n==null?void 0:n.concurrency,()=>vo(zi,n==null?void 0:n.concurrentFinalizers)(o=>s?Cd(e,1,(i,c)=>o(t(i,c)),!0):Vn(e,(i,c)=>o(t(i,c)))),()=>vo(od,n==null?void 0:n.concurrentFinalizers)(o=>Id(e,(i,c)=>o(t(i,c)),s)),o=>vo(id(o),n==null?void 0:n.concurrentFinalizers)(i=>Cd(e,o,(c,u)=>i(t(c,u)),s)))})),Id=(e,t,n)=>P(()=>{const r=he(e),s=new Array(r.length);return ae(er(r,(i,c)=>w(t(i,c),u=>k(()=>s[c]=u)),n,!1),v(s))}),er=(e,t,n,r,s)=>xt(o=>BR(i=>se(c=>{let u=Array.from(e).reverse(),f=u.length;if(f===0)return W;let d=0,m=!1;const p=s?Math.min(u.length,s):u.length,g=new Set,b=new Array,S=()=>g.forEach(D=>{D._scheduler.scheduleTask(()=>{D.unsafeInterruptAsFork(c.id())},0)}),_=new Array,y=new Array,E=new Array,O=()=>{const D=b.filter(({exit:le})=>le._tag==="Failure").sort((le,ne)=>le.index<ne.index?-1:le.index===ne.index?0:1).map(({exit:le})=>le);return D.length===0&&D.push(Yt),D},U=(D,le=!1)=>{const ne=mr(i(D)),X=fN(ne,c,c._runtimeFlags,Cu);return c._scheduler.scheduleTask(()=>{le&&X.unsafeInterruptAsFork(c.id()),X.resume(ne)},0),X},J=()=>{r||(f-=u.length,u=[]),m=!0,S()},j=n?UR:an,M=U(Qt(D=>{const le=(X,_e)=>{X._op==="Blocked"?E.push(X):(b.push({index:_e,exit:X}),X._op==="Failure"&&!m&&J())},ne=()=>{if(u.length>0){const X=u.pop();let _e=d++;const rt=()=>{const Xe=u.pop();return _e=d++,w($i(),()=>w(j(o(t(Xe,_e))),vt))},vt=Xe=>u.length>0&&(le(Xe,_e),u.length>0)?rt():v(Xe),bn=w(j(o(t(X,_e))),vt),$t=U(bn);_.push($t),g.add($t),m&&$t._scheduler.scheduleTask(()=>{$t.unsafeInterruptAsFork(c.id())},0),$t.addObserver(Xe=>{let _n;if(Xe._op==="Failure"?_n=Xe:_n=Xe.effect_instruction_i0,y.push($t),g.delete($t),le(_n,_e),b.length===f)D(v(we(ns(O(),{parallel:!0}),()=>Yt)));else if(E.length+b.length===f){const Fs=E.map(Dr=>Dr.effect_instruction_i0).reduce(vy);D(v(jy(Fs,er([we(ns(O(),{parallel:!0}),()=>Yt),...E.map(Dr=>Dr.effect_instruction_i1)],Dr=>Dr,n,!0,s))))}else ne()})}};for(let X=0;X<p;X++)ne()}));return Nt(Jn(lo(o(Ru(M))),mu({onFailure:()=>{J();const D=E.length+1,le=Math.min(typeof s=="number"?s:E.length,E.length),ne=Array.from(E);return Qt(X=>{const _e=[];let rt=0,vt=0;const bn=(Xe,_n)=>Fs=>{_e[Xe]=Fs,rt++,rt===D&&X(up(ns(_e,{parallel:!0}))),ne.length>0&&_n&&$t()},$t=()=>{U(ne.pop(),!0).addObserver(bn(vt,!0)),vt++};M.addObserver(bn(vt,!1)),vt++;for(let Xe=0;Xe<le;Xe++)$t()})},onSuccess:()=>Vn(y,D=>D.inheritAll)})))}))),Cd=(e,t,n,r)=>P(()=>{const s=he(e),o=new Array(s.length);return ae(er(s,(c,u)=>A(n(c,u),f=>o[u]=f),r,!1,t),v(o))}),ko=e=>hN(e,Cu),lN=(e,t,n,r=null)=>{const s=Ku(e,t,n,r);return s.resume(e),s},fN=(e,t,n,r=null)=>Ku(e,t,n,r),Ku=(e,t,n,r=null)=>{const s=ny(),o=t.getFiberRefs(),i=V1(o,s),c=new u_(s,i,n),u=Wh(i,Dt),f=c._supervisor;return f.onStart(u,e,T(t),c),c.addObserver(m=>f.onEnd(m,c)),(r!==null?r:h(t.getFiberRef(wh),we(()=>t.scope()))).add(n,c),c},hN=(e,t)=>se((n,r)=>v(lN(e,n,r.runtimeFlags,t))),d_=e=>po(t=>ze(ar(t,tr),{onNone:()=>e,onSome:n=>{switch(n.strategy._tag){case"Parallel":return e;case"Sequential":case"ParallelN":return w(lu(n,od),r=>ls(e,r))}}})),m_=e=>t=>po(n=>ze(ar(n,tr),{onNone:()=>t,onSome:r=>r.strategy._tag==="ParallelN"&&r.strategy.parallelism===e?t:w(lu(r,id(e)),s=>ls(t,s))})),vo=(e,t)=>n=>po(r=>ze(ar(r,tr),{onNone:()=>n(R),onSome:s=>{if(t===!0){const o=e._tag==="Parallel"?d_:e._tag==="Sequential"?p_:m_(e.parallelism);switch(s.strategy._tag){case"Parallel":return o(n(d_));case"Sequential":return o(n(p_));case"ParallelN":return o(n(m_(s.strategy.parallelism)))}}else return n(R)}})),Rd=e=>w(tr,e),g_=e=>w($o(),t=>SN(e,t)),p_=e=>po(t=>ze(ar(t,tr),{onNone:()=>e,onSome:n=>{switch(n.strategy._tag){case"Sequential":return e;case"Parallel":case"ParallelN":return w(lu(n,zi),r=>ls(e,r))}}})),dN=l(e=>vn(e[1]),(e,t,n)=>ec(e,t,(r,s)=>[r,s],n)),mN=l(e=>vn(e[1]),(e,t,n)=>(n==null?void 0:n.concurrent)!==!0&&((n==null?void 0:n.batching)===void 0||n.batching===!1)?es(e,t):ec(e,t,(r,s)=>r,n)),gN=l(e=>vn(e[1]),(e,t,n)=>(n==null?void 0:n.concurrent)!==!0&&((n==null?void 0:n.batching)===void 0||n.batching===!1)?ae(e,t):ec(e,t,(r,s)=>s,n)),ec=l(e=>vn(e[1]),(e,t,n,r)=>A(Od([e,t],{concurrency:r!=null&&r.concurrent?2:1,batching:r==null?void 0:r.batching,concurrentFinalizers:r==null?void 0:r.concurrentFinalizers}),([s,o])=>n(s,o))),tr=Vt("effect/Scope"),y_=tr,pN=(e,t)=>{e.state._tag==="Open"&&e.state.finalizers.add(t)},yN={[uS]:uS,[lS]:lS,pipe(){return I(this,arguments)},fork(e){return k(()=>{const t=S_(e);if(this.state._tag==="Closed")return t.state=this.state,t;const n=r=>t.close(r);return this.state.finalizers.add(n),pN(t,r=>k(()=>{this.state._tag==="Open"&&this.state.finalizers.delete(n)})),t})},close(e){return P(()=>{if(this.state._tag==="Closed")return W;const t=Array.from(this.state.finalizers.values()).reverse();return this.state={_tag:"Closed",exit:e},t.length===0?W:jP(this.strategy)?h(Vn(t,n=>an(n(e))),w(n=>h(ns(n),Ds($h),we(()=>Yt)))):zP(this.strategy)?h(Id(t,n=>an(n(e)),!1),w(n=>h(ns(n,{parallel:!0}),Ds($h),we(()=>Yt)))):h(Cd(t,this.strategy.parallelism,n=>an(n(e)),!1),w(n=>h(ns(n,{parallel:!0}),Ds($h),we(()=>Yt))))})},addFinalizer(e){return P(()=>this.state._tag==="Closed"?e(this.state.exit):(this.state.finalizers.add(e),W))}},S_=(e=_o)=>{const t=Object.create(yN);return t.strategy=e,t.state={_tag:"Open",finalizers:new Set},t},$o=(e=_o)=>k(()=>S_(e)),ls=l(2,(e,t)=>wS(e,Br(oi(tr,t)))),SN=l(2,(e,t)=>h(e,ls(t),Jn(n=>t.close(n)))),bN=e=>mo(e,{differ:GA,fork:Yi}),_N=l(2,(e,t)=>Nt(Td(w(Oi(e),n=>We(cu(e,t),n)),n=>cu(e,n)))),b_=l(2,(e,t)=>ts(e,n=>_N(e,t(n)))),__=oF(JC),w_=bN(Nu),E_=l(3,(e,t,n)=>v_(e,t,{onSelfWin:(r,s)=>w(r.await,o=>{switch(o._tag){case ft:return w(r.inheritAll,()=>n.onSelfDone(o,s));case lt:return n.onSelfDone(o,s)}}),onOtherWin:(r,s)=>w(r.await,o=>{switch(o._tag){case ft:return w(r.inheritAll,()=>n.onOtherDone(o,s));case lt:return n.onOtherDone(o,s)}})})),k_=l(2,(e,t)=>uo(n=>E_(e,t,{onSelfDone:(r,s)=>Ih(r,{onFailure:o=>h(Ru(s),mb(i=>cn(o,i))),onSuccess:o=>h(s,Gn(n),We(o))}),onOtherDone:(r,s)=>Ih(r,{onFailure:o=>h(Ru(s),mb(i=>cn(i,o))),onSuccess:o=>h(s,Gn(n),We(o))})}))),v_=l(3,(e,t,n)=>se((r,s)=>{const o=s.runtimeFlags,i=Jr(!0),c=Ku(e,r,o,n.selfScope),u=Ku(t,r,o,n.otherScope);return Qt(f=>{c.addObserver(()=>$_(c,u,n.onSelfWin,i,f)),u.addObserver(()=>$_(u,c,n.onOtherWin,i,f)),c.startFork(e),u.startFork(t)},Zf(c.id(),u.id()))})),$_=(e,t,n,r,s)=>{$0(!0,!1)(r)&&s(n(e,t))},tc=l(2,(e,t)=>xt(n=>ht(n(e),{onFailure:r=>ht(t,{onFailure:s=>fe(Qe(r,s)),onSuccess:()=>fe(r)}),onSuccess:r=>We(t,r)}))),wN=(e,t,n)=>uo(r=>w(w(ko(su(e)),s=>Qt(o=>{const i=t.map(f=>f.listeners.count),c=()=>{i.every(f=>f===0)&&t.every(f=>f.result.state.current._tag==="Pending"?!0:!!(f.result.state.current._tag==="Done"&&hu(f.result.state.current.effect)&&f.result.state.current.effect._tag==="Failure"&&Cy(f.result.state.current.effect.cause)))&&(u.forEach(f=>f()),n==null||n(),o(Ti(s)))};s.addObserver(f=>{u.forEach(d=>d()),o(f)});const u=t.map((f,d)=>{const m=p=>{i[d]=p,c()};return f.listeners.addObserver(m),()=>f.listeners.removeObserver(m)});return c(),k(()=>{u.forEach(f=>f())})})),()=>P(()=>{const s=t.flatMap(o=>o.state.completed?[]:[o]);return vi(s,o=>zA(o.request,Oh(r)))}))),Uu=Hn,qu=dr,Fd=pt,T_=Gt,EN=cn,kN=Qe,vN=fh,$N=hh,TN=Wa,O_=Cy,nc=Ha,ju=Va,ON=pR,Pd=_R,IN=Ga,CN=yF,RN=Ci,FN=Zr,zu=Symbol.for("effect/ScheduleInterval"),I_={[zu]:zu,startMillis:0,endMillis:0},Md=(e,t)=>e>t?I_:{[zu]:zu,startMillis:e,endMillis:t},PN=l(2,(e,t)=>MN(e,t)===e),MN=l(2,(e,t)=>e.endMillis<=t.startMillis?e:t.endMillis<=e.startMillis?t:e.startMillis<t.startMillis?e:t.startMillis<e.startMillis?t:e.endMillis<=t.endMillis?e:t),AN=e=>e.startMillis>=e.endMillis,NN=l(2,(e,t)=>{const n=Math.max(e.startMillis,t.startMillis),r=Math.min(e.endMillis,t.endMillis);return Md(n,r)}),xN=e=>ai(e.endMillis-e.startMillis),DN=e=>Md(e,Number.POSITIVE_INFINITY),C_=Md,R_=I_,LN=PN,KN=AN,UN=NN,qN=xN,jN=DN,F_=Symbol.for("effect/ScheduleIntervals"),P_=e=>({[F_]:F_,intervals:e}),zN=l(2,(e,t)=>BN(e.intervals,t.intervals,Me())),BN=(e,t,n)=>{let r=e,s=t,o=n;for(;zn(r)&&zn(s);){const i=h(kn(r),UN(kn(s))),c=KN(i)?o:h(o,ot(i));h(kn(r),LN(kn(s)))?r=Bn(r):s=Bn(s),o=c}return P_(jn(o))},Ad=e=>h(e.intervals,Cf,we(()=>R_)).startMillis,WN=e=>h(e.intervals,Cf,we(()=>R_)).endMillis,HN=l(2,(e,t)=>Ad(e)<Ad(t)),VN=e=>zn(e.intervals),JN=P_,GN=zN,Nd=Ad,xd=WN,QN=HN,YN=VN,Dd="Continue",M_="Done",XN=e=>({_tag:Dd,intervals:e}),ZN=e=>({_tag:Dd,intervals:JN(Ae(e))}),ex={_tag:M_},tx=e=>e._tag===Dd,nx=e=>e._tag===M_,rx=XN,A_=ZN,rc=ex,N_=tx,sc=nx,wr=fS,fs=uu,oc=ls,Ld=lu,Bu=$o,x_=Symbol.for("effect/Schedule"),D_=e=>N(e,x_),sx=Symbol.for("effect/ScheduleDriver"),ox={_Out:e=>e,_In:e=>e,_R:e=>e},ix={_Out:e=>e,_In:e=>e,_R:e=>e};eT=x_;class cx{constructor(t,n){a(this,"initial");a(this,"step");a(this,eT,ox);this.initial=t,this.step=n}pipe(){return I(this,arguments)}}tT=sx;class ax{constructor(t,n){a(this,"schedule");a(this,"ref");a(this,tT,ix);this.schedule=t,this.ref=n}get state(){return A(br(this.ref),t=>t[1])}get last(){return w(br(this.ref),([t,n])=>{switch(t._tag){case"None":return ru(()=>new Ci);case"Some":return v(t.value)}})}get reset(){return Ui(this.ref,[$(),this.schedule.initial])}next(t){return h(A(br(this.ref),n=>n[1]),w(n=>h(q1,w(r=>h(P(()=>this.schedule.step(r,t,n)),w(([s,o,i])=>{const c=Ui(this.ref,[T(o),s]);if(sc(i))return ae(c,Ee($()));const u=Nd(i.intervals)-r;return u<=0?We(c,o):h(c,ae(rd(ai(u))),We(o))}))))))}}const To=(e,t)=>new cx(e,t),ux=l(2,(e,t)=>lx(e,n=>k(()=>t(n)))),lx=l(2,(e,t)=>gx(e,(n,r)=>A(t(n),s=>jI(r,rn(s))))),fx=l(2,(e,t)=>Kd(e,(n,r)=>k(()=>t(n,r)))),Kd=l(2,(e,t)=>To(e.initial,(n,r,s)=>w(e.step(n,r,s),([o,i,c])=>sc(c)?v([o,i,rc]):A(t(r,i),u=>u?[o,i,c]:[o,i,rc])))),L_=e=>h(wu([$(),e.initial]),A(t=>new ax(e,t))),K_=l(2,(e,t)=>hx(e,t,GN)),hx=l(3,(e,t,n)=>To([e.initial,t.initial],(r,s,o)=>h(eS(e.step(r,s,o[0]),t.step(r,s,o[1]),(i,c)=>[i,c]),w(([[i,c,u],[f,d,m]])=>N_(u)&&N_(m)?Ud(e,t,s,i,c,u.intervals,f,d,m.intervals,n):v([[i,f],[c,d],rc]))))),Ud=(e,t,n,r,s,o,i,c,u,f)=>{const d=f(o,u);return YN(d)?v([[r,i],[s,c],rx(d)]):h(o,QN(u))?w(e.step(xd(o),n,r),([m,p,g])=>sc(g)?v([[m,i],[p,c],rc]):Ud(e,t,n,m,p,g.intervals,i,c,u,f)):w(t.step(xd(u),n,i),([m,p,g])=>sc(g)?v([[r,m],[s,p],rc]):Ud(e,t,n,r,s,o,m,p,g.intervals,f))},dx=l(2,(e,t)=>mx(e,n=>k(()=>t(n)))),mx=l(2,(e,t)=>To(e.initial,(n,r,s)=>w(e.step(n,r,s),([o,i,c])=>A(t(i),u=>[o,u,c])))),gx=l(2,(e,t)=>To(e.initial,(n,r,s)=>w(e.step(n,r,s),([o,i,c])=>{if(sc(c))return v([o,i,c]);const u=c.intervals,f=qN(C_(n,Nd(u)));return A(t(i,f),d=>{const m=rn(d),p=Nd(u),g=n+ui(m),b=g-p,S=Math.max(0,xd(u)+b),_=C_(g,S);return[o,i,A_(_)]})}))),px=e=>To(e.initial,(t,n,r)=>h(e.step(t,n,r),A(([s,o,i])=>[s,n,i]))),U_=e=>bx(Vu,t=>t<e),yx=e=>ux(Vu,()=>e),Sx=(e,t)=>To(e,(n,r,s)=>k(()=>[t(s),s,A_(jN(n))])),q_=l(2,(e,t)=>Kd(e,(n,r)=>OP(t(n)))),j_=l(2,(e,t)=>Kd(e,(n,r)=>t(n))),bx=l(2,(e,t)=>fx(e,(n,r)=>t(r))),Wu=Symbol.for("effect/Schedule/ScheduleDefect");nT=Wu;class _x{constructor(t){a(this,"error");a(this,nT);this.error=t,this[Wu]=Wu}}const wx=e=>N(e,Wu),Hu=e=>co(e,t=>Ei(new _x(t))),z_=e=>wi(e,t=>ze(Ja(t,n=>hh(n)&&wx(n.defect)?T(n.defect):$()),{onNone:()=>fe(t),onSome:n=>Ee(n.error)})),B_=l(2,(e,t)=>kx(e,t,(n,r)=>Ee(n))),Ex=l(2,(e,t)=>{if(D_(t))return B_(e,t);const n=t.schedule??px(Vu),r=t.while?j_(n,i=>{const c=t.while(i);return typeof c=="boolean"?v(c):Hu(c)}):n,s=t.until?q_(r,i=>{const c=t.until(i);return typeof c=="boolean"?v(c):Hu(c)}):r,o=t.times?K_(s,U_(t.times)).pipe(dx(i=>i[0])):s;return z_(B_(e,o))}),kx=l(3,(e,t,n)=>w(L_(t),r=>$n(e,{onFailure:s=>n(s,$()),onSuccess:s=>W_(e,r,n,s)}))),W_=(e,t,n,r)=>$n(t.next(r),{onFailure:()=>yh(t.last),onSuccess:s=>$n(e,{onFailure:o=>n(o,T(s)),onSuccess:o=>W_(e,t,n,o)})}),H_=l(2,(e,t)=>$x(e,t,(n,r)=>Ee(n))),vx=l(2,(e,t)=>{if(D_(t))return H_(e,t);const n=t.schedule??Vu,r=t.while?j_(n,i=>{const c=t.while(i);return typeof c=="boolean"?v(c):Hu(c)}):n,s=t.until?q_(r,i=>{const c=t.until(i);return typeof c=="boolean"?v(c):Hu(c)}):r,o=t.times?K_(s,U_(t.times)):s;return z_(H_(e,o))}),$x=l(3,(e,t,n)=>w(L_(t),r=>V_(e,r,n))),V_=(e,t,n)=>co(e,r=>$n(t.next(r),{onFailure:()=>h(t.last,yh,w(s=>n(r,s))),onSuccess:()=>V_(e,t,n)})),Vu=Sx(0,e=>e+1);class Tx{constructor(t){a(this,"permits");a(this,"waiters",new Set);a(this,"taken",0);a(this,"take",t=>Qt(n=>{if(this.free<t){const r=()=>{this.free<t||(this.waiters.delete(r),this.taken+=t,n(v(t)))};return this.waiters.add(r),k(()=>{this.waiters.delete(r)})}return this.taken+=t,n(v(t))}));a(this,"updateTaken",t=>se(n=>(this.taken=t(this.taken),this.waiters.size>0&&n.getFiberRef(Hi).scheduleTask(()=>{const r=this.waiters.values();let s=r.next();for(;s.done===!1&&this.free>0;)s.value(),s=r.next()},n.getFiberRef(Ii)),v(this.free))));a(this,"release",t=>this.updateTaken(n=>n-t));a(this,"releaseAll",this.updateTaken(t=>0));a(this,"withPermits",t=>n=>xt(r=>w(r(this.take(t)),s=>tc(r(n),this.release(s)))));this.permits=t}get free(){return this.permits-this.taken}}const ic=e=>new Tx(e),Ox=e=>k(()=>ic(e)),J_=l(2,(e,t)=>xt(n=>w(t.fork(_o),r=>h(n(e),Jn(s=>r.close(s)),ko,Tn(s=>r.addFinalizer(()=>uo(o=>L(o,s.id())?W:Nt(Ti(s))))))))),Ix=e=>Rd(t=>J_(e,t)),Cx=l(2,(e,t)=>h(an(e),k_(an(t)),n=>lo(n))),Rx=l(2,(e,t)=>Fx(e,{onTimeout:()=>bF(t),duration:t})),Fx=l(2,(e,{duration:t,onTimeout:n})=>lo(Px(e,{onTimeout:()=>ru(n),onSuccess:v,duration:t}))),Px=l(2,(e,{duration:t,onSuccess:n,onTimeout:r})=>uo(s=>v_(e,su(rd(t)),{onSelfWin:(o,i)=>w(o.await,c=>c._tag==="Success"?w(o.inheritAll,()=>We(Gn(i,s),n(c.value))):w(Gn(i,s),()=>ue(c.cause))),onOtherWin:(o,i)=>w(o.await,c=>c._tag==="Success"?w(o.inheritAll,()=>We(Gn(i,s),r())):w(Gn(i,s),()=>ue(c.cause))),otherScope:Cu}))),G_=Symbol.for("effect/Ref/SynchronizedRef"),Q_={_A:e=>e};oT=G_,sT=Qh,rT=Xn;class Mx{constructor(t,n){a(this,"ref");a(this,"withLock");a(this,oT,Q_);a(this,sT,Yh);a(this,rT);a(this,"get");this.ref=t,this.withLock=n,this[Xn]=Xn,this.get=br(this.ref)}modify(t){return this.modifyEffect(n=>v(t(n)))}modifyEffect(t){return this.withLock(h(w(br(this.ref),t),w(([n,r])=>We(Ui(this.ref,r),n))))}pipe(){return I(this,arguments)}}const Ax=e=>k(()=>Nx(e)),Nx=e=>{const t=tb(e),n=ic(1);return new Mx(t,n.withPermits(1))},xx="Fold",Dx="Fresh",Lx="FromEffect",Kx="Scoped",Ux="Suspend",qx="Provide",jx="ProvideMerge",zx="ZipWith",Bx=wM,Wx=EM,Er=Ti,Hx=Gn,Vx=kM,Y_=Ru,qd=e=>(t,n)=>{const r=ny(),s=[[Dt,[[r,e.context]]]];n!=null&&n.scheduler&&s.push([Hi,[[r,n.scheduler]]]);let o=G1(e.fiberRefs,{entries:s,forkAs:r});n!=null&&n.updateRefs&&(o=n.updateRefs(o,r));const i=new u_(r,o,e.runtimeFlags);let c=t;n!=null&&n.scope&&(c=w(Ld(n.scope,_o),f=>ae(fS(f,uo(d=>L(d,i.id())?W:Gn(i,d))),Jn(t,d=>fs(f,d)))));const u=i._supervisor;return u!==Nu&&(u.onStart(e.context,c,$(),i),i.addObserver(f=>u.onEnd(f,i))),Cu.add(e.runtimeFlags,i),(n==null?void 0:n.immediate)===!1?i.resume(c):i.start(c),i},Jx=e=>t=>{const n=eD(e)(t);if(n._tag==="Failure")throw Xx(n.effect_instruction_i0);return n.effect_instruction_i0};class Gx extends Error{constructor(n){super(`Fiber #${n.id().id} cannot be resolved synchronously. This is caused by using runSync on an effect that performs async work`);a(this,"fiber");a(this,"_tag","AsyncFiberException");this.fiber=n,this.name=this._tag,this.stack=this.message}}const Qx=e=>{const t=Error.stackTraceLimit;Error.stackTraceLimit=0;const n=new Gx(e);return Error.stackTraceLimit=t,n},jd=Symbol.for("effect/Runtime/FiberFailure"),zd=Symbol.for("effect/Runtime/FiberFailure/Cause");class Yx extends Error{constructor(n){super();a(this,cT);a(this,iT);this[jd]=jd,this[zd]=n;const r=xy(n);if(r.length>0){const s=r[0];this.name=s.name,this.message=s.message,this.stack=s.stack}this.name=`(FiberFailure) ${this.name}`,(this.message===void 0||this.message.length===0)&&(this.message="An error has occurred")}toJSON(){return{_id:"FiberFailure",cause:this[zd].toJSON()}}toString(){return"(FiberFailure) "+(this.stack??this.message)}[(cT=jd,iT=zd,ge)](){return this.toString()}}const Xx=e=>{const t=Error.stackTraceLimit;Error.stackTraceLimit=0;const n=new Yx(e);return Error.stackTraceLimit=t,n},Zx=e=>{const t=e;switch(t._op){case"Failure":case"Success":return t;case"Left":return Th(t.left);case"Right":return et(t.right);case"Some":return et(t.value);case"None":return Th(Ci())}},eD=e=>t=>{const n=Zx(t);if(n)return n;const r=new dM,s=qd(e)(t,{scheduler:r});r.flush();const o=s.unsafePoll();if(o)return o;throw Qx(s)};class X_{constructor(t,n,r){a(this,"context");a(this,"runtimeFlags");a(this,"fiberRefs");this.context=t,this.runtimeFlags=n,this.fiberRefs=r}pipe(){return I(this,arguments)}}const tD=e=>new X_(e.context,e.runtimeFlags,e.fiberRefs),nD=()=>se((e,t)=>v(new X_(e.getFiberRef(Dt),t.runtimeFlags,e.getFiberRefs()))),Ju=tD({context:qn(),runtimeFlags:by(Qs,yy,py),fiberRefs:Q1()}),rD=qd(Ju),sD=Jx(Ju),oD=l(2,(e,t)=>e.modifyEffect(t)),Z_=Symbol.for("effect/Layer"),iD={_RIn:e=>e,_E:e=>e,_ROut:e=>e},hs={[Z_]:iD,pipe(){return I(this,arguments)}},Bd=Symbol.for("effect/Layer/MemoMap"),ew=e=>N(e,Z_),cD=e=>e._tag===Dx;aT=Bd;class aD{constructor(t){a(this,"ref");a(this,aT);this.ref=t,this[Bd]=Bd}getOrElseMemoize(t,n){return h(oD(this.ref,r=>{const s=r.get(t);if(s!==void 0){const[o,i]=s,c=h(o,w(([u,f])=>h(IP(u),We(f))),Jn(mu({onFailure:()=>W,onSuccess:()=>Eh(n,i)})));return v([c,r])}return h(wu(0),w(o=>h(Fi(),w(i=>h(wu(()=>W),A(c=>{const u=xt(d=>h($o(),w(m=>h(d(w(tw(t,m,!0),p=>SP(p(this)))),an,w(p=>{switch(p._tag){case lt:return h(_S(i,p.effect_instruction_i0),ae(uu(m,p)),ae(fe(p.effect_instruction_i0)));case ft:return h(Ui(c,g=>h(uu(m,g),iu(nb(o,b=>[b===1,b-1])),Nt)),ae(Xh(o,g=>g+1)),ae(Eh(n,g=>h(k(()=>r.delete(t)),ae(br(c)),w(b=>b(g))))),ae(Pi(i,p.effect_instruction_i0)),We(p.effect_instruction_i0[1]))}}))))),f=[h(Qn(i),Jn(Ih({onFailure:()=>W,onSuccess:()=>Xh(o,d=>d+1)}))),d=>h(br(c),w(m=>m(d)))];return[u,cD(t)?r:r.set(t,f)]}))))))}),lo)}}const uD=P(()=>A(Ax(new Map),e=>new aD(e))),Gu=l(2,(e,t)=>w(uD,n=>w(tw(e,t),r=>r(n)))),tw=(e,t,n=!1)=>{const r=e;switch(r._tag){case"Locally":return k(()=>s=>r.f(s.getOrElseMemoize(r.self,t)));case"ExtendScope":return k(()=>s=>Rd(o=>s.getOrElseMemoize(r.layer,o)));case"Fold":return k(()=>s=>h(s.getOrElseMemoize(r.layer,t),ht({onFailure:o=>s.getOrElseMemoize(r.failureK(o),t),onSuccess:o=>s.getOrElseMemoize(r.successK(o),t)})));case"Fresh":return k(()=>s=>h(r.layer,Gu(t)));case"FromEffect":return k(n?()=>s=>r.effect:()=>s=>s.getOrElseMemoize(e,t));case"Provide":return k(()=>s=>h(s.getOrElseMemoize(r.first,t),w(o=>h(s.getOrElseMemoize(r.second,t),Fh(o)))));case"Scoped":return k(n?()=>s=>ls(r.effect,t):()=>s=>s.getOrElseMemoize(e,t));case"Suspend":return k(()=>s=>s.getOrElseMemoize(r.evaluate(),t));case"ProvideMerge":return k(()=>s=>h(s.getOrElseMemoize(r.first,t),eS(s.getOrElseMemoize(r.second,t),r.zipK)));case"ZipWith":return k(()=>s=>h(s.getOrElseMemoize(r.first,t),ec(s.getOrElseMemoize(r.second,t),r.zipK,{concurrent:!0})))}},lD=()=>cc(Ai()),fD=e=>nw(qu(e)),nw=e=>cc(fe(e)),rw=l(2,(e,t)=>gD(e,{onFailure:fD,onSuccess:t})),hD=l(2,(e,t)=>{const n=Sa(e),r=n?e:t;return cc(A(n?t:e,o=>oi(r,o)))});function cc(e){const t=Object.create(hs);return t._tag=Lx,t.effect=e,t}const dD=e=>g_(ae(Rd(t=>h(e,Gu(t))),JR)),mD=l(2,(e,{onFailure:t,onSuccess:n})=>{const r=Object.create(hs);return r._tag=xx,r.layer=e,r.failureK=t,r.successK=n,r}),gD=l(2,(e,{onFailure:t,onSuccess:n})=>mD(e,{onFailure:r=>{const s=ju(r);switch(s._tag){case"Left":return t(s.left);case"Right":return nw(s.right)}},onSuccess:n})),pD=l(2,(e,t)=>wD(e,t,(n,r)=>Br(n,r))),yD=l(2,(e,t)=>{const n=Sa(e),r=n?e:t;return sw(A(n?t:e,o=>oi(r,o)))}),Wd=e=>sw(h(e,We(qn()))),sw=e=>{const t=Object.create(hs);return t._tag=Kx,t.effect=e,t},SD=l(2,(e,t)=>{const n=Sa(e);return cc(v(oi(n?e:t,n?t:e)))}),ow=e=>{const t=Object.create(hs);return t._tag=Ux,t.evaluate=e,t},bD=l(2,(e,t)=>{const n=Sa(e),r=n?e:t,s=n?t:e;return cc(k(()=>oi(r,s())))}),_D=l(2,(e,t)=>ow(()=>{const n=Object.create(hs);return n._tag=qx,n.first=Object.create(hs,{_tag:{value:jx,enumerable:!0},first:{value:lD(),enumerable:!0},second:{value:t},zipK:{value:(r,s)=>h(r,Br(s))}}),n.second=e,n})),wD=l(3,(e,t,n)=>ow(()=>{const r=Object.create(hs);return r._tag=zx,r.first=e,r.second=t,r.zipK=n,r})),ED=e=>{const t=Vt("effect/Layer/unwrapScoped/Layer.Layer<R1, E1, A>");return rw(yD(t,e),n=>Mt(n,t))},kD=l(2,(e,t)=>tu($o(),n=>w(Gu(t,n),r=>Ph(e,r)),(n,r)=>uu(n,r))),vD=l(2,(e,t)=>{const n=Bi(Ju.fiberRefs,t.fiberRefs),r=Xr(Ju.runtimeFlags,t.runtimeFlags);return xt(s=>se(o=>{const i=o.getFiberRef(Dt),c=o.getFiberRefs(),u=Wi(o.id(),c)(n),f=o._runtimeFlags,d=Ys(r)(f),m=Bi(u,c),p=Xr(d,f);return o.setFiberRefs(u),o._runtimeFlags=d,tc(Ph(s(e),Br(i,t.context)),se(g=>(g.setFiberRefs(Wi(g.id(),g.getFiberRefs())(m)),g._runtimeFlags=Ys(p)(g._runtimeFlags),W)))}))}),$D=l(2,(e,t)=>ew(t)?kD(e,t):bI(t)?Ph(e,t):vD(e,t)),TD=jA,kr=vn,Hd=Od,St=Eo,Qu=se,ac=Ee,In=fe,OD=Ei,ID=Gy,de=wP,oe=v,xe=P,Y=k,H=W,CD=$i,Yu=co,vr=wi,RD=gP,FD=Hy,Vd=pP,PD=yP,MD=kP,iw=vP,cw=vx,aw=mP,Oo=He,ln=su,uc=mr,Io=xt,$r=We,Xu=Nt,V=A,AD=ph,Tr=ou,Or=Td,uw=tu,Jd=h_,Ir=tc,ND=qR,Gd=y_,Co=g_,xD=uo,lw=ko,lc=J_,Cn=Ix,DD=rd,LD=Rx,Ro=$D,fc=gb,KD=AP,hc=bP,fw=_P,ds=ao,Ct=an,hw=Xy,UD=MP,C=w,Zu=KR,ms=lo,Qd=k_,qD=Cx,dw=E_,Lt=Tn,jD=RP,dc=FP,zD=td,mw=Ex,BD=hb,el=Yy,Rn=ht,gw=$n,pw=db,yw=$P,WD=TP,tl=dP,HD=yh,VD=jR,Sw=nD,Yd=Ox,Xd=rD,bw=sD,_w=dN,nl=mN,ke=gN,rl=ec,JD=NP,mc=LP,GD=sd,QD=ts,YD=Dt,XD=bh,ZD=Hi,eL=l(2,(e,t)=>ho(l_,t)(e)),tL=e=>Wd(b_($d,Hs(e))),nL=e=>Wd(b_($d,Jf(e))),rL=l(2,(e,t)=>rw(nL(e),()=>tL(t))),sL=ew,oL=Gu,iL=hD,cL=dD,aL=pD,uL=Wd,ww=SD,lL=bD,Ew=_D,fL=ED,kw=Symbol.for("effect/QueueEnqueue"),Zd=Symbol.for("effect/QueueDequeue"),em=Symbol.for("effect/QueueStrategy"),hL=Symbol.for("effect/BackingQueue"),tm={_A:e=>e},dL={_A:e=>e},vw={_In:e=>e},nm={_Out:e=>e};lT=kw,uT=Zd;class mL{constructor(t,n,r,s,o){a(this,"queue");a(this,"takers");a(this,"shutdownHook");a(this,"shutdownFlag");a(this,"strategy");a(this,lT,vw);a(this,uT,nm);this.queue=t,this.takers=n,this.shutdownHook=r,this.shutdownFlag=s,this.strategy=o}pipe(){return I(this,arguments)}capacity(){return this.queue.capacity()}get size(){return P(()=>co(this.unsafeSize(),()=>He))}unsafeSize(){return te(this.shutdownFlag)?$():T(this.queue.length()-Uh(this.takers)+this.strategy.surplusSize())}get isEmpty(){return A(this.size,t=>t<=0)}get isFull(){return A(this.size,t=>t>=this.capacity())}get shutdown(){return mr(se(t=>(h(this.shutdownFlag,Gr(!0)),h(er(Fo(this.takers),n=>Rh(n,t.id()),!1,!1),ae(this.strategy.shutdown),iu(Pi(this.shutdownHook,void 0)),Nt))))}get isShutdown(){return k(()=>te(this.shutdownFlag))}get awaitShutdown(){return Qn(this.shutdownHook)}isActive(){return!te(this.shutdownFlag)}unsafeOffer(t){if(te(this.shutdownFlag))return!1;let n;if(this.queue.length()===0){const s=h(this.takers,Yn(Ne));s!==Ne?(gs(s,t),n=!0):n=!1}else n=!1;if(n)return!0;const r=this.queue.offer(t);return ps(this.strategy,this.queue,this.takers),r}offer(t){return P(()=>{if(te(this.shutdownFlag))return He;let n;if(this.queue.length()===0){const s=h(this.takers,Yn(Ne));s!==Ne?(gs(s,t),n=!0):n=!1}else n=!1;if(n)return v(!0);const r=this.queue.offer(t);return ps(this.strategy,this.queue,this.takers),r?v(!0):this.strategy.handleSurplus([t],this.queue,this.takers,this.shutdownFlag)})}offerAll(t){return P(()=>{if(te(this.shutdownFlag))return He;const n=he(t),r=this.queue.length()===0?he(FL(this.takers,n.length)):cr,[s,o]=h(n,bp(r.length));for(let c=0;c<r.length;c++){const u=r[c],f=s[c];gs(u,f)}if(o.length===0)return v(!0);const i=this.queue.offerAll(o);return ps(this.strategy,this.queue,this.takers),Ea(i)?v(!0):this.strategy.handleSurplus(i,this.queue,this.takers,this.shutdownFlag)})}get take(){return se(t=>{if(te(this.shutdownFlag))return He;const n=this.queue.poll(Ne);if(n!==Ne)return this.strategy.unsafeOnQueueEmptySpace(this.queue,this.takers),v(n);{const r=Ri(t.id());return h(P(()=>(h(this.takers,yo(r)),ps(this.strategy,this.queue,this.takers),te(this.shutdownFlag)?He:Qn(r))),fo(()=>k(()=>PL(this.takers,r))))}})}get takeAll(){return P(()=>te(this.shutdownFlag)?He:k(()=>{const t=this.queue.pollUpTo(Number.POSITIVE_INFINITY);return this.strategy.unsafeOnQueueEmptySpace(this.queue,this.takers),ii(t)}))}takeUpTo(t){return P(()=>te(this.shutdownFlag)?He:k(()=>{const n=this.queue.pollUpTo(t);return this.strategy.unsafeOnQueueEmptySpace(this.queue,this.takers),ii(n)}))}takeBetween(t,n){return P(()=>$w(this,t,n,Me()))}}const $w=(e,t,n,r)=>n<t?v(r):h(vL(e,n),w(s=>{const o=t-s.length;return o===1?h(sm(e),A(i=>h(r,Be(s),ci(i)))):o>1?h(sm(e),w(i=>$w(e,o-1,n-s.length-1,h(r,Be(s),ci(i))))):v(h(r,Be(s)))})),gL=e=>h(k(()=>Kh(e)),w(t=>sl(ol(t),TL()))),pL=e=>h(k(()=>Kh(e)),w(t=>sl(ol(t),Tw()))),yL=e=>h(k(()=>Kh(e)),w(t=>sl(ol(t),OL()))),rm=()=>h(k(()=>pu()),w(e=>sl(ol(e),Tw()))),SL=(e,t,n,r,s)=>new mL(e,t,n,r,s),sl=(e,t)=>h(Fi(),A(n=>SL(e,pu(),n,Jr(!1),t)));fT=hL;class bL{constructor(t){a(this,"mutable");a(this,fT,dL);this.mutable=t}poll(t){return Yn(this.mutable,t)}pollUpTo(t){return yu(this.mutable,t)}offerAll(t){return qh(this.mutable,t)}offer(t){return yo(this.mutable,t)}capacity(){return XF(this.mutable)}length(){return Uh(this.mutable)}}const ol=e=>new bL(e),_L=e=>e.size,wL=e=>e.isShutdown,EL=e=>e.shutdown,kL=l(2,(e,t)=>e.offer(t)),sm=e=>e.take,vL=l(2,(e,t)=>e.takeUpTo(t)),$L=l(3,(e,t,n)=>e.takeBetween(t,n)),TL=()=>new IL,Tw=()=>new CL,OL=()=>new RL;hT=em;class IL{constructor(){a(this,hT,tm);a(this,"putters",pu())}surplusSize(){return Uh(this.putters)}onCompleteTakersWithEmptyQueue(t){for(;!ss(this.putters)&&!ss(t);){const n=Yn(t,void 0),r=Yn(this.putters,void 0);r[2]&&gs(r[1],!0),gs(n,r[0])}}get shutdown(){return h(ki,w(t=>h(k(()=>Fo(this.putters)),w(n=>er(n,([r,s,o])=>o?h(Rh(s,t),Nt):W,!1,!1)))))}handleSurplus(t,n,r,s){return se(o=>{const i=Ri(o.id());return h(P(()=>(this.unsafeOffer(t,i),this.unsafeOnQueueEmptySpace(n,r),ps(this,n,r),te(s)?He:Qn(i))),fo(()=>k(()=>this.unsafeRemove(i))))})}unsafeOnQueueEmptySpace(t,n){let r=!0;for(;r&&(t.capacity()===Number.POSITIVE_INFINITY||t.length()<t.capacity());){const s=h(this.putters,Yn(Ne));if(s===Ne)r=!1;else{const o=t.offer(s[0]);o&&s[2]?gs(s[1],!0):o||il(this.putters,h(Fo(this.putters),ot(s))),ps(this,t,n)}}}unsafeOffer(t,n){const r=he(t);for(let s=0;s<r.length;s++){const o=r[s];s===r.length-1?h(this.putters,yo([o,n,!0])):h(this.putters,yo([o,n,!1]))}}unsafeRemove(t){il(this.putters,h(Fo(this.putters),wa(([,n])=>n!==t)))}}let CL=(dT=em,class{constructor(){a(this,dT,tm)}surplusSize(){return 0}get shutdown(){return W}onCompleteTakersWithEmptyQueue(){}handleSurplus(t,n,r,s){return v(!1)}unsafeOnQueueEmptySpace(t,n){}});mT=em;class RL{constructor(){a(this,mT,tm)}surplusSize(){return 0}get shutdown(){return W}onCompleteTakersWithEmptyQueue(){}handleSurplus(t,n,r,s){return k(()=>(this.unsafeOffer(n,t),ps(this,n,r),!0))}unsafeOnQueueEmptySpace(t,n){}unsafeOffer(t,n){const r=n[Symbol.iterator]();let s,o=!0;for(;!(s=r.next()).done&&o;){if(t.capacity()===0)return;t.poll(Ne),o=t.offer(s.value)}}}const gs=(e,t)=>Mi(e,v(t)),il=(e,t)=>h(e,qh(t)),Fo=e=>h(e,yu(Number.POSITIVE_INFINITY)),FL=(e,t)=>h(e,yu(t)),PL=(e,t)=>{il(e,h(Fo(e),wa(n=>t!==n)))},ps=(e,t,n)=>{let r=!0;for(;r&&t.length()!==0;){const s=h(n,Yn(Ne));if(s!==Ne){const o=t.poll(Ne);o!==Ne?(gs(s,o),e.unsafeOnQueueEmptySpace(t,n)):il(n,h(Fo(n),ot(s))),r=!0}else r=!1}r&&t.length()===0&&!ss(n)&&e.onCompleteTakersWithEmptyQueue(n)},Fn=Symbol.for("effect/PubSub/AbsentValue"),Ow=(e,t)=>n=>{n.has(e)||n.set(e,new Set),n.get(e).add(t)},ML=(e,t)=>n=>{if(!n.has(e))return;const r=n.get(e);r.delete(t),r.size===0&&n.delete(e)},AL=e=>P(()=>{const t=LL(e);return WL(t,new XL)}),NL=e=>e.shutdown,xL=l(2,(e,t)=>e.publish(t)),DL=e=>e.subscribe,LL=e=>new qL(e!=null&&e.replay?new t2(e.replay):void 0),KL=(e,t,n)=>A(Fi(),r=>UL(e,t,e.subscribe(),pu(),r,Jr(!1),n)),UL=(e,t,n,r,s,o,i)=>new zL(e,t,n,r,s,o,i,e.replayWindow());class qL{constructor(t){a(this,"replayBuffer");a(this,"publisherHead",{value:Fn,subscribers:0,next:null});a(this,"publisherTail",this.publisherHead);a(this,"publisherIndex",0);a(this,"subscribersIndex",0);a(this,"capacity",Number.MAX_SAFE_INTEGER);this.replayBuffer=t}replayWindow(){return this.replayBuffer?new n2(this.replayBuffer):r2}isEmpty(){return this.publisherHead===this.publisherTail}isFull(){return!1}size(){return this.publisherIndex-this.subscribersIndex}publish(t){const n=this.publisherTail.subscribers;return n!==0&&(this.publisherTail.next={value:t,subscribers:n,next:null},this.publisherTail=this.publisherTail.next,this.publisherIndex+=1),this.replayBuffer&&this.replayBuffer.offer(t),!0}publishAll(t){if(this.publisherTail.subscribers!==0)for(const n of t)this.publish(n);else this.replayBuffer&&this.replayBuffer.offerAll(t);return Me()}slide(){this.publisherHead!==this.publisherTail&&(this.publisherHead=this.publisherHead.next,this.publisherHead.value=Fn,this.subscribersIndex+=1),this.replayBuffer&&this.replayBuffer.slide()}subscribe(){return this.publisherTail.subscribers+=1,new jL(this,this.publisherTail,this.publisherIndex,!1)}}class jL{constructor(t,n,r,s){a(this,"self");a(this,"subscriberHead");a(this,"subscriberIndex");a(this,"unsubscribed");this.self=t,this.subscriberHead=n,this.subscriberIndex=r,this.unsubscribed=s}isEmpty(){if(this.unsubscribed)return!0;let t=!0,n=!0;for(;n;)this.subscriberHead===this.self.publisherTail?n=!1:this.subscriberHead.next.value!==Fn?(t=!1,n=!1):(this.subscriberHead=this.subscriberHead.next,this.subscriberIndex+=1);return t}size(){return this.unsubscribed?0:this.self.publisherIndex-Math.max(this.subscriberIndex,this.self.subscribersIndex)}poll(t){if(this.unsubscribed)return t;let n=!0,r=t;for(;n;)if(this.subscriberHead===this.self.publisherTail)n=!1;else{const s=this.subscriberHead.next.value;s!==Fn&&(r=s,this.subscriberHead.subscribers-=1,this.subscriberHead.subscribers===0&&(this.self.publisherHead=this.self.publisherHead.next,this.self.publisherHead.value=Fn,this.self.subscribersIndex+=1),n=!1),this.subscriberHead=this.subscriberHead.next,this.subscriberIndex+=1}return r}pollUpTo(t){const n=[],r=Fn;let s=0;for(;s!==t;){const o=this.poll(r);o===r?s=t:(n.push(o),s+=1)}return ii(n)}unsubscribe(){if(!this.unsubscribed)for(this.unsubscribed=!0,this.self.publisherTail.subscribers-=1;this.subscriberHead!==this.self.publisherTail;)this.subscriberHead.next.value!==Fn&&(this.subscriberHead.subscribers-=1,this.subscriberHead.subscribers===0&&(this.self.publisherHead=this.self.publisherHead.next,this.self.publisherHead.value=Fn,this.self.subscribersIndex+=1)),this.subscriberHead=this.subscriberHead.next}}gT=Zd;class zL{constructor(t,n,r,s,o,i,c,u){a(this,"pubsub");a(this,"subscribers");a(this,"subscription");a(this,"pollers");a(this,"shutdownHook");a(this,"shutdownFlag");a(this,"strategy");a(this,"replayWindow");a(this,gT,nm);this.pubsub=t,this.subscribers=n,this.subscription=r,this.pollers=s,this.shutdownHook=o,this.shutdownFlag=i,this.strategy=c,this.replayWindow=u}pipe(){return I(this,arguments)}capacity(){return this.pubsub.capacity}isActive(){return!te(this.shutdownFlag)}get size(){return P(()=>te(this.shutdownFlag)?He:v(this.subscription.size()+this.replayWindow.remaining))}unsafeSize(){return te(this.shutdownFlag)?$():T(this.subscription.size()+this.replayWindow.remaining)}get isFull(){return P(()=>te(this.shutdownFlag)?He:v(this.subscription.size()===this.capacity()))}get isEmpty(){return A(this.size,t=>t===0)}get shutdown(){return mr(se(t=>(Gr(this.shutdownFlag,!0),h(Id(om(this.pollers),n=>Rh(n,t.id()),!1),ae(k(()=>{this.subscribers.delete(this.subscription),this.subscription.unsubscribe(),this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers)})),iu(Pi(this.shutdownHook,void 0)),Nt))))}get isShutdown(){return k(()=>te(this.shutdownFlag))}get awaitShutdown(){return Qn(this.shutdownHook)}get take(){return se(t=>{if(te(this.shutdownFlag))return He;if(this.replayWindow.remaining>0){const r=this.replayWindow.take();return v(r)}const n=ss(this.pollers)?this.subscription.poll(Ne):Ne;if(n===Ne){const r=Ri(t.id());return h(P(()=>(h(this.pollers,yo(r)),h(this.subscribers,Ow(this.subscription,this.pollers)),this.strategy.unsafeCompletePollers(this.pubsub,this.subscribers,this.subscription,this.pollers),te(this.shutdownFlag)?He:Qn(r))),fo(()=>k(()=>YL(this.pollers,r))))}else return this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers),v(n)})}get takeAll(){return P(()=>{if(te(this.shutdownFlag))return He;const t=ss(this.pollers)?JL(this.subscription):Me();return this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers),this.replayWindow.remaining>0?v(Be(this.replayWindow.takeAll(),t)):v(t)})}takeUpTo(t){return P(()=>{if(te(this.shutdownFlag))return He;let n;if(this.replayWindow.remaining>=t){const s=this.replayWindow.takeN(t);return v(s)}else this.replayWindow.remaining>0&&(n=this.replayWindow.takeAll(),t=t-n.length);const r=ss(this.pollers)?GL(this.subscription,t):Me();return this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers),v(n?Be(n,r):r)})}takeBetween(t,n){return P(()=>Iw(this,t,n,Me()))}}const Iw=(e,t,n,r)=>n<t?v(r):h(e.takeUpTo(n),w(s=>{const o=t-s.length;return o===1?h(e.take,A(i=>h(r,Be(s),ci(i)))):o>1?h(e.take,w(i=>Iw(e,o-1,n-s.length-1,h(r,Be(s),ci(i))))):v(h(r,Be(s)))}));yT=kw,pT=Zd;class BL{constructor(t,n,r,s,o,i){a(this,"pubsub");a(this,"subscribers");a(this,"scope");a(this,"shutdownHook");a(this,"shutdownFlag");a(this,"strategy");a(this,yT,vw);a(this,pT,nm);this.pubsub=t,this.subscribers=n,this.scope=r,this.shutdownHook=s,this.shutdownFlag=o,this.strategy=i}capacity(){return this.pubsub.capacity}get size(){return P(()=>te(this.shutdownFlag)?He:k(()=>this.pubsub.size()))}unsafeSize(){return te(this.shutdownFlag)?$():T(this.pubsub.size())}get isFull(){return A(this.size,t=>t===this.capacity())}get isEmpty(){return A(this.size,t=>t===0)}get awaitShutdown(){return Qn(this.shutdownHook)}get isShutdown(){return k(()=>te(this.shutdownFlag))}get shutdown(){return mr(se(t=>(h(this.shutdownFlag,Gr(!0)),h(this.scope.close(Oh(t.id())),ae(this.strategy.shutdown),iu(Pi(this.shutdownHook,void 0)),Nt))))}publish(t){return P(()=>te(this.shutdownFlag)?He:this.pubsub.publish(t)?(this.strategy.unsafeCompleteSubscribers(this.pubsub,this.subscribers),v(!0)):this.strategy.handleSurplus(this.pubsub,this.subscribers,Ae(t),this.shutdownFlag))}isActive(){return!te(this.shutdownFlag)}unsafeOffer(t){return te(this.shutdownFlag)?!1:this.pubsub.publish(t)?(this.strategy.unsafeCompleteSubscribers(this.pubsub,this.subscribers),!0):!1}publishAll(t){return P(()=>{if(te(this.shutdownFlag))return He;const n=QL(this.pubsub,t);return this.strategy.unsafeCompleteSubscribers(this.pubsub,this.subscribers),Ea(n)?v(!0):this.strategy.handleSurplus(this.pubsub,this.subscribers,n,this.shutdownFlag)})}get subscribe(){const t=Tn(Od([this.scope.fork(_o),KL(this.pubsub,this.subscribers,this.strategy)]),n=>n[0].addFinalizer(()=>n[1].shutdown));return A(Td(t,(n,r)=>n[0].close(r)),n=>n[1])}offer(t){return this.publish(t)}offerAll(t){return this.publishAll(t)}pipe(){return I(this,arguments)}}const WL=(e,t)=>w($o(),n=>A(Fi(),r=>HL(e,new Map,n,r,Jr(!1),t))),HL=(e,t,n,r,s,o)=>new BL(e,t,n,r,s,o),VL=(e,t)=>{Mi(e,v(t))},Cw=(e,t)=>h(e,qh(t)),om=e=>h(e,yu(Number.POSITIVE_INFINITY)),JL=e=>e.pollUpTo(Number.POSITIVE_INFINITY),GL=(e,t)=>e.pollUpTo(t),QL=(e,t)=>e.publishAll(t),YL=(e,t)=>{Cw(e,h(om(e),wa(n=>n!==t)))};class XL{get shutdown(){return W}handleSurplus(t,n,r,s){return v(!1)}unsafeOnPubSubEmptySpace(t,n){}unsafeCompletePollers(t,n,r,s){return ZL(this,t,n,r,s)}unsafeCompleteSubscribers(t,n){return e2(this,t,n)}}const ZL=(e,t,n,r,s)=>{let o=!0;for(;o&&!r.isEmpty();){const i=h(s,Yn(Ne));if(i===Ne)h(n,ML(r,s)),ss(s)?o=!1:h(n,Ow(r,s));else{const c=r.poll(Ne);c===Ne?Cw(s,h(om(s),ot(i))):(VL(i,c),e.unsafeOnPubSubEmptySpace(t,n))}}},e2=(e,t,n)=>{for(const[r,s]of n)for(const o of s)e.unsafeCompletePollers(t,n,r,o)};class t2{constructor(t){a(this,"capacity");a(this,"head",{value:Fn,next:null});a(this,"tail",this.head);a(this,"size",0);a(this,"index",0);this.capacity=t}slide(){this.index++}offer(t){this.tail.value=t,this.tail.next={value:Fn,next:null},this.tail=this.tail.next,this.size===this.capacity?this.head=this.head.next:this.size+=1}offerAll(t){for(const n of t)this.offer(n)}}class n2{constructor(t){a(this,"buffer");a(this,"head");a(this,"index");a(this,"remaining");this.buffer=t,this.index=t.index,this.remaining=t.size,this.head=t.head}fastForward(){for(;this.index<this.buffer.index;)this.head=this.head.next,this.index++}take(){if(this.remaining===0)return;this.index<this.buffer.index&&this.fastForward(),this.remaining--;const t=this.head.value;return this.head=this.head.next,t}takeN(t){if(this.remaining===0)return Me();this.index<this.buffer.index&&this.fastForward();const n=Math.min(t,this.remaining),r=new Array(n);for(let s=0;s<n;s++){const o=this.head.value;this.head=this.head.next,r[s]=o}return this.remaining-=n,Jt(r)}takeAll(){return this.takeN(this.remaining)}}const r2={remaining:0,take:()=>{},takeN:()=>Me(),takeAll:()=>Me()},s2=AL,Rw=NL,Fw=xL,Pw=DL,im=gL,o2=pL,i2=yL,gc=rm,c2=_L,a2=wL,ys=EL,be=kL,pc=sm,u2=$L,Mw="Continue",l2="Close",f2="Yield",Aw=Symbol.for("effect/ChannelChildExecutorDecision"),h2={[Aw]:Aw},Nw=e=>{const t=Object.create(h2);return t._tag=Mw,t},cl="ContinuationK",d2="ContinuationFinalizer",xw=Symbol.for("effect/ChannelContinuation"),Dw={_Env:e=>e,_InErr:e=>e,_InElem:e=>e,_InDone:e=>e,_OutErr:e=>e,_OutDone:e=>e,_OutErr2:e=>e,_OutElem:e=>e,_OutDone2:e=>e};ST=xw;class cm{constructor(t,n){a(this,"onSuccess");a(this,"onHalt");a(this,"_tag",cl);a(this,ST,Dw);this.onSuccess=t,this.onHalt=n}onExit(t){return Ah(t)?this.onHalt(t.cause):this.onSuccess(t.value)}}bT=xw;class m2{constructor(t){a(this,"finalizer");a(this,"_tag",d2);a(this,bT,Dw);this.finalizer=t}}const Lw="PullAfterNext",g2="PullAfterAllEnqueued",p2=Symbol.for("effect/ChannelUpstreamPullStrategy"),y2={_A:e=>e},S2={[p2]:y2},Kw=e=>{const t=Object.create(S2);return t._tag=Lw,t.emitSeparator=e,t},Uw="BracketOut",qw="Bridge",am="ConcatAll",jw="Emit",zw="Ensuring",Bw="Fail",um="Fold",Ww="FromEffect",Hw="PipeTo",Vw="Provide",Jw="Read",Gw="Succeed",Qw="SucceedNow",Yw="Suspend",Xw=Symbol.for("effect/Channel"),b2={_Env:e=>e,_InErr:e=>e,_InElem:e=>e,_InDone:e=>e,_OutErr:e=>e,_OutElem:e=>e,_OutDone:e=>e},dt={[Xw]:b2,pipe(){return I(this,arguments)}},Zw=e=>N(e,Xw)||kr(e),_2=l(2,(e,t)=>{const n=Object.create(dt);return n._tag=Uw,n.acquire=()=>e,n.finalizer=t,n}),eE=l(2,(e,t)=>{const n=Object.create(dt);return n._tag=um,n.channel=e,n.k=new cm(Po,t),n}),w2=(e,t,n)=>{const r=Object.create(dt);return r._tag=am,r.combineInners=t,r.combineAll=n,r.onPull=()=>Kw($()),r.onEmit=()=>Nw,r.value=()=>e,r.k=R,r},E2=l(4,(e,t,n,r)=>{const s=Object.create(dt);return s._tag=am,s.combineInners=n,s.combineAll=r,s.onPull=()=>Kw($()),s.onEmit=()=>Nw,s.value=()=>e,s.k=t,s}),tE=l(2,(e,t)=>{const n=Object.create(dt);return n._tag=qw,n.input=t,n.channel=e,n}),nE=l(2,(e,t)=>{const n=Object.create(dt);return n._tag=zw,n.channel=e,n.finalizer=t,n}),yc=e=>Ve(qu(e)),Ve=e=>k2(()=>e),k2=e=>{const t=Object.create(dt);return t._tag=Bw,t.error=e,t},ie=l(2,(e,t)=>{const n=Object.create(dt);return n._tag=um,n.channel=e,n.k=new cm(t,Ve),n}),tt=e=>{const t=Object.create(dt);return t._tag=Ww,t.effect=()=>e,t},Kt=l(2,(e,t)=>{const n=Object.create(dt);return n._tag=Hw,n.left=()=>e,n.right=()=>t,n}),v2=l(2,(e,t)=>{const n=Object.create(dt);return n._tag=Vw,n.context=()=>t,n.inner=e,n}),al=e=>nr({onInput:e.onInput,onFailure:t=>gt(ju(t),{onLeft:e.onFailure,onRight:Ve}),onDone:e.onDone}),nr=e=>{const t=Object.create(dt);return t._tag=Jw,t.more=e.onInput,t.done=new cm(e.onDone,e.onFailure),t},Po=e=>rE(()=>e),Ss=e=>{const t=Object.create(dt);return t._tag=Qw,t.terminal=e,t},lm=e=>{const t=Object.create(dt);return t._tag=Yw,t.channel=e,t},rE=e=>{const t=Object.create(dt);return t._tag=Gw,t.evaluate=e,t},mt=Ss(void 0),ve=e=>{const t=Object.create(dt);return t._tag=jw,t.out=e,t},Sc="Done",bc="Emit",Mo="FromEffect",_c="Read",$2=Symbol.for("effect/ChannelState"),T2={_E:e=>e,_R:e=>e},ul={[$2]:T2},Ao=()=>{const e=Object.create(ul);return e._tag=Sc,e},fm=()=>{const e=Object.create(ul);return e._tag=bc,e},wc=e=>{const t=Object.create(ul);return t._tag=Mo,t.effect=e,t},hm=(e,t,n,r)=>{const s=Object.create(ul);return s._tag=_c,s.upstream=e,s.onEffect=t,s.onEmit=n,s.onDone=r,s},ll=e=>e._tag===Mo,O2=e=>ll(e)?e.effect:H,sE=e=>ll(e)?MD(e.effect):void 0,oE="PullFromChild",dm="PullFromUpstream",mm="DrainChildExecutors",iE="Emit";class fl{constructor(t,n,r){a(this,"childExecutor");a(this,"parentSubexecutor");a(this,"onEmit");a(this,"_tag",oE);this.childExecutor=t,this.parentSubexecutor=n,this.onEmit=r}close(t){const n=this.childExecutor.close(t),r=this.parentSubexecutor.close(t);return n!==void 0&&r!==void 0?rl(Ct(n),Ct(r),(s,o)=>h(s,Di(o))):n!==void 0?n:r!==void 0?r:void 0}enqueuePullFromChild(t){return this}}class bs{constructor(t,n,r,s,o,i,c,u){a(this,"upstreamExecutor");a(this,"createChild");a(this,"lastDone");a(this,"activeChildExecutors");a(this,"combineChildResults");a(this,"combineWithChildResult");a(this,"onPull");a(this,"onEmit");a(this,"_tag",dm);this.upstreamExecutor=t,this.createChild=n,this.lastDone=r,this.activeChildExecutors=s,this.combineChildResults=o,this.combineWithChildResult=i,this.onPull=c,this.onEmit=u}close(t){const n=this.upstreamExecutor.close(t),s=[...this.activeChildExecutors.map(o=>o!==void 0?o.childExecutor.close(t):void 0),n].reduce((o,i)=>o!==void 0&&i!==void 0?rl(o,Ct(i),(c,u)=>Di(c,u)):o!==void 0?o:i!==void 0?Ct(i):void 0,void 0);return s}enqueuePullFromChild(t){return new bs(this.upstreamExecutor,this.createChild,this.lastDone,[...this.activeChildExecutors,t],this.combineChildResults,this.combineWithChildResult,this.onPull,this.onEmit)}}class No{constructor(t,n,r,s,o,i,c){a(this,"upstreamExecutor");a(this,"lastDone");a(this,"activeChildExecutors");a(this,"upstreamDone");a(this,"combineChildResults");a(this,"combineWithChildResult");a(this,"onPull");a(this,"_tag",mm);this.upstreamExecutor=t,this.lastDone=n,this.activeChildExecutors=r,this.upstreamDone=s,this.combineChildResults=o,this.combineWithChildResult=i,this.onPull=c}close(t){const n=this.upstreamExecutor.close(t),s=[...this.activeChildExecutors.map(o=>o!==void 0?o.childExecutor.close(t):void 0),n].reduce((o,i)=>o!==void 0&&i!==void 0?rl(o,Ct(i),(c,u)=>Di(c,u)):o!==void 0?o:i!==void 0?Ct(i):void 0,void 0);return s}enqueuePullFromChild(t){return new No(this.upstreamExecutor,this.lastDone,[...this.activeChildExecutors,t],this.upstreamDone,this.combineChildResults,this.combineWithChildResult,this.onPull)}}class gm{constructor(t,n){a(this,"value");a(this,"next");a(this,"_tag",iE);this.value=t,this.next=n}close(t){const n=this.next.close(t);return n}enqueuePullFromChild(t){return this}}const I2="Pulled",C2="NoUpstream",R2=Symbol.for("effect/ChannelUpstreamPullRequest"),F2={_A:e=>e},cE={[R2]:F2},aE=e=>{const t=Object.create(cE);return t._tag=I2,t.value=e,t},P2=e=>{const t=Object.create(cE);return t._tag=C2,t.activeDownstreamCount=e,t};class _s{constructor(t,n,r){a(this,"_activeSubexecutor");a(this,"_cancelled");a(this,"_closeLastSubstream");a(this,"_currentChannel");a(this,"_done");a(this,"_doneStack",[]);a(this,"_emitted");a(this,"_executeCloseLastSubstream");a(this,"_input");a(this,"_inProgressFinalizer");a(this,"_providedEnv");this._currentChannel=t,this._executeCloseLastSubstream=r,this._providedEnv=n}run(){let t;for(;t===void 0;)if(this._cancelled!==void 0)t=this.processCancellation();else if(this._activeSubexecutor!==void 0)t=this.runSubexecutor();else try{if(this._currentChannel===void 0)t=Ao();else if(kr(this._currentChannel))this._currentChannel=tt(this._currentChannel);else switch(this._currentChannel._tag){case Uw:{t=this.runBracketOut(this._currentChannel);break}case qw:{const n=this._currentChannel.input;if(this._currentChannel=this._currentChannel.channel,this._input!==void 0){const r=this._input;this._input=void 0;const s=()=>C(n.awaitRead(),()=>xe(()=>{const o=r.run();switch(o._tag){case Sc:return un(r.getDone(),{onFailure:i=>n.error(i),onSuccess:i=>n.done(i)});case bc:return C(n.emit(r.getEmit()),()=>s());case Mo:return Rn(o.effect,{onFailure:i=>n.error(i),onSuccess:()=>s()});case _c:return Sm(o,()=>s(),i=>n.error(i))}}));t=wc(C(lw(s()),o=>Y(()=>this.addFinalizer(i=>C(Er(o),()=>xe(()=>{const c=this.restorePipe(i,r);return c!==void 0?c:H}))))))}break}case am:{const n=new _s(this._currentChannel.value(),this._providedEnv,s=>Y(()=>{const o=this._closeLastSubstream===void 0?H:this._closeLastSubstream;this._closeLastSubstream=h(o,ke(s))}));n._input=this._input;const r=this._currentChannel;this._activeSubexecutor=new bs(n,s=>r.k(s),void 0,[],(s,o)=>r.combineInners(s,o),(s,o)=>r.combineAll(s,o),s=>r.onPull(s),s=>r.onEmit(s)),this._closeLastSubstream=void 0,this._currentChannel=void 0;break}case jw:{this._emitted=this._currentChannel.out,this._currentChannel=this._activeSubexecutor!==void 0?void 0:mt,t=fm();break}case zw:{this.runEnsuring(this._currentChannel);break}case Bw:{t=this.doneHalt(this._currentChannel.error());break}case um:{this._doneStack.push(this._currentChannel.k),this._currentChannel=this._currentChannel.channel;break}case Ww:{const n=this._providedEnv===void 0?this._currentChannel.effect():h(this._currentChannel.effect(),Ro(this._providedEnv));t=wc(Rn(n,{onFailure:r=>{const s=this.doneHalt(r);return s!==void 0&&ll(s)?s.effect:H},onSuccess:r=>{const s=this.doneSucceed(r);return s!==void 0&&ll(s)?s.effect:H}}));break}case Hw:{const n=this._input,r=new _s(this._currentChannel.left(),this._providedEnv,s=>this._executeCloseLastSubstream(s));r._input=n,this._input=r,this.addFinalizer(s=>{const o=this.restorePipe(s,n);return o!==void 0?o:H}),this._currentChannel=this._currentChannel.right();break}case Vw:{const n=this._providedEnv;this._providedEnv=this._currentChannel.context(),this._currentChannel=this._currentChannel.inner,this.addFinalizer(()=>Y(()=>{this._providedEnv=n}));break}case Jw:{const n=this._currentChannel;t=hm(this._input,R,r=>{try{this._currentChannel=n.more(r)}catch(s){this._currentChannel=n.done.onExit(xh(s))}},r=>{const s=o=>n.done.onExit(o);this._currentChannel=s(r)});break}case Gw:{t=this.doneSucceed(this._currentChannel.evaluate());break}case Qw:{t=this.doneSucceed(this._currentChannel.terminal);break}case Yw:{this._currentChannel=this._currentChannel.channel();break}default:this._currentChannel._tag}}catch(n){this._currentChannel=Ve(Fd(n))}return t}getDone(){return this._done}getEmit(){return this._emitted}cancelWith(t){this._cancelled=t}clearInProgressFinalizer(){this._inProgressFinalizer=void 0}storeInProgressFinalizer(t){this._inProgressFinalizer=t}popAllFinalizers(t){const n=[];let r=this._doneStack.pop();for(;r;)r._tag==="ContinuationFinalizer"&&n.push(r.finalizer),r=this._doneStack.pop();const s=n.length===0?H:ym(n,t);return this.storeInProgressFinalizer(s),s}popNextFinalizers(){const t=[];for(;this._doneStack.length!==0;){const n=this._doneStack[this._doneStack.length-1];if(n._tag===cl)return t;t.push(n),this._doneStack.pop()}return t}restorePipe(t,n){const r=this._input;return this._input=n,r!==void 0?r.close(t):H}close(t){let n;const r=this._inProgressFinalizer;r!==void 0&&(n=h(r,Ir(Y(()=>this.clearInProgressFinalizer()))));let s;const o=this.popAllFinalizers(t);o!==void 0&&(s=h(o,Ir(Y(()=>this.clearInProgressFinalizer()))));const i=this._activeSubexecutor===void 0?void 0:this._activeSubexecutor.close(t);if(!(i===void 0&&n===void 0&&s===void 0))return h(Ct(pm(i)),_w(Ct(pm(n))),_w(Ct(pm(s))),V(([[c,u],f])=>h(c,Di(u),Di(f))),uc,C(c=>xe(()=>c)))}doneSucceed(t){if(this._doneStack.length===0)return this._done=It(t),this._currentChannel=void 0,Ao();const n=this._doneStack[this._doneStack.length-1];if(n._tag===cl){this._doneStack.pop(),this._currentChannel=n.onSuccess(t);return}const r=this.popNextFinalizers();if(this._doneStack.length===0)return this._doneStack=r.reverse(),this._done=It(t),this._currentChannel=void 0,Ao();const s=ym(r.map(i=>i.finalizer),It(t));this.storeInProgressFinalizer(s);const o=h(s,Ir(Y(()=>this.clearInProgressFinalizer())),uc,C(()=>Y(()=>this.doneSucceed(t))));return wc(o)}doneHalt(t){if(this._doneStack.length===0)return this._done=Ye(t),this._currentChannel=void 0,Ao();const n=this._doneStack[this._doneStack.length-1];if(n._tag===cl){this._doneStack.pop(),this._currentChannel=n.onHalt(t);return}const r=this.popNextFinalizers();if(this._doneStack.length===0)return this._doneStack=r.reverse(),this._done=Ye(t),this._currentChannel=void 0,Ao();const s=ym(r.map(i=>i.finalizer),Ye(t));this.storeInProgressFinalizer(s);const o=h(s,Ir(Y(()=>this.clearInProgressFinalizer())),uc,C(()=>Y(()=>this.doneHalt(t))));return wc(o)}processCancellation(){return this._currentChannel=void 0,this._done=this._cancelled,this._cancelled=void 0,Ao()}runBracketOut(t){const n=uc(Rn(this.provide(t.acquire()),{onFailure:r=>Y(()=>{this._currentChannel=Ve(r)}),onSuccess:r=>Y(()=>{this.addFinalizer(s=>this.provide(t.finalizer(r,s))),this._currentChannel=ve(r)})}));return wc(n)}provide(t){return this._providedEnv===void 0?t:h(t,Ro(this._providedEnv))}runEnsuring(t){this.addFinalizer(t.finalizer),this._currentChannel=t.channel}addFinalizer(t){this._doneStack.push(new m2(t))}runSubexecutor(){const t=this._activeSubexecutor;switch(t._tag){case oE:return this.pullFromChild(t.childExecutor,t.parentSubexecutor,t.onEmit,t);case dm:return this.pullFromUpstream(t);case mm:return this.drainChildExecutors(t);case iE:return this._emitted=t.value,this._activeSubexecutor=t.next,fm()}}replaceSubexecutor(t){this._currentChannel=void 0,this._activeSubexecutor=t}finishWithExit(t){const n=un(t,{onFailure:r=>this.doneHalt(r),onSuccess:r=>this.doneSucceed(r)});return this._activeSubexecutor=void 0,n===void 0?H:O2(n)}finishSubexecutorWithCloseEffect(t,...n){this.addFinalizer(()=>h(n,St(s=>h(Y(()=>s(t)),C(o=>o!==void 0?o:H)),{discard:!0})));const r=h(t,un({onFailure:s=>this.doneHalt(s),onSuccess:s=>this.doneSucceed(s)}));return this._activeSubexecutor=void 0,r}applyUpstreamPullStrategy(t,n,r){switch(r._tag){case Lw:{const s=!t||n.some(o=>o!==void 0);return[r.emitSeparator,s?[void 0,...n]:n]}case g2:{const s=!t||n.some(o=>o!==void 0);return[r.emitSeparator,s?[...n,void 0]:n]}}}pullFromChild(t,n,r,s){return hm(t,R,o=>{const i=r(o);switch(i._tag){case Mw:break;case l2:{this.finishWithDoneValue(t,n,i.value);break}case f2:{const c=n.enqueuePullFromChild(s);this.replaceSubexecutor(c);break}}this._activeSubexecutor=new gm(o,this._activeSubexecutor)},un({onFailure:o=>{const i=this.handleSubexecutorFailure(t,n,o);return i===void 0?void 0:sE(i)},onSuccess:o=>{this.finishWithDoneValue(t,n,o)}}))}finishWithDoneValue(t,n,r){const s=n;switch(s._tag){case dm:{const o=new bs(s.upstreamExecutor,s.createChild,s.lastDone!==void 0?s.combineChildResults(s.lastDone,r):r,s.activeChildExecutors,s.combineChildResults,s.combineWithChildResult,s.onPull,s.onEmit);this._closeLastSubstream=t.close(It(r)),this.replaceSubexecutor(o);break}case mm:{const o=new No(s.upstreamExecutor,s.lastDone!==void 0?s.combineChildResults(s.lastDone,r):r,s.activeChildExecutors,s.upstreamDone,s.combineChildResults,s.combineWithChildResult,s.onPull);this._closeLastSubstream=t.close(It(r)),this.replaceSubexecutor(o);break}}}handleSubexecutorFailure(t,n,r){return this.finishSubexecutorWithCloseEffect(Ye(r),s=>n.close(s),s=>t.close(s))}pullFromUpstream(t){if(t.activeChildExecutors.length===0)return this.performPullFromUpstream(t);const n=t.activeChildExecutors[0],r=new bs(t.upstreamExecutor,t.createChild,t.lastDone,t.activeChildExecutors.slice(1),t.combineChildResults,t.combineWithChildResult,t.onPull,t.onEmit);if(n===void 0)return this.performPullFromUpstream(r);this.replaceSubexecutor(new fl(n.childExecutor,r,n.onEmit))}performPullFromUpstream(t){return hm(t.upstreamExecutor,n=>{const r=this._closeLastSubstream===void 0?H:this._closeLastSubstream;return this._closeLastSubstream=void 0,h(this._executeCloseLastSubstream(r),ke(n))},n=>{if(this._closeLastSubstream!==void 0){const i=this._closeLastSubstream;return this._closeLastSubstream=void 0,h(this._executeCloseLastSubstream(i),V(()=>{const c=new _s(t.createChild(n),this._providedEnv,this._executeCloseLastSubstream);c._input=this._input;const[u,f]=this.applyUpstreamPullStrategy(!1,t.activeChildExecutors,t.onPull(aE(n)));this._activeSubexecutor=new fl(c,new bs(t.upstreamExecutor,t.createChild,t.lastDone,f,t.combineChildResults,t.combineWithChildResult,t.onPull,t.onEmit),t.onEmit),q(u)&&(this._activeSubexecutor=new gm(u.value,this._activeSubexecutor))}))}const r=new _s(t.createChild(n),this._providedEnv,this._executeCloseLastSubstream);r._input=this._input;const[s,o]=this.applyUpstreamPullStrategy(!1,t.activeChildExecutors,t.onPull(aE(n)));this._activeSubexecutor=new fl(r,new bs(t.upstreamExecutor,t.createChild,t.lastDone,o,t.combineChildResults,t.combineWithChildResult,t.onPull,t.onEmit),t.onEmit),q(s)&&(this._activeSubexecutor=new gm(s.value,this._activeSubexecutor))},n=>{if(t.activeChildExecutors.some(o=>o!==void 0)){const o=new No(t.upstreamExecutor,t.lastDone,[void 0,...t.activeChildExecutors],t.upstreamExecutor.getDone(),t.combineChildResults,t.combineWithChildResult,t.onPull);if(this._closeLastSubstream!==void 0){const i=this._closeLastSubstream;return this._closeLastSubstream=void 0,h(this._executeCloseLastSubstream(i),V(()=>this.replaceSubexecutor(o)))}this.replaceSubexecutor(o);return}const r=this._closeLastSubstream,s=this.finishSubexecutorWithCloseEffect(h(n,KF(o=>t.combineWithChildResult(t.lastDone,o))),()=>r,o=>t.upstreamExecutor.close(o));return s===void 0?void 0:sE(s)})}drainChildExecutors(t){if(t.activeChildExecutors.length===0){const o=this._closeLastSubstream;return o!==void 0&&this.addFinalizer(()=>oe(o)),this.finishSubexecutorWithCloseEffect(t.upstreamDone,()=>o,i=>t.upstreamExecutor.close(i))}const n=t.activeChildExecutors[0],r=t.activeChildExecutors.slice(1);if(n===void 0){const[o,i]=this.applyUpstreamPullStrategy(!0,r,t.onPull(P2(r.reduce((c,u)=>u!==void 0?c+1:c,0))));return this.replaceSubexecutor(new No(t.upstreamExecutor,t.lastDone,i,t.upstreamDone,t.combineChildResults,t.combineWithChildResult,t.onPull)),q(o)?(this._emitted=o.value,fm()):void 0}const s=new No(t.upstreamExecutor,t.lastDone,r,t.upstreamDone,t.combineChildResults,t.combineWithChildResult,t.onPull);this.replaceSubexecutor(new fl(n.childExecutor,s,n.onEmit))}}const pm=e=>e!==void 0?e:H,ym=(e,t)=>h(St(e,n=>Ct(n(t))),V(n=>h(DF(n),we(()=>pr))),C(n=>xe(()=>n))),Sm=(e,t,n)=>{const r=[e],s=()=>{const o=r.pop();if(o===void 0||o.upstream===void 0)return ID("Unexpected end of input for channel execution");const i=o.upstream.run();switch(i._tag){case bc:{const c=o.onEmit(o.upstream.getEmit());return r.length===0?c===void 0?xe(t):h(c,Rn({onFailure:n,onSuccess:t})):c===void 0?xe(()=>s()):h(c,Rn({onFailure:n,onSuccess:()=>s()}))}case Sc:{const c=o.onDone(o.upstream.getDone());return r.length===0?c===void 0?xe(t):h(c,Rn({onFailure:n,onSuccess:t})):c===void 0?xe(()=>s()):h(c,Rn({onFailure:n,onSuccess:()=>s()}))}case Mo:return r.push(o),h(o.onEffect(i.effect),vr(c=>xe(()=>{const u=o.onDone(Ye(c));return u===void 0?H:u})),Rn({onFailure:n,onSuccess:()=>s()}));case _c:return r.push(o),r.push(i),xe(()=>s())}};return s()},M2=e=>h(uE(e),Co),uE=e=>{const t=(n,r,s)=>uw(Y(()=>new _s(e,void 0,R)),o=>xe(()=>h(hl(o.run(),o),hw(n),ke(Se(n)),nl(Se(r)))),(o,i)=>{const c=o.close(i);return c===void 0?H:dc(c,u=>wr(s,In(u)))});return Io(n=>C(Gd,r=>h(Hd([Ld(r,zi),Ke(),Ke()]),C(([s,o,i])=>h(Cn(n(t(o,i,s))),C(c=>h(wr(r,yt(i,void 0).pipe(ke(CD()))),ke(n(Se(o))),nl(Wx(c)))))))))},hl=(e,t)=>{const n=e;switch(n._tag){case Mo:return h(n.effect,C(()=>hl(t.run(),t)));case bc:return hl(t.run(),t);case Sc:return xe(()=>t.getDone());case _c:return Sm(n,()=>hl(t.run(),t),In)}},A2="Done",N2="Await",x2={[Symbol.for("effect/ChannelMergeDecision")]:{_R:e=>e,_E0:e=>e,_Z0:e=>e,_E:e=>e,_Z:e=>e}},lE=e=>{const t=Object.create(x2);return t._tag=N2,t.f=e,t},fE="BothRunning",hE="LeftDone",dE="RightDone",mE=Symbol.for("effect/ChannelMergeState"),bm={[mE]:mE},_m=(e,t)=>{const n=Object.create(bm);return n._tag=fE,n.left=e,n.right=t,n},gE=e=>{const t=Object.create(bm);return t._tag=hE,t.f=e,t},pE=e=>{const t=Object.create(bm);return t._tag=dE,t.f=e,t},yE="BackPressure",SE="BufferSliding",bE=Symbol.for("effect/ChannelMergeStrategy"),_E={[bE]:bE},D2=e=>{const t=Object.create(_E);return t._tag=yE,t},L2=e=>{const t=Object.create(_E);return t._tag=SE,t},K2=l(2,(e,{onBackPressure:t,onBufferSliding:n})=>{switch(e._tag){case yE:return t();case SE:return n()}}),xo="Empty",Ec="Emit",kc="Error",vc="Done",wE=e=>({_tag:xo,notifyProducer:e}),wm=e=>({_tag:Ec,notifyConsumers:e}),U2=e=>({_tag:kc,cause:e}),q2=e=>({_tag:vc,done:e});class j2{constructor(t){a(this,"ref");this.ref=t}awaitRead(){return ms(ji(this.ref,t=>t._tag===xo?[Se(t.notifyProducer),t]:[H,t]))}get close(){return xD(t=>this.error(T_(t)))}done(t){return ms(ji(this.ref,n=>{switch(n._tag){case xo:return[Se(n.notifyProducer),n];case Ec:return[St(n.notifyConsumers,r=>yt(r,z(t)),{discard:!0}),q2(t)];case kc:return[Oo,n];case vc:return[Oo,n]}}))}emit(t){return C(Ke(),n=>ms(ji(this.ref,r=>{switch(r._tag){case xo:return[Se(r.notifyProducer),r];case Ec:{const s=r.notifyConsumers[0],o=r.notifyConsumers.slice(1);if(s!==void 0)return[yt(s,re(t)),o.length===0?wE(n):wm(o)];throw new Error("Bug: Channel.SingleProducerAsyncInput.emit - Queue was empty! please report an issue at https://github.com/Effect-TS/effect/issues")}case kc:return[Oo,r];case vc:return[Oo,r]}})))}error(t){return ms(ji(this.ref,n=>{switch(n._tag){case xo:return[Se(n.notifyProducer),n];case Ec:return[St(n.notifyConsumers,r=>Ni(r,t),{discard:!0}),U2(t)];case kc:return[Oo,n];case vc:return[Oo,n]}}))}get take(){return this.takeWith(t=>Ye(Pd(t,z)),t=>It(t),t=>gu(re(t)))}takeWith(t,n,r){return C(Ke(),s=>ms(ji(this.ref,o=>{switch(o._tag){case xo:return[ke(yt(o.notifyProducer,void 0),el(Se(s),{onFailure:t,onSuccess:gt({onLeft:r,onRight:n})})),wm([s])];case Ec:return[el(Se(s),{onFailure:t,onSuccess:gt({onLeft:r,onRight:n})}),wm([...o.notifyConsumers,s])];case kc:return[oe(t(o.cause)),o];case vc:return[oe(r(o.done)),o]}})))}}const EE=()=>h(Ke(),C(e=>qi(wE(e))),V(e=>new j2(e))),z2=(e,t,n)=>ie(tt(qi(()=>H)),r=>h(tt(uc(Lt(e,s=>Eu(r,o=>n(s,o))))),ie(t),nE(s=>C(cs(r),o=>o(s))))),dl=l(2,(e,t)=>E2(e,t,()=>{},()=>{})),Em=e=>{const t=nr({onInput:()=>t,onFailure:Ve,onDone:Po});return Kt(e,t)},kE=l(2,(e,t)=>nE(e,()=>t)),B2=e=>ie(e,R),km=e=>fn(e.takeWith(Ve,t=>ie(ve(t),()=>km(e)),Po)),vE=()=>al({onInput:e=>ie(ve(e),()=>vE()),onFailure:yc,onDone:Ss}),$E=l(2,(e,t)=>ie(e,n=>rE(()=>t(n)))),W2=l(2,(e,t)=>H2(e,Pd(t))),H2=l(2,(e,t)=>eE(e,n=>Ve(t(n)))),ml=l(2,(e,t)=>{const n=al({onInput:r=>ie(ve(t(r)),()=>n),onFailure:yc,onDone:Ss});return Kt(e,n)}),V2=l(3,(e,t,n)=>h(de(function*(r){const s=yield*r(Or(im(n),u=>ys(u))),o=yield*r(Ke()),i=n===Number.POSITIVE_INFINITY?u=>R:(yield*r(Yd(n))).withPermits,c=yield*r(Do(e));return yield*r(Rn(c,{onFailure:u=>be(s,In(u)),onSuccess:u=>gt(u,{onLeft:f=>{const d=i(n);return ke(ln(d(H)),Xu(be(s,oe(z(f)))))},onRight:f=>de(function*(d){const m=yield*d(Ke()),p=yield*d(Ke());yield*d(Xu(be(s,V(Se(m),re)))),yield*d(yt(p,void 0),ke(h(Io(g=>h(Ct(g(Se(o))),qD(Ct(g(t(f)))),C(b=>xe(()=>b)))),dc(g=>Ni(o,g)),hw(m))),i(1),Cn),yield*d(Se(p))})})}),zD,ln,Cn),s}),V(r=>{const s=fn(el(ms(pc(r)),{onFailure:Ve,onSuccess:gt({onLeft:Ss,onRight:o=>ie(ve(o),()=>s)})}));return s}),gl)),J2=e=>t=>G2(e)(t,of),G2=({bufferSize:e=16,concurrency:t,mergeStrategy:n=D2()})=>(r,s)=>h(de(function*(o){const i=t==="unbounded"?Number.MAX_SAFE_INTEGER:t,c=yield*o(EE()),u=km(c),f=yield*o(Or(im(e),_=>ys(_))),d=yield*o(Or(gc(),_=>ys(_))),m=yield*o(qi($())),p=yield*o(Ke()),g=(yield*o(Yd(i))).withPermits,b=yield*o(Do(r)),S=_=>h(C(_,gt({onLeft:y=>oe(T(y)),onRight:y=>$r(be(f,oe(re(y))),$())})),mw({until:y=>q(y)}),C(y=>cP(m,ze({onNone:()=>T(y.value),onSome:E=>T(s(E,y.value))}))),vr(y=>O_(y)?In(y):h(be(f,In(y)),ke(yt(p,void 0)),Xu)));return yield*o(Rn(b,{onFailure:_=>h(be(f,In(_)),ke(oe(!1))),onSuccess:gt({onLeft:_=>dw(ln(Se(p)),ln(g(i)(H)),{onSelfDone:(y,E)=>$r(Er(E),!1),onOtherDone:(y,E)=>ke(Er(E),h(cs(m),C(ze({onNone:()=>be(f,oe(z(_))),onSome:O=>be(f,oe(z(s(O,_))))})),$r(!1)))}),onRight:_=>K2(n,{onBackPressure:()=>de(function*(y){const E=yield*y(Ke()),O=h(u,Kt(_),Do,C(J=>Qd(S(J),ln(Se(p)))),Co);return yield*y(yt(E,void 0),ke(O),g(1),Cn),yield*y(Se(E)),!(yield*y(Mh(p)))}),onBufferSliding:()=>de(function*(y){const E=yield*y(Ke()),O=yield*y(Ke()),U=yield*y(c2(d));yield*y(pc(d),C(M=>yt(M,void 0)),UD(()=>U>=i)),yield*y(be(d,E));const J=h(u,Kt(_),Do,C(M=>h(S(M),Qd(ln(Se(p))),Qd(ln(Se(E))))),Co);return yield*y(yt(O,void 0),ke(J),g(1),Cn),yield*y(Se(O)),!(yield*y(Mh(p)))})})})}),mw({while:_=>_}),Cn),[f,c]}),V(([o,i])=>{const c=h(pc(o),ms,el({onFailure:Ve,onSuccess:gt({onLeft:Ss,onRight:u=>ie(ve(u),()=>c)})}),fn);return tE(c,i)}),gl),TE=l(3,(e,t,n)=>J2(n)(ml(e,t))),Q2=l(2,(e,t)=>gl(C(EE(),n=>{const r=km(n);return V(Hd([Do(Kt(r,e)),Do(Kt(r,t.other)),Gd]),([s,o,i])=>{const c=(f,d,m)=>(p,g,b)=>{const S=_=>{const y=_;return y._tag===A2?oe(tt(ke(Er(d),y.effect))):V(Bx(d),un({onFailure:E=>tt(y.f(Ye(E))),onSuccess:gt({onLeft:E=>tt(y.f(It(E))),onRight:E=>yl(ve(E),u(b(y.f)))})}))};return un(f,{onFailure:_=>S(p(Ye(_))),onSuccess:gt({onLeft:_=>S(p(It(_))),onRight:_=>oe(ie(ve(_),()=>ie(tt(lw(m)),y=>u(g(y,d)))))})})},u=f=>{switch(f._tag){case fE:{const d=ln(Y_(f.left)),m=ln(Y_(f.right));return fn(dw(d,m,{onSelfDone:(p,g)=>ke(Er(g),c(p,f.right,s)(t.onSelfDone,_m,b=>gE(b))),onOtherDone:(p,g)=>ke(Er(g),c(p,f.left,o)(t.onOtherDone,(b,S)=>_m(S,b),b=>pE(b)))}))}case hE:return fn(V(Ct(o),un({onFailure:d=>tt(f.f(Ye(d))),onSuccess:gt({onLeft:d=>tt(f.f(It(d))),onRight:d=>ie(ve(d),()=>u(gE(f.f)))})})));case dE:return fn(V(Ct(s),un({onFailure:d=>tt(f.f(Ye(d))),onSuccess:gt({onLeft:d=>tt(f.f(It(d))),onRight:d=>ie(ve(d),()=>u(pE(f.f)))})})))}};return h(tt(rl(lc(s,i),lc(o,i),(f,d)=>_m(f,d))),ie(u),tE(n))})}))),OE=l(2,(e,t)=>lm(()=>{let n;const r=al({onInput:o=>ie(ve(o),()=>r),onFailure:o=>(n=Z2(o),Ve(Fd(n))),onDone:Ss}),s=nr({onInput:o=>h(ve(o),ie(()=>s)),onFailure:o=>$N(o)&&eK(o.defect)&&L(o.defect,n)?yc(o.defect.error):Ve(o),onDone:Ss});return Kt(Kt(Kt(e,r),t),s)})),Y2=e=>M2(Em(e)),IE=e=>fn(Io(t=>V(Bu(),n=>_2(dc(t(oc(e,n)),r=>fs(n,Ye(r))),(r,s)=>fs(n,s))))),Do=e=>V(Or(Y(()=>new _s(e,void 0,R)),(t,n)=>{const r=t.close(n);return r===void 0?H:r}),t=>xe(()=>vm(t.run(),t))),vm=(e,t)=>{const n=e;switch(n._tag){case Sc:return un(t.getDone(),{onFailure:In,onSuccess:r=>oe(z(r))});case bc:return oe(re(t.getEmit()));case Mo:return h(n.effect,C(()=>vm(t.run(),t)));case _c:return Sm(n,()=>vm(t.run(),t),r=>In(r))}},fn=e=>B2(tt(e)),gl=e=>w2(IE(e),(t,n)=>t,(t,n)=>t),pl=e=>CE(0,e.length,e),CE=(e,t,n)=>e===t?mt:h(ve(h(n,ur(e))),ie(()=>CE(e+1,t,n))),X2=l(e=>Zw(e[1]),(e,t,n)=>n!=null&&n.concurrent?Q2(e,{other:t,onSelfDone:r=>lE(s=>xe(()=>$S(r,s))),onOtherDone:r=>lE(s=>xe(()=>$S(s,r)))}):ie(e,r=>$E(t,s=>[r,s]))),yl=l(e=>Zw(e[1]),(e,t,n)=>n!=null&&n.concurrent?$E(X2(e,t,{concurrent:!0}),r=>r[1]):ie(e,()=>t)),$m=Symbol.for("effect/Channel/ChannelException"),Z2=e=>({_tag:"ChannelException",[$m]:$m,error:e}),eK=e=>N(e,$m),tK=Symbol.for("effect/Sink"),nK={_A:e=>e,_In:e=>e,_L:e=>e,_E:e=>e,_R:e=>e};_T=tK;class Sl{constructor(t){a(this,"channel");a(this,_T,nK);this.channel=t}pipe(){return I(this,arguments)}}const rK=()=>new Sl(RE(Me())),RE=e=>nr({onInput:t=>RE(h(e,Be(t))),onFailure:Ve,onDone:()=>Po(e)}),sK=new Sl(Em(vE())),oK=e=>{const t=nr({onInput:n=>h(tt(e(n)),ie(()=>t)),onFailure:Ve,onDone:()=>mt});return new Sl(t)},iK=e=>new Sl(tt(e)),FE=e=>kr(e)?FE(iK(e)):e.channel,cK=qd,PE=yx,aK=(e,t)=>{let n=!1,r=[],s=!1;function o(u){if(n)return!1;if(u.length<=5e4)r.push.apply(r,u);else for(let f=0;f<u.length;f++)r.push(u[0]);return s||(s=!0,t.scheduleTask(i,0)),!0}function i(){s=!1,r.length>0&&(e.unsafeOffer(r),r=[])}function c(u){n||(n=!0,u._tag==="Success"&&r.push(u.value),i(),e.unsafeOffer(u._tag==="Success"?pr:u))}return{single(u){return n?!1:(r.push(u),s||(s=!0,t.scheduleTask(i,0)),!0)},array:o,chunk(u){return o(At(u))},done:c,end(){n||(n=!0,i(),e.unsafeOffer(pr))},halt(u){return c(Ye(u))},fail(u){return c(gu(u))},die(u){return c(xh(u))},dieMessage(u){return c(xh(new Error(u)))}}},uK=Symbol.for("effect/Take"),lK={_A:e=>e,_E:e=>e};wT=uK;class bl{constructor(t){a(this,"exit");a(this,wT,lK);this.exit=t}pipe(){return I(this,arguments)}}const ME=e=>new bl(It(e)),AE=new bl(gu($())),fK=e=>new bl(Ye(h(e,Pd(T)))),hK=e=>new bl(It(Ae(e))),dK=()=>ac($()),mK=e=>Tr(In(e),T),NE=Symbol.for("effect/Stream"),gK={_R:e=>e,_E:e=>e,_A:e=>e};ET=NE;class De{constructor(t){a(this,"channel");a(this,ET,gK);this.channel=t}pipe(){return I(this,arguments)}}const xE=e=>N(e,NE)||kr(e),Tm=4096,pK=e=>{if((e==null?void 0:e.bufferSize)==="unbounded"||(e==null?void 0:e.bufferSize)===void 0&&(e==null?void 0:e.strategy)===void 0)return gc();switch(e==null?void 0:e.strategy){case"sliding":return i2(e.bufferSize??16);default:return o2((e==null?void 0:e.bufferSize)??16)}},yK=(e,t)=>Or(pK(t),ys).pipe(Lt(n=>QD(ZD,r=>e(aK(n,r)))),V(n=>{const r=ie(pc(n),s=>xF(s)?Nh(s)?mt:Ve(s.cause):yl(ve(Jt(s)),r));return r}),gl,KE),SK=l(2,(e,t)=>bK(e,n=>gt(ju(n),{onLeft:t,onRight:EK}))),bK=l(2,(e,t)=>new De(h($e(e),eE(n=>$e(t(n)))))),_K=l(2,(e,t)=>new De(h($e(e),yl($e(t))))),wK=e=>$c(OD(e)),Om=l(2,(e,t)=>new De(h($e(e),kE(t)))),EK=e=>$c(In(e)),kK=l(2,(e,t)=>PK(e,wa(t))),_l=l(e=>xE(e[0]),(e,t,n)=>{const r=(n==null?void 0:n.bufferSize)??16;return n!=null&&n.switch?Im(n==null?void 0:n.concurrency,()=>DE(e,1,r,t),s=>DE(e,s,r,t)):Im(n==null?void 0:n.concurrency,()=>new De(dl($e(e),s=>h(s,Fp(o=>$e(t(o))),RI(mt,(o,i)=>h(o,yl(i)))))),s=>new De(h($e(e),dl(pl),TE(o=>$e(t(o)),n))))}),Im=(e,t,n)=>{switch(e){case void 0:return t();case"unbounded":return n(Number.MAX_SAFE_INTEGER);default:return e>1?n(e):t()}},DE=l(4,(e,t,n,r)=>new De(h($e(e),dl(pl),TE(s=>$e(r(s)),{concurrency:t,mergeStrategy:L2(),bufferSize:n})))),Cm=l(e=>xE(e[0]),(e,t)=>_l(e,R,t)),vK=e=>{const t=nr({onInput:n=>ie(pl(n),()=>t),onFailure:Ve,onDone:()=>mt});return new De(h($e(e),Kt(t)))},$K=e=>{const t=(r,s)=>{const[o,i]=h(r,CI(u=>!Nh(u))),c=h(Cf(i),ze({onNone:()=>s,onSome:un({onFailure:u=>ze(ON(u),{onNone:()=>mt,onSome:Ve}),onSuccess:()=>mt})}));return h(ve(h(o,OI(u=>Nh(u)?T(u.value):$()))),ie(()=>c))},n=nr({onInput:r=>t(r,n),onFailure:r=>Ve(r),onDone:()=>mt});return new De(h($e(e),Kt(n)))},LE=e=>vK($K(h(e,UE(t=>t.exit)))),KE=e=>new De(e),$e=e=>{if("channel"in e)return e.channel;if(kr(e))return $e($c(e));throw new TypeError("Expected a Stream.")},TK=e=>new De(Ea(e)?mt:ve(e)),$c=e=>h(e,Tr(T),OK),OK=e=>new De(fn(BD(e,{onFailure:ze({onNone:()=>mt,onSome:yc}),onSuccess:t=>ve(Ae(t))}))),IK=(e,t)=>{const n=(t==null?void 0:t.maxChunkSize)??Tm;if(t!=null&&t.scoped){const s=V(Pw(e),o=>Tc(o,{maxChunkSize:n,shutdown:!0}));return t.shutdown?V(s,Om(Rw(e))):s}const r=_l(qE(Pw(e)),s=>Tc(s,{maxChunkSize:n}));return t!=null&&t.shutdown?Om(r,Rw(e)):r},CK=e=>jE(()=>Tf(e)?TK(e):RK(e[Symbol.iterator]())),RK=(e,t=Tm)=>h(Y(()=>{let n=[];const r=s=>h(Y(()=>{let o=s.next();if(t===1)return o.done?mt:h(ve(Ae(o.value)),ie(()=>r(s)));n=[];let i=0;for(;o.done===!1&&(n.push(o.value),i=i+1,!(i>=t));)o=s.next();return i>0?h(ve(Jt(n)),ie(()=>r(s))):mt}),fn);return new De(r(e))}),zE),Tc=(e,t)=>h(u2(e,1,(t==null?void 0:t.maxChunkSize)??Tm),vr(n=>h(a2(e),C(r=>r&&O_(n)?dK():mK(n)))),xK,t!=null&&t.shutdown?Om(ys(e)):R),FK=(...e)=>CK(e),UE=l(2,(e,t)=>new De(h($e(e),ml(Fp(t))))),PK=l(2,(e,t)=>new De(h($e(e),ml(t)))),Rm=l(2,(e,t)=>{const n=r=>{const s=r.next();if(s.done)return nr({onInput:o=>n(o[Symbol.iterator]()),onFailure:Ve,onDone:Po});{const o=s.value;return fn(V(t(o),i=>ie(ve(Ae(i)),()=>n(r))))}};return new De(h($e(e),Kt(lm(()=>n(Me()[Symbol.iterator]())))))}),MK=l(3,(e,t,n)=>new De(h($e(e),dl(pl),V2(n,t),ml(Ae)))),AK=l(2,(e,t)=>new De(h($e(e),W2(t)))),NK=l(2,(e,t)=>new De(h($e(e),v2(t)))),xK=e=>jK(e,t=>h(V(t,n=>T([n,t])),Yu(ze({onNone:()=>oe($()),onSome:ac})))),Fm=l(2,(e,t)=>h($e(e),OE(FE(t)),Y2)),DK=e=>h(e,Fm(rK())),LK=e=>h(e,Fm(sK)),KK=l(2,(e,t)=>h(e,Fm(oK(t)))),qE=e=>new De(kE(IE(h(e,V(Ae))),H)),jE=e=>new De(lm(()=>$e(e()))),UK=l(2,(e,t)=>{if(!Number.isInteger(t))return wK(new CN(`${t} must be an integer`));const n=r=>al({onInput:s=>{const o=h(s,ba(Math.min(r,Number.POSITIVE_INFINITY))),i=Math.max(0,r-o.length);return i>0?h(ve(o),ie(()=>n(i))):ve(o)},onFailure:yc,onDone:Po});return new De(h($e(e),OE(0<t?n(t):mt)))}),qK=l(2,(e,t)=>Rm(e,n=>$r(t(n),n))),jK=(e,t)=>jE(()=>{const n=r=>fn(V(t(r),ze({onNone:()=>mt,onSome:([s,o])=>ie(ve(s),()=>n(o))})));return new De(n(e))}),zE=e=>Cm($c(e)),Pm=e=>Cm(qE(e)),zK=(e,t,n)=>yK(r=>Or(Y(()=>e.addEventListener(t,r.single,n)),()=>Y(()=>e.removeEventListener(t,r.single,n))),{bufferSize:typeof n=="object"?n.bufferSize:void 0}),BK=z2,WK=Ve,BE=ie,HK=mt,VK=ve,WE=function(){const e=Symbol.for("effect/Data/Error/plainArgs");return class extends kh{constructor(n){super(n==null?void 0:n.message,n!=null&&n.cause?{cause:n.cause}:void 0),n&&(Object.assign(this,n),Object.defineProperty(this,e,{value:n,enumerable:!1}))}toJSON(){return{...this[e],...this}}}}(),JK=e=>{class t extends WE{constructor(){super(...arguments);a(this,"_tag",e)}}return t.prototype.name=e,t},Mm=Symbol.for("effect/FiberSet"),GK=e=>N(e,Mm),QK={[Mm]:Mm,[Symbol.iterator](){return this.state._tag==="Closed"?DO():this.state.backing[Symbol.iterator]()},toString(){return je(this.toJSON())},toJSON(){return{_id:"FiberMap",state:this.state}},[ge](){return this.toJSON()},pipe(){return I(this,arguments)}},YK=(e,t)=>{const n=Object.create(QK);return n.state={_tag:"Open",backing:e},n.deferred=t,n},HE=()=>Or(V(Ke(),e=>YK(new Set,e)),e=>ke(eU(e),xe(()=>(e.state={_tag:"Closed"},NF(e.deferred,pr))))),VE=-1,JE=D0(VE,0),XK=IN(void 0,{emptyCase:Ps,failCase:Ps,dieCase:Ps,interruptCase:(e,t)=>Qp(x0(t),VE),sequentialCase:(e,t,n)=>t||n,parallelCase:(e,t,n)=>t||n}),ZK=l(e=>GK(e[0]),(e,t,n)=>{if(e.state._tag==="Closed"){t.unsafeInterruptAsFork(Zf((n==null?void 0:n.interruptAs)??fr,JE));return}else if(e.state.backing.has(t))return;t.setFiberRef(XD,$()),e.state.backing.add(t),t.addObserver(r=>{e.state._tag!=="Closed"&&(e.state.backing.delete(t),Ah(r)&&((n==null?void 0:n.propagateInterruption)===!0?!XK(r.cause):!nc(r.cause))&&xi(e.deferred,r))})}),eU=e=>Qu(t=>e.state._tag==="Closed"?H:St(e.state.backing,n=>Hx(n,Zf(t.id(),JE)))),GE=e=>()=>V(Sw(),t=>{const n=cK(t);return(r,s)=>{const o=n(r,s);return ZK(e,o),o}}),QE=e=>Se(e.deferred),YE=Symbol.for("effect/GroupBy"),tU={_R:e=>e,_E:e=>e,_K:e=>e,_V:e=>e},nU=e=>N(e,YE),rU=l(e=>nU(e[0]),(e,t,n)=>_l(e.grouped,([r,s])=>t(r,LE(Tc(s,{shutdown:!0}))),{concurrency:"unbounded",bufferSize:(n==null?void 0:n.bufferSize)??16})),sU=e=>({[YE]:tU,pipe(){return I(this,arguments)},grouped:e}),oU=l(e=>typeof e[0]!="function",(e,t,n)=>n!=null&&n.key?rU(iU(e,n.key,{bufferSize:n.bufferSize}),(r,s)=>Rm(s,t)):Im(n==null?void 0:n.concurrency,()=>Rm(e,t),r=>n!=null&&n.unordered?_l(e,s=>$c(t(s)),{concurrency:r}):MK(e,r,t))),iU=l(e=>typeof e[0]!="function",(e,t,n)=>{const r=(s,o)=>nr({onInput:i=>ie(tt(St(cU(i,t),([c,u])=>{const f=s.get(c);return f===void 0?h(im((n==null?void 0:n.bufferSize)??16),C(d=>h(Y(()=>{s.set(c,d)}),ke(be(o,hK([c,d]))),ke(h(be(d,ME(u)),Vd(m=>nc(m)?T(H):$())))))):Vd(be(f,ME(u)),d=>nc(d)?T(H):$())},{discard:!0})),()=>r(s,o)),onFailure:i=>tt(be(o,fK(i))),onDone:()=>h(tt(h(St(s.entries(),([i,c])=>h(be(c,AE),Vd(u=>nc(u)?T(H):$())),{discard:!0}),ke(be(o,AE)))))});return sU(Pm(h(Y(()=>new Map),C(s=>h(Or(gc(),o=>ys(o)),C(o=>h(e,$e,Kt(r(s,o)),Em,uE,Cn,$r(LE(Tc(o,{shutdown:!0}))))))))))}),cU=l(2,(e,t)=>{const n=[],r=e[Symbol.iterator](),s=new Map;let o;for(;(o=r.next())&&!o.done;){const i=o.value,c=t(i);if(s.has(c))s.get(c).push(i);else{const u=[i];n.push([c,u]),s.set(c,u)}}return Jt(n.map(i=>[i[0],Jt(i[1])]))}),XE=Symbol.for("effect/Pool"),aU={_E:e=>e,_A:e=>e},ZE=e=>xt(t=>w(Ai(),n=>{const r=Mt(n,tr),s=wS(e.acquire,u=>Br(n,u)),o=new fU(s,e.concurrency??1,e.min,e.max,e.strategy,Math.min(Math.max(e.targetUtilization??1,.1),1)),i=Tn(ko(t(o.resize)),u=>r.addFinalizer(()=>Ti(u))),c=Tn(ko(t(e.strategy.run(o))),u=>r.addFinalizer(()=>Ti(u)));return v(o).pipe(es(r.addFinalizer(()=>o.shutdown)),es(i),es(c))})),uU=e=>ZE({...e,min:e.size,max:e.size,strategy:hU()}),lU=e=>w(e.timeToLiveStrategy==="creation"?dU(e.timeToLive):mU(e.timeToLive),t=>ZE({...e,strategy:t}));kT=XE;class fU{constructor(t,n,r,s,o,i){a(this,"acquire");a(this,"concurrency");a(this,"minSize");a(this,"maxSize");a(this,"strategy");a(this,"targetUtilization");a(this,kT);a(this,"isShuttingDown",!1);a(this,"semaphore");a(this,"items",new Set);a(this,"available",new Set);a(this,"invalidated",new Set);a(this,"waiters",0);a(this,"allocate",tu($o(),t=>this.acquire.pipe(ls(t),an,w(n=>{const r={exit:n,finalizer:wi(t.close(n),gU),refCount:0,disableReclaim:!1};return this.items.add(r),this.available.add(r),We(n._tag==="Success"?this.strategy.onAcquire(r):ae(r.finalizer,this.strategy.onAcquire(r)),r)})),(t,n)=>n._tag==="Failure"?t.close(n):W));a(this,"resizeLoop",P(()=>this.activeSize>=this.targetSize?W:this.strategy.reclaim(this).pipe(w(ze({onNone:()=>this.allocate,onSome:v})),ae(this.resizeLoop))));a(this,"resizeSemaphore",ic(1));a(this,"resize",this.resizeSemaphore.withPermits(1)(this.resizeLoop));a(this,"getPoolItem",xt(t=>t(this.semaphore.take(1)).pipe(ae(tr),w(n=>P(()=>(this.waiters++,this.isShuttingDown?He:this.targetSize>this.activeSize?ae(t(this.resize),k(()=>fp(this.available))):v(fp(this.available)))).pipe(tc(k(()=>this.waiters--)),Tn(r=>r.exit._tag==="Failure"?(this.items.delete(r),this.invalidated.delete(r),this.available.delete(r),this.semaphore.release(1)):(r.refCount++,this.available.delete(r),r.refCount<this.concurrency&&this.available.add(r),n.addFinalizer(()=>ae(P(()=>(r.refCount--,this.invalidated.has(r)?this.invalidatePoolItem(r):(this.available.add(r),W))),this.semaphore.release(1))))),fo(()=>this.semaphore.release(1)))))));a(this,"get",w(P(()=>this.isShuttingDown?He:this.getPoolItem),t=>t.exit));this.acquire=t,this.concurrency=n,this.minSize=r,this.maxSize=s,this.strategy=o,this.targetUtilization=i,this[XE]=aU,this.semaphore=ic(n*s)}get currentUsage(){let t=this.waiters;for(const n of this.items)t+=n.refCount;return t}get targetSize(){if(this.isShuttingDown)return 0;const t=this.currentUsage/this.targetUtilization,n=Math.ceil(t/this.concurrency);return Math.min(Math.max(this.minSize,n),this.maxSize)}get activeSize(){return this.items.size-this.invalidated.size}invalidate(t){return P(()=>{if(this.isShuttingDown)return W;for(const n of this.items)if(n.exit._tag==="Success"&&n.exit.value===t)return n.disableReclaim=!0,mr(this.invalidatePoolItem(n));return W})}invalidatePoolItem(t){return P(()=>{if(this.items.has(t)){if(t.refCount===0)return this.items.delete(t),this.available.delete(t),this.invalidated.delete(t),ae(t.finalizer,this.resize)}else return W;return this.invalidated.add(t),this.available.delete(t),W})}get shutdown(){return P(()=>{if(this.isShuttingDown)return W;this.isShuttingDown=!0;const t=this.items.size,n=ic(t);return vi(this.items,r=>r.refCount>0?(r.finalizer=es(r.finalizer,n.release(1)),this.invalidated.add(r),n.take(1)):(this.items.delete(r),this.available.delete(r),this.invalidated.delete(r),r.finalizer)).pipe(ae(this.semaphore.releaseAll),ae(n.take(t)))})}pipe(){return I(this,arguments)}}const hU=()=>({run:e=>W,onAcquire:e=>W,reclaim:e=>ku}),dU=e=>Bh(t=>A(rm(),n=>{const r=ui(e),s=new WeakMap;return R({run:o=>{const i=c=>P(()=>{if(!o.items.has(c)||o.invalidated.has(c))return W;const u=t.unsafeCurrentTimeMillis(),f=s.get(c),d=r-(u-f);return d>0?fb(i(c),d):o.invalidatePoolItem(c)});return n.take.pipe(Tn(i),td)},onAcquire:o=>P(()=>(s.set(o,t.unsafeCurrentTimeMillis()),n.offer(o))),reclaim:o=>ku})})),mU=e=>A(rm(),t=>R({run:n=>{const r=P(()=>n.activeSize-n.targetSize<=0?W:t.take.pipe(Tn(o=>n.invalidatePoolItem(o)),ae(r)));return r.pipe(fb(e),td)},onAcquire:n=>t.offer(n),reclaim(n){return P(()=>{if(n.invalidated.size===0)return ku;const r=MO(LO(n.invalidated,s=>!s.disableReclaim));return r._tag==="None"?ku:(n.invalidated.delete(r.value),r.value.refCount<n.concurrency&&n.available.add(r.value),We(t.offer(r.value),r))})}})),gU=e=>se(t=>{const n=t.getFiberRef(bh);return n._tag==="Some"&&t.log("Unhandled error in pool finalizer",e,n),W}),pU=rL,yU=eL,SU=pU(f_,oN),bU=uU,_U=lU,wU=SK,ek=kK,EU=Cm,kU=KE,vU=Tc,$U=UE,TU=oU,OU=AK,IU=NK,CU=DK,tk=LK,RU=KK,FU=UK,nk=qK,PU=zE,MU=Pm,AU=zK,NU=l(e=>Dn(e[0]),(e,...t)=>{const n={};for(const r of t)r in e&&(n[r]=e[r]);return n}),xU=l(e=>Dn(e[0]),(e,...t)=>{const n={...e};for(const r of t)delete n[r];return n}),Am=Symbol.for("effect/Subscribable"),DU=G_,LU=Symbol.for("effect/SubscriptionRef"),KU={_A:e=>e};IT=Xn,OT=Am,TT=iP,$T=DU,vT=LU;class UU{constructor(t,n,r){a(this,"ref");a(this,"pubsub");a(this,"semaphore");a(this,IT);a(this,OT);a(this,TT,Yh);a(this,$T,Q_);a(this,vT,KU);a(this,"get");this.ref=t,this.pubsub=n,this.semaphore=r,this[Xn]=Xn,this[Am]=Am,this.get=cs(this.ref)}pipe(){return I(this,arguments)}get changes(){return h(cs(this.ref),C(t=>V(IK(this.pubsub,{scoped:!0}),n=>_K(FK(t),n))),this.semaphore.withPermits(1),Pm)}modify(t){return this.modifyEffect(n=>oe(t(n)))}modifyEffect(t){return h(cs(this.ref),C(t),C(([n,r])=>h(Eu(this.ref,r),$r(n),nl(Fw(this.pubsub,r)))),this.semaphore.withPermits(1))}}const qU=e=>cs(e.ref),jU=e=>h(Hd([s2(),qi(e),Yd(1)]),V(([t,n,r])=>new UU(n,t,r))),zU=l(2,(e,t)=>h(Eu(e.ref,t),nl(Fw(e.pubsub,t)),e.semaphore.withPermits(1))),BU=qU,WU=jU,rk=zU,sk=l(2,(e,t)=>h(e.changes,ek(t),FU(1),CU,V(Rf))),ok=(e,t)=>{switch(t._tag){case"StringKeyword":case"TemplateLiteral":return Object.keys(e);case"SymbolKeyword":return Object.getOwnPropertySymbols(e);case"Refinement":return ok(e,t.from)}},hn=e=>Object.keys(e).concat(Object.getOwnPropertySymbols(e)),Nm=e=>{let t=!1,n;return()=>(t||(n=e(),t=!0),n)},dn=e=>{if(Tt(e))return JSON.stringify(e);if(En(e)||e==null||Ur(e)||Yc(e)||jg(e))return String(e);if(Qc(e))return String(e)+"n";if(!vf(e)&&N(e,"toString")&&Ms(e.toString)&&e.toString!==Object.prototype.toString)return e.toString();try{return JSON.stringify(e),vf(e)?`[${e.map(dn).join(",")}]`:`{${hn(e).map(t=>`${Tt(t)?JSON.stringify(t):String(t)}:${dn(e[t])}`).join(",")}}`}catch{return String(e)}},xm=e=>typeof e=="string"?JSON.stringify(e):String(e),ik=e=>Array.isArray(e),HU=e=>!Array.isArray(e),ck=e=>`[${xm(e)}]`,ak=e=>ik(e)?e.map(ck).join(""):ck(e),rr=(e,t,n,r)=>{let s=e;return n&&ye(n)&&(s+=`
at path: ${ak(n)}`),t!==void 0&&(s+=`
details: ${t}`),r&&(s+=`
schema (${r._tag}): ${r}`),s},uk=(e,t,n)=>rr("Unsupported schema",e,t,n),VU=(e,t)=>uk("Cannot build an Equivalence",t,e),lk=(e,t,n)=>rr("Unsupported schema or overlapping types",`cannot extend ${e} with ${t}`,n),wl=e=>uk(void 0,void 0,e),JU=e=>rr("Unsupported key schema",void 0,void 0,e),GU=e=>rr("Unsupported literal",`literal value: ${dn(e)}`),fk=e=>rr("Duplicate index signature",`${e} index signature`),QU=rr("Unsupported index signature parameter","An index signature parameter type must be `string`, `symbol`, a template literal type or a refinement of the previous types"),YU=rr("Invalid element","A required element cannot follow an optional element. ts(1257)"),hk=e=>rr("Duplicate property signature transformation",`Duplicate key ${dn(e)}`),dk=e=>rr("Duplicate property signature",`Duplicate key ${dn(e)}`),mk=Symbol.for("@effect/schema/annotation/Brand"),gk=Symbol.for("@effect/schema/annotation/Type"),pk=Symbol.for("@effect/schema/annotation/Message"),yk=Symbol.for("@effect/schema/annotation/MissingMessage"),El=Symbol.for("@effect/schema/annotation/Identifier"),Ut=Symbol.for("@effect/schema/annotation/Title"),Lo=Symbol.for("@effect/schema/annotation/Description"),XU=Symbol.for("@effect/schema/annotation/Examples"),ZU=Symbol.for("@effect/schema/annotation/Default"),eq=Symbol.for("@effect/schema/annotation/JSONSchema"),tq=Symbol.for("@effect/schema/annotation/Documentation"),Sk=Symbol.for("@effect/schema/annotation/Concurrency"),bk=Symbol.for("@effect/schema/annotation/Batching"),_k=Symbol.for("@effect/schema/annotation/ParseIssueTitle"),wk=Symbol.for("@effect/schema/annotation/ParseOptions"),Ek=Symbol.for("@effect/schema/annotation/DecodingFallback"),Dm=Symbol.for("@effect/schema/annotation/Surrogate"),Rt=l(2,(e,t)=>Object.prototype.hasOwnProperty.call(e.annotations,t)?T(e.annotations[t]):$()),nq=Rt(mk),rq=Rt(pk),sq=Rt(yk),kk=Rt(Ut),vk=Rt(El),oq=Rt(Lo),iq=Rt(Sk),cq=Rt(bk),aq=Rt(_k),uq=Rt(wk),lq=Rt(Ek),Oc=Rt(Dm),$k=Symbol.for("@effect/schema/annotation/JSONIdentifier"),fq=Rt($k);class kl{constructor(t,n,r,s={}){a(this,"typeParameters");a(this,"decodeUnknown");a(this,"encodeUnknown");a(this,"annotations");a(this,"_tag","Declaration");this.typeParameters=t,this.decodeUnknown=n,this.encodeUnknown=r,this.annotations=s}toString(){return we(gn(this),()=>"<declaration schema>")}toJSON(){return{_tag:this._tag,typeParameters:this.typeParameters.map(t=>t.toJSON()),annotations:Ge(this.annotations)}}}const sr=e=>t=>t._tag===e;let vl=class{constructor(t,n={}){a(this,"literal");a(this,"annotations");a(this,"_tag","Literal");this.literal=t,this.annotations=n}toString(){return we(gn(this),()=>dn(this.literal))}toJSON(){return{_tag:this._tag,literal:Qc(this.literal)?String(this.literal):this.literal,annotations:Ge(this.annotations)}}};const $l=sr("Literal"),hq=new vl(null);class dq{constructor(t,n={}){a(this,"symbol");a(this,"annotations");a(this,"_tag","UniqueSymbol");this.symbol=t,this.annotations=n}toString(){return we(gn(this),()=>dn(this.symbol))}toJSON(){return{_tag:this._tag,symbol:String(this.symbol),annotations:Ge(this.annotations)}}}class mq{constructor(t={}){a(this,"annotations");a(this,"_tag","UndefinedKeyword");this.annotations=t}toString(){return Fr(this)}toJSON(){return{_tag:this._tag,annotations:Ge(this.annotations)}}}const Lm=new mq({[Ut]:"undefined"});class gq{constructor(t={}){a(this,"annotations");a(this,"_tag","VoidKeyword");this.annotations=t}toString(){return Fr(this)}toJSON(){return{_tag:this._tag,annotations:Ge(this.annotations)}}}const pq=new gq({[Ut]:"void"});class yq{constructor(t={}){a(this,"annotations");a(this,"_tag","NeverKeyword");this.annotations=t}toString(){return Fr(this)}toJSON(){return{_tag:this._tag,annotations:Ge(this.annotations)}}}const Ic=new yq({[Ut]:"never"});class Sq{constructor(t={}){a(this,"annotations");a(this,"_tag","UnknownKeyword");this.annotations=t}toString(){return Fr(this)}toJSON(){return{_tag:this._tag,annotations:Ge(this.annotations)}}}const Tk=new Sq({[Ut]:"unknown"});class bq{constructor(t={}){a(this,"annotations");a(this,"_tag","AnyKeyword");this.annotations=t}toString(){return Fr(this)}toJSON(){return{_tag:this._tag,annotations:Ge(this.annotations)}}}const Ok=new bq({[Ut]:"any"});class _q{constructor(t={}){a(this,"annotations");a(this,"_tag","StringKeyword");this.annotations=t}toString(){return Fr(this)}toJSON(){return{_tag:this._tag,annotations:Ge(this.annotations)}}}const Km=new _q({[Ut]:"string",[Lo]:"a string"}),Tl=sr("StringKeyword");class wq{constructor(t={}){a(this,"annotations");a(this,"_tag","NumberKeyword");this.annotations=t}toString(){return Fr(this)}toJSON(){return{_tag:this._tag,annotations:Ge(this.annotations)}}}const Um=new wq({[Ut]:"number",[Lo]:"a number"}),qm=sr("NumberKeyword");class Eq{constructor(t={}){a(this,"annotations");a(this,"_tag","BooleanKeyword");this.annotations=t}toString(){return Fr(this)}toJSON(){return{_tag:this._tag,annotations:Ge(this.annotations)}}}const jm=new Eq({[Ut]:"boolean",[Lo]:"a boolean"}),Ik=sr("BooleanKeyword"),zm=sr("SymbolKeyword");let Cc=class{constructor(t,n={}){a(this,"type");a(this,"annotations");this.type=t,this.annotations=n}toJSON(){return{type:this.type.toJSON(),annotations:Ge(this.annotations)}}toString(){return String(this.type)}};class Cr extends Cc{constructor(n,r,s={}){super(n,s);a(this,"isOptional");this.isOptional=r}toJSON(){return{type:this.type.toJSON(),isOptional:this.isOptional,annotations:Ge(this.annotations)}}toString(){return String(this.type)+(this.isOptional?"?":"")}}const Bm=e=>e.map(t=>t.type);class Rc{constructor(t,n,r,s={}){a(this,"elements");a(this,"rest");a(this,"isReadonly");a(this,"annotations");a(this,"_tag","TupleType");this.elements=t,this.rest=n,this.isReadonly=r,this.annotations=s;let o=!1,i=!1;for(const c of t)if(c.isOptional)o=!0;else if(o){i=!0;break}if(i||o&&n.length>1)throw new Error(YU)}toString(){return we(gn(this),()=>kq(this))}toJSON(){return{_tag:this._tag,elements:this.elements.map(t=>t.toJSON()),rest:this.rest.map(t=>t.toJSON()),isReadonly:this.isReadonly,annotations:Ge(this.annotations)}}}const kq=e=>{const t=e.elements.map(String).join(", ");return BO(e.rest,{onEmpty:()=>`readonly [${t}]`,onNonEmpty:(n,r)=>{const s=String(n),o=s.includes(" | ")?`(${s})`:s;if(r.length>0){const i=r.map(String).join(", ");return e.elements.length>0?`readonly [${t}, ...${o}[], ${i}]`:`readonly [...${o}[], ${i}]`}else return e.elements.length>0?`readonly [${t}, ...${o}[]]`:`ReadonlyArray<${s}>`}})};class Te extends Cr{constructor(n,r,s,o,i){super(r,s,i);a(this,"name");a(this,"isReadonly");this.name=n,this.isReadonly=o}toString(){return(this.isReadonly?"readonly ":"")+String(this.name)+(this.isOptional?"?":"")+": "+this.type}toJSON(){return{name:String(this.name),type:this.type.toJSON(),isOptional:this.isOptional,isReadonly:this.isReadonly,annotations:Ge(this.annotations)}}}const Ck=e=>{switch(e._tag){case"StringKeyword":case"SymbolKeyword":case"TemplateLiteral":return!0;case"Refinement":return Ck(e.from)}return!1};class Ko{constructor(t,n,r){a(this,"type");a(this,"isReadonly");a(this,"parameter");if(this.type=n,this.isReadonly=r,Ck(t))this.parameter=t;else throw new Error(QU)}toString(){return(this.isReadonly?"readonly ":"")+`[x: ${this.parameter}]: ${this.type}`}toJSON(){return{parameter:this.parameter.toJSON(),type:this.type.toJSON(),isReadonly:this.isReadonly}}}class mn{constructor(t,n,r={}){a(this,"annotations");a(this,"_tag","TypeLiteral");a(this,"propertySignatures");a(this,"indexSignatures");this.annotations=r;const s={};for(let i=0;i<t.length;i++){const c=t[i].name;if(Object.prototype.hasOwnProperty.call(s,c))throw new Error(dk(c));s[c]=null}const o={string:!1,symbol:!1};for(let i=0;i<n.length;i++){const c=qo(n[i].parameter);if(Tl(c)){if(o.string)throw new Error(fk("string"));o.string=!0}else if(zm(c)){if(o.symbol)throw new Error(fk("symbol"));o.symbol=!0}}this.propertySignatures=jq(t),this.indexSignatures=zq(n)}toString(){return we(gn(this),()=>vq(this))}toJSON(){return{_tag:this._tag,propertySignatures:this.propertySignatures.map(t=>t.toJSON()),indexSignatures:this.indexSignatures.map(t=>t.toJSON()),annotations:Ge(this.annotations)}}}const Rk=e=>e.map(String).join("; "),vq=e=>{if(e.propertySignatures.length>0){const t=e.propertySignatures.map(String).join("; ");return e.indexSignatures.length>0?`{ ${t}; ${Rk(e.indexSignatures)} }`:`{ ${t} }`}else return e.indexSignatures.length>0?`{ ${Rk(e.indexSignatures)} }`:"{}"},Ol=sr("TypeLiteral"),$q=e=>e.filter(t=>t!==Ic),Tq=jr(la(yr,e=>{switch(e._tag){case"AnyKeyword":return 0;case"UnknownKeyword":return 1;case"ObjectKeyword":return 2;case"StringKeyword":case"NumberKeyword":case"BooleanKeyword":case"BigIntKeyword":case"SymbolKeyword":return 3}return 4})),Oq={string:"StringKeyword",number:"NumberKeyword",boolean:"BooleanKeyword",bigint:"BigIntKeyword"},Fk=e=>ya(e,t=>Il(t)?Fk(t.types):[t]),Iq=e=>{const t=Tq(e),n=[],r={},s=[];for(const o of t)switch(o._tag){case"NeverKeyword":break;case"AnyKeyword":return[Ok];case"UnknownKeyword":return[Tk];case"ObjectKeyword":case"UndefinedKeyword":case"VoidKeyword":case"StringKeyword":case"NumberKeyword":case"BooleanKeyword":case"BigIntKeyword":case"SymbolKeyword":{r[o._tag]||(r[o._tag]=o,n.push(o));break}case"Literal":{const i=typeof o.literal;switch(i){case"string":case"number":case"bigint":case"boolean":{const c=Oq[i];!r[c]&&!s.includes(o.literal)&&(s.push(o.literal),n.push(o));break}case"object":{s.includes(o.literal)||(s.push(o.literal),n.push(o));break}}break}case"UniqueSymbol":{!r.SymbolKeyword&&!s.includes(o.symbol)&&(s.push(o.symbol),n.push(o));break}case"TupleType":{r.ObjectKeyword||n.push(o);break}case"TypeLiteral":{o.propertySignatures.length===0&&o.indexSignatures.length===0?r["{}"]||(r["{}"]=o,n.push(o)):r.ObjectKeyword||n.push(o);break}default:n.push(o)}return n};let qt=(Bt=class{constructor(t,n={}){a(this,"types");a(this,"annotations");a(this,"_tag","Union");this.types=t,this.annotations=n}toString(){return we(gn(this),()=>this.types.map(String).join(" | "))}toJSON(){return{_tag:this._tag,types:this.types.map(t=>t.toJSON()),annotations:Ge(this.annotations)}}},a(Bt,"make",(t,n)=>{const r=[],s=new Set;for(let o=0;o<t.length;o++){const i=t[o];i===Ic||s.has(i)||(s.add(i),r.push(i))}return Bt.union(r,n)}),a(Bt,"members",(t,n)=>Bt.union($q(t),n)),a(Bt,"unify",(t,n)=>Bt.union(Iq(Fk(t)),n)),a(Bt,"union",(t,n)=>Wm(t)?new Bt(t,n):t.length===1?t[0]:Ic),Bt);const Cq=(e,t)=>e.map(t),Wm=e=>e.length>1,Il=sr("Union"),Hm=Q(Symbol.for("@effect/schema/AST/toJSONMemoMap"),()=>new WeakMap);class Rr{constructor(t,n={}){a(this,"f");a(this,"annotations");a(this,"_tag","Suspend");this.f=t,this.annotations=n,this.f=Nm(t)}toString(){return gn(this).pipe(fa(()=>ti(CO(this.f)(),t=>gn(t))),we(()=>"<suspended schema>"))}toJSON(){const t=this.f();let n=Hm.get(t);return n||(Hm.set(t,{_tag:this._tag}),n={_tag:this._tag,ast:t.toJSON(),annotations:Ge(this.annotations)},Hm.set(t,n),n)}}let Cl=class{constructor(t,n,r={}){a(this,"from");a(this,"filter");a(this,"annotations");a(this,"_tag","Refinement");this.from=t,this.filter=n,this.annotations=r}toString(){return we(gn(this),()=>`{ ${this.from} | filter }`)}toJSON(){return{_tag:this._tag,from:this.from.toJSON(),annotations:Ge(this.annotations)}}};const Rl=sr("Refinement"),Vm={};let Pn=class{constructor(t,n,r,s={}){a(this,"from");a(this,"to");a(this,"transformation");a(this,"annotations");a(this,"_tag","Transformation");this.from=t,this.to=n,this.transformation=r,this.annotations=s}toString(){return we(gn(this),()=>`(${String(this.from)} <-> ${String(this.to)})`)}toJSON(){return{_tag:this._tag,from:this.from.toJSON(),to:this.to.toJSON(),annotations:Ge(this.annotations)}}};const Rq=sr("Transformation");class Fq{constructor(t,n){a(this,"decode");a(this,"encode");a(this,"_tag","FinalTransformation");this.decode=t,this.encode=n}}const Pq=e=>t=>t._tag===e;class Mq{constructor(){a(this,"_tag","ComposeTransformation")}}const Pk=new Mq;let Aq=class{constructor(t,n,r,s){a(this,"from");a(this,"to");a(this,"decode");a(this,"encode");this.from=t,this.to=n,this.decode=r,this.encode=s}};const Nq=e=>e.decode===R&&e.encode===R;class Fc{constructor(t){a(this,"propertySignatureTransformations");a(this,"_tag","TypeLiteralTransformation");this.propertySignatureTransformations=t;const n={},r={};for(const s of t){const o=s.from;if(n[o])throw new Error(hk(o));n[o]=!0;const i=s.to;if(r[i])throw new Error(hk(i));r[i]=!0}}}const Fl=Pq("TypeLiteralTransformation"),Jm=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e);return n.annotations.value={...e.annotations,...t},Object.create(Object.getPrototypeOf(e),n)},xq=".*",Dq="[+-]?\\d*\\.?\\d+(?:[Ee][+-]?\\d+)?",Mk=e=>{let t=`^${jh(e.head)}`;for(const n of e.spans)Tl(n.type)?t+=xq:qm(n.type)&&(t+=Dq),t+=jh(n.literal);return t+="$",new RegExp(t)},Pl=e=>{switch(e._tag){case"Declaration":{const t=Oc(e);if(q(t))return Pl(t.value);break}case"TypeLiteral":return e.propertySignatures.slice();case"Suspend":return Pl(e.f())}return ws(e).map(t=>Pc(e,t))},Pc=(e,t)=>{switch(e._tag){case"Declaration":{const n=Oc(e);if(q(n))return Pc(n.value,t);break}case"TypeLiteral":{const n=ZO(e.propertySignatures,r=>r.name===t);if(q(n))return n.value;if(Tt(t))for(const r of e.indexSignatures){const s=qo(r.parameter);switch(s._tag){case"TemplateLiteral":{if(Mk(s).test(t))return new Te(t,r.type,!1,!0);break}case"StringKeyword":return new Te(t,r.type,!1,!0)}}else if(Yc(t))for(const r of e.indexSignatures){const s=qo(r.parameter);if(zm(s))return new Te(t,r.type,!1,!0)}break}case"Union":return new Te(t,qt.make(e.types.map(n=>Pc(n,t).type)),!1,!0);case"Suspend":return Pc(e.f(),t)}return new Te(t,Ic,!1,!0)},ws=e=>{switch(e._tag){case"Declaration":{const t=Oc(e);if(q(t))return ws(t.value);break}case"TypeLiteral":return e.propertySignatures.map(t=>t.name);case"Suspend":return ws(e.f());case"Union":return e.types.slice(1).reduce((t,n)=>sI(t,ws(n)),ws(e.types[0]));case"Transformation":return ws(e.to)}return[]},Ak=(e,t)=>{const n=[],r=[],s=o=>{switch(o._tag){case"NeverKeyword":break;case"StringKeyword":case"SymbolKeyword":case"TemplateLiteral":case"Refinement":r.push(new Ko(o,t,!0));break;case"Literal":if(Tt(o.literal)||En(o.literal))n.push(new Te(o.literal,t,!1,!0));else throw new Error(GU(o.literal));break;case"Enums":{for(const[i,c]of o.enums)n.push(new Te(c,t,!1,!0));break}case"UniqueSymbol":n.push(new Te(o.symbol,t,!1,!0));break;case"Union":o.types.forEach(s);break;default:throw new Error(JU(o))}};return s(e),{propertySignatures:n,indexSignatures:r}},Es=(e,t)=>{if(Rq(e))switch(e.transformation._tag){case"ComposeTransformation":return new Pn(Es(e.from,t),Es(e.to,t),Pk);case"TypeLiteralTransformation":{const n=[],r=[];for(const s of t){const o=e.transformation.propertySignatureTransformations.find(i=>i.to===s);o?(n.push(o),r.push(o.from)):r.push(s)}return ye(n)?new Pn(Es(e.from,r),Es(e.to,t),new Fc(n)):Es(e.from,r)}case"FinalTransformation":{const n=Oc(e);if(q(n))return Es(n.value,t);throw new Error(wl(e))}}return new mn(t.map(n=>Pc(e,n)),[])},Lq=(e,t)=>Es(e,ws(e).filter(n=>!t.includes(n))),Gm=e=>qt.make([e,Lm]),Mc=(e,t)=>{switch(e._tag){case"TupleType":return new Rc(e.elements.map(n=>new Cr(Gm(n.type),!0)),zO(e.rest,{onEmpty:()=>e.rest,onNonEmpty:n=>[new Cc(qt.make([...Bm(n),Lm]))]}),e.isReadonly);case"TypeLiteral":return new mn(e.propertySignatures.map(n=>new Te(n.name,Gm(n.type),!0,n.isReadonly,n.annotations)),e.indexSignatures.map(n=>new Ko(n.parameter,Gm(n.type),n.isReadonly)));case"Union":return qt.make(e.types.map(n=>Mc(n)));case"Suspend":return new Rr(()=>Mc(e.f()));case"Declaration":throw new Error(wl(e));case"Refinement":throw new Error(wl(e));case"Transformation":{if(Fl(e.transformation)&&e.transformation.propertySignatureTransformations.every(Nq))return new Pn(Mc(e.from),Mc(e.to),e.transformation);throw new Error(wl(e))}}return e},Uo=e=>{switch(e._tag){case"TupleType":return e.isReadonly===!1?e:new Rc(e.elements,e.rest,!1,e.annotations);case"TypeLiteral":{const t=bt(e.propertySignatures,r=>r.isReadonly===!1?r:new Te(r.name,r.type,r.isOptional,!1,r.annotations)),n=bt(e.indexSignatures,r=>r.isReadonly===!1?r:new Ko(r.parameter,r.type,!1));return t===e.propertySignatures&&n===e.indexSignatures?e:new mn(t,n,e.annotations)}case"Union":{const t=bt(e.types,Uo);return t===e.types?e:qt.make(t,e.annotations)}case"Suspend":return new Rr(()=>Uo(e.f()),e.annotations);case"Refinement":{const t=Uo(e.from);return t===e.from?e:new Cl(t,e.filter,e.annotations)}case"Transformation":{const t=Uo(e.from),n=Uo(e.to);return t===e.from&&n===e.to?e:new Pn(t,n,e.transformation,e.annotations)}}return e},Je=e=>{switch(e._tag){case"Declaration":{const t=bt(e.typeParameters,Je);return t===e.typeParameters?e:new kl(t,e.decodeUnknown,e.encodeUnknown,e.annotations)}case"TupleType":{const t=bt(e.elements,s=>{const o=Je(s.type);return o===s.type?s:new Cr(o,s.isOptional)}),n=Bm(e.rest),r=bt(n,Je);return t===e.elements&&r===n?e:new Rc(t,r.map(s=>new Cc(s)),e.isReadonly,e.annotations)}case"TypeLiteral":{const t=bt(e.propertySignatures,r=>{const s=Je(r.type);return s===r.type?r:new Te(r.name,s,r.isOptional,r.isReadonly)}),n=bt(e.indexSignatures,r=>{const s=Je(r.type);return s===r.type?r:new Ko(r.parameter,s,r.isReadonly)});return t===e.propertySignatures&&n===e.indexSignatures?e:new mn(t,n,e.annotations)}case"Union":{const t=bt(e.types,Je);return t===e.types?e:qt.make(t,e.annotations)}case"Suspend":return new Rr(()=>Je(e.f()),e.annotations);case"Refinement":{const t=Je(e.from);return t===e.from?e:new Cl(t,e.filter,e.annotations)}case"Transformation":return Je(e.to)}return e},Kq=e=>t=>{const n={...t.annotations};for(const r of e)delete n[r];return n},Uq=e=>fa(fq(e),()=>vk(e)),Ml=e=>ze(Uq(e),{onNone:()=>{},onSome:t=>({[$k]:t})});function bt(e,t){let n=!1;const r=da(e.length);for(let s=0;s<e.length;s++){const o=e[s],i=t(o);i!==o&&(n=!0),r[s]=i}return n?r:e}const Mn=(e,t)=>{switch(e._tag){case"Declaration":{const n=bt(e.typeParameters,r=>Mn(r));return n===e.typeParameters?e:new kl(n,e.decodeUnknown,e.encodeUnknown,e.annotations)}case"TupleType":{const n=bt(e.elements,o=>{const i=Mn(o.type);return i===o.type?o:new Cr(i,o.isOptional)}),r=Bm(e.rest),s=bt(r,o=>Mn(o));return n===e.elements&&s===r?e:new Rc(n,s.map(o=>new Cc(o)),e.isReadonly,Ml(e))}case"TypeLiteral":{const n=bt(e.propertySignatures,s=>{const o=Mn(s.type);return o===s.type?s:new Te(s.name,o,s.isOptional,s.isReadonly)}),r=bt(e.indexSignatures,s=>{const o=Mn(s.type);return o===s.type?s:new Ko(s.parameter,o,s.isReadonly)});return n===e.propertySignatures&&r===e.indexSignatures?e:new mn(n,r,Ml(e))}case"Union":{const n=bt(e.types,r=>Mn(r));return n===e.types?e:qt.make(n,Ml(e))}case"Suspend":return new Rr(()=>Mn(e.f()),Ml(e));case"Refinement":return Mn(e.from);case"Transformation":return Mn(e.from)}return e},Nk=e=>Mn(e),Ge=e=>{const t={};for(const n of Object.getOwnPropertySymbols(e))t[String(n)]=e[n];return t},qq=e=>{switch(e._tag){case"NeverKeyword":return 0;case"Literal":case"UndefinedKeyword":case"VoidKeyword":case"UniqueSymbol":return 1;case"BooleanKeyword":return 2;case"StringKeyword":case"NumberKeyword":case"BigIntKeyword":case"SymbolKeyword":return 3;case"ObjectKeyword":return 5;case"UnknownKeyword":case"AnyKeyword":return 6;default:return 4}},jq=jr(la(yr,e=>qq(e.type))),zq=jr(la(yr,e=>{switch(qo(e.parameter)._tag){case"StringKeyword":return 2;case"SymbolKeyword":return 3;case"TemplateLiteral":return 1}})),qo=e=>{switch(e._tag){case"StringKeyword":case"SymbolKeyword":case"TemplateLiteral":return e;case"Refinement":return qo(e.from)}},Bq=(e,t)=>new Pn(e,t,Pk),Fr=e=>we(gn(e),()=>e._tag),gn=e=>vk(e).pipe(fa(()=>kk(e)),fa(()=>oq(e))),Wq=Symbol.for("@effect/schema/TypeId/Int"),Hq=Symbol.for("@effect/schema/TypeId/Between"),Vq=Symbol.for("@effect/schema/TypeId/ParseJson"),Jq=Symbol.for("@effect/schema/ArbitraryHookId"),jt=(e,t=[])=>({value:e,forest:t}),Gq=e=>V(jo(e),t=>Yq(t)),xk=e=>bw(Gq(e)),Qq=e=>xk(e.issue),Yq=e=>e.value+Dk(`
`,e.forest),Dk=(e,t)=>{let n="";const r=t.length;let s;for(let o=0;o<r;o++){s=t[o];const i=o===r-1;n+=e+(i?"":"")+" "+s.value,n+=Dk(e+(r>1&&!i?"  ":"   "),s.forest)}return n},Xq=e=>{switch(e){case"Encoded":return"Encoded side transformation failure";case"Transformation":return"Transformation process failure";case"Type":return"Type side transformation failure"}},Zq=e=>{switch(e){case"From":return"From side refinement failure";case"Predicate":return"Predicate refinement failure"}},Lk=e=>"ast"in e?T(e.ast):$(),ej=e=>Lk(e).pipe(ti(rq),C(t=>{const n=t(e);return Tt(n)?oe({message:n,override:!1}):kr(n)?V(n,r=>({message:r,override:!1})):Tt(n.message)?oe({message:n.message,override:n.override}):V(n.message,r=>({message:r,override:n.override}))})),Qm=e=>t=>t._tag===e,tj=Qm("Composite"),Kk=Qm("Refinement"),Uk=Qm("Transformation"),Ym=e=>ej(e).pipe(C(t=>!t.override&&(tj(e)||Kk(e)&&e.kind==="From"||Uk(e)&&e.kind!=="Transformation")?Uk(e)||Kk(e)?Ym(e.issue):$():oe(t.message))),qk=e=>Lk(e).pipe(ti(aq),lp(t=>ei(t(e)))),nj=e=>Ym(e).pipe(VD(()=>qk(e)),Yu(()=>oe(e.message??`Expected ${String(e.ast)}, actual ${dn(e.actual)}`))),Al=e=>we(qk(e),()=>String(e.ast)),rj=e=>e.message??"is forbidden",sj=e=>e.message??"is unexpected",oj=e=>sq(e.ast).pipe(C(t=>{const n=t();return Tt(n)?oe(n):n}),Yu(()=>oe(e.message??"is missing"))),Xm=(e,t)=>gw(Ym(e),{onFailure:t,onSuccess:n=>oe(jt(n))}),jo=e=>{switch(e._tag){case"Type":return V(nj(e),jt);case"Forbidden":return oe(jt(Al(e),[jt(rj(e))]));case"Unexpected":return oe(jt(sj(e)));case"Missing":return V(oj(e),jt);case"Transformation":return Xm(e,()=>V(jo(e.issue),t=>jt(Al(e),[jt(Xq(e.kind),[t])])));case"Refinement":return Xm(e,()=>V(jo(e.issue),t=>jt(Al(e),[jt(Zq(e.kind),[t])])));case"Pointer":return V(jo(e.issue),t=>jt(ak(e.path),[t]));case"Composite":{const t=Al(e);return Xm(e,()=>ik(e.issues)?V(St(e.issues,jo),n=>jt(t,n)):V(jo(e.issues),n=>jt(t,[n])))}}};class ct{constructor(t,n,r){a(this,"path");a(this,"actual");a(this,"issue");a(this,"_tag","Pointer");this.path=t,this.actual=n,this.issue=r}}class jk{constructor(t,n){a(this,"actual");a(this,"message");a(this,"_tag","Unexpected");this.actual=t,this.message=n}}class Ac{constructor(t,n){a(this,"ast");a(this,"message");a(this,"_tag","Missing");a(this,"actual");this.ast=t,this.message=n}}class Ue{constructor(t,n,r,s){a(this,"ast");a(this,"actual");a(this,"issues");a(this,"output");a(this,"_tag","Composite");this.ast=t,this.actual=n,this.issues=r,this.output=s}}class zk{constructor(t,n,r,s){a(this,"ast");a(this,"actual");a(this,"kind");a(this,"issue");a(this,"_tag","Refinement");this.ast=t,this.actual=n,this.kind=r,this.issue=s}}class Zm{constructor(t,n,r,s){a(this,"ast");a(this,"actual");a(this,"kind");a(this,"issue");a(this,"_tag","Transformation");this.ast=t,this.actual=n,this.kind=r,this.issue=s}}class at{constructor(t,n,r){a(this,"ast");a(this,"actual");a(this,"message");a(this,"_tag","Type");this.ast=t,this.actual=n,this.message=r}}class ij{constructor(t,n,r){a(this,"ast");a(this,"actual");a(this,"message");a(this,"_tag","Forbidden");this.ast=t,this.actual=n,this.message=r}}const Bk=Symbol.for("@effect/schema/ParseErrorTypeId");class cj extends JK("ParseError"){constructor(){super(...arguments);a(this,CT,Bk)}get message(){return this.toString()}toString(){return xk(this.issue)}toJSON(){return{_id:"ParseError",message:this.toString()}}[(CT=Bk,ge)](){return this.toJSON()}}const Nc=e=>new cj({issue:e}),zo=re,Bo=z,Wk=kO,Nl=l(2,(e,t)=>{const n=e;return n._tag==="Left"?n:n._tag==="Right"?t(n.right):C(e,t)}),xl=l(2,(e,t)=>{const n=e;return n._tag==="Left"?n:n._tag==="Right"?re(t(n.right)):V(e,t)}),Wo=l(2,(e,t)=>{const n=e;return n._tag==="Left"?z(t(n.left)):n._tag==="Right"?n:Tr(e,t)}),or=e=>{const t=e;if(t._tag==="Left"||t._tag==="Right")return t},aj=l(2,(e,t)=>{const n=e;return n._tag==="Left"?z(t.onFailure(n.left)):n._tag==="Right"?re(t.onSuccess(n.right)):AD(e,t)}),uj=l(2,(e,t)=>{const n=e;return n._tag==="Left"?t(n.left):n._tag==="Right"?n:Yu(e,t)}),Dl=(e,t)=>t===void 0||En(t)?e:e===void 0?t:{...e,...t},eg=(e,t,n)=>{const r=nt(e,t);return(s,o)=>r(s,Dl(n,o))},tg=(e,t,n)=>{const r=eg(e,t,n);return(s,o)=>$O(r(s,o),Nc)},Hk=(e,t,n)=>{const r=nt(e,t);return(s,o)=>r(s,{...Dl(n,o),isEffectAllowed:!0})},lj=(e,t)=>tg(e.ast,!0,t),fj=(e,t)=>eg(e.ast,!0,t),Ll=(e,t)=>Hk(e.ast,!0,t),hj=(e,t)=>tg(e.ast,!1,t),dj=(e,t)=>eg(e.ast,!1,t),xc=(e,t)=>Hk(e.ast,!1,t),mj=lj,Dc=(e,t)=>tg(Je(e.ast),!0,t),Lc=(e,t)=>{const n=nt(Je(e.ast),!0);return(r,s)=>Ln(n(r,{exact:!0,...Dl(t,s)}))},gj=hj,pj=Q(Symbol.for("@effect/schema/Parser/decodeMemoMap"),()=>new WeakMap),yj=Q(Symbol.for("@effect/schema/Parser/encodeMemoMap"),()=>new WeakMap),nt=(e,t)=>{const n=t?pj:yj,r=n.get(e);if(r)return r;const s=Sj(e,t),o=uq(e),i=q(o)?(f,d)=>s(f,Dl(d,o.value)):s,c=lq(e),u=t&&q(c)?(f,d)=>Uc(uj(i(f,d),c.value),e,f,d):i;return n.set(e,u),u},ng=e=>Kn(iq(e)),rg=e=>Kn(cq(e)),Sj=(e,t)=>{switch(e._tag){case"Refinement":if(t){const n=nt(e.from,!0);return(r,s)=>Uc(Nl(Wo(n(r,s),o=>new zk(e,r,"From",o)),o=>ze(e.filter(o,s??Vm,e),{onNone:()=>re(o),onSome:i=>z(new zk(e,r,"Predicate",i))})),e,r,s)}else{const n=nt(Je(e),!0),r=nt(Jk(e.from),!1);return(s,o)=>Uc(Nl(n(s,o),i=>r(i,o)),e,s,o)}case"Transformation":{const n=_j(e.transformation,t),r=t?nt(e.from,!0):nt(e.to,!1),s=t?nt(e.to,!0):nt(e.from,!1);return(o,i)=>Uc(Nl(Wo(r(o,i),c=>new Zm(e,o,t?"Encoded":"Type",c)),c=>Nl(Wo(n(c,i??Vm,e,o),u=>new Zm(e,o,"Transformation",u)),u=>Wo(s(u,i),f=>new Zm(e,o,t?"Type":"Encoded",f)))),e,o,i)}case"Declaration":{const n=t?e.decodeUnknown(...e.typeParameters):e.encodeUnknown(...e.typeParameters);return(r,s)=>Uc(n(r,s??Vm,e),e,r,s)}case"Literal":return zt(e,n=>n===e.literal);case"UniqueSymbol":return zt(e,n=>n===e.symbol);case"UndefinedKeyword":return zt(e,VT);case"NeverKeyword":return zt(e,JT);case"UnknownKeyword":case"AnyKeyword":case"VoidKeyword":return re;case"StringKeyword":return zt(e,Tt);case"NumberKeyword":return zt(e,En);case"BooleanKeyword":return zt(e,Ur);case"BigIntKeyword":return zt(e,Qc);case"SymbolKeyword":return zt(e,Yc);case"ObjectKeyword":return zt(e,Dn);case"Enums":return zt(e,n=>e.enums.some(([r,s])=>s===n));case"TemplateLiteral":{const n=Mk(e);return zt(e,r=>Tt(r)&&n.test(r))}case"TupleType":{const n=e.elements.map(f=>nt(f.type,t)),r=e.rest.map(f=>nt(f.type,t));let s=e.elements.filter(f=>!f.isOptional);e.rest.length>0&&(s=s.concat(e.rest.slice(1)));const o=s.length,i=e.elements.length>0?e.elements.map((f,d)=>d).join(" | "):"never",c=ng(e),u=rg(e);return(f,d)=>{if(!vf(f))return z(new at(e,f));const m=(d==null?void 0:d.errors)==="all",p=[];let g=0;const b=[],S=f.length;for(let O=S;O<=o-1;O++){const U=new ct(O,f,new Ac(s[O-S]));if(m){p.push([g++,U]);continue}else return z(new Ue(e,f,U,b))}if(e.rest.length===0)for(let O=e.elements.length;O<=S-1;O++){const U=new ct(O,f,new jk(f[O],`is unexpected, expected: ${i}`));if(m){p.push([g++,U]);continue}else return z(new Ue(e,f,U,b))}let _=0,y;for(;_<n.length;_++)if(S<_+1){if(e.elements[_].isOptional)continue}else{const O=n[_],U=O(f[_],d),J=or(U);if(J){if(st(J)){const j=new ct(_,f,J.left);if(m){p.push([g++,j]);continue}else return z(new Ue(e,f,j,pn(b)))}b.push([g++,J.right])}else{const j=g++,M=_;y||(y=[]),y.push(({es:D,output:le})=>C(ds(U),ne=>{if(st(ne)){const X=new ct(M,f,ne.left);return m?(D.push([j,X]),H):z(new Ue(e,f,X,pn(le)))}return le.push([j,ne.right]),H}))}}if(ye(r)){const[O,...U]=r;for(;_<S-U.length;_++){const J=O(f[_],d),j=or(J);if(j)if(st(j)){const M=new ct(_,f,j.left);if(m){p.push([g++,M]);continue}else return z(new Ue(e,f,M,pn(b)))}else b.push([g++,j.right]);else{const M=g++,D=_;y||(y=[]),y.push(({es:le,output:ne})=>C(ds(J),X=>{if(st(X)){const _e=new ct(D,f,X.left);return m?(le.push([M,_e]),H):z(new Ue(e,f,_e,pn(ne)))}else return ne.push([M,X.right]),H}))}}for(let J=0;J<U.length;J++)if(_+=J,!(S<_+1)){const j=U[J](f[_],d),M=or(j);if(M){if(st(M)){const D=new ct(_,f,M.left);if(m){p.push([g++,D]);continue}else return z(new Ue(e,f,D,pn(b)))}b.push([g++,M.right])}else{const D=g++,le=_;y||(y=[]),y.push(({es:ne,output:X})=>C(ds(j),_e=>{if(st(_e)){const rt=new ct(le,f,_e.left);return m?(ne.push([D,rt]),H):z(new Ue(e,f,rt,pn(X)))}return X.push([D,_e.right]),H}))}}}const E=({es:O,output:U})=>ga(O)?z(new Ue(e,f,pn(O),pn(U))):re(pn(U));if(y&&y.length>0){const O=y;return xe(()=>{const U={es:ri(p),output:ri(b)};return C(St(O,J=>J(U),{concurrency:c,batching:u,discard:!0}),()=>E(U))})}return E({output:b,es:p})}}case"TypeLiteral":{if(e.propertySignatures.length===0&&e.indexSignatures.length===0)return zt(e,GT);const n=[],r={},s=[];for(const d of e.propertySignatures)n.push([nt(d.type,t),d]),r[d.name]=null,s.push(d.name);const o=e.indexSignatures.map(d=>[nt(d.parameter,t),nt(d.type,t),d.parameter]),i=qt.make(e.indexSignatures.map(d=>d.parameter).concat(s.map(d=>Yc(d)?new dq(d):new vl(d)))),c=nt(i,t),u=ng(e),f=rg(e);return(d,m)=>{if(!lf(d))return z(new at(e,d));const p=(m==null?void 0:m.errors)==="all",g=[];let b=0;const S=(m==null?void 0:m.onExcessProperty)==="error",_=(m==null?void 0:m.onExcessProperty)==="preserve",y={};let E;if(S||_){E=hn(d);for(const j of E){const M=or(c(j,m));if(st(M))if(S){const D=new ct(j,d,new jk(d[j],`is unexpected, expected: ${String(i)}`));if(p){g.push([b++,D]);continue}else return z(new Ue(e,d,D,y))}else y[j]=d[j]}}let O;const U=(m==null?void 0:m.exact)===!0;for(let j=0;j<n.length;j++){const M=n[j][1],D=M.name,le=Object.prototype.hasOwnProperty.call(d,D);if(!le){if(M.isOptional)continue;if(U){const rt=new ct(D,d,new Ac(M));if(p){g.push([b++,rt]);continue}else return z(new Ue(e,d,rt,y))}}const ne=n[j][0],X=ne(d[D],m),_e=or(X);if(_e){if(st(_e)){const rt=new ct(D,d,le?_e.left:new Ac(M));if(p){g.push([b++,rt]);continue}else return z(new Ue(e,d,rt,y))}y[D]=_e.right}else{const rt=b++,vt=D;O||(O=[]),O.push(({es:bn,output:$t})=>C(ds(X),Xe=>{if(st(Xe)){const _n=new ct(vt,d,le?Xe.left:new Ac(M));return p?(bn.push([rt,_n]),H):z(new Ue(e,d,_n,$t))}return $t[vt]=Xe.right,H}))}}for(let j=0;j<o.length;j++){const M=o[j],D=M[0],le=M[1],ne=ok(d,M[2]);for(const X of ne){const _e=or(D(X,m));if(_e&&Ln(_e)){const rt=le(d[X],m),vt=or(rt);if(vt)if(st(vt)){const bn=new ct(X,d,vt.left);if(p){g.push([b++,bn]);continue}else return z(new Ue(e,d,bn,y))}else Object.prototype.hasOwnProperty.call(r,X)||(y[X]=vt.right);else{const bn=b++,$t=X;O||(O=[]),O.push(({es:Xe,output:_n})=>C(ds(rt),Fs=>{if(st(Fs)){const Dr=new ct($t,d,Fs.left);return p?(Xe.push([bn,Dr]),H):z(new Ue(e,d,Dr,_n))}else return Object.prototype.hasOwnProperty.call(r,X)||(_n[X]=Fs.right),H}))}}}}const J=({es:j,output:M})=>{if(ga(j))return z(new Ue(e,d,pn(j),M));if((m==null?void 0:m.propertyOrder)==="original"){const D=E||hn(d);for(const ne of s)D.indexOf(ne)===-1&&D.push(ne);const le={};for(const ne of D)Object.prototype.hasOwnProperty.call(M,ne)&&(le[ne]=M[ne]);return re(le)}return re(M)};if(O&&O.length>0){const j=O;return xe(()=>{const M={es:ri(g),output:Object.assign({},y)};return C(St(j,D=>D(M),{concurrency:u,batching:f,discard:!0}),()=>J(M))})}return J({es:g,output:y})}}case"Union":{const n=Vk(e.types,t),r=hn(n.keys),s=r.length,o=new Map;for(let u=0;u<e.types.length;u++)o.set(e.types[u],nt(e.types[u],t));const i=ng(e)??1,c=rg(e);return(u,f)=>{const d=[];let m=0,p=[];if(s>0)if(lf(u))for(let S=0;S<s;S++){const _=r[S],y=n.keys[_].buckets;if(Object.prototype.hasOwnProperty.call(u,_)){const E=String(u[_]);if(Object.prototype.hasOwnProperty.call(y,E))p=p.concat(y[E]);else{const O=qt.make(n.keys[_].literals);d.push([m++,new Ue(new mn([new Te(_,O,!1,!0)],[]),u,new ct(_,u,new at(O,u[_])))])}}else{const E=qt.make(n.keys[_].literals),O=new Te(_,E,!1,!0);d.push([m++,new Ue(new mn([O],[]),u,new ct(_,u,new Ac(O)))])}}else d.push([m++,new at(e,u)]);n.otherwise.length>0&&(p=p.concat(n.otherwise));let g;for(let S=0;S<p.length;S++){const _=p[S],y=o.get(_)(u,f),E=!g||g.length===0?or(y):void 0;if(E){if(Ln(E))return re(E.right);d.push([m++,E.left])}else{const O=m++;g||(g=[]),g.push(U=>xe(()=>"finalResult"in U?H:C(ds(y),J=>(Ln(J)?U.finalResult=re(J.right):U.es.push([O,J.left]),H))))}}const b=S=>ga(S)?S.length===1&&S[0][1]._tag==="Type"?z(S[0][1]):z(new Ue(e,u,pn(S))):z(new at(e,u));if(g&&g.length>0){const S=g;return xe(()=>{const _={es:ri(d)};return C(St(S,y=>y(_),{concurrency:i,batching:c,discard:!0}),()=>"finalResult"in _?_.finalResult:b(_.es))})}return b(d)}}case"Suspend":{const n=Nm(()=>nt(Jm(e.f(),e.annotations),t));return(r,s)=>n()(r,s)}}},zt=(e,t)=>n=>t(n)?re(n):z(new at(e,n)),Kc=(e,t)=>{switch(e._tag){case"Declaration":{const n=Oc(e);if(q(n))return Kc(n.value,t);break}case"TypeLiteral":{const n=[];for(let r=0;r<e.propertySignatures.length;r++){const s=e.propertySignatures[r],o=t?Nk(s.type):Je(s.type);$l(o)&&!s.isOptional&&n.push([s.name,o])}return n}case"Refinement":return Kc(e.from,t);case"Suspend":return Kc(e.f(),t);case"Transformation":return Kc(t?e.from:e.to,t)}return[]},Vk=(e,t)=>{const n={},r=[];for(let s=0;s<e.length;s++){const o=e[s],i=Kc(o,t);if(i.length>0)for(let c=0;c<i.length;c++){const[u,f]=i[c],d=String(f.literal);n[u]=n[u]||{buckets:{},literals:[]};const m=n[u].buckets;if(Object.prototype.hasOwnProperty.call(m,d)){if(c<i.length-1)continue;m[d].push(o),n[u].literals.push(f)}else{m[d]=[o],n[u].literals.push(f);break}}else r.push(o)}return{keys:n,otherwise:r}},Jk=e=>Rl(e)?Jk(e.from):e,Uc=(e,t,n,r)=>{const s=or(e);if(s)return s;if((r==null?void 0:r.isEffectAllowed)===!0)return e;try{return bw(ds(e))}catch{return z(new ij(t,n,"cannot be be resolved synchronously, this is caused by using runSync on an effect that performs async work"))}},bj=([e],[t])=>e>t?1:e<t?-1:0;function pn(e){return e.sort(bj).map(t=>t[1])}const _j=(e,t)=>{switch(e._tag){case"FinalTransformation":return t?e.decode:e.encode;case"ComposeTransformation":return re;case"TypeLiteralTransformation":return n=>{let r=re(n);for(const s of e.propertySignatureTransformations){const[o,i]=t?[s.from,s.to]:[s.to,s.from],c=t?s.decode:s.encode;r=xl(r,f=>{const d=c(Object.prototype.hasOwnProperty.call(f,o)?T(f[o]):$());return delete f[o],q(d)&&(f[i]=d.value),f})}return r}}},Gk=Symbol.for("@effect/schema/EquivalenceHookId"),Qk=e=>yn(e.ast,[]),wj=Rt(Gk),yn=(e,t)=>{const n=wj(e);if(q(n))switch(e._tag){case"Declaration":return n.value(...e.typeParameters.map(r=>yn(r,t)));case"Refinement":return n.value(yn(e.from,t));default:return n.value()}switch(e._tag){case"NeverKeyword":throw new Error(VU(e,t));case"Transformation":return yn(e.to,t);case"Declaration":case"Literal":case"StringKeyword":case"TemplateLiteral":case"UniqueSymbol":case"SymbolKeyword":case"UnknownKeyword":case"AnyKeyword":case"NumberKeyword":case"BooleanKeyword":case"BigIntKeyword":case"UndefinedKeyword":case"VoidKeyword":case"Enums":case"ObjectKeyword":return L;case"Refinement":return yn(e.from,t);case"Suspend":{const r=Nm(()=>yn(e.f(),t));return(s,o)=>r()(s,o)}case"TupleType":{const r=e.elements.map((o,i)=>yn(o.type,t.concat(i))),s=e.rest.map(o=>yn(o.type,t));return Kr((o,i)=>{const c=o.length;if(c!==i.length)return!1;let u=0;for(;u<Math.min(c,e.elements.length);u++)if(!r[u](o[u],i[u]))return!1;if(ye(s)){const[f,...d]=s;for(;u<c-d.length;u++)if(!f(o[u],i[u]))return!1;for(let m=0;m<d.length;m++)if(u+=m,!d[m](o[u],i[u]))return!1}return!0})}case"TypeLiteral":{if(e.propertySignatures.length===0&&e.indexSignatures.length===0)return L;const r=e.propertySignatures.map(o=>yn(o.type,t.concat(o.name))),s=e.indexSignatures.map(o=>yn(o.type,t));return Kr((o,i)=>{const c=Object.keys(o),u=Object.getOwnPropertySymbols(o);for(let m=0;m<r.length;m++){const p=e.propertySignatures[m],g=p.name,b=Object.prototype.hasOwnProperty.call(o,g),S=Object.prototype.hasOwnProperty.call(i,g);if(p.isOptional&&b!==S||b&&S&&!r[m](o[g],i[g]))return!1}let f,d;for(let m=0;m<s.length;m++){const p=e.indexSignatures[m],g=qo(p.parameter),b=zm(g);if(b){if(f=f||Object.getOwnPropertySymbols(i),u.length!==f.length)return!1}else if(d=d||Object.keys(i),c.length!==d.length)return!1;const S=b?u:c;for(let _=0;_<S.length;_++){const y=S[_];if(!Object.prototype.hasOwnProperty.call(i,y)||!s[m](o[y],i[y]))return!1}}return!0})}case"Union":{const r=Vk(e.types,!0),s=hn(r.keys),o=s.length;return Kr((i,c)=>{let u=[];if(o>0&&lf(i))for(let d=0;d<o;d++){const m=s[d],p=r.keys[m].buckets;if(Object.prototype.hasOwnProperty.call(i,m)){const g=String(i[m]);Object.prototype.hasOwnProperty.call(p,g)&&(u=u.concat(p[g]))}}r.otherwise.length>0&&(u=u.concat(r.otherwise));const f=u.map(d=>[yn(d,t),Lc({ast:d})]);for(let d=0;d<f.length;d++){const[m,p]=f[d];if(p(i)&&p(c)&&m(i,c))return!0}return!1})}}},Yk=Symbol.for("@effect/schema/Serializable/symbol"),Xk=Symbol.for("@effect/schema/Serializable/symbolResult"),Ej=Symbol.for("@effect/schema/PrettyHookId"),Ho=Symbol.for("@effect/schema/Schema"),ce=e=>{var t,n,r;return n=Ho,t=Ho,r=class{constructor(){a(this,n,sg)}static annotations(o){return ce(An(this.ast,o))}static pipe(){return I(this,arguments)}static toString(){return String(e)}},a(r,"Type"),a(r,"Encoded"),a(r,"Context"),a(r,t,sg),a(r,"ast",e),r},sg={_A:e=>e,_I:e=>e,_R:e=>e},ks=e=>{if(!e)return{};const t={},n=Object.getOwnPropertySymbols(e);for(const s of n)t[s]=e[s];if(e.typeId!==void 0){const s=e.typeId;typeof s=="object"?(t[gk]=s.id,t[s.id]=s.annotation):t[gk]=s}const r=(s,o)=>{e[s]!==void 0&&(t[o]=e[s])};return r("message",pk),r("missingMessage",yk),r("identifier",El),r("title",Ut),r("description",Lo),r("examples",XU),r("default",ZU),r("documentation",tq),r("jsonSchema",eq),r("arbitrary",Jq),r("pretty",Ej),r("equivalence",Gk),r("concurrency",Sk),r("batching",bk),r("parseIssueTitle",_k),r("parseOptions",wk),r("decodingFallback",Ek),t},An=(e,t)=>Jm(e,ks(t)),og=e=>e,ig=e=>String(e.ast),Zk=e=>ce(Nk(e.ast)),qc=e=>ce(Je(e.ast)),ev=(e,t)=>{const n=xc(e,t);return(r,s)=>Wo(n(r,s),Nc)},kj=(e,t)=>{const n=dj(e,t);return(r,s)=>ip(n(r,s),Nc)},cg=ev,vj=kj,tv=(e,t)=>{const n=Ll(e,t);return(r,s)=>Wo(n(r,s),Nc)},$j=(e,t)=>{const n=fj(e,t);return(r,s)=>ip(n(r,s),Nc)},Kl=tv,Tj=$j,Nn=e=>N(e,Ho)&&Dn(e[Ho]),Oj=e=>Wm(e)?qt.make(Cq(e,t=>new vl(t))):new vl(e[0]),nv=(e,t=Oj(e))=>{var n;return n=class extends ce(t){static annotations(s){return nv(this.literals,An(this.ast,s))}},a(n,"literals",[...e]),n};function me(...e){return ye(e)?nv(e):sv}const Ij=(e,t,n)=>ce(new kl(e.map(r=>r.ast),(...r)=>t.decode(...r.map(ce)),(...r)=>t.encode(...r.map(ce)),ks(n))),Cj=(e,t)=>{const n=()=>(s,o,i)=>e(s)?zo(s):Bo(new at(i,s)),r=n;return ce(new kl([],n,r,ks(t)))},Vo=function(){if(Array.isArray(arguments[0])){const n=arguments[0],r=arguments[1],s=arguments[2];return Ij(n,r,s)}const e=arguments[0],t=arguments[1];return Cj(e,t)};class Rj extends ce(Lm){}class vs extends ce(pq){}class rv extends ce(hq){}class sv extends ce(Ic){}class Ul extends ce(Tk){}class _t extends ce(Ok){}class K extends ce(Km){}class Le extends ce(Um){}class Ft extends ce(jm){}const Fj=e=>qt.members(e.map(t=>t.ast)),ov=(e,t=Fj(e))=>{var n;return n=class extends ce(t){static annotations(s){return ov(this.members,An(this.ast,s))}},a(n,"members",[...e]),n};function Oe(...e){return Wm(e)?ov(e):ye(e)?e[0]:sv}const iv=e=>Oe(e,rv),ql=e=>Oe(e,Rj),Pj=(e,t)=>new Rc(e.map(n=>Nn(n)?new Cr(n.ast,!1):n.ast),t.map(n=>Nn(n)?new Cc(n.ast):n.ast),!0),jl=(e,t,n=Pj(e,t))=>{var r;return r=class extends ce(n){static annotations(o){return jl(this.elements,this.rest,An(this.ast,o))}},a(r,"elements",[...e]),a(r,"rest",[...t]),r};function Mj(...e){return Array.isArray(e[0])?jl(e[0],e.slice(1)):jl(e,[])}const cv=(e,t)=>{var n;return n=class extends jl([],[e],t){static annotations(s){return cv(this.value,An(this.ast,s))}},a(n,"value",e),n},wt=e=>cv(e),ag=e=>e?'"?:"':'":"';class zl extends Cr{constructor(n,r,s,o,i){super(n,r,o);a(this,"isReadonly");a(this,"defaultValue");a(this,"_tag","PropertySignatureDeclaration");this.isReadonly=s,this.defaultValue=i}toString(){const n=ag(this.isOptional),r=String(this.type);return`PropertySignature<${n}, ${r}, never, ${n}, ${r}>`}}class Aj extends Cr{constructor(n,r,s,o,i){super(n,r,o);a(this,"isReadonly");a(this,"fromKey");this.isReadonly=s,this.fromKey=i}}class av extends Cr{constructor(n,r,s,o,i){super(n,r,o);a(this,"isReadonly");a(this,"defaultValue");this.isReadonly=s,this.defaultValue=i}}const Nj=e=>e===void 0?"never":Tt(e)?JSON.stringify(e):String(e);class uv{constructor(t,n,r,s){a(this,"from");a(this,"to");a(this,"decode");a(this,"encode");a(this,"_tag","PropertySignatureTransformation");this.from=t,this.to=n,this.decode=r,this.encode=s}toString(){return`PropertySignature<${ag(this.to.isOptional)}, ${this.to.type}, ${Nj(this.from.fromKey)}, ${ag(this.from.isOptional)}, ${this.from.type}>`}}const lv=(e,t)=>{switch(e._tag){case"PropertySignatureDeclaration":return new zl(e.type,e.isOptional,e.isReadonly,{...e.annotations,...t},e.defaultValue);case"PropertySignatureTransformation":return new uv(new Aj(e.from.type,e.from.isOptional,e.from.isReadonly,e.from.annotations),new av(e.to.type,e.to.isOptional,e.to.isReadonly,{...e.to.annotations,...t},e.to.defaultValue),e.decode,e.encode)}},fv=Symbol.for("@effect/schema/PropertySignature"),ug=e=>N(e,fv);FT=Ho,RT=fv;const Ng=class Ng{constructor(t){a(this,"ast");a(this,FT);a(this,RT,null);a(this,"_TypeToken");a(this,"_Key");a(this,"_EncodedToken");a(this,"_HasDefault");this.ast=t}pipe(){return I(this,arguments)}annotations(t){return new Ng(lv(this.ast,ks(t)))}toString(){return String(this.ast)}};let Bl=Ng;const hv=e=>new Bl(e);class Wl extends Bl{constructor(n,r){super(n);a(this,"from");this.from=r}annotations(n){return new Wl(lv(this.ast,ks(n)),this.from)}}const dv=e=>new Wl(new zl(e.ast,!1,!0,{},void 0),e),mv=l(2,(e,t)=>{const n=e.ast;switch(n._tag){case"PropertySignatureDeclaration":return hv(new zl(n.type,n.isOptional,n.isReadonly,n.annotations,t));case"PropertySignatureTransformation":return hv(new uv(n.from,new av(n.to.type,n.to.isOptional,n.to.isReadonly,n.to.annotations,t),n.decode,n.encode))}}),Pr=e=>new Wl(new zl(ql(e).ast,!0,!0,{},void 0),e),xj=(e,t)=>{const n=hn(e),r=[];if(n.length>0){const o=[],i=[],c=[];for(let u=0;u<n.length;u++){const f=n[u],d=e[f];if(ug(d)){const m=d.ast;switch(m._tag){case"PropertySignatureDeclaration":{const p=m.type,g=m.isOptional,b=m.annotations;o.push(new Te(f,p,g,!0)),i.push(new Te(f,Je(p),g,!0,b)),r.push(new Te(f,p,g,!0,b));break}case"PropertySignatureTransformation":{const p=m.from.fromKey??f;o.push(new Te(p,m.from.type,m.from.isOptional,!0,m.from.annotations)),i.push(new Te(f,m.to.type,m.to.isOptional,!0,m.to.annotations)),c.push(new Aq(p,f,m.decode,m.encode));break}}}else o.push(new Te(f,d.ast,!1,!0)),i.push(new Te(f,Je(d.ast),!1,!0)),r.push(new Te(f,d.ast,!1,!0))}if(ye(c)){const u=[],f=[];for(const d of t){const{indexSignatures:m,propertySignatures:p}=Ak(d.key.ast,d.value.ast);p.forEach(g=>{o.push(g),i.push(new Te(g.name,Je(g.type),g.isOptional,g.isReadonly,g.annotations))}),m.forEach(g=>{u.push(g),f.push(new Ko(g.parameter,Je(g.type),g.isReadonly))})}return new Pn(new mn(o,u,{[Ut]:"Struct (Encoded side)"}),new mn(i,f,{[Ut]:"Struct (Type side)"}),new Fc(c))}}const s=[];for(const o of t){const{indexSignatures:i,propertySignatures:c}=Ak(o.key.ast,o.value.ast);c.forEach(u=>r.push(u)),i.forEach(u=>s.push(u))}return new mn(r,s)},gv=(e,t)=>{const n=hn(e);for(const r of n){const s=e[r];if(t[r]===void 0&&ug(s)){const o=s.ast,i=o._tag==="PropertySignatureDeclaration"?o.defaultValue:o.to.defaultValue;i!==void 0&&(t[r]=i())}}return t},lg=(e,t,n=xj(e,t))=>{var r;return r=class extends ce(n){static annotations(o){return lg(this.fields,this.records,An(this.ast,o))}static pick(...o){return x(NU(e,...o))}static omit(...o){return x(xU(e,...o))}},a(r,"fields",{...e}),a(r,"records",[...t]),a(r,"make",(o,i)=>{const c=gv(e,{...o});return Jl(i)?c:Dc(r)(c)}),r};function x(e,...t){return lg(e,t)}const Dj=e=>me(e).pipe(dv,mv(()=>e)),Et=(e,t)=>x({_tag:Dj(e),...t}),pv=(e,t,n)=>{var r;return r=class extends lg({},[{key:e,value:t}],n){static annotations(o){return pv(e,t,An(this.ast,o))}},a(r,"key",e),a(r,"value",t),r},Hl=e=>pv(e.key,e.value),Lj=(...e)=>t=>ce(Lq(t.ast,e)),yv=e=>{var t;return t=class extends ce(e){static annotations(r){return yv(An(this.ast,r))}},a(t,"make",(r,s)=>Jl(s)?r:Dc(t)(r)),t},Kj=(e,t)=>n=>{const r=ze(nq(n.ast),{onNone:()=>[e],onSome:o=>[...o,e]}),s=Jm(n.ast,ks({title:String(n.ast)+` & Brand<${dn(e)}>`,...t,[mk]:r}));return yv(s)},Vl=e=>ce(Mc(e.ast)),Uj=e=>ce(Uo(e.ast)),$s=(e,t,n)=>{if(Ol(e)&&Ol(t)){const r=[...e.propertySignatures];for(const s of t.propertySignatures){const o=s.name,i=r.findIndex(c=>c.name===o);if(i===-1)r.push(s);else{const{isOptional:c,type:u}=r[i];r[i]=new Te(o,jc(u,s.type,n.concat(o)),c,!0)}}return new mn(r,e.indexSignatures.concat(t.indexSignatures))}throw new Error(lk(e,t,n))},qj=Kq([El]),Jo=(e,t)=>t.map(n=>new Cl(n,e.filter,qj(e))),jc=(e,t,n)=>qt.make(xn([e],[t],n)),Mr=e=>Il(e)?e.types:[e],xn=(e,t,n)=>ya(e,r=>ya(t,s=>{switch(s._tag){case"Literal":{if(Tt(s.literal)&&Tl(r)||En(s.literal)&&qm(r)||Ur(s.literal)&&Ik(r))return[s];break}case"StringKeyword":{if(s===Km){if(Tl(r)||$l(r)&&Tt(r.literal))return[r];if(Rl(r))return Jo(r,xn(Mr(r.from),[s],n))}else if(r===Km)return[s];break}case"NumberKeyword":{if(s===Um){if(qm(r)||$l(r)&&En(r.literal))return[r];if(Rl(r))return Jo(r,xn(Mr(r.from),[s],n))}else if(r===Um)return[s];break}case"BooleanKeyword":{if(s===jm){if(Ik(r)||$l(r)&&Ur(r.literal))return[r];if(Rl(r))return Jo(r,xn(Mr(r.from),[s],n))}else if(r===jm)return[s];break}case"Union":return xn(Mr(r),s.types,n);case"Suspend":return[new Rr(()=>jc(r,s.f(),n))];case"Refinement":return Jo(s,xn(Mr(r),Mr(s.from),n));case"TypeLiteral":{switch(r._tag){case"Union":return xn(r.types,[s],n);case"Suspend":return[new Rr(()=>jc(r.f(),s,n))];case"Refinement":return Jo(r,xn(Mr(r.from),[s],n));case"TypeLiteral":return[$s(r,s,n)];case"Transformation":{if(Fl(r.transformation))return[new Pn($s(r.from,s,n),$s(r.to,Je(s),n),new Fc(r.transformation.propertySignatureTransformations))];break}}break}case"Transformation":{if(Fl(s.transformation))switch(r._tag){case"Union":return xn(r.types,[s],n);case"Suspend":return[new Rr(()=>jc(r.f(),s,n))];case"Refinement":return Jo(r,xn(Mr(r.from),[s],n));case"TypeLiteral":return[new Pn($s(r,s.from,n),$s(Je(r),s.to,n),new Fc(s.transformation.propertySignatureTransformations))];case"Transformation":if(Fl(r.transformation))return[new Pn($s(r.from,s.from,n),$s(r.to,s.to,n),new Fc(s.transformation.propertySignatureTransformations.concat(r.transformation.propertySignatureTransformations)))];break}break}}throw new Error(lk(r,s,n))})),fg=l(2,(e,t)=>ce(jc(e.ast,t.ast,[]))),jj=l(e=>Nn(e[1]),(e,t)=>ce(Bq(e.ast,t.ast))),hg=e=>ce(new Rr(()=>e().ast)),Sv=Symbol.for("@effect/schema/refine"),bv=(e,t,n)=>{var r,s,o;return o=class extends(s=ce(n),r=Sv,s){static annotations(c){return bv(this.from,this.filter,An(this.ast,c))}},a(o,r,e),a(o,"from",e),a(o,"filter",t),a(o,"make",(c,u)=>Jl(u)?c:Dc(o)(c)),o},_v=(e,t,n)=>{if(Ur(e))return e?$():T(new at(t,n));if(Tt(e))return T(new at(t,n,e));if(e!==void 0){if("_tag"in e)return T(e);const r=new at(t,n,e.message);return T(ye(e.path)?new ct(e.path,n,r):r)}return $()},zj=(e,t,n)=>{if(HU(e))return _v(e,t,n);if(ye(e)){const r=_p(e,s=>_v(s,t,n));if(ye(r))return T(r.length===1?r[0]:new Ue(t,n,r))}return $()};function wv(e,t){return n=>{function r(o,i,c){return zj(e(o,i,c),c,o)}const s=new Cl(n.ast,r,ks(t));return bv(n,r,s)}}const Ev=(e,t,n)=>{var r;return r=class extends ce(n){static annotations(o){return Ev(this.from,this.to,An(this.ast,o))}},a(r,"from",e),a(r,"to",t),r},zc=l(e=>Nn(e[0])&&Nn(e[1]),(e,t,n)=>Ev(e,t,new Pn(e.ast,t.ast,new Fq(n.decode,n.encode)))),Ar=l(e=>Nn(e[0])&&Nn(e[1]),(e,t,n)=>zc(e,t,{strict:!0,decode:(r,s,o,i)=>zo(n.decode(r,i)),encode:(r,s,o,i)=>zo(n.encode(r,i))})),Bj=K.annotations({[El]:"JsonString",[Ut]:"JsonString",[Lo]:"a JSON string"}),Wj=e=>zc(Bj,Ul,{strict:!0,decode:(t,n,r)=>Wk({try:()=>JSON.parse(t,e==null?void 0:e.reviver),catch:s=>new at(r,t,s.message)}),encode:(t,n,r)=>Wk({try:()=>JSON.stringify(t,e==null?void 0:e.replacer,e==null?void 0:e.space),catch:s=>new at(r,t,s.message)})}).annotations({typeId:Vq}),kv=(e,t)=>Nn(e)?jj(kv(t),e):Wj(e),Hj=Wq,Vj=e=>t=>t.pipe(wv(n=>Number.isSafeInteger(n),{typeId:Hj,title:"integer",description:"an integer",jsonSchema:{type:"integer"},...e})),Jj=Hq,Gj=(e,t,n)=>r=>r.pipe(wv(s=>s>=e&&s<=t,{typeId:Jj,description:`a number between ${e} and ${t}`,jsonSchema:{maximum:t,minimum:e},...n}));class vv extends Le.pipe(Vj({identifier:"Int",title:"Int"})){}const $v=(e,t,n,r)=>aj(e,{onFailure:s=>new Ue(n,r,s),onSuccess:t}),dg=Vo(QT,{identifier:"Uint8ArrayFromSelf",pretty:()=>e=>`new Uint8Array(${JSON.stringify(Array.from(e))})`,arbitrary:()=>e=>e.uint8Array(),equivalence:()=>si(L)}),Qj=Ar(wt(Le.pipe(Gj(0,255,{title:"8-bit unsigned integer",description:"a 8-bit unsigned integer"}))).annotations({description:"an array of 8-bit unsigned integers"}),dg,{strict:!0,decode:e=>Uint8Array.from(e),encode:e=>Array.from(e)}).annotations({identifier:"Uint8Array"});class Yj extends Vo(jg,{identifier:"DateFromSelf",description:"a potentially invalid Date instance",pretty:()=>t=>`new Date(${JSON.stringify(t)})`,arbitrary:()=>t=>t.date({noInvalidDate:!1}),equivalence:()=>qT}){}const Xj=e=>t=>t.array(e(t)).map(n=>new Set(n)),Zj=e=>t=>`new Set([${Array.from(t.values()).map(n=>e(n)).join(", ")}])`,ez=e=>{const t=si(e);return Kr((n,r)=>t(Array.from(n.values()),Array.from(r.values())))},Tv=e=>(t,n,r)=>HT(t)?$v(e(Array.from(t.values()),n),s=>new Set(s),r,t):Bo(new at(r,t)),tz=(e,t)=>Vo([e],{decode:n=>Tv(Ll(wt(n))),encode:n=>Tv(xc(wt(n)))},{description:t,pretty:Zj,arbitrary:Xj,equivalence:ez}),nz=e=>tz(e,`ReadonlySet<${ig(e)}>`),mg=e=>{const t=og(e);return Ar(wt(t),nz(qc(t)),{strict:!0,decode:n=>new Set(n),encode:n=>Array.from(n)})},rz=e=>Nn(e)||ug(e),Ov=e=>hn(e).every(t=>rz(e[t])),gg=e=>"fields"in e?e.fields:gg(e[Sv]),Iv=e=>Ov(e)?x(e):Nn(e)?e:x(gg(e)),Cv=e=>Ov(e)?e:gg(e),Rv=e=>mv(dv(me(e)),()=>e),Ts=e=>(t,n,r)=>{var f;class s extends WE{}s.prototype.name=t;const o=Cv(n),i=Iv(n),c={_tag:Rv(t)},u=Bc(c,o);return f=class extends Wc({kind:"TaggedError",identifier:t,schema:fg(i,x(c)),fields:u,Base:s,annotations:r,disableToString:!0}){get message(){return`{ ${hn(o).map(m=>`${xm(m)}: ${dn(this[m])}`).join(", ")} }`}},a(f,"_tag",t),f},Pt=e=>(t,n,r)=>{var o;const s=Bc({_tag:Rv(t)},n.payload);return o=class extends Wc({kind:"TaggedRequest",identifier:t,schema:x(s),fields:s,Base:TD,annotations:r}){get[Yk](){return this.constructor}get[Xk](){return{failure:n.failure,success:n.success}}},a(o,"_tag",t),a(o,"success",n.success),a(o,"failure",n.failure),o},Bc=(e,t)=>{const n={...e};for(const r of hn(t)){if(r in e)throw new Error(dk(r));n[r]=t[r]}return n},pg=(e,t)=>{const n=kk(e.ast);return pe(n)?e.annotations({title:t}):e},Jl=e=>Ur(e)?e:(e==null?void 0:e.disableValidation)??!1,Wc=({Base:e,annotations:t,disableToString:n,fields:r,identifier:s,kind:o,schema:i})=>{var g,b;const c=Symbol.for(`@effect/schema/${o}/${s}`),u=pg(i,`${s} (Constructor)`),f=pg(i,`${s} (Encoded side)`),d=pg(qc(i),`${s} (Type side)`),m=S=>N(S,c)&&Lc(d)(S),p=(b=class extends e{constructor(S={},_=!1){S={...S},o!=="Class"&&delete S._tag,S=gv(r,S),Jl(_)||(S=Dc(u)(S)),super(S,!0)}static get ast(){const S=Vo([d],{decode:()=>(y,E,O)=>y instanceof this||m(y)?zo(y):Bo(new at(O,y)),encode:()=>(y,E)=>y instanceof this?zo(y):xl(xc(d)(y,E),O=>new this(O,!0))},{identifier:s,title:s,description:`an instance of ${s}`,pretty:y=>E=>`${s}(${y(E)})`,arbitrary:y=>E=>y(E).map(O=>new this(O)),equivalence:R,[Dm]:d.ast,...t});return Ar(f,S,{strict:!0,decode:y=>new this(y,!0),encode:R}).annotations({[Dm]:i.ast}).ast}static pipe(){return I(this,arguments)}static annotations(S){return ce(this.ast).annotations(S)}static toString(){return`(${String(f)} <-> ${s})`}static make(...S){return new this(...S)}static extend(S){return(_,y)=>{const E=Cv(_),O=Iv(_),U=Bc(r,E);return Wc({kind:o,identifier:S,schema:fg(i,O),fields:U,Base:this,annotations:y})}}static transformOrFail(S){return(_,y,E)=>{const O=Bc(r,_);return Wc({kind:o,identifier:S,schema:zc(i,qc(x(O)),y),fields:O,Base:this,annotations:E})}}static transformOrFailFrom(S){return(_,y,E)=>{const O=Bc(r,_);return Wc({kind:o,identifier:S,schema:zc(Zk(i),x(O),y),fields:O,Base:this,annotations:E})}}get[(g=Ho,c)](){return c}},a(b,g,sg),a(b,"fields",{...r}),a(b,"identifier",s),b);return n!==!0&&Object.defineProperty(p.prototype,"toString",{value(){return`${s}({ ${hn(r).map(S=>`${xm(S)}: ${dn(this[S])}`).join(", ")} })`},configurable:!0}),p},yg=Oe(x({_tag:me("None")}).annotations({identifier:"FiberIdNoneEncoded"}),x({_tag:me("Runtime"),id:vv.annotations({title:"id",description:"id"}),startTimeMillis:vv.annotations({title:"startTimeMillis",description:"startTimeMillis"})}).annotations({identifier:"FiberIdRuntimeEncoded"}),x({_tag:me("Composite"),left:hg(()=>yg),right:hg(()=>yg)}).annotations({identifier:"FiberIdCompositeEncoded"})).annotations({identifier:"FiberIdEncoded"}),sz=e=>e.letrec(t=>({None:e.record({_tag:e.constant("None")}),Runtime:e.record({_tag:e.constant("Runtime"),id:e.integer(),startTimeMillis:e.integer()}),Composite:e.record({_tag:e.constant("Composite"),left:t("FiberId"),right:t("FiberId")}),FiberId:e.oneof(t("None"),t("Runtime"),t("Composite"))})).FiberId.map(Gl),Sg=e=>{switch(e._tag){case"None":return"FiberId.none";case"Runtime":return`FiberId.runtime(${e.id}, ${e.startTimeMillis})`;case"Composite":return`FiberId.composite(${Sg(e.right)}, ${Sg(e.left)})`}},Gl=e=>{switch(e._tag){case"None":return fr;case"Runtime":return A0(e.id,e.startTimeMillis);case"Composite":return N0(Gl(e.left),Gl(e.right))}},oz=e=>x({_tag:me("Die"),defect:e}),iz=x({_tag:me("Empty")}),cz=e=>x({_tag:me("Fail"),error:e}),az=x({_tag:me("Interrupt"),fiberId:yg}),uz=e=>x({_tag:me("Parallel"),left:e,right:e}),lz=e=>x({_tag:me("Sequential"),left:e,right:e}),bg=(e,t)=>{const n=hg(()=>r),r=Oe(iz,cz(e),oz(t),az,lz(n),uz(n)).annotations({title:`CauseEncoded<${ig(e)}>`});return r},fz=(e,t)=>n=>n.letrec(r=>({Empty:n.record({_tag:n.constant("Empty")}),Fail:n.record({_tag:n.constant("Fail"),error:e(n)}),Die:n.record({_tag:n.constant("Die"),defect:t(n)}),Interrupt:n.record({_tag:n.constant("Interrupt"),fiberId:sz(n)}),Sequential:n.record({_tag:n.constant("Sequential"),left:r("Cause"),right:r("Cause")}),Parallel:n.record({_tag:n.constant("Parallel"),left:r("Cause"),right:r("Cause")}),Cause:n.oneof(r("Empty"),r("Fail"),r("Die"),r("Interrupt"),r("Sequential"),r("Parallel"))})).Cause.map(Os),hz=e=>t=>{const n=r=>{switch(r._tag){case"Empty":return"Cause.empty";case"Fail":return`Cause.fail(${e(r.error)})`;case"Die":return`Cause.die(${FN(r)})`;case"Interrupt":return`Cause.interrupt(${Sg(r.fiberId)})`;case"Sequential":return`Cause.sequential(${n(r.left)}, ${n(r.right)})`;case"Parallel":return`Cause.parallel(${n(r.left)}, ${n(r.right)})`}};return n(t)},Fv=e=>(t,n,r)=>vN(t)?$v(e(Go(t),n),Os,r,t):Bo(new at(r,t)),dz=({defect:e,error:t})=>Vo([t,e],{decode:(n,r)=>Fv(Ll(bg(n,r))),encode:(n,r)=>Fv(xc(bg(n,r)))},{title:`Cause<${t.ast}>`,pretty:hz,arbitrary:fz});function Os(e){switch(e._tag){case"Empty":return Uu;case"Fail":return qu(e.error);case"Die":return Fd(e.defect);case"Interrupt":return T_(Gl(e.fiberId));case"Sequential":return kN(Os(e.left),Os(e.right));case"Parallel":return EN(Os(e.left),Os(e.right))}}function Go(e){switch(e._tag){case"Empty":return{_tag:"Empty"};case"Fail":return{_tag:"Fail",error:e.error};case"Die":return{_tag:"Die",defect:e.defect};case"Interrupt":return{_tag:"Interrupt",fiberId:e.fiberId};case"Sequential":return{_tag:"Sequential",left:Go(e.left),right:Go(e.right)};case"Parallel":return{_tag:"Parallel",left:Go(e.left),right:Go(e.right)}}}const mz=({defect:e,error:t})=>{const n=og(t),r=og(e);return Ar(bg(n,r),dz({error:qc(n),defect:Ul}),{strict:!1,decode:Os,encode:Go})},Ql=Ar(Ul,Ul,{strict:!0,decode:e=>{if(Dn(e)&&"message"in e&&typeof e.message=="string"){const t=new Error(e.message,{cause:e});return"name"in e&&typeof e.name=="string"&&(t.name=e.name),t.stack="stack"in e&&typeof e.stack=="string"?e.stack:"",t}return String(e)},encode:e=>e instanceof Error?{name:e.name,message:e.message}:String(e)}).annotations({identifier:"Defect"});class Qo extends wI("@effect/platform/Transferable/Collector")(){}const Pv=()=>{const e=[],t=s=>{for(const o of s)e.push(o)},n=()=>e,r=()=>{e.length=0};return Qo.of({unsafeAddAll:t,addAll:s=>Y(()=>t(s)),unsafeRead:n,read:Y(n),unsafeClear:r,clear:Y(r)})},gz=e=>C(KD(Qo),ze({onNone:()=>H,onSome:t=>t.addAll(e)})),Mv=l(2,(e,t)=>zc(Zk(e),e,{strict:!0,decode:zo,encode:n=>$r(gz(t(n)),n)})),Nr=Mv(_t,e=>[e]),Yo=Mv(dg,e=>[e.buffer]),pz=Yk,yz=e=>ev(e[pz])(e),Yl=Xk,Av=e=>e[Yl].failure,Nv=e=>e[Yl].success,Sz=l(2,(e,t)=>cg(e[Yl].failure)(t)),bz=l(2,(e,t)=>cg(e[Yl].success)(t)),_g=Symbol.for("@effect/platform/WorkerError"),_z=e=>N(e,_g),xr=class xr extends(MT=Ts()("WorkerError",{reason:me("spawn","decode","send","unknown","encode"),cause:Ql}),PT=_g,MT){constructor(){super(...arguments);a(this,PT,_g)}get message(){switch(this.reason){case"send":return"An error occurred calling .postMessage";case"spawn":return"An error occurred while spawning a worker";case"decode":return"An error occurred during decoding";case"encode":return"An error occurred during encoding";case"unknown":return"An unexpected error occurred"}}};a(xr,"Cause",mz({error:xr,defect:Ql})),a(xr,"encodeCause",gj(xr.Cause)),a(xr,"decodeCause",mj(xr.Cause));let kt=xr;const xv=Symbol.for("@effect/platform/Worker/PlatformWorker"),wg=Vt("@effect/platform/Worker/PlatformWorker"),Dv=Symbol.for("@effect/platform/Worker/WorkerManager"),Hc=Vt("@effect/platform/Worker/WorkerManager"),Lv=Vt("@effect/platform/Worker/Spawner"),wz=iL(Hc,de(function*(){const e=yield*wg;let t=0;return Hc.of({[Dv]:Dv,spawn({encode:n,initialMessage:r}){return de(function*(s){const o=t++;let i=0;const c=new Map,u=Pv(),f=n?y=>ke(u.clear,fc(n(y),Qo,u)):oe,d=yield*Ke(),m=yield*e.spawn(o);yield*m.run(y=>y[0]===0?AF(d,H):p(y[1])).pipe(ND(y=>St(c.values(),E=>gr in E?Ni(E,y):be(E,Ye(y)))),cw(PE(1e3)),tl({package:"@effect/platform",module:"Worker"}),ln,Cn),yield*Jd(()=>ke(St(c.values(),y=>gr in y?vS(y):be(y,Ye(Uu)),{discard:!0}),Y(()=>c.clear())));const p=y=>xe(()=>{const E=c.get(y[0]);if(!E)return H;switch(y[1]){case 0:return gr in E?yt(E,y[2][0]):be(E,It(y[2]));case 1:return y.length===2?gr in E?vS(E):be(E,Ye(Uu)):gr in E?yt(E,y[2][0]):ke(be(E,It(y[2])),be(E,Ye(Uu)));case 2:case 3:{if(y[1]===2)return gr in E?kS(E,y[2]):be(E,gu(y[2]));const O=kt.decodeCause(y[2]);return gr in E?Ni(E,O):be(E,Ye(O))}}}),g=(y,E)=>Qu(O=>{const U=O.getFiberRef(YD),J=ar(U,aP).pipe(RO(M=>M._tag==="Span")),j=i++;return E.pipe(Lt(M=>(c.set(j,M),f(y).pipe(Lt(D=>m.send([j,0,D,J._tag==="Some"?[J.value.traceId,J.value.spanId,J.value.sampled]:void 0],u.unsafeRead())),vr(D=>gr in M?Ni(M,D):be(M,Ye(D)))))),V(M=>({id:j,queue:M})))}),b=({id:y},E)=>{const O=Y(()=>c.delete(y));return Ah(E)?ke(HD(m.send([y,1])),O):O},S=y=>kU(BK(g(y,gc()),({queue:E})=>{const O=BE(pc(E),un({onFailure:U=>TN(U)?HK:WK(U),onSuccess:U=>BE(VK(Jt(U)),()=>O)}));return O},b)),_=y=>uw(g(y,Ke()),({queue:E})=>Se(E),b);return yield*Se(d),r&&(yield*Y(r).pipe(C(_),Tr(y=>new kt({reason:"spawn",cause:y})))),{id:o,execute:S,executeEffect:_}})}})})),Ez=e=>de(function*(){const n=yield*(yield*Hc).spawn({...e,encode(o){return Tr(yz(o),i=>new kt({reason:"encode",cause:i}))}}),r=o=>{const i=Kl(Nv(o)),c=Kl(Av(o));return h(n.execute(o),wU(u=>C(c(u),ac)),TU(i))},s=o=>{const i=Kl(Nv(o)),c=Kl(Av(o));return gw(n.executeEffect(o),{onFailure:u=>C(c(u),ac),onSuccess:i})};return R({id:n.id,execute:r,executeEffect:s})}),kz=e=>de(function*(){const t=yield*Hc,n=new Set,r=h(Ez(e),Lt(i=>Y(()=>n.add(i))),Lt(i=>Jd(()=>Y(()=>n.delete(i)))),e.onCreate?Lt(e.onCreate):R,fc(Hc,t)),s=yield*"timeToLive"in e?_U({acquire:r,min:e.minSize,max:e.maxSize,concurrency:e.concurrency,targetUtilization:e.targetUtilization,timeToLive:e.timeToLive}):bU({acquire:r,size:e.size,concurrency:e.concurrency,targetUtilization:e.targetUtilization}),o={backing:s,broadcast:i=>St(n,c=>c.executeEffect(i),{concurrency:"unbounded",discard:!0}),execute:i=>MU(V(s.get,c=>c.execute(i))),executeEffect:i=>Co(C(s.get,c=>c.executeEffect(i)))};return yield*Co(s.get),o}),vz=e=>ww(Lv,e),$z=()=>e=>wg.of({[xv]:xv,spawn(t){return de(function*(n){const r=yield*Lv;let s;const o=[];return{run:u=>Io(f=>Bu().pipe(fw("scope"),hc("port",({scope:d})=>e.setup({worker:r(t),scope:d})),Lt(({port:d,scope:m})=>(s=d,wr(m,Y(()=>{s=void 0})))),hc("fiberSet",({scope:d})=>HE().pipe(oc(d))),hc("runFork",({fiberSet:d})=>GE(d)()),Lt(({fiberSet:d,port:m,runFork:p,scope:g})=>e.listen({port:m,scope:g,emit(b){p(u(b))},deferred:d.deferred})),Lt(({port:d})=>{if(o.length>0){for(const[m,p]of o)d.postMessage([0,m],p);o.length=0}}),C(({fiberSet:d,scope:m})=>f(QE(d)).pipe(Ir(fs(m,pr)))))),send:(u,f)=>aw({try:()=>{s===void 0?o.push([u,f]):s.postMessage([0,u],f)},catch:d=>new kt({reason:"send",cause:d})})}})}}),Tz=wg,Oz=wz,Iz=kz,Cz=vz,Rz=Symbol.for("@effect/platform/Runner/PlatformRunner"),Kv=Vt("@effect/platform/Runner/PlatformRunner"),Fz=(e,t)=>de(function*(){const r=yield*(yield*Kv).start(),s=new Map;return yield*r.run((o,[i,c,u,f])=>{if(c===1){const d=s.get(i);return d?Er(d):H}return Qu(d=>(s.set(i,d),t!=null&&t.decode?t.decode(u):oe(u))).pipe(C(d=>{const m=Pv(),p=e(d);let g=kr(p)?C(p,b=>h(t!=null&&t.encodeOutput?fc(t.encodeOutput(d,b),Qo,m):oe(b),C(S=>r.send(o,[i,0,[S]],m.unsafeRead())))):h(p,RU(b=>{if((t==null?void 0:t.encodeOutput)===void 0){const S=At(b);return r.send(o,[i,0,S])}return m.unsafeClear(),h(St(b,S=>t.encodeOutput(d,S)),fc(Qo,m),C(S=>r.send(o,[i,0,S],m.unsafeRead())))}),Zu(r.send(o,[i,1])));return f&&(g=GD(g,{_tag:"ExternalSpan",traceId:f[0],spanId:f[1],sampled:f[2],context:qn()})),Io(b=>b(g).pipe(FD(_z,S=>r.send(o,[i,3,kt.encodeCause(qu(S))])),vr(S=>gt(ju(S),{onLeft:_=>(m.unsafeClear(),h(t!=null&&t.encodeError?fc(t.encodeError(d,_),Qo,m):oe(_),C(y=>r.send(o,[i,2,y],m.unsafeRead())),vr(y=>r.send(o,[i,3,kt.encodeCause(y)])))),onRight:_=>r.send(o,[i,3,kt.encodeCause(_)])}))))}),Ir(Y(()=>s.delete(i))))})}),Pz=(e,t)=>Qu(n=>Fz(e,t).pipe(dc(pw),cw(PE(1e3)),tl({package:"@effect/platform-node",module:"WorkerRunner"}),Ir(Vx(n,n.id())),ln,Cn,Xu)),Mz=(e,t)=>de(function*(n){const r=yield*n(Gd);let s=qn();const o=tv(e);return yield*n(Pz(i=>{const c=t[i._tag](i);return sL(c)?C(oL(c,r),u=>Y(()=>{s=Br(s,u)})):kr(c)?Ro(c,s):IU(c,s)},{decode(i){return Tr(o(i),c=>new kt({reason:"decode",cause:c}))},encodeError(i,c){return Tr(Sz(i,c),u=>new kt({reason:"encode",cause:u}))},encodeOutput(i,c){return vr(bz(i,c),u=>new kt({reason:"encode",cause:u}))}}))}),Az=(e,t)=>uL(Mz(e,t)),Uv=Rz,qv=Kv,Nz=Az,xz=e=>(t,n)=>{const r=[];return Eg(e.ast,t,n,"",r),r},Eg=(e,t,n,r,s)=>{if(Qk({ast:e})(t,n)===!1)if(Il(e))if(Dz(e)){s.push({path:r,a:t,b:n,ast:e});return}else for(const i of e.types)try{Eg(i,t,n,r,s);return}catch{}else if(Ol(e)){const i=Pl(e);for(const c of i)Eg(c.type,t[c.name],n[c.name],`${r}.${c.name.toString()}`,s)}else s.push({path:r,a:t,b:n,ast:e})},Dz=e=>{if(Il(e))return e.types.every(t=>Ol(t)===!1?!1:Pl(t).some(r=>r.name.toString()==="_tag"))},jv=({channelName:e,listenSchema:t,sendSchema:n})=>de(function*(){const r=new BroadcastChannel(e);yield*Jd(()=>aw(()=>r.close()).pipe(iw));const s=c=>de(function*(){const u=yield*cg(n)(c);r.postMessage(u)}),o=AU(r,"message").pipe($U(c=>Tj(t)(c.data))),i=yield*Ke();return{send:s,listen:o,closedDeferred:i}}).pipe(mc(`WebChannel:broadcastChannel(${e})`));var Is;(function(e){e[e.INTERNAL=0]="INTERNAL",e[e.SERVER=1]="SERVER",e[e.CLIENT=2]="CLIENT",e[e.PRODUCER=3]="PRODUCER",e[e.CONSUMER=4]="CONSUMER"})(Is||(Is={}));const Lz=Symbol.for("@effect/opentelemetry/Tracer/OtelSpan");Is.INTERNAL,Is.CLIENT,Is.SERVER,Is.PRODUCER,Is.CONSUMER;const Kz=C(JD,e=>Lz in e?oe(e.span):ac(new RN)),Uz=Ew(Oz,ww(Tz,$z()({setup({scope:e,worker:t}){const n="port"in t?t.port:t;return $r(wr(e,Y(()=>{n.postMessage([1])})),n)},listen({deferred:e,emit:t,port:n,scope:r}){function s(i){t(i.data)}function o(i){xi(e,new kt({reason:"unknown",cause:i.error??i.message}))}return n.addEventListener("message",s),n.addEventListener("error",o),"start"in n&&n.start(),wr(r,Y(()=>{n.removeEventListener("message",s),n.removeEventListener("error",o)}))}}))),qz=e=>aL(Uz,Cz(e)),kg=Q("@effect/platform-browser/Worker/cachedPorts",()=>new Set);function jz(e){kg.add(e.ports[0])}typeof self<"u"&&"onconnect"in self&&(self.onconnect=jz);const zz=e=>qv.of({[Uv]:Uv,start(){return Y(()=>{let t=0;const n=new Map;return{run:o=>Io(i=>Bu().pipe(fw("scope"),hc("fiberSet",({scope:c})=>HE().pipe(oc(c))),hc("runFork",({fiberSet:c})=>GE(c)()),Lt(({fiberSet:c,runFork:u,scope:f})=>{function d(S){return function(_){const y=_.data;if(y[0]===0)u(i(o(S,y[1])));else{const E=n.get(S);E&&Xd(fs(E[1],pr)),n.delete(S),n.size===0&&xi(c.deferred,LF(fr))}}}function m(S){xi(c.deferred,new kt({reason:"decode",cause:S.data}))}function p(S){xi(c.deferred,new kt({reason:"unknown",cause:S.data}))}function g(S){return Ld(f,zi).pipe(C(_=>{const y=t++;n.set(y,[S,_]);const E=d(y);return S.addEventListener("message",E),S.addEventListener("messageerror",m),"start"in S&&S.start(),S.postMessage([0]),wr(_,Y(()=>{S.removeEventListener("message",E),S.removeEventListener("messageerror",p)}))}),u)}e.addEventListener("error",p);let b;if("onconnect"in e){b=e.onconnect,e.onconnect=function(S){const _=S.ports[0];g(_)};for(const S of kg)g(S);kg.clear()}else g(e);return wr(f,Y(()=>{e.removeEventListener("error",p),"onconnect"in e&&(e.onconnect=b),e.close()}))}),C(({fiberSet:c,scope:u})=>i(QE(c)).pipe(Ir(fs(u,pr)))))),send:(o,i,c)=>Y(()=>{var u;(((u=n.get(o))==null?void 0:u[0])??e).postMessage([1,i],{transfer:c})})}})}}),Bz=lL(qv,()=>zz(self)),zv=e=>e!==void 0,Wz={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};var Bv={};const Xl=(e,...t)=>{if(console.error(e,...t),Jz())debugger;throw new Error(`This should never happen: ${e}`)},Hz=e=>{const t=new Map;return n=>{if(t.has(n))return t.get(n);const r=e(n);return t.set(n,r),r}},Vz=e=>typeof e=="string"&&e.length>0,Jz=Hz(()=>{if(Wz===void 0)return typeof process<"u"&&Bv!==void 0?Bv.DEV:!1}),Gz=()=>{const e=globalThis.name;return Vz(e)?e:typeof window=="object"?"Browser Main Thread":"unknown-thread"},Cs=e=>dc(e,t=>de(function*(){if(nc(t))return;const n=yield*Kz.pipe(PD("NoSuchElementException",o=>oe(void 0))),r=Gz(),s=t.toString().split(`
`)[0];yield*WD(`Error on ${r}: ${s}`,t).pipe(o=>n===void 0?o:tl({spanId:n.spanContext().spanId,traceId:n.spanContext().traceId})(o))})),Wv=({label:e,duration:t})=>n=>de(function*(){const r=yield*Sw();let s=!1;const o=DD(t).pipe(Lt(()=>(s=!0,yw(`${e}: Took longer than ${t}ms`))),Ro(r),Xd),i=Date.now(),c=yield*n;if(s){const u=Date.now();yield*yw(`${e}: Actual duration: ${u-i}ms`)}return yield*Er(o),c}),vg=e=>{const t=["text","integer","real","blob"];return typeof e=="object"&&e!==null&&"columnType"in e&&t.includes(e.columnType)},Hv=Symbol.for("NoDefault"),Qz=e=>typeof e=="object"&&e!==null&&"sql"in e&&typeof e.sql=="string",Vv=e=>t=>{const n=(t==null?void 0:t.nullable)??!1,r=(t==null?void 0:t.schema)??Yz(e),s=n===!0?iv(r):r,o=(t==null?void 0:t.default)===void 0||t.default===Hv?$():T(t.default);return{columnType:e,schema:s,default:o,nullable:n,primaryKey:(t==null?void 0:t.primaryKey)??!1}},Sn=Vv("text"),$g=Vv("integer"),Jv=(e,t)=>n=>{const r=(n==null?void 0:n.nullable)??!1,s=t._tag==="baseSchemaFn"?t.baseSchemaFn(n==null?void 0:n.schema):t.baseSchema,o=r===!0?iv(s):s,i=(n==null?void 0:n.default)===void 0||n.default===Hv?$():T(n.default);return{columnType:e,schema:o,default:i,nullable:r,primaryKey:(n==null?void 0:n.primaryKey)??!1}};Jv("integer",{_tag:"baseSchema",baseSchema:Ar(Le,Yj,{decode:e=>new Date(e),encode:e=>e.getTime()})}),Jv("integer",{_tag:"baseSchema",baseSchema:Ar(Le,Ft,{decode:e=>e===1,encode:e=>e?1:0})});const Yz=e=>{switch(e){case"text":return K;case"integer":return Le;case"real":return Le;case"blob":return dg;default:return LT()}},Xz=(e,t,n)=>{const r={_tag:"table",name:e,columns:eB(t),indexes:tB(n??[])};return{name:e,columns:t,indexes:n,ast:r}},Zz=e=>x(Object.fromEntries(e.ast.columns.map(t=>[t.name,t.schema]))),eB=e=>Object.entries(e).map(([t,n])=>({_tag:"column",name:t,schema:n.schema,default:n.default,nullable:n.nullable??!1,primaryKey:n.primaryKey??!1,type:{_tag:n.columnType}})),tB=e=>e.map(t=>({_tag:"index",columns:t.columns,name:t.name,unique:t.isUnique??!1})),nB=Math.pow(2,32)-1,rB=globalThis.crypto,sB=()=>Math.abs(rB.getRandomValues(new Uint32Array(1))[0]/nB),Tg=(e,t)=>{const n="000000000"+e;return n.slice(n.length-t)},oB=Object.keys(typeof window=="object"?window:self).length,iB=navigator.product==="ReactNative"?"rn":Tg(navigator.userAgent.length.toString(36)+oB.toString(36),4),cB=()=>iB;let Vc=0;const Og=4,Zl=36,Gv=Math.pow(Zl,Og),Qv=()=>Tg(Math.trunc(sB()*Gv).toString(Zl),Og),aB=()=>(Vc=Vc<Gv?Vc:0,Vc++,Vc-1),uB=()=>{const e="c",t=Date.now().toString(Zl),n=Tg(aB().toString(Zl),Og),r=cB(),s=Qv()+Qv();return e+t+n+r+s},ef=(e,t,n,r)=>{const s=o=>({mutation:e,args:o,id:uB()});return Object.defineProperty(s,"name",{value:e}),Object.defineProperty(s,"schema",{value:t}),Object.defineProperty(s,"sql",{value:n}),Object.defineProperty(s,"options",{value:{localOnly:(r==null?void 0:r.localOnly)??!1}}),s};ef("livestore.RawSql",x({sql:K,bindValues:Pr(Hl({key:K,value:_t})),writeTables:Pr(mg(K))}),({sql:e,bindValues:t,writeTables:n})=>({sql:e,bindValues:t??{},writeTables:n})),x({mutation:K,args:_t,id:K}).annotations({title:"MutationEventSchema.DecodedAny"});const Yv=x({mutation:K,args:_t,id:K}).annotations({title:"MutationEventSchema.EncodedAny"}),lB=(e,t)=>h(e.sqliteDef.columns,KO((n,r)=>(t==null?void 0:t[r])!==void 0?!0:r==="id"?!1:n.default._tag==="None"||Qz(n.default.value)===!1),Ef((n,r)=>(t==null?void 0:t[r])===void 0?n.default._tag==="None"?n.nullable===!0?null:Xl(`Column ${r} has no default value and is not nullable`):Dc(n.schema)(n.default.value):t[r])),Xv=Oe(K,Le,Qj,rv),Zv=Oe(wt(Xv),Hl({key:K,value:Xv})).pipe(Kj("PreparedBindValues")),tf=(e,...t)=>{let n="";for(const[r,s]of t.entries())n+=e[r]+String(s);return n+e[e.length-1]},e$=e=>Object.entries(e),fB=e=>[">","<","="].includes(e),hB=({tableName:e,columns:t,values:n,options:r={orReplace:!1}})=>{const s=Object.keys(n).join(", "),o=Object.keys(n).map(i=>`$${i}`).join(", ");return[tf`INSERT ${r.orReplace?"OR REPLACE ":""}INTO ${e} (${s}) VALUES (${o})`,nf({columns:t,values:n})]},dB=({columns:e,tableName:t,updateValues:n,where:r})=>{const s=gB(n);if(Object.keys(s).length===0)return[tf`select 1`,{}];const o=Object.keys(s).map(f=>`${f} = $update_${f}`).join(", "),i={...nf({columns:e,values:s,variablePrefix:"update_"}),...nf({columns:e,values:r,variablePrefix:"where_",skipNil:!0})},c=t$({where:r}),u=c===""?"":`WHERE ${c}`;return[tf`UPDATE ${t} SET ${o} ${u}`,i]},mB=({columns:e,tableName:t,where:n})=>{const r={...nf({columns:e,values:n,variablePrefix:"where_",skipNil:!0})},s=t$({where:n}),o=s===""?"":`WHERE ${s}`;return[tf`DELETE FROM ${t} ${o}`,r]},nf=({columns:e,values:t,variablePrefix:n="",skipNil:r})=>{const s=h(e,e$,Un(([o,i])=>[o,c=>{if(i.nullable===!0&&c==null)return null;const u=vj(i.schema)(c);if(u._tag==="Left"){const f=Qq(u.left),d=String(i.schema.ast);console.error(`Error making bind values for SQL query for column "${o}".

Expected schema: ${d}

Error: ${f}

Value:`,c);debugger;throw u.left}else return u.right}]),Object.fromEntries);return h(Object.entries(t).filter(([,o])=>r!==!0||o!=null).flatMap(([o,i])=>{const c=s[o]??Xl(`No codec found for column "${o}"`);if(typeof i=="object"&&i!==null&&"op"in i)switch(i.op){case"in":return i.val.map((u,f)=>[`${n}${o}_${f}`,c(u)]);case"=":case">":case"<":return[[`${n}${o}`,c(i.val)]];default:throw new Error(`Unknown op: ${i.op}`)}else return[[`${n}${o}`,c(i)]]}),Object.fromEntries)},t$=({where:e})=>{const t=(n,r)=>r===null?"IS NULL":typeof r=="object"&&typeof r.op=="string"&&fB(r.op)?`${r.op} $where_${n}`:typeof r=="object"&&typeof r.op=="string"&&r.op==="in"?`in (${r.val.map((s,o)=>`$where_${n}_${o}`).join(", ")})`:`= $where_${n}`;return h(e,e$,Un(([n,r])=>`${n} ${t(n,r)}`),zr(" AND "))},gB=e=>Object.fromEntries(Object.entries(e).filter(([,t])=>t!==void 0)),pB=e=>({insert:yB(e),update:SB(e),delete:bB(e)}),yB=e=>{const t=e.sqliteDef.name,[n,r]=UO(e.sqliteDef.columns,o=>o.nullable===!1&&o.default._tag==="None"),s=x(Ef(r,o=>o.schema)).pipe(fg(Vl(x(Ef(n,o=>o.schema)))));return ef(`_Derived_Create_${t}`,s,({id:o,...i})=>{const c=lB(e,i),[u,f]=hB({tableName:e.sqliteDef.name,columns:e.sqliteDef.columns,values:{...c,id:o}});return{sql:u,bindValues:f,writeTables:new Set([t])}},{localOnly:e.options.deriveMutations.localOnly})},SB=e=>{const t=e.sqliteDef.name;return ef(`_Derived_Update_${t}`,x({where:Vl(e.schema),values:Vl(e.schema)}),({where:n,values:r})=>{const[s,o]=dB({tableName:e.sqliteDef.name,columns:e.sqliteDef.columns,where:n,updateValues:r});return{sql:s,bindValues:o,writeTables:new Set([t])}},{localOnly:e.options.deriveMutations.localOnly})},bB=e=>{const t=e.sqliteDef.name;return ef(`_Derived_Delete_${t}`,x({where:Vl(e.schema)}),({where:n})=>{const[r,s]=mB({tableName:e.sqliteDef.name,columns:e.sqliteDef.columns,where:n});return{sql:r,bindValues:s,writeTables:new Set([t])}},{localOnly:e.options.deriveMutations.localOnly})},Ig=(e,t,n)=>{const r=e,s={isSingleton:(n==null?void 0:n.isSingleton)??!1,disableAutomaticIdColumn:(n==null?void 0:n.disableAutomaticIdColumn)??!1,deriveMutations:(n==null?void 0:n.deriveMutations)===!0?{enabled:!0,localOnly:!1}:(n==null?void 0:n.deriveMutations)===!1?{enabled:!1}:(n==null?void 0:n.deriveMutations)===void 0?{enabled:!1}:{enabled:!0,localOnly:n.deriveMutations.localOnly??!1},isSingleColumn:vg(t)===!0},o=vg(t)?{value:t}:t;s.disableAutomaticIdColumn===!0?o.id===void 0&&s.isSingleton===!0&&Xl(`Cannot create table ${e} with "isSingleton: true" because there is no column with name "id" and "disableAutomaticIdColumn: true" is set`):o.id===void 0&&qO(o,d=>d.primaryKey===!0)===!1&&(s.isSingleton?o.id=Sn({schema:me("singleton"),primaryKey:!0,default:"singleton"}):o.id=Sn({primaryKey:!0}));const i=Xz(r,o,(n==null?void 0:n.indexes)??[]);if(s.isSingleton)for(const d of i.ast.columns)d.nullable===!1&&d.default._tag==="None"&&Xl(`When creating a singleton table, each column must be either nullable or have a default value. Column '${d.name}' is neither.`);const c=vg(t)===!0,u=Zz(i),f={sqliteDef:i,isSingleColumn:c,options:s,schema:u};if(_B(f)){const d=pB(f);f.insert=m=>c&&s.isSingleton?d.insert({id:"singleton",value:{value:m}}):d.insert(m),f.update=m=>c&&s.isSingleton?d.update({where:{id:"singleton"},values:{value:m}}):d.update(m),f.delete=m=>d.delete(m)}return f},_B=e=>e.options.deriveMutations.enabled===!0;Ig("__livestore_schema",{tableName:Sn({primaryKey:!0}),schemaHash:$g({nullable:!1}),updatedAt:Sn({nullable:!1})},{disableAutomaticIdColumn:!0}),Ig("__livestore_schema_mutations",{mutationName:Sn({primaryKey:!0}),schemaHash:$g({nullable:!1}),updatedAt:Sn({nullable:!1})},{disableAutomaticIdColumn:!0});const wB=me("synced","pending","error","localOnly");Ig("mutation_log",{id:Sn({primaryKey:!0}),mutation:Sn({nullable:!1}),argsJson:Sn({nullable:!1,schema:kv(_t)}),schemaHash:$g({nullable:!1}),createdAt:Sn({nullable:!1}),syncStatus:Sn({schema:wB})},{disableAutomaticIdColumn:!0});const EB=x({isConnected:Ft,timestampMs:Le}),Cg=x({done:Le,total:Le}),kB=Oe(x({stage:me("loading")}),x({stage:me("migrating"),progress:Cg}),x({stage:me("rehydrating"),progress:Cg}),x({stage:me("syncing"),progress:Cg}),x({stage:me("done")})),ir=class ir extends Ts()("LiveStore.UnexpectedError",{cause:Ql,note:Pr(K),payload:Pr(_t)}){};a(ir,"mapToUnexpectedError",t=>t.pipe(Cs,Tr(n=>Lc(ir)(n)?n:new ir({cause:n})),RD(n=>new ir({cause:n})))),a(ir,"mapToUnexpectedErrorStream",t=>t.pipe(OU(n=>Lc(ir)(n)?n:new ir({cause:n}))));let Ie=ir;class n$ extends Ts()("LiveStore.IntentionalShutdownCause",{reason:me("devtools-reset","devtools-import")}){}class uH extends Ts()("LiveStore.SqliteError",{query:Pr(x({sql:K,bindValues:Oe(Hl({key:K,value:_t}),wt(_t))})),code:Pr(Le),cause:Ql}){}class lH extends Ts()("IsOfflineError",{}){}class fH extends Ts()("InvalidPushError",{message:K}){}class hH extends Ts()("InvalidPullError",{message:K}){}AT=Symbol.iterator;const sf=class sf{constructor(t){xg(this,Wt,[]);a(this,"sizeLimit");a(this,"onEvict");a(this,"push",t=>{if(wn(this,Wt).push(t),wn(this,Wt).length>this.sizeLimit){const n=wn(this,Wt).shift();n&&this.onEvict&&this.onEvict(n)}});a(this,"get",t=>wn(this,Wt)[t]);a(this,"delete",t=>{wn(this,Wt).splice(t,1)});a(this,AT,()=>wn(this,Wt)[Symbol.iterator]());a(this,"map",t=>wn(this,Wt).map(t));a(this,"clear",()=>{Dg(this,Wt,[])});a(this,"sort",t=>wn(this,Wt).sort(t));this.sizeLimit=t}get length(){return wn(this,Wt).length}};Wt=new WeakMap,a(sf,"make",(t,n=[])=>{const r=new sf(t);for(const s of n)r.push(s);return r});let Rs=sf;const vB=x({queryStr:K,bindValues:ql(Zv),durationMs:Le,rowsCount:ql(Le),queriedTables:mg(K),startTimePerfNow:Le}),$B=e=>Vo([e],{decode:t=>(n,r,s)=>{if(n instanceof Rs){const o=Ll(wt(t))([...n],r);return xl(o,i=>Rs.make(n.sizeLimit,i))}return Bo(new at(s,n))},encode:t=>(n,r,s)=>{if(n instanceof Rs){const o=xc(wt(t))([...n],r);return xl(o,i=>Rs.make(n.sizeLimit,i))}return Bo(new at(s,n))}},{description:`BoundArray<${ig(e)}>`,pretty:()=>t=>`BoundArray(${t.length})`,arbitrary:()=>t=>t.anything(),equivalence:()=>(t,n)=>t===n}),r$=e=>Ar(x({size:Le,items:wt(e)}),$B(qc(e)),{encode:t=>({size:t.sizeLimit,items:[...t]}),decode:t=>Rs.make(t.size,t.items)}),Rg=x({slowQueries:r$(vB),queryFrameDuration:Le,queryFrameCount:Le,events:r$(Mj(K,_t))});Uj(Rg);var TB={name:"@livestore/common",version:"0.0.57",type:"module",exports:{".":{types:"./dist/index.d.ts",default:"./dist/index.js"},"./sql-queries":{types:"./dist/sql-queries/index.d.ts",default:"./dist/sql-queries/index.js"},"./schema":{types:"./dist/schema/index.d.ts",default:"./dist/schema/index.js"}},types:"./dist/index.d.ts",typesVersions:{"*":{schema:["./dist/schema/index.d.ts"],"sql-queries":["./dist/sql-queries/index.d.ts"]}},dependencies:{"@opentelemetry/api":"^1.9.0","@livestore/utils":"0.0.57","effect-db-schema":"0.0.57"},devDependencies:{vitest:"^2.0.4"},publishConfig:{access:"public"},scripts:{test:"vitest"}};const OB=TB.version,IB=K,CB=K,RB=me(OB),Fg=(e,t)=>Et(e,{liveStoreVersion:RB,...t}).annotations({identifier:e}),rf=(e,t)=>Fg(e,{appHostId:CB,...t}),Z=(e,t)=>rf(e,{requestId:IB,...t});class FB extends Z("LSD.SnapshotReq",{}){}class PB extends Z("LSD.SnapshotRes",{snapshot:Yo}){}class MB extends Z("LSD.LoadDatabaseFileReq",{data:Yo}){}class AB extends Z("LSD.LoadDatabaseFileRes",{status:me("ok","unsupported-file","unsupported-database")}){}class NB extends Z("LSD.DebugInfoReq",{}){}class xB extends Z("LSD.DebugInfoRes",{debugInfo:Rg}){}class DB extends Z("LSD.DebugInfoHistorySubscribe",{}){}class LB extends Z("LSD.DebugInfoHistoryRes",{debugInfoHistory:wt(Rg)}){}class KB extends Z("LSD.DebugInfoHistoryUnsubscribe",{}){}class UB extends Z("LSD.DebugInfoResetReq",{}){}class qB extends Z("LSD.DebugInfoResetRes",{}){}class jB extends Z("LSD.DebugInfoRerunQueryReq",{queryStr:K,bindValues:ql(Zv),queriedTables:mg(K)}){}class zB extends Z("LSD.DebugInfoRerunQueryRes",{}){}class BB extends Fg("LSD.MutationBroadcast",{mutationEventEncoded:Yv,persisted:Ft}){}class WB extends Z("LSD.RunMutationReq",{mutationEventEncoded:Yv,persisted:Ft}){}class HB extends Z("LSD.RunMutationRes",{}){}class VB extends Z("LSD.MutationLogReq",{}){}class JB extends Z("LSD.MutationLogRes",{mutationLog:Yo}){}class GB extends Z("LSD.ReactivityGraphSubscribe",{includeResults:Ft}){}class QB extends Z("LSD.ReactivityGraphUnsubscribe",{}){}class YB extends Z("LSD.ReactivityGraphRes",{reactivityGraph:_t}){}class XB extends Z("LSD.LiveQueriesSubscribe",{}){}class ZB extends Z("LSD.LiveQueriesUnsubscribe",{}){}class eW extends x({_tag:me("js","sql","graphql"),id:Le,label:K,runs:Le,executionTimes:wt(Le),lastestResult:_t,activeSubscriptions:wt(x({frames:wt(x({name:K,filePath:K}))}))}){}class tW extends Z("LSD.LiveQueriesRes",{liveQueries:wt(eW)}){}class nW extends Z("LSD.ResetAllDataReq",{mode:me("all-data","only-app-db")}){}class rW extends Z("LSD.ResetAllDataRes",{}){}class sW extends Z("LSD.DatabaseFileInfoReq",{}){}class s$ extends x({fileSize:Le,persistenceInfo:x({fileName:K},{key:K,value:_t})}){}class oW extends Z("LSD.DatabaseFileInfoRes",{db:s$,mutationLog:s$}){}class iW extends Z("LSD.MessagePortForStoreReq",{}){}class cW extends Z("LSD.MessagePortForStoreRes",{port:Nr}){}class aW extends Z("LSD.NetworkStatusSubscribe",{}){}class uW extends Z("LSD.NetworkStatusUnsubscribe",{}){}class lW extends Z("LSD.NetworkStatusRes",{networkStatus:EB}){}class fW extends Z("LSD.SyncingInfoReq",{}){}class hW extends x({enabled:Ft,metadata:Hl({key:K,value:_t})}){}class dW extends Z("LSD.SyncingInfoRes",{syncingInfo:hW}){}class mW extends Fg("LSD.DevtoolsReady",{}){}class gW extends rf("LSD.DevtoolsConnected",{}){}class pW extends rf("LSD.AppHostReady",{isLeaderTab:Ft}){}class o$ extends rf("LSD.Disconnect",{}){}class yW extends Z("LSD.Ping",{}){}class SW extends Z("LSD.Pong",{}){}Oe(FB,MB,VB,nW,cW,aW,uW,mW,o$,gW,WB,yW,sW,fW).annotations({identifier:"LSD.MessageToAppHostCoordinator"}),Oe(NB,DB,KB,UB,jB,GB,QB,XB,ZB).annotations({identifier:"LSD.MessageToAppHostStore"}),Oe(PB,AB,JB,rW,iW,o$,BB,pW,lW,HB,SW,oW,dW).annotations({identifier:"LSD.MessageFromAppHostCoordinator"}),Oe(xB,LB,qB,zB,YB,tW).annotations({identifier:"LSD.MessageFromAppHostStore"});const i$=K;var c$;(function(e){class t extends Et("LSD.WindowMessage.MessagePortReady",{port:Nr,appHostId:i$}){}e.MessagePortReady=t;class n extends Et("LSD.WindowMessage.ContentscriptListening",{}){}e.ContentscriptListening=n;class r extends Et("LSD.WindowMessage.LoadIframe",{}){}e.LoadIframe=r;class s extends Et("LSD.WindowMessage.StoreReady",{appHostId:i$}){}e.StoreReady=s;class o extends Oe(t,n){}e.MessageForStore=o;class i extends Oe(s,r){}e.MessageForContentscript=i})(c$||(c$={}));var a$;(function(e){class t extends Et("LSD.WebBridge.AppHostReady",{appHostId:K,isLeader:Ft}){}e.AppHostReady=t;class n extends Et("LSD.WebBridge.DevtoolsReady",{devtoolsId:K}){}e.DevtoolsReady=n;class r extends Et("LSD.WebBridge.ConnectToDevtools",{devtoolsId:K,appHostId:K,webBridgeId:K,isLeader:Ft}){}e.ConnectToDevtools=r;class s extends Et("LSD.WebBridge.AppHostWillDisconnect",{appHostId:K}){}e.AppHostWillDisconnect=s;class o extends Oe(t,n,r,s){}e.All=o,e.makeBroadcastChannel=i=>jv({channelName:`livestore-web-bridge-devtools${i?`-${i}`:""}`,listenSchema:o,sendSchema:o})})(a$||(a$={}));const bW=de(function*(){const e=new Map;globalThis.__debugDevtoolsPortDeferreds=e;const t=de(function*(){e.clear()});return{handlers:{DevtoolsWebBridgeOfferPort:({port:r,webBridgeId:s})=>de(function*(){const o=e.get(s);if(o===void 0){const i=yield*Ke();yield*yt(i,r),e.set(s,i)}else yield*yt(o,r)}).pipe(mc("@livestore/web:shared-worker:offerDevtoolsPort"),Ie.mapToUnexpectedError),DevtoolsWebBridgeWaitForPort:({webBridgeId:r})=>de(function*(){if(!e.has(r)){const i=yield*Ke();e.set(r,i)}const s=e.get(r),o=yield*Se(s);return e.delete(r),{port:o}}).pipe(mc("@livestore/web:shared-worker:waitForDevtoolsPort"),Ie.mapToUnexpectedError)},reset:t}});class _W extends Et("DedicatedWorkerDisconnectBroadcast",{}){}class u$ extends Oe(n$,_W){}const wW=e=>jv({channelName:`livestore.shutdown.${e}`,listenSchema:u$,sendSchema:u$}),l$=Et("execute",{query:K,bindValues:_t}),f$=Et("mutate",{mutationEventEncoded:x({mutation:K,args:_t,id:K}),persisted:Ft}),EW=Et("txn",{items:Oe(l$,f$)}),kW=Oe(l$,f$,EW),vW=x({type:me("opfs"),directory:Pr(K)}),$W=Oe(vW),TW=x({type:me("websocket"),url:K,roomId:K}),OW=Oe(TW);var h$;(function(e){class t extends Pt()("InitialMessage",{payload:{port:Nr},success:vs,failure:Ie}){}e.InitialMessage=t;class n extends Oe(t){}e.Request=n})(h$||(h$={}));var en;(function(e){class t extends Pt()("InitialMessage",{payload:{storageOptions:$W,needsRecreate:Ft,syncOptions:Pr(OW),devtoolsEnabled:Ft},success:vs,failure:Ie}){}e.InitialMessage=t;class n extends Pt()("BootStatusStream",{payload:{},success:kB,failure:Ie}){}e.BootStatusStream=n;class r extends Pt()("ExecuteBulk",{payload:{items:wt(kW)},success:vs,failure:Ie}){}e.ExecuteBulk=r;class s extends Pt()("Export",{payload:{},success:Yo,failure:Ie}){}e.Export=s;class o extends Pt()("GetRecreateSnapshot",{payload:{},success:Yo,failure:Ie}){}e.GetRecreateSnapshot=o;class i extends Pt()("ExportMutationlog",{payload:{},success:Yo,failure:Ie}){}e.ExportMutationlog=i;class c extends Pt()("NetworkStatusStream",{payload:{},success:x({isConnected:Ft,timestampMs:Le}),failure:Ie}){}e.NetworkStatusStream=c;class u extends Pt()("Shutdown",{payload:{},success:vs,failure:Ie}){}e.Shutdown=u;class f extends Pt()("ConnectDevtoolsStream",{payload:{port:Nr,appHostId:K,isLeaderTab:Ft},success:x({storeMessagePort:Nr}),failure:Ie}){}e.ConnectDevtoolsStream=f,e.Request=Oe(t,n,r,s,o,i,c,u,f)})(en||(en={}));var Pg;(function(e){class t extends Et("FromCoordinator",{initialMessage:en.InitialMessage,schemaKey:K}){}e.InitialMessagePayloadFromCoordinator=t;class n extends Pt()("InitialMessage",{payload:{payload:Oe(t,Et("FromWebBridge",{}))},success:vs,failure:Ie}){}e.InitialMessage=n;class r extends Pt()("UpdateMessagePort",{payload:{port:Nr},success:vs,failure:Ie}){}e.UpdateMessagePort=r;class s extends Pt()("DevtoolsWebBridgeWaitForPort",{payload:{webBridgeId:K},success:x({port:Nr}),failure:Ie}){}e.DevtoolsWebBridgeWaitForPort=s;class o extends Pt()("DevtoolsWebBridgeOfferPort",{payload:{port:Nr,webBridgeId:K},success:vs,failure:Ie}){}e.DevtoolsWebBridgeOfferPort=o;class i extends Oe(n,r,s,o,en.BootStatusStream,en.ExecuteBulk,en.Export,en.GetRecreateSnapshot,en.ExportMutationlog,en.NetworkStatusStream,en.Shutdown,en.ConnectDevtoolsStream){}e.Request=i})(Pg||(Pg={}));const IW=de(function*(){const e=yield*WU(void 0),t=yield*Ke().pipe(Zu(qi)),n=sk(e,zv).pipe(V(u=>u.worker)),r=u=>n.pipe(Zu(f=>f.executeEffect(u)),Wv({label:`@livestore/web:shared-worker:forwardRequest:${u._tag}`,duration:500}),Ie.mapToUnexpectedError,Cs),s=u=>de(function*(){const{worker:f,scope:d}=yield*sk(e,zv),m=yield*gc();return yield*wr(d,ys(m)),yield*f.execute(u).pipe(nk(g=>be(m,g)),tk,lc(d)),vU(m)}).pipe(Ie.mapToUnexpectedError,Cs,PU,Ie.mapToUnexpectedErrorStream),o=de(function*(){const u=yield*BU(e);u!==void 0&&(yield*rk(e,void 0),yield*fs(u.scope,pr).pipe(LD(Np(1)),Wv({label:"@livestore/web:shared-worker:close-previous-worker",duration:500}),iw))}),i=yield*bW,c=de(function*(){yield*pw("reset");const u=yield*Ke();yield*Eu(t,u),yield*o,yield*i.reset});return Nz(Pg.Request,{InitialMessage:u=>de(function*(){if(u.payload._tag==="FromWebBridge")return;const f=yield*cs(t),d=yield*Mh(f),m=u.payload.initialMessage;if(d){const p=yield*Se(f),g=en.InitialMessage.pipe(Lj("needsRecreate"));if(Qk(g)(m,p.initialMessage)===!1){const S=xz(g)(p.initialMessage,m);yield*new Ie({cause:{message:"Initial message already sent and was different now",diff:S,previousInitialMessage:p,newInitialMessage:m}})}}else yield*yt(f,u.payload)}),UpdateMessagePort:({port:u})=>de(function*(){const f=yield*t.get.pipe(Zu(Se));yield*o;const d=yield*Bu(),m=yield*Ke();yield*Iz({size:1,concurrency:100,initialMessage:()=>f.initialMessage}).pipe(Lt(b=>yt(m,b)),Ro(qz(()=>u)),vr(b=>new Ie({cause:b})),jD(b=>kS(m,b)),mc("@livestore/web:shared-worker:makeWorkerProxyFromPort"),Cs,oc(d),lc(d)),yield*(yield*wW(f.schemaKey)).listen.pipe(EU(),ek(Lc(n$)),nk(()=>c),tk,Cs,Cn,oc(d),lc(d));const g=yield*Se(m);yield*rk(e,{worker:g,scope:d})}).pipe(mc("@livestore/web:shared-worker:updateMessagePort"),Ie.mapToUnexpectedError,Cs),BootStatusStream:s,ExecuteBulk:r,Export:r,GetRecreateSnapshot:r,ExportMutationlog:r,Setup:r,NetworkStatusStream:s,Shutdown:r,ConnectDevtoolsStream:s,...i.handlers})}).pipe(fL);(()=>{IW.pipe(Ew(Bz),cL,Co,Cs,tl({thread:self.name}),Ro(SU),yU(Gh),Xd)})()})();
